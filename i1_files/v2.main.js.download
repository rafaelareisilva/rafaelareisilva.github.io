!function(e){try{var n=window,r=n.performance,t=n.Promise,o=n.MessageChannel,a=n.requestAnimationFrame;if(!(r&&r.mark&&t&&o&&a))return;var s=function(n){return r.mark("chunk-"+e+"-"+n)},i=!1,c=!1,u=t.resolve();s("exec-start");for(var f=0;f<5;f++)u=u.then();u.then((function(){s("exec-sync-end")}));var m=function(){i&&!c&&(s("after-paint"),c=!0)},p=new o;p.port1.onmessage=m,p.port2.postMessage(null),setTimeout(m),a((function(){i=!0,s("raf"),p.port2.postMessage(null),setTimeout(m)}))}catch(e){window.__jsPerformanceMarksError=e}}("v2.main");(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{2353:function(e,t,i){},2354:function(e,t,i){(function(t,i,s,r){window,e.exports=function(e){function t(t){for(var i,r,n=t[0],a=t[1],o=0,h=[];o<n.length;o++)r=n[o],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&h.push(s[r][0]),s[r]=0;for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i]);for(l&&l(t);h.length;)h.shift()()}var i={},s={0:0};function r(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=i,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(i,s,function(t){return e[t]}.bind(null,s));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var n=window.webpackJsonpHls=window.webpackJsonpHls||[],a=n.push.bind(n);n.push=t,n=n.slice();for(var o=0;o<n.length;o++)t(n[o]);var l=a;return r(r.s=27)}([function(e,t,i){"use strict";var s;i.d(t,"e",(function(){return s})),i.d(t,"n",(function(){return n})),i.d(t,"p",(function(){return a})),i.d(t,"l",(function(){return o})),i.d(t,"q",(function(){return l})),i.d(t,"k",(function(){return h})),i.d(t,"j",(function(){return d})),i.d(t,"i",(function(){return c})),i.d(t,"r",(function(){return u})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return p})),i.d(t,"o",(function(){return g})),i.d(t,"h",(function(){return m})),i.d(t,"a",(function(){return y})),i.d(t,"g",(function(){return v})),i.d(t,"d",(function(){return _})),i.d(t,"f",(function(){return b})),i.d(t,"m",(function(){return T})),function(e){e.Upgraded="Upgraded",e.Downgraded="Downgraded"}(s||(s={}));class r extends Error{constructor(e,t,i,s){super(s),this.type=e,this.details=t,this.fatal=i,this.reason=s}}class n extends r{constructor(e,t,i,s,r,n,a,o,l){super(e,t,i,s),this.response=r,this.decryptdata=n,this.stats=a,this.levelIds=o,this.keyErrorReason=l}}class a extends r{constructor(e,t,i,s,r,n,a,o){super(e,t,i,s),this.response=r,this.url=n,this.loader=a,this.context=o}}class o extends r{constructor(e,t,i,s,r,n,a){super(e,t,i,s),this.response=r,this.loader=n,this.frag=a}}class l extends r{constructor(e,t,i,s,r){super(e,t,i,s),this.response=r}}class h extends r{constructor(e,t,i,s,r){super(e,t,i,s),this.frag=r}}class d extends r{constructor(e,t,i,s,r,n){super(e,t,i,s),this.response=r,this.frag=n}}class c extends r{constructor(e,t,i,s){super(e,t,i,s)}}class u extends r{constructor(e,t,i,s,r){super(e,t,i,s),this.response=r}}class f extends u{constructor(e,t,i,s,r,n,a,o){super(e,t,i,s,r),this.parent=n,this.trackType=a,this.maxTotalBytes=o}}class p extends r{constructor(e,t,i,s,r){super(e,t,i,s),this.response=r}}class g extends r{constructor(e,t,i,s,r,n,a){super(e,t,i,s),this.response=r,this.bytes=n,this.frag=a}}class m extends r{constructor(e,t,i,s){super(e,t,i,s)}}class y extends Error{constructor(e){super(e)}}const v={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",KEY_SYSTEM_ERROR:"keySystemError",OTHER_ERROR:"otherError"},_={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",MANIFEST_INCOMPATIBLE_VIDEO_RANGE_ERROR:"manifestIncompatibleVideoRangeError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",SUBTITLE_TRACK_LOAD_ERROR:"subtitleTrackLoadError",SUBTITLE_TRACK_LOAD_TIMEOUT:"subtitleTrackLoadTimeout",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",KEY_SYSTEM_GENERIC_ERROR:"keySystemGenericError",CERT_LOAD_ERROR:"certificateLoadError",CERT_LOAD_TIMEOUT:"certificateLoadTimeOut",SESSION_DATA_LOAD_ERROR:"sessionDataLoadError",SESSION_DATA_LOAD_TIMEOUT:"sessionDataLoadTimeOut"},b={PlaylistNotReceived:{code:-12884,text:"Playlist not received"},CryptResponseReceivedSlowly:{code:-16833,text:"Crypt key received slowly"},LivePlaylistUpdateError:{code:-12888,text:"Live playlist not updated"},NoResponseFromMediaRequest:{code:-12889,text:"No response for fragment"},IncompatibleAsset:{code:-12927,text:"IncompatibleAsset"},CorruptStream:{code:-16041,text:"Corrupt fragment"},InternalError:{code:-12645,text:"InternalException"},CantSwitchInTime:{code:-12644,text:"CantSwitchInTime"},VideoDecoderBadDataErr:{code:-12909,text:"Buffer error"},InsufficientDataAvailable:{code:-12928,text:"Incomplete data"},AllocationFailed:{code:-12862,text:"AllocationFailed"},PlaylistErrorMissingEXTM3U:{code:-12269,text:"Response doesnt have #EXTM3U tag"},PlaylistErrorInvalidEntry:{code:-12264,text:"Invalid entry"},PlaylistErrorBadTargetDuration:{code:-12271,text:"Invalid targetduration"},NoValidAlternates:{code:-12925,text:"No valid alternates"},FormatError:{code:-12642,text:"Incorrect playlist format"}},T={SeekToUnbufferedTimeRanges:"SeekToUnbufferedTimeRanges",InvalidFormat:"InvalidFormat",FatalErrorWhileLoading:"FatalErrorWhileLoading",ApplicationInitiated:"ApplicationInitiated"}},function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_FLUSHED="hlsBufferFlushed",e.BUFFER_SOURCE_RESETTING="hlsBufferSourceResetting",e.BUFFER_SOURCE_RESET="hlsBufferSourceReset",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCH="hlsLevelSwitch",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_CHANGED="hlsLevelsChanged",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCH="hlsAudioTrackSwitch",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_CREATED="hlsSubtitleTracksCreated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.INLINE_STYLES_PARSED="hlsInlineStylesParsed",e.SESSION_DATA_PARSED="hlsSessionDataParsed",e.SESSION_DATA_LOADING="hlsSessionDataLoading",e.SESSION_DATA_LOADED="hlsSessionDataLoaded",e.SESSION_DATA_COMPLETE="hlsSessionDataComplete",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_PROGRESS="hlsFragLoadProgress",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_CAPTIONDATA="hlsFragParsingCaptiondata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSING_DATA="hlsFragParsingData",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.INTERNAL_ERROR="hlsInternalError",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_REQUEST_STARTED="hlsKeyRequestStarted",e.LICENSE_CHALLENGE_CREATED="hlsLicenseChallengeCreated",e.KEY_LOADED="hlsKeyLoaded",e.STREAM_STATE_TRANSITION="hlsStreamStateTransition",e.LICENSE_RELEASED="hlsLicenseReleased",e.UNRESOLVED_URI_LOADING="hlsUnresolvedUriLoading",e.UNRESOLVED_URI_LOADED="hlsUnresolvedUriLoaded",e.DESIRED_RATE_CHANGED="hlsDesiredRateChanged",e.PLAYER_STATE_CHANGE="hlsPlayerStateChange",e.SEEKING="hlsSeeking",e.SEEKED="hlsSeeked",e.BANDWIDTH_CHANGED="hlsBandwidthChanged",e.BUFFER_CHANGED="hlsBufferChanged",e.STALLED="hlsStalled",e.PREFERRED_HOST_CHANGED="hlsPreferredHostChanged",e.READY_FOR_NEXT_ITEM="hlsReadyForNextItem",e.ITEM_TRANSITIONED="hlsItemTransitioned",e.ITEM_EVICTED="hlsItemEvicted"}(s||(s={})),t.b=s},function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const s=()=>s;function r(e){return e<10?"0"+e:e.toString()}const n=["debug","log","info","warn","error"];class a{constructor(){this._enabled={},this.streamAndSessionIDStr=""}_fn(e,...t){return"function"!=typeof this._enabled[e]?s:(t=[`${function(){const e=new Date,t=e.getTimezoneOffset(),i=r(Math.floor(Math.abs(t)/60)),s=r(Math.abs(t)%60);let n=t<=0?"UTC+"+i:"UTC-"+i;return n=s?n+":"+s:n,e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())+" "+r(e.getHours())+":"+r(e.getMinutes())+":"+r(e.getSeconds())+"."+(e.getMilliseconds()/1e3).toFixed(3).slice(2,5)+" "+n}()}${this.streamAndSessionIDStr} | [${e}] >`,...t],this._enabled[e].bind(this,t.map(e=>"string"==typeof e?e:e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e)).join(" ")))}trace(...e){return this._fn("trace",...e)}debug(...e){return this._fn("debug",...e)}log(...e){return this._fn("log",...e)}info(...e){return this._fn("info",...e)}warn(...e){return this._fn("warn",...e)}error(...e){return this._fn("error",...e)}_set(e,t){this._enabled[e]=t||console[e]}enable(e,t){e&&(this._enabled={},(null!=t&&n.indexOf(t)>=0?n.slice(n.indexOf(t)):n).forEach(t=>this._set(t,"boolean"!=typeof e&&e[t]||console[t])))}setStreamAndSessionIDs(e,t){this.sessionID=e,this.streamID=t,this.streamAndSessionIDStr=this.getStreamAndSessionIDString()}getStreamAndSessionIDString(){return(this.sessionID?"| [SessionID: "+this.sessionID.slice(0,8):"")+(this.streamID?", StreamID: "+this.streamID+"]":"]")}}const o=new a;o.enable("undefined"==typeof globalHlsLogConfig||globalHlsLogConfig),t.b=o},function(e,t,i){"use strict";i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return a}));const s=new Set(["ac-3","mp4a.a5","mp4a.A5"]),r=new Set(["ec-3","mp4a.a6","mp4a.A6"]);function n(e){return"number"==typeof e&&isFinite(e)}const a={aac:1024,mp3:1024,ac3:1536,ec3:1536},o={isAC3:function(e){return Boolean(e&&s.has(e))},isEC3:function(e){return Boolean(e&&r.has(e))},isDolbyAtmos:function(e,t){let i=t.split("/");return Boolean(o.isEC3(e)&&i.length>1&&"JOC"===i[1])},isAAC:function(e){let t;return Boolean(e&&("aac"===e||null!==(t=e.match(/^mp4a\.40\.(.*)/))&&"34"!==t[1]))},isMP3:function(e){let t;return Boolean(e&&("mp3"===e||null!==(t=e.match(/^mp4a\.40\.(.*)/))&&"34"===t[1]))},isAVC:function(e){return Boolean(e&&e.match(/^avc[13]\.(.*)/))},isHEVC:function(e){return Boolean(e&&e.match(/^(hev|hvc)1\..*/))},isDolby:function(e){return Boolean(e&&e.match(/^dv(h1|he|a1|av)\..*/))},isVP09:function(e){return Boolean(e&&e.match(/^vp09\..*/))},isCompatibleCodecString:function(e,t){let i=e.split(","),s=t.split(","),r=i.filter(e=>o.isVideoCodec(e)),n=s.filter(e=>o.isVideoCodec(e)),a=i.filter(e=>o.isAudioCodec(e)),l=s.filter(e=>o.isAudioCodec(e)),h=0===r.length&&0===n.length||r.length===n.length&&o.isCompatibleVideoCodec(r[0],n[0]),d=0===a.length&&0===l.length||a.length===l.length&&o.isCompatibleAudioCodec(a[0],l[0]);return h&&d},isVideoCodec:function(e){return o.isAVC(e)||o.isDolby(e)||o.isHEVC(e)},isAudioCodec:function(e){return o.isAC3(e)||o.isEC3(e)||o.isAAC(e)||o.isMP3(e)},isCompatibleVideoCodec:function(e,t){return Boolean(e&&t&&(e===t||o.isDolby(e)&&o.isDolby(t)||o.isHEVC(e)&&o.isHEVC(t)||o.isAVC(e)&&o.isAVC(t)))},isCompatibleAudioCodec:function(e,t){return Boolean(e&&t&&(e===t||o.isAAC(e)&&o.isAAC(t)||o.isAC3(e)&&o.isAC3(t)||o.isEC3(e)&&o.isEC3(t)||o.isMP3(e)&&o.isMP3(t)))},getSegmentCodec:function(e){let t;if(o.isAAC(e))t="aac";else if(o.isAC3(e))t="ac3";else if(o.isEC3(e))t="ec3";else{if("mp3"!==e)throw"invalid audio config, codec "+e;t="mp3"}return t},getChannelCount:function(e){if(!e)return 0;let t=e.split("/"),i=parseInt(t[0]);return isNaN(i)?0:i}};t.b=o},function(e,t,i){"use strict";const s=Math.pow(2,32)-1;class r{static init(){var e;for(e in r.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],free:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],dec3:[],"ec-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],uuid:[],encv:[],enca:[],frma:[],schm:[],schi:[],senc:[],saio:[],saiz:[],sinf:[],tenc:[],sbgp:[],seig:[],sgpd:[],pssh:[]},r.types)r.types.hasOwnProperty(e)&&(r.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);r.HDLR_TYPES={video:t,audio:i};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);r.STTS=r.STSC=r.STCO=n,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);r.FTYP=r.box(r.types.ftyp,a,l,a,o),r.DINF=r.box(r.types.dinf,r.box(r.types.dref,s))}static set16(e,t,i){return t[i]=e>>8&255,t[i+1]=255&e,i+2}static set32(e,t,i){return t[i]=e>>24&255,t[i+1]=e>>16&255,t[i+2]=e>>8&255,t[i+3]=255&e,i+4}static box(e,...t){for(var i,s=Array.prototype.slice.call(arguments,1),r=8,n=s.length,a=n;n--;)r+=s[n].byteLength;for((i=new Uint8Array(r))[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=255&r,i.set(e,4),n=0,r=8;n<a;n++)i.set(s[n],r),r+=s[n].byteLength;return i}static hdlr(e){return r.box(r.types.hdlr,r.HDLR_TYPES[e])}static mdat(e){return r.box(r.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(s+1)),n=Math.floor(t%(s+1));return r.box(r.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}static mdia(e){let t=r.mdhd(e.info.timescale,e.info.duration),i=r.hdlr(e.type),s=r.minf(e);return r.box(r.types.mdia,t,i,s)}static mfhd(e){return r.box(r.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?r.box(r.types.minf,r.box(r.types.smhd,r.SMHD),r.DINF,r.stbl(e)):r.box(r.types.minf,r.box(r.types.vmhd,r.VMHD),r.DINF,r.stbl(e))}static moof(e,t){r.types||r.init();let i=r.traf(t,e);return r.box(r.types.moof,r.mfhd(t.sequenceNumber),i)}static moov(e){for(var t=e.length,i=[];t--;)i[t]=r.trak(e[t]);return r.box.apply(null,[r.types.moov,r.mvhd(e[0].info.timescale,e[0].info.duration)].concat(i).concat(r.mvex(e)))}static mvex(e){for(var t=e.length,i=[];t--;)i[t]=r.trex(e[t]);return r.box(r.types.mvex,...i)}static mvhd(e,t){t*=e;const i=Math.floor(t/(s+1)),n=Math.floor(t%(s+1));var a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r.box(r.types.mvhd,a)}static sdtp(e){var t,i,s=e.samples||[],n=new Uint8Array(4+s.length);for(i=0;i<s.length;i++)t=s[i].flags,n[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return r.box(r.types.sdtp,n)}static stbl(e){let t=r.stsd(e),i=r.box(r.types.stts,r.STTS),s=r.box(r.types.stsc,r.STSC),n=r.box(r.types.stsz,r.STSZ),a=r.box(r.types.stco,r.STCO);return r.box(r.types.stbl,t,i,s,n,a)}static avc1(e){var t,i,s,n=[],a=[];let o=e.info.encrypted?r.types.encv:r.types.avc1;for(t=0;t<e.config.sps.length;t++)s=(i=e.config.sps[t]).byteLength,n.push(s>>>8&255),n.push(255&s),n=n.concat(Array.prototype.slice.call(i));for(t=0;t<e.config.pps.length;t++)s=(i=e.config.pps[t]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(i));var l=r.box(r.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.config.sps.length].concat(n).concat([e.config.pps.length]).concat(a))),h=e.config.width,d=e.config.height,c=e.config.pixelRatio[0],u=e.config.pixelRatio[1],f=e.info.encrypted&&e.info.decryptdata?r.sinf(e.info.decryptdata,e.type,r.types.avc1):new Uint8Array;return r.box(o,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,255&h,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,f,r.box(r.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),r.box(r.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){var t=e.esdsConfig.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.esdsConfig).concat([6,1,2]))}static audioStsd(e){var t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static dac3(e){let t=e.extraData;return new Uint8Array([t>>16&255,t>>8&255,255&t])}static dec3(e){return e.extraDataBytes}static mp4a(e,t){let i=r.types.mp4a,s=null;e.encrypted&&e.decryptdata?(i=r.types.enca,s=r.sinf(e.decryptdata,"audio",r.types.mp4a)):s=new Uint8Array;let n=r.audioStsd(t),a=r.box(r.types.esds,r.esds(t));return r.box(i,n,a,s)}static mp3(e){return r.box(r.types[".mp3"],r.audioStsd(e))}static ac3(e,t){let i=r.types["ac-3"],s=null;return e.encrypted&&e.decryptdata?(i=r.types.enca,s=r.sinf(e.decryptdata,"audio",r.types["ac-3"])):s=new Uint8Array,r.box(i,r.audioStsd(t),r.box(r.types.dac3,r.dac3(t)),s)}static ec3(e,t){let i=r.types["ec-3"],s=null;return e.encrypted&&e.decryptdata?(i=r.types.enca,s=r.sinf(e.decryptdata,"audio",r.types["ec-3"])):s=new Uint8Array,r.box(i,r.audioStsd(t),r.box(r.types.dec3,r.dec3(t)),s)}static stsd(e){if("audio"===e.type){if("mp3"===e.config.segmentCodec&&"mp3"===e.config.codec)return r.box(r.types.stsd,r.STSD,r.mp3(e.config));if("ac3"===e.config.segmentCodec)return r.box(r.types.stsd,r.STSD,r.ac3(e.info,e.config));if("ec3"===e.config.segmentCodec)return r.box(r.types.stsd,r.STSD,r.ec3(e.info,e.config));if("aac"===e.config.segmentCodec)return r.box(r.types.stsd,r.STSD,r.mp4a(e.info,e.config));throw"unknown segmentCodec "+e.config.segmentCodec}return r.box(r.types.stsd,r.STSD,r.avc1(e))}static tkhd(e){let t=e.info.id,i=e.info.duration*e.info.timescale,n=Math.floor(i/(s+1)),a=Math.floor(i%(s+1)),o=0,l=0;return"video"===e.type&&(o=e.config.width,l=e.config.height),r.box(r.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,l>>8&255,255&l,0,0]))}static traf(e,t){const i=r.senc(e);var n=r.sdtp(e),a=i.boxData,o=a.length?r.saio(76):new Uint8Array,l=a.length?r.saiz(i.defaultSampleInfoSize,i.sampleInfoSizes):new Uint8Array,h=r.sbgp(e),d=r.sgpd(e),c=e.id,u=Math.floor(t/(s+1)),f=Math.floor(t%(s+1));return r.box(r.types.traf,r.box(r.types.tfhd,new Uint8Array([0,2,0,0,c>>24,c>>16&255,c>>8&255,255&c])),r.box(r.types.tfdt,new Uint8Array([1,0,0,0,u>>24,u>>16&255,u>>8&255,255&u,f>>24,f>>16&255,f>>8&255,255&f])),a,o,l,h,d,r.trun(e,n.length+a.length+h.length+d.length+o.length+l.length+16+20+8+16+8+8),n)}static trak(e){if("trakData"in e)return e.trakData;e.info.duration=e.info.duration||4294967295;let t=r.types.trak,i=r.tkhd(e),s=r.mdia(e);return r.box(t,i,s)}static trex(e){var t=e.info.id;return r.box(r.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){var i,s,n,a,o,l,h=e.samples||[],d=h.length,c=12+16*d,u=new Uint8Array(c);for(t+=8+c,u.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;i<d;i++)n=(s=h[i]).duration,a=s.size,o=s.flags,l=s.cts,u.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return r.box(r.types.trun,u)}static initSegment(e){r.types||r.init();var t,i=r.moov(e);return(t=new Uint8Array(r.FTYP.byteLength+i.byteLength)).set(r.FTYP),t.set(i,r.FTYP.byteLength),t}static saio(e){const t=e+4+4;return r.box(r.types.saio,new Uint8Array([0,0,0,0,0,0,0,1,t>>24&255,t>>16&255,t>>8&255,255&t]))}static saiz(e,t){isNaN(e)&&(e=0);const i=t.length;let s=0===e?new Uint8Array(t):new Uint8Array;return r.box(r.types.saiz,new Uint8Array([0,0,0,0,e,i>>24&255,i>>16&255,i>>8&255,255&i]),s)}static senc(e){const t=e.samples||[],i=t.length;let s=0,n=NaN,a=!0,o=[];if(!e.encrypted||i<=0)return{boxData:new Uint8Array,sampleInfoSizes:o,defaultSampleInfoSize:0};const l=e.defaultPerSampleIVSize?e.defaultPerSampleIVSize:0;for(const r of t)r.subsamples&&(s+=r.subsamples.length);if(s<=0)return{boxData:new Uint8Array,sampleInfoSizes:o,defaultSampleInfoSize:0};let h=new Uint8Array(2*i+i*l+6*s+4),d=this.set32(i,h,0);for(const r of t){let e=r.subsamples?r.subsamples:[],t=2;r.iv&&(h.set(r.iv,d),d+=r.iv.byteLength,t+=r.iv.byteLength),d=this.set16(e.length,h,d);for(const i of e)d=this.set16(i[0],h,d),d=this.set32(i[1],h,d),t+=6;o.push(t),isNaN(n)&&(n=t),a=a&&n===t,n=t}return{boxData:r.box(r.types.senc,new Uint8Array([0,0,0,2]),h),defaultSampleInfoSize:a?n:0,sampleInfoSizes:o}}static sinf(e,t,i){return r.box(r.types.sinf,r.frma(i),r.schm(),r.schi(e,t))}static frma(e){return r.box(r.types.frma,new Uint8Array(e))}static schm(){return r.box(r.types.schm,new Uint8Array([0,0,0,0,99,98,99,115,0,1,0,0]))}static schi(e,t){return r.box(r.types.schi,r.tenc(e,t))}static tenc(e,t){let i=0;"video"===t&&(i=25);let s=new Uint8Array(17);if(s[0]=16,e.iv&&16===e.iv.byteLength&&s.set(e.iv,1),!e.keyId)throw"tenc: no key id found in decryptdata";return r.box(r.types.tenc,new Uint8Array([1,0,0,0,0,i,1,0]),e.keyId,s)}static sbgp(e){if(!e.encrypted||0===e.samples.length||!e.samples[0].decryptdata)return new Uint8Array;let t=e.samples.length;return r.box(r.types.sbgp,new Uint8Array([0,0,0,0]),new Uint8Array(r.types.seig),new Uint8Array([0,0,0,1,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,1]))}static sgpd(e){if(!e.encrypted||0===e.samples.length||!e.samples[0].decryptdata)return new Uint8Array;let t=e.samples[0].decryptdata,i=0;"video"===e.type&&(i=25);let s=new Uint8Array(17);if(s[0]=16,t.iv&&s.set(t.iv,1),!t.keyId)throw"sgpd: no keyid in decryptdata";return r.box(r.types.sgpd,new Uint8Array([1,0,0,0]),new Uint8Array(r.types.seig),new Uint8Array([0,0,0,37,0,0,0,1]),new Uint8Array([0,i,1,0]),t.keyId,s)}static pssh(e,t,i){if(r.types||r.init(),!e)throw new TypeError("Bad system id");if(16!==e.byteLength)throw new RangeError("Invalid system id");let s,n,a;if(t){s=1,n=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){let i=t[e];if(16!==i.byteLength)throw new RangeError("Invalid key");n.set(i,16*e)}}else s=0,n=new Uint8Array;s>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;let o=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(o.buffer).setUint32(0,i.byteLength,!1),r.box(r.types.pssh,new Uint8Array([s,0,0,0]),e,a,n,o,i||new Uint8Array)}}t.a=r},function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var s,r=i(8);let n,a;const o={strToUtf8array:function(e){const t=r.a.Buffer.from(e,"utf-8");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},utf8arrayToStr:function(e){return r.a.Buffer.from(e).toString("utf-8")}};let l={strToUtf8array:function(e){const t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i},utf8arrayToStr:function(e){return String.fromCharCode.apply(null,e)}};"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder?l={strToUtf8array:function(e){return n||(n=new TextEncoder),n.encode(e)},utf8arrayToStr:function(e){return a||(a=new TextDecoder("utf-8")),a.decode(e)}}:"function"==typeof(null===(s=r.a.Buffer)||void 0===s?void 0:s.from)&&(l=o);class h{constructor(){this.transfer=[]}add(e){this.transfer.indexOf(e)<0&&this.transfer.push(e)}}t.b=l},function(e,t,i){"use strict";var s=i(8);function r(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}class n{static strToBase64Encode(e){return btoa(e)}static base64DecodeToStr(e){return atob(e)}static base64Encode(e){return btoa(String.fromCharCode(...e))}static base64UrlEncode(e){return r(n.base64Encode(e))}static base64Decode(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}}class a{static strToBase64Encode(e){return s.a.Buffer.from(e).toString("base64")}static base64DecodeToStr(e){return s.a.Buffer.from(e,"base64").toString()}static base64Encode(e){return s.a.Buffer.from(e).toString("base64")}static base64UrlEncode(e){return r(a.base64Encode(e))}static base64Decode(e){const t=s.a.Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}}const o=void 0!==s.a.Buffer?a:n;t.a=o},function(e,t,i){"use strict";i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r})),i(1);var s,r,n=i(17);function a(e){var t,i;const{cc:s,level:r}=e;return`cc:${s}/level:${r}/keyId:${(null===(t=e.decryptdata)||void 0===t?void 0:t.keyId)?n.a.hexDump(null===(i=e.decryptdata)||void 0===i?void 0:i.keyId):"clear"}`}!function(e){e.LowBuffer="LowBuffer",e.HighBuffer="HighBuffer",e.Seek="Seek"}(s||(s={})),(r||(r={})).INIT="init"},function(e,i,s){"use strict";const r=e=>e&&e.Math===Math&&e;i.a=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")()},function(e,i,s){"use strict";var r="undefined"!=typeof t&&t||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new a(n.call(setTimeout,r,arguments),clearTimeout)},i.setInterval=function(){return new a(n.call(setInterval,r,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(r,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},s(20),i.setImmediate="undefined"!=typeof self&&self.setImmediate||"undefined"!=typeof t&&t.setImmediate||this&&this.setImmediate,i.clearImmediate="undefined"!=typeof self&&self.clearImmediate||"undefined"!=typeof t&&t.clearImmediate||this&&this.clearImmediate},,,function(e,t,i){"use strict";var s,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function h(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,i,s){var r,n,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),n=e._events),a=n[t]),void 0===a)a=n[t]=i,++e._eventsCount;else if("function"==typeof a?a=n[t]=s?[i,a]:[a,i]:s?a.unshift(i):a.push(i),(r=h(e))>0&&a.length>r&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,o=l,console&&console.warn&&console.warn(o)}return e}function c(e,t,i){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,n(this.listener,this.target,e))}.bind(s);return r.listener=i,s.wrapFn=r,r}function u(e,t,i){var s=e._events;if(void 0===s)return[];var r=s[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):p(r,r.length)}function f(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),s=0;s<t;++s)i[s]=e[s];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s="error"===e,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var h=l.length,d=p(l,h);for(i=0;i<h;++i)n(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,c(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,c(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,s,r,n,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(s=this._events))return this;if(void 0===(i=s[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,n=i.length-1;n>=0;n--)if(i[n]===t||i[n].listener===t){a=i[n].listener,r=n;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(s[e]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,n=Object.keys(i);for(s=0;s<n.length;++s)"removeListener"!==(r=n[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return u(this,e,!0)},o.prototype.rawListeners=function(e){return u(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(e,t,i){"use strict";function s(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),s(i(21)),s(i(23))},function(e,t,i){"use strict";var s=i(1),r=i(0),n=i(2),a=i(5);class o{constructor(e,t){this._hasTimeStamp=!1,this._audioType=null,this._length=0,this._frames=[],this.logger=null==t?n.b:t;for(var i,s,r,a,l=0;;)if(r=o.readUTF(e,l,3),l+=3,"ID3"===r){this._minor=e[l++],this._revision=e[l++];let t=e[l++];if(128&t&&(this._unsynchronized=!0,this.logger.error("id3 tag is unsynchronized")()),64&t&&(this._hasExtendedHeader=!0,this.logger.warn("id3 tag has extended header")()),i=o.readSynchSafeUint32(e.subarray(l,l+4)),s=(l+=4)+i,this._hasExtendedHeader){let t=o.readSynchSafeUint32(e.subarray(l,l+4));this.logger.warn(`id3 tag has ${t}-byte extended header. usually 6 or 10 bytes`)(),l+=t}this.minor>2?this._parseID3Frames(e,l,s):this.logger.error("[id3] doesn't support older than v2.3 tags")(),l=s}else{if("3DI"!==r)return void((a=l-=3)&&(this.hasTimeStamp||this.logger.warn("ID3 tag found, but no timestamp")(),this._length=a,this._payload=e.slice(0,a)));l+=7}}static isHeader(e,t){return 73===e[t]&&68===e[t+1]&&51===e[t+2]}static readSynchSafeUint32(e){return 2097152*(127&e[0])+16384*(127&e[1])+128*(127&e[2])+(127&e[3])}static readUTF(e,t,i){var s="",r=t,n=t+i;do{s+=String.fromCharCode(e[r++])}while(r<n);return s}isID3Frame(e,t){return e[t+4]<128&&e[t+5]<128&&e[t+6]<128&&e[t+7]<128}decodeID3Frame(e){return"TXXX"===e.type?this.decodeTxxxFrame(e):"WXXX"===e.type?this.decodeWxxxFrame(e):"PRIV"===e.type?this.decodePrivFrame(e):"T"===e.type[0]?this.decodeTextFrame(e):{key:e.type,data:e.data}}decodeTxxxFrame(e){if(e.size<2)return;if(3!==e.data[0])return;let t=1,i=this.utf8ArrayToStr(e.data.subarray(t));return t+=i.length+1,{key:"TXXX",description:i,data:this.utf8ArrayToStr(e.data.subarray(t))}}decodeWxxxFrame(e){if(e.size<2)return;if(3!==e.data[0])return;let t=1,i=this.utf8ArrayToStr(e.data.subarray(t));return t+=i.length+1,{key:"WXXX",description:i,data:a.b.utf8arrayToStr(e.data.subarray(t))}}decodeTextFrame(e){if(e.size<2)return;if(3!==e.data[0])return;let t=e.data.subarray(1);return{key:e.type,data:this.utf8ArrayToStr(t)}}decodePrivFrame(e){if(e.size<2)return;let t=this.utf8ArrayToStr(e.data);return{key:"PRIV",info:t,data:e.data.slice(t.length+1)}}_extractID3Frame(e,t,i,s,r){let n,a=s+i;return a<=r?(this.logger.info(`[QE Critical] [id3] parsed frame id ${t} size ${i}`)(),n={type:t,data:e.slice(s,a)}):this.logger.error(`id3 frame ${t} size ${i} exceeded ${r}`)(),n}_parseID3Frames(e,t,i){for(var s,r,n,a;t+8<=i;){if(!this.isID3Frame(e,t))return void this.logger.error(`[id3] illegal id3 frame @ offset ${t}. skip this id3 tag`)();if(s=o.readUTF(e,t,4),t+=4,""===s)return void this.logger.info("[id3] empty tagId. padding.")();if(0===(r=o.readSynchSafeUint32(e.subarray(t,t+4))))return void this.logger.info("[id3] zero tag length. padding.")();t+=4,e[t++],e[t++],n=t;let h=this._extractID3Frame(e,s,r,n,i);if(h){let e=this.decodeID3Frame(h);this._frames.push(e)}switch(s){case"PRIV":if(53===r&&"com.apple.streaming.transportStreamTimestamp"===o.readUTF(e,t,44)){t+=44,t+=4;var l=1&e[t++];this._hasTimeStamp=!0,a=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,l&&(a+=47721858.84),a=Math.round(a),this._timeStamp=a}else r>=45&&"com.apple.streaming.audioDescription"===o.readUTF(e,t,36)?(t+=37,this._audioType=o.readUTF(e,t,4),t+=4,t+=r-41):t+=r;break;default:t+=r}}}utf8ArrayToStr(e){let t,i,s="",r=0,n=e.length;for(;r<n;){let n=e[r++];switch(n>>4){case 0:return s;case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(n);break;case 12:case 13:t=e[r++],s+=String.fromCharCode((31&n)<<6|63&t);break;case 14:t=e[r++],i=e[r++],s+=String.fromCharCode((15&n)<<12|(63&t)<<6|(63&i)<<0)}}}get hasTimeStamp(){return this._hasTimeStamp}get timeStamp(){return this._timeStamp}get audioType(){return this._audioType}get length(){return this._length}get payload(){return this._payload}get frames(){return this._frames}get minor(){return this._minor}get revision(){return this._revision}}var l=o;class h{bsReadAndUpdate(e,t,i){let s=this.readBits(e,t,i);return this.updateOffset(t,i),s}bsWriteAndUpdate(e,t,i,s){let r=this.writeBits(e,t,i,s);return this.updateOffset(t,i),r}bsSkip(e,t){this.updateOffset(e,t)}readBits(e,t,i){if(!e||!t)return;let s,r=t.byteOffset,n=t.usedBits;if(n>=8||n+i>32)return;let a=new Uint32Array(1),o=new Uint32Array(1),l=new Uint8Array(1);if(!(n>=8||i>32)){if(n){let t=8-n,a=i<t?t-i:0;o[0]=4278190080>>>32-t,s=(e[r]&o[0])>>>a,r+=1,i-=t}for(;i>0;){l[0]=e[r];let t=Math.min(i,8),n=8-t;o[0]=4278190080>>>24+n<<n,a[0]=(l[0]&o[0])>>n,s=s?s<<t|a[0]:a[0],r+=1,i-=t}return s}}writeBits(e,t,i,s){if(!e||!t)return;let r=t.byteOffset,n=t.usedBits;if(n>=8||n+i>32)return;let a=new Uint32Array(1),o=new Uint32Array(1),l=new Uint32Array(1),h=new Uint8Array(1);for(a[0]=s,n&&(o[0]=a[0]<<32-i,l[0]=4278190080,h[0]=(o[0]&l[0])>>>24+n,e[r]&=~(l[0]>>>24+n),e[r]|=h[0],r+=1,i-=8-n);i>0;){o[0]=a[0]<<32-i,l[0]=4278190080,h[0]=(o[0]&l[0])>>>24;let t=i<0?8-i:0;e[r]&=~(l[0]>>>24>>>t<<t),e[r]|=h[0],i-=8,r+=1}return 0}updateOffset(e,t){if(!e||!t||e.usedBits+t>32)return;let i=e.usedBits%8,s=Math.floor((i+t)/8),r=(i+t)%8;e.byteOffset+=s,e.usedBits=r}}var d=function(e,t,i){let n,a=new h,o=!1,d=0;for(;i<t.length;){if(i+8>t.length)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"error parsing ec-3, not enough data"},void e.trigger(s.b.INTERNAL_ERROR,n);let h=0;if(l.isHeader(t,i)&&(i+=h=new l(t.subarray(i)).length||0),11!==t[i]||119!==t[i+1])return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ec-3 magic"},void e.trigger(s.b.INTERNAL_ERROR,n);let c={byteOffset:i+2,usedBits:0},u=a.bsReadAndUpdate(t,c,2),f=a.bsReadAndUpdate(t,c,3);if(0===u||2===u)if(!0===o){if(0===f)break}else o=!0;else if(1!==u)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"reserved stream type"},void e.trigger(s.b.INTERNAL_ERROR,n);let p=2*(a.bsReadAndUpdate(t,c,11)+1);i+=p,d+=p+(h||0)}return d},c=function(e,t,i){let n,a={frmsiz:0,fscod:0,numblkscod:0,acmod:0,lfeon:0,bsid:0,strmtyp:0,substreamid:0,chanmape:0,chanmap:0,mixdef:0,mixdeflen:0,bsmod:0},o={fscod:0,acmod:0,lfeon:0,bsid:0,bsmod:0,chan_loc:0,data_rate:0,num_ind_sub:0,num_dep_sub:[],complexity_index_type_a:0},d=new h,c=!1,u=0;for(;i<t.length;){if(i+8>t.length)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"error parsing ec-3, not enough data"},void e.trigger(s.b.INTERNAL_ERROR,n);let h=0;if(l.isHeader(t,i)&&(i+=h=new l(t.subarray(i)).length||0),11!==t[i]||119!==t[i+1])return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ec-3 magic"},void e.trigger(s.b.INTERNAL_ERROR,n);let f={byteOffset:i+2,usedBits:0};if(a.strmtyp=d.bsReadAndUpdate(t,f,2),a.substreamid=d.bsReadAndUpdate(t,f,3),0===a.strmtyp||2===a.strmtyp){if(!0===c){if(0===a.substreamid)break}else c=!0;o.num_ind_sub++,o.num_dep_sub.push(0)}else{if(1!==a.strmtyp)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"reserved stream type"},void e.trigger(s.b.INTERNAL_ERROR,n);o.num_dep_sub[o.num_ind_sub-1]++}if(a.frmsiz=d.bsReadAndUpdate(t,f,11),a.fscod=d.bsReadAndUpdate(t,f,2),3===a.fscod?(d.bsSkip(f,2),a.numblkscod=3):a.numblkscod=d.bsReadAndUpdate(t,f,2),a.acmod=d.bsReadAndUpdate(t,f,3),a.lfeon=d.bsReadAndUpdate(t,f,1),a.bsid=d.bsReadAndUpdate(t,f,5),d.bsSkip(f,5),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,8),0===a.acmod&&(d.bsSkip(f,5),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,8)),1===a.strmtyp&&(a.chanmape=d.bsReadAndUpdate(t,f,1),a.chanmape&&(a.chanmap=d.bsReadAndUpdate(t,f,16))),d.bsReadAndUpdate(t,f,1)&&(a.acmod>2&&d.bsSkip(f,2),1&a.acmod&&a.acmod>2&&d.bsSkip(f,6),4&a.acmod&&d.bsSkip(f,6),a.lfeon&&d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,5),0===a.strmtyp)){if(d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,6),0===a.acmod&&d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,6),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,6),a.mixdef=d.bsReadAndUpdate(t,f,2),1===a.mixdef)d.bsSkip(f,5);else if(2===a.mixdef)d.bsSkip(f,12);else if(3===a.mixdef){a.mixdeflen=d.bsReadAndUpdate(t,f,5),d.bsReadAndUpdate(t,f,1)&&(d.bsSkip(f,5),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&(d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,4))),d.bsReadAndUpdate(t,f,1)&&(d.bsSkip(f,5),d.bsReadAndUpdate(t,f,1)&&(d.bsSkip(f,7),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,8)));let e=a.mixdeflen+2+(f.usedBits?1:0);f.byteOffset+=e}if(a.acmod<2&&(d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,14),0===a.acmod&&d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,14)),d.bsReadAndUpdate(t,f,1))if(0===a.numblkscod)d.bsSkip(f,5);else for(let e=0;e<a.numblkscod;e++)d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,5)}if(a.bsmod=0,d.bsReadAndUpdate(t,f,1)&&(a.bsmod=d.bsReadAndUpdate(t,f,3),d.bsSkip(f,2),2===a.acmod&&d.bsSkip(f,4),a.acmod>=6&&d.bsSkip(f,2),d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,8),0===a.acmod&&d.bsReadAndUpdate(t,f,1)&&d.bsSkip(f,8),a.fscod<3&&d.bsSkip(f,1)),0===a.strmtyp&&3!==a.numblkscod&&d.bsSkip(f,1),2===a.strmtyp){let e;(e=3===a.numblkscod?1:d.bsReadAndUpdate(t,f,1))&&d.bsReadAndUpdate(t,f,6)}if(d.bsReadAndUpdate(t,f,1)){let e=d.bsReadAndUpdate(t,f,6);if(0===a.strmtyp&&0===a.substreamid&&1===e){let e=d.bsReadAndUpdate(t,f,7),i=d.bsReadAndUpdate(t,f,1),s=d.bsReadAndUpdate(t,f,8);0===e&&1===i&&s>=1&&s<=16&&(o.complexity_index_type_a=s)}}if(a.chanmape)o.chan_loc|=a.chanmap;else{let e=[40960,16384,40960,57344,41472,57856,47104,63488];o.chan_loc|=e[a.acmod]}0===a.strmtyp&&(o.fscod=a.fscod,o.bsid=a.bsid,o.bsmod=a.bsmod,o.acmod=a.acmod,o.lfeon=a.lfeon),o.chan_loc|=a.lfeon?1:0;let p=2*(a.frmsiz+1);i+=p,u+=p+(h||0)}let f=0;for(let s=0;s<16;s++)o.chan_loc&1<<s&&f++;o.lfeon&&f++;let p=10+3*o.num_ind_sub,g=[48e3,44100,32e3][o.fscod];o.data_rate=g/1536*u*8,p=10+3*o.num_ind_sub;for(let s=0;s<o.num_ind_sub;s++)o.num_dep_sub[s]>0&&p++;o.complexity_index_type_a>0&&(p+=2);let m=new Uint8Array(p),y={byteOffset:0,usedBits:0};d.bsWriteAndUpdate(m,y,32,p),d.bsWriteAndUpdate(m,y,32,1684366131),d.bsWriteAndUpdate(m,y,13,o.data_rate),d.bsWriteAndUpdate(m,y,3,o.num_ind_sub);for(let s=0;s<o.num_ind_sub;s++)d.bsWriteAndUpdate(m,y,2,o.fscod),d.bsWriteAndUpdate(m,y,5,o.bsid),d.bsWriteAndUpdate(m,y,1,0),d.bsWriteAndUpdate(m,y,1,0===s?0:1),d.bsWriteAndUpdate(m,y,3,o.bsmod),d.bsWriteAndUpdate(m,y,3,o.acmod),d.bsWriteAndUpdate(m,y,1,o.lfeon),d.bsWriteAndUpdate(m,y,3,0),d.bsWriteAndUpdate(m,y,4,o.num_dep_sub[s]),o.num_dep_sub[s]>0?d.bsWriteAndUpdate(m,y,9,o.chan_loc):d.bsWriteAndUpdate(m,y,1,0);return o.complexity_index_type_a>0&&(d.bsWriteAndUpdate(m,y,7,0),d.bsWriteAndUpdate(m,y,1,1),d.bsWriteAndUpdate(m,y,8,o.complexity_index_type_a)),{samplerate:g,channelCount:f,segmentCodec:"ec3",codec:"ec-3",extraDataBytes:m}};class u{constructor(e,t,i,s,r){this.observer=e,this.remuxer=t,this.config=i,this.typeSupported=s,this.logger=r}static probe(e){throw new Error("Method not implemented.")}resetTimeStamp(e){}resetInitSegment(e,t,i,s){}destroy(){}}class f extends u{constructor(e,t,i,s,r){super(e,t,i,s,r),this.observer=e,this.remuxer=t,this.config=i,this.typeSupported=s,this.logger=r,this.esRemuxer=t}}class p{constructor(e,t){this.observer=e,this.config=t}resetInitSegment(){}resetTimeStamp(e){}destroy(){}}let g=[48e3,44100,32e3],m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920];var y=function(e,t){return 1536/e.samplerate*t},v=function(e,t,i){let n;if(i+8>t.length)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"error parsing ac-3, not enough data"},void e.trigger(s.b.INTERNAL_ERROR,n);if(11!==t[i]||119!==t[i+1])return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ac-3 magic"},void e.trigger(s.b.INTERNAL_ERROR,n);let a=t[i+4]>>6;if(a>=3)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ac-3 samplingRateCode:"+a},void e.trigger(s.b.INTERNAL_ERROR,n);let o=63&t[i+4],l=t[i+6]>>5,h=0;2===l?h+=2:(1&l&&1!==l&&(h+=2),4&l&&(h+=2));let d=(t[i+6]<<8|t[i+7])>>12-h&1,c=[2,1,2,3,3,4,4,5][l]+d,u=t[i+5]>>3,f=7&t[i+5];return{samplerate:g[a],channelCount:c,segmentCodec:"ac3",codec:"ac-3",extraData:a<<22|u<<17|f<<14|l<<11|d<<10|o>>1<<5}},_=function(e,t,i){let n;if(i+8>t.length)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"error parsing ac-3, not enough data"},void e.trigger(s.b.INTERNAL_ERROR,n);if(11!==t[i]||119!==t[i+1])return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ac-3 magic"},void e.trigger(s.b.INTERNAL_ERROR,n);let a=t[i+4]>>6;if(a>=3)return n={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ac-3 samplingRateCode:"+a},void e.trigger(s.b.INTERNAL_ERROR,n);let o=63&t[i+4];return 2*m[3*o+a]},b=function(e,t,i,n){let a,o,l,h,d,c=navigator.userAgent.toLowerCase(),u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(a=1+((192&t[i+2])>>>6),!((o=(60&t[i+2])>>>2)>u.length-1))return h=(1&t[i+2])<<2,h|=(192&t[i+3])>>>6,/firefox/i.test(c)?o>=6?(a=5,d=new Array(4),l=o-3):(a=2,d=new Array(2)):-1!==c.indexOf("android")?(a=2,d=new Array(2)):(a=5,d=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&o>=6?l=o-3:((n&&-1!==n.indexOf("mp4a.40.2")||!n&&1===h)&&(a=2,d=new Array(2)),l=o)),d[0]=a<<3,d[0]|=(14&o)>>1,d[1]|=(1&o)<<7,d[1]|=h<<3,5===a&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{esdsConfig:d,samplerate:u[o],channelCount:h,segmentCodec:"aac",codec:"mp4a.40."+a};e.trigger(s.b.INTERNAL_ERROR,{type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o})};const T={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],onFrame:function(e,t,i,s,r,n,a){var o=a+n*(10368e4/s);e.esSamples.push({unit:t,pts:o,dts:o}),e.len+=t.length},onNoise:function(e){n.b.warn("mpeg audio has noise: "+e.length+" bytes")()},parseFrames:function(e,t,i,s,r,n){if(i+2>s)return-1;if(255===t[i]||224==(224&t[i+1])){if(i+24>s)return-1;var a=t[i+1]>>3&3,o=t[i+1]>>1&3,l=t[i+2]>>4&15,h=t[i+2]>>2&3,d=!!(2&t[i+2]);if(1!==a&&0!==l&&15!==l&&3!==h){var c=1e3*[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160][14*(3===a?3-o:3===o?3:4)+l-1],u=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3][3*(3===a?0:2===a?1:2)+h],f=d?1:0,p=t[i+3]>>6==3?1:2,g=3===o?(3===a?12:6)*c/u+f<<2:(3===a?144:72)*c/u+f|0;return i+g>s?-1:(T.onFrame(e,t.subarray(i,i+g),c,u,p,r,n),g)}}for(var m=i+2;m<s;){if(255===t[m-1]&&224==(224&t[m]))return T.onNoise(t.subarray(i,m-1)),m-i-1;m++}return-1},parse:function(e,t,i,s){for(var r,n=t.length,a=0;i<n&&(r=T.parseFrames(e,t,i,n,a++,s))>0;)i+=r},getAudioConfig:function(e,t){let i=e[t+1]>>3&3,s=e[t+1]>>1&3,r=e[t+2]>>4&15,n=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!==i&&0!==r&&15!==r&&3!==n){let o=3===i?3-s:3===s?3:4,l=1e3*T.BitratesMap[14*o+r-1],h=3===i?0:2===i?1:2,d=T.SamplingRateMap[3*h+n],c=e[t+3]>>6==3?1:2,u=T.SamplesCoefficients[i][s],f=T.BytesInSlot[s];return{segmentCodec:"mp3",codec:"mp3",samplerate:d,channelCount:c,frameLength:parseInt(u*l/d+a,10)*f}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},probe:function(e,t){if(t+1<e.length&&T.isHeaderPattern(e,t)){let i=4,s=T.getAudioConfig(e,t),r=i;s&&s.frameLength&&(r=s.frameLength);let n=t+r;if(n===e.length||n+1<e.length&&T.isHeaderPattern(e,n))return!0}return!1}};var S=T,E=i(4),w=i(3);class I{static getTrack(e,t,i,s){let r;switch(w.b.getSegmentCodec(i)){case"aac":{let n;(n=b(e,1===s?new Uint8Array([255,241,92,64,1,127,252]):new Uint8Array([255,241,92,128,1,191,252]),0,i))&&(r={type:"audio",info:{id:t,timescale:n.samplerate,duration:0,encrypted:!1,decryptdata:void 0},config:n})}break;case"ac3":case"ec3":{let i;(i=v(e,new Uint8Array([11,119,69,17,128,64,47,132]),0))&&(r={type:"audio",info:{id:t,timescale:i.samplerate,duration:0,encrypted:!1,decryptdata:void 0},config:i})}}return r}static getSample(e,t){let i;switch(e){case"mp4a.40.2":case"mp4a.40.5":i=1===t?new Uint8Array([0,208,0,7]):new Uint8Array([33,0,3,64,104,28]);break;case"ac-3":case"ec-3":i=new Uint8Array([11,119,69,17,128,64,47,132,41,3,253,214,124,253,243,215,233,95,185,123,78,20,40,106,97,190,74,253,43,218,208,140,191,176,144,120,214,181,44,124,129,251,91,109,187,109,198,225,43,172,116,140,176,123,38,144,211,247,225,64,29,53,175,96,16,57,121,87,78,203,81,37,7,72,228,132,37,169,38,231,97,229,247,194,208,8,12,83,74,139,137,17,22,26,221,203,107,113,94,93,75,33,208,247,146,105,39,143,6,36,1,227,108,70,11,180,152,218,182,218,209,59,85,104,201,70,37,82,219,68,55,225,144,99,149,0,119,26,14,69,164,241,204,222,81,177,142,80,20,100,97,143,101,221,140,113,31,208,124,25,64,29,49,77,140,30,155,74,214,204,138,229,109,172,95,130,70,230,134,88,59,179,212,155,232,0,0,0,0,0,173,234])}return i}static getSegment(e,t,i,s){let r=I.getSample(e.config.codec,e.config.channelCount);if(!r)return;let n=[],a={id:e.info.id,sequenceNumber:t,type:"audio",encrypted:!1,samples:n,defaultPerSampleIVSize:0},o=w.a[e.config.segmentCodec],l=Math.ceil(s*e.info.timescale/o),h=0,d=l*r.byteLength+8,c=new Uint8Array(d);c[0]=d>>24&255,c[1]=d>>16&255,c[2]=d>>8&255,c[3]=255&d,E.a.types||E.a.init(),c.set(E.a.types.mdat,4),h+=8;for(var u=0;u<l;u++)n.push({duration:o,size:r.byteLength,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0,paddingValue:0}}),c.set(r,h),h+=r.byteLength;let f=E.a.moof(i,a),p=new Uint8Array(f.byteLength+c.byteLength);return p.set(f),p.set(c,f.byteLength),p}}var D=I;i(17),i(6);const L={bin2str:e=>String.fromCharCode.apply(null,e),readUint16(e,t){const i=e[t]<<8|e[t+1];return i<0?65536+i:i},readSint32:(e,t)=>e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],readUint32(e,t){const i=L.readSint32(e,t);return i<0?4294967296+i:i},writeUint32(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},findBox(e,t){let i,s,r,n,a,o=[];if(!t.length)return[];for(i=0;i<e.byteLength;)s=L.readUint32(e,i),r=L.bin2str(e.subarray(i+4,i+8)),n=s>1?i+s:e.byteLength,r===t[0]&&(1===t.length?o.push(e.subarray(i+8,n)):(a=L.findBox(e.subarray(i+8,n),t.slice(1))).length&&(o=o.concat(a))),i=n;return o},findBoxWithOffset(e,t,i,s){let r,n,a,o,l,h=[];if(!i.length)return[];for(r=0;r<e.byteLength;)n=L.readUint32(e,r),a=L.bin2str(e.subarray(r+4,r+8)),o=n>1?r+n:e.byteLength,a===i[0]&&(s&&s.push({offset:r+t,type:a,size:n}),1===i.length?h.push({offset:r+t,type:a,data:e.subarray(r+8,o),boxSize:n,walkedPath:s?s.slice(0):void 0}):(l=L.findBoxWithOffset(e.subarray(r+8,o),r+t+8,i.slice(1),s?s.slice(0):void 0)).length&&(h=h.concat(l),s=s?s.slice(0,-1):void 0)),r=o;return h}};class k extends p{constructor(e,t){super(e,t)}static _isCommonEncryptionInternal(e){return Boolean(e&&!("NONE"===e||"AES-128"===e))}static remuxInitSegment(e,t,i){if(!t)return e;let s=e;if(k._isCommonEncryptionInternal(t.method)){let r=t.keyId,a=!1,o=[];L.findBoxWithOffset(e,0,["moov","trak"]).forEach(s=>{let l,h,d=s.data,c=0,u=L.findBoxWithOffset(d,0,["mdia","minf","stbl","stsd"],[])[0],f=u.data.subarray(8),p=null,g=L.findBoxWithOffset(f,u.offset+16,["enca"])[0];g?(p=g.data.subarray(28),h="audio",c=u.offset+16+8+28):(g=L.findBoxWithOffset(f,u.offset+16,["encv"])[0])&&(p=g.data.subarray(78),h="video",c=u.offset+16+8+78),p&&L.findBoxWithOffset(p,c,["sinf"]).forEach(e=>{let s=e.data,o=L.findBox(s,["frma"])[0],c=L.findBox(s,["schm"])[0];if(!o)return void n.b.error("missing frma box")();if(!c)return void n.b.error("missing schm box")();let f=L.bin2str(c.subarray(4,8));if("aac "===L.bin2str(o.subarray(0,4))&&(E.a.types||E.a.init(),n.b.info("found frma with type 'aac ', patching to 'mp4a'")(),o.set(E.a.types.mp4a,0)),"cbcs"===f||"cenc"===f){i&&i.push(s);let e=L.findBox(s,["schi","tenc"])[0];if(e){const i=8;e.subarray(i,i+16).find((function(e){return 0!==e})),e.set(r,i);let s=e[6],n=e[7];if(1===s&&0===n){let i=e[24];i>0&&t.iv&&i===t.iv.length&&e.set(t.iv,25)}}}else if("cbc2"===f){a=!0,E.a.types||E.a.init();let i=L.findBoxWithOffset(s,0,["frma"])[0],r=E.a.box(E.a.types.schi,E.a.tenc(t,h)),n=E.a.box(E.a.types.sinf,s.subarray(i.offset,i.boxSize),E.a.schm(),r),o=(l=E.a.box(E.a.types.trak,d.subarray(0,e.offset),n,d.subarray(e.offset+e.boxSize))).subarray(8),c=n.byteLength-e.boxSize;u.walkedPath&&(u.walkedPath.push({type:"stsd",offset:g.offset,size:g.boxSize}),u.walkedPath.forEach(e=>{L.writeUint32(o,e.offset,e.size+c)}))}});let m=L.findBoxWithOffset(d,0,["edts"])[0];m&&(E.a.types||E.a.init(),d.set(E.a.types.free,m.offset+4)),l||(l=e.subarray(s.offset,s.offset+s.boxSize)),o.push(l)}),a&&(s=k.remuxCbc2InitSegment(e,o)||e)}return s}static remuxCbc2InitSegment(e,t){let i=L.findBoxWithOffset(e,0,["ftyp"])[0];if(!i)return void n.b.error("no ftyp found")();let s=L.findBoxWithOffset(e,i.boxSize,["moov"])[0],r=[],a=0;for(;a<s.data.byteLength;){let e=L.readUint32(s.data,a),i=L.bin2str(s.data.subarray(a+4,a+8)),n=e>1?a+e:s.data.byteLength;switch(i){case"trak":t&&(r=r.concat(t),t=void 0);break;default:r.push(s.data.subarray(a,n))}a=n}let o=E.a.box(E.a.types.moov,...r),l=new Uint8Array(i.boxSize+o.byteLength);return l.set(e.subarray(0,i.boxSize)),l.set(o,i.boxSize),l}static remuxOverflowSegment(e){E.a.types||E.a.init();let t,i=L.findBoxWithOffset(e,0,["moof","traf","tfdt"],[]),s=e.byteLength;if(i.forEach(e=>{0===e.data[0]&&(s+=4)}),s>e.byteLength){t=new Uint8Array(s);let i=0,r=0;for(;r<e.byteLength;){let s=L.readUint32(e,r),n=L.bin2str(e.subarray(r+4,r+8)),a=s>1?r+s:e.byteLength;if("moof"===n){let s=k.remuxOverflowMoof(e.subarray(r+8,a));t.set(s,i),i+=s.byteLength}else t.set(e.subarray(r,a),i),i+=s;r=a}}else n.b.warn("no increase in size")();return t||e}static remuxOverflowMoof(e){let t=0,i=[];for(;t<e.byteLength;){let s=L.readUint32(e,t);if("traf"===L.bin2str(e.subarray(t+4,t+8))){let r=k.remuxOverflowTraf(e.subarray(t+8,t+s));i.push(r)}else i.push(e.subarray(t,t+s));t=s>1?t+s:e.byteLength}let s=E.a.box(E.a.types.moof,...i),r=s.byteLength-e.byteLength-8;return L.findBoxWithOffset(s,0,["moof","traf","trun"],[]).forEach(e=>{if(0!=(1&e.data[3])){let t=L.readUint32(e.data,8);L.writeUint32(e.data,8,t+r)}}),s}static remuxOverflowTraf(e){let t=0,i=[];for(;t<e.byteLength;){let s=L.readUint32(e,t);if("tfdt"===L.bin2str(e.subarray(t+4,t+8))&&0===e[t+8]){let s=L.readUint32(e,t+12),r=E.a.box(E.a.types.tfdt,new Uint8Array([1,0,0,0,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s]));i.push(r)}else i.push(e.subarray(t,t+s));t=s>1?t+s:e.byteLength}return E.a.box(E.a.types.traf,...i)}remuxText(e){e.captionSamples.sort((function(e,t){return e.pts-t.pts})),e.captionSamples.length&&this.observer.trigger(s.b.FRAG_PARSING_CAPTIONDATA,{samples:e.captionSamples}),e.captionSamples=[]}remuxIFrame(e,t,i,r,n){if(!t.samples||!t.samples.length||!t.samples[0].data)return;var a=this.observer;let o,l,h=E.a.moof(e*t.timescale,t),d=new Uint8Array(h.byteLength+t.samples[0].data.byteLength+8);d.set(h),L.writeUint32(d,h.byteLength,t.samples[0].data.byteLength+8),d.set(E.a.types.mdat,h.byteLength+4),d.set(t.samples[0].data,h.byteLength+8),t.sequenceNumber++,i?(l="audiovideo",i.sequenceNumber=t.sequenceNumber,t.sequenceNumber++,o=D.getSegment(i,i.sequenceNumber,e*i.info.timescale,r)):l="video";let c={data1:d,data2:o,startPTS:e,startDTS:e,type:l,dropped:0,track:n};a.trigger(s.b.FRAG_PARSING_DATA,c),a.trigger(s.b.FRAG_PARSED)}remuxRawData(e,t,i,r,n,a,o,l){const h=this.observer;let d;t&&r?d="audiovideo":t?d="audio":r&&(d="video");let c=Math.max(i,e),u={data1:o,track:l,startPTS:a,startDTS:a,endPTS:void 0,endDTS:void 0,type:d,dropped:0};c&&(u.endPTS=a+c,u.endDTS=a+c),h.trigger(s.b.FRAG_PARSING_DATA,u),n&&n.captionSamples.length&&this.remuxText(n),h.trigger(s.b.FRAG_PARSED)}remuxEmsg(e,t,i,r,n){let a=this.observer,o="";e&&(o+="audio"),t&&(o+="video"),a.trigger(s.b.FRAG_PARSING_DATA,{data1:n,startPTS:r,startDTS:r,type:o,nb:1,dropped:0}),i&&i.id3Samples.length>0&&(this.remuxID3(i),this.emitId3Samples(i)),a.trigger(s.b.FRAG_PARSED)}emitId3Samples(e){e.id3Samples.length&&this.observer.trigger(s.b.FRAG_PARSING_METADATA,{samples:e.id3Samples})}remuxID3(e){let t;const i=e.id3Samples.length;if(i)for(let s=0;s<i;s++)(t=e.id3Samples[s]).pts=t.pts-10,t.dts=t.dts-10}}var R=k;const C=Math.pow(2,32)-1,A=Math.pow(2,20)-1;class P extends u{constructor(e,t,i,s,r){super(e,t,i,{},r),this.mp4Remuxer=t,this.audioPrimingDelay=i.audioPrimingDelay,this.audioPrimingDelay}resetTimeStamp(e){isNaN(e)?this.initPtsTs=void 0:this.initData.audio&&!this.initData.video?(this.initPtsTs={baseTime:Math.round(e*this.initData.audio.timescale/9e4),timescale:this.initData.audio.timescale},this.logger.info(`resetting audio track initPTS: ${this.initPtsTs.baseTime}/${this.initPtsTs.timescale}, seconds: ${this.initPtsTs.baseTime/this.initPtsTs.timescale}`)()):this.initPtsTs={baseTime:e,timescale:9e4}}static isHEVCFlavor(e){if(!e)return!1;let t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"chvc"===i||"qhvc"===i||"qhev"===i||"muxa"===i||"dvh1"===i||"dvhe"===i||"cdh1"===i||"qdh1"===i||"qdhe"===i}resetInitSegment(e,t,i){if(this._silentAudioTrack=void 0,e&&e.byteLength){let r=R.remuxInitSegment(e,i);const n=this.initData=P.parseInitSegment(r);let a;n.foundLargeTimescale&&this.logger.warn("large timescale found, will check for 32 bit tfdts")();const o=n.audioCodec,l=n.videoCodec;if(n.audio&&n.video?a={type:"audiovideo",container:"video/mp4",codec:o+","+l,initSegment:r}:(n.audio&&o&&(a={type:"audio",container:"audio/mp4",codec:o,initSegment:r}),n.video&&l&&(a={type:"video",container:"video/mp4",codec:l,initSegment:r})),n.video){const i=n.video,s=e.subarray(i.trakOffset,i.trakOffset+i.trakSize);this._videoTrack=Object.assign(Object.assign({},i),{info:{id:i.id,timescale:i.timescale,duration:t},trakData:s,sequenceNumber:0,samples:[]}),this.trySEICaptions=!0,this._captionTrack=Object.assign(Object.assign({},n.caption),{sequenceNumber:0,captionSamples:[]})}n.audio&&o&&(this._audioTrack=Object.assign({},n.audio)),n.caption&&(this.trySEICaptions=!1,this._captionTrack=Object.assign(Object.assign({},n.caption),{sequenceNumber:0,captionSamples:[]})),this.remuxedInitDataTrack=a;let h={track:a};this.observer.trigger(s.b.FRAG_PARSING_INIT_SEGMENT,h)}}static probe(e){return L.findBox(e.subarray(0,Math.min(e.length,512e3)),["moof"]).length>0}static parseHvcC(e){let t;if(e){let i=e[0];if(1===i){let i=e[1];t={profileSpace:i>>6,tierFlag:(32&i)>>5?"H":"L",profileIDC:31&i,profileCompat:L.readUint32(e,2),constraintIndicator:e.subarray(6,12),levelIDC:e[12]}}else n.b.warn(`Unhandled version ${i} in hvcC box`)()}else n.b.warn("No hvcC box")();return t}static hvcCToCodecString(e,t){let i=e+"."+(t.profileSpace?String.fromCharCode(t.profileSpace+"A"-1):"")+t.profileIDC+"."+t.profileCompat.toString(16).toUpperCase()+"."+t.tierFlag+t.levelIDC,s="";for(let r=t.constraintIndicator.length-1;r>=0;--r){let e=t.constraintIndicator[r];if(0!==e||""!==s){let t=e.toString(16).toUpperCase();s="."+(""===s?t:t+s)}}return i+s}static parseDvcC(e){let t;return e?t={versionMajor:e[0],versionMinor:e[1],profile:e[2]>>1&127,level:e[2]<<5&32|e[3]>>3&31}:n.b.warn("No dvcC box")(),t}static dvcCToCodecString(e,t){return e+"."+(t.profile<10?"0"+t.profile:t.profile)+"."+(t.level<10?"0"+t.level:t.level)}static parseVpcC(e){let t;return e?t={profile:e[4],level:e[5],bitDepth:e[6]>>4&15}:n.b.warn("No vpcC box")(),t}static vpcCToCodecString(e,t){return e+"."+(t.profile<10?"0"+t.profile:t.profile)+"."+(t.level<10?"0"+t.level:t.level)+"."+t.bitDepth}static parseInitSegment(e){let t={foundLargeTimescale:!1,tracksById:{}};return L.findBoxWithOffset(e,0,["moov","trak"]).forEach(e=>{let i=e.data;const s=L.findBox(i,["tkhd"])[0];if(s){let r=s[0],n=0===r?12:20,a=L.readUint32(s,n);const o=L.findBox(i,["mdia","mdhd"])[0];if(o){let s=0===(r=o[0])?12:20;const n=L.readUint32(o,s);s+=4,n>=1e6&&(t.foundLargeTimescale=!0);let l=0===r?L.readUint32(o,s):0;const h=L.findBox(i,["mdia","hdlr"])[0];if(h){const s=L.bin2str(h.subarray(8,12));let r={soun:"audio",vide:"video",clcp:"caption"}[s]||s;if(r){let s,o=L.findBox(i,["mdia","minf","stbl","stsd"]);if(o.length){let i=o[0];s=L.bin2str(i.subarray(12,16));const h=P.parseStsd(i);let d;if("caption"===r){let e=Object.assign({id:a,type:r,timescale:n,duration:l,isTimingTrack:!1,sequenceNumber:0,captionSamples:[]},h);t.caption=e,d=e}else{let i=Object.assign({id:a,type:r,timescale:n,duration:l,isTimingTrack:!0,trakOffset:e.offset,trakSize:e.boxSize,sequenceNumber:0,samples:[],fragmentDuration:0},h);"video"===r?(t.video=i,t.videoCodec=i.codec):(t.audio=i,t.audioCodec=i.codec),d=i}t.tracksById[a]=d}}}}}}),t}static parseStsd(e){let t,i,s;const r=e.subarray(8);let n,a=L.bin2str(r.subarray(4,8)),o=null,l=null;"enca"===a?l=(o=L.findBox(r,["enca"])[0]).subarray(28):"encv"===a&&(l=(o=L.findBox(r,["encv"])[0]).subarray(78)),t=!!l,i=0,l&&L.findBox(l,["sinf"]).forEach(e=>{let t=L.findBox(e,["schm"])[0];if(t){let s=L.bin2str(t.subarray(4,8));if("cbcs"===s||"cenc"===s){let t=L.findBox(e,["frma"])[0];t&&(a=L.bin2str(t));let s=L.findBox(e,["schi","tenc"])[0];s&&(i=s[7])}}});let h=r.subarray(86);switch(a){case"mp4a":s="mp4a.40.5";break;case"ac-3":case"ec-3":s=a;break;case"avc1":case"avc3":s=a+".640028";break;case"hvc1":case"hev1":let e=L.findBox(h,["hvcC"])[0];s=(n=P.parseHvcC(e))?P.hvcCToCodecString(a,n):a+".2.4.H150.B0";break;case"dvh1":case"dvhe":let t=L.findBox(h,["dvcC"])[0];s=(n=P.parseDvcC(t))?P.dvcCToCodecString(a,n):a+".05.01";break;case"c608":s=a;break;case"vp09":let i=L.findBox(h,["vpcC"])[0];n=P.parseVpcC(i),s=P.vpcCToCodecString(a,n);break;default:s=a}return{codec:s,encrypted:t,defaultPerSampleIVSize:i}}static has32BitTfdts(e){let t=!1;return L.findBox(e,["moof","traf","tfdt"]).forEach(e=>{0===e[0]&&(t=!0)}),t}static getStartDtsTs(e,t){let i,s=L.findBox(t,["moof","traf"]),r=Number.MAX_SAFE_INTEGER;return s.map((function(t){return L.findBox(t,["tfhd"]).forEach(s=>{const a=L.readUint32(s,4),o=e.tracksById[a];let l,h;if(!o)return;if(!o.isTimingTrack)return 1/0;l=o.timescale||9e4;let d=L.findBox(t,["tfdt"]).map((function(e){var t,i;return t=e[0],i=L.readUint32(e,4),1===t&&(i>A&&n.b.warn("Value larger than can be represented by float for upper 32 bits "+i)(),i*=Math.pow(2,32),i+=L.readUint32(e,8)),i}));h=d.length>0?d[0]:1/0,isFinite(h)&&h/l<r&&(r=h/l,i={baseTime:h,timescale:l})})})),i}static offsetStartDTS(e,t,i,s){L.findBox(t,["moof","traf"]).map((function(t){return L.findBox(t,["tfhd"]).map((function(r){const a=L.readUint32(r,4),o=e.tracksById[a];if(!o)return;var l=o.timescale||9e4;let h="caption"===o.type?0:s;L.findBox(t,["tfdt"]).map((function(e){var t=e[0];const s=o.type;if(0===t){let t=L.readUint32(e,4)-Math.round(i.baseTime*l/i.timescale);"video"===s&&t<0&&(n.b.warn(`video tdft would have gone negative by ${t/l} seconds`)(),t=0),t+=Math.round(h*l),t=Math.max(t,0),L.writeUint32(e,4,t)}else{let t=L.readUint32(e,4);t>A&&n.b.error("baseMediaDecodeTime larger than can be represented by float for upper 32 bits "+t)();let r=t;r*=Math.pow(2,32),r+=L.readUint32(e,8),r-=Math.round(i.baseTime*l/i.timescale),"video"===s&&r<0&&(n.b.warn(`video tdft would have gone negative by ${r/l} seconds`)(),r=0),r+=Math.round(h*l),r=Math.max(r,0);const a=Math.floor(r/(C+1)),o=Math.floor(r%(C+1));L.writeUint32(e,4,a),L.writeUint32(e,8,o)}}))}))}))}static writeStartDTS(e,t,i){L.findBox(t,["moof","traf"]).map((function(t){return L.findBox(t,["tfhd"]).map((function(s){let r=L.readUint32(s,4),a=e.tracksById[r];if(!a)return;let o=a.timescale||9e4,l=Math.round(i*o)/o;Math.abs(l-i)>.01&&n.b.warn(`[iframes] large rounding error when adjusting timestamps, startDTS: ${i}, roundedStartDTS: ${l}`)(),L.findBox(t,["tfdt"]).map((function(e){if(0===e[0])L.writeUint32(e,4,l*o);else{let t=l*o;t=Math.max(t,0);const i=Math.floor(t/(C+1)),s=Math.floor(t%(C+1));L.writeUint32(e,4,i),L.writeUint32(e,8,s)}}))}))}))}static parseSAIO(e){let t=0,i=0,s=e[0];i+=4,0!=(1&L.readUint32(e,0))&&(i+=8);let r=16777215&L.readUint32(e,i);return 1===r?(i+=4,t=L.readUint32(e,i),1===s&&(i+=4,t*=Math.pow(2,32),t+=L.readUint32(e,i))):n.b.error("saio entry count error, count is: "+r)(),t}static parseSAIZ(e){let t=0,i=0;return i+=4,0!=(1&L.readUint32(e,0))&&(i+=8),t=e[i],i++,i+=4,0===t&&(t=e[i]),t}static parseSubsample(e,t){let i={subsamples:[]},s=0;for(e&&(i.iv=t.subarray(0,e),s+=e),s+=2;s+6<=t.byteLength;){let e=L.readUint16(t,s);s+=2;let r=L.readUint32(t,s);s+=4,i.subsamples.push([e,r])}return i}static isSEIMessage(e,t){return e?39===t||40===t:6===t}static parseCLCPSample(e,t,i){let s=0,r=[],n=0;for(;s<i;){let i=t+s,o=L.readUint32(e,i);i+=4;let l=L.bin2str(e.subarray(i,i+4));if(i+=4,"cdat"!==l)break;{let t=o-8;var a=e.subarray(i,i+t);n+=t,r.push(a),s+=o}}return{cdatList:r,cdatTotalSize:n}}static parseSamples(e,t,i,s,r,a){let o,l=i.timescale,h=i.id,d=e,c=0,u=!1;L.findBoxWithOffset(t,0,["moof"]).map((function(e){var f=e.data,p=e.offset;L.findBox(f,["traf"]).map((function(e){let f=L.findBox(e,["tfdt"]).map((function(e){var t,i;return t=e[0],i=L.readUint32(e,4),1===t&&(i*=Math.pow(2,32),i+=L.readUint32(e,8)),i/l}))[0];return void 0!==f&&(d=f),L.findBox(e,["tfhd"]).map((function(f){let g=L.readUint32(f,4),m=16777215&L.readUint32(f,0),y=0,v=0!=(2&m),_=0,b=0!=(8&m),T=0,S=0!=(16&m),E=0,w=0!=(32&m),I=0,D=8;if(g===h){if(0!=(1&m)){y=L.readUint32(f,D),D+=4;let e=L.readUint32(f,D);D+=4,0!==e&&n.b.info("tfhd baseDataOffset has 64-bit value. Caption should be turned off")()}if(v&&(_=L.readUint32(f,D),D+=4),b&&(T=L.readUint32(f,D),D+=4),S&&(E=L.readUint32(f,D),D+=4),w&&(I=L.readUint32(f,D),D+=4),"video"===i.type){let s=0,r=0;L.findBox(e,["saio"]).map((function(e){s=P.parseSAIO(e)})),L.findBox(e,["saiz"]).map((function(e){r=P.parseSAIZ(e)})),s&&r&&(o=P.parseSubsample(i.defaultPerSampleIVSize,t.subarray(s,s+r))),u=P.isHEVCFlavor(i.codec)}L.findBox(e,["trun"]).map((function(e){let n=e[0],h=16777215&L.readUint32(e,0),f=0!=(1&h),g=0,m=0!=(4&h),y=0!=(256&h),v=0,_=0!=(512&h),b=0,S=0!=(1024&h),w=0!=(2048&h),I=0,D=L.readUint32(e,4),k=8;f&&(g=L.readUint32(e,k),k+=4),m&&(k+=4);let R=g+p;for(let p=0;p<D&&(a<0||c<a);p++){if(y?(v=L.readUint32(e,k),k+=4):v=T,_?(b=L.readUint32(e,k),k+=4):b=E,S&&(k+=4),w&&(I=0===n?L.readUint32(e,k):L.readSint32(e,k),k+=4),"video"===i.type)if(isNaN(s)){if(i.fragmentDuration+=v,r){let e=0;for(;e<b;){let s=L.readUint32(t,R),r=31&t[R+=4];if(i.seiSamples||(i.seiSamples=[]),P.isSEIMessage(u,r)){var C=t.subarray(R,R+s);i.seiSamples.push({pts:d+I/l,type:r,data:C,sampleOffset:R,naluSize:s})}R+=s,e+=s+4}}}else i.samples.push({data:t.subarray(R,R+b),size:b,duration:s*l,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:2,isNonSync:0,paddingValue:0},subsamples:o?o.subsamples:[],iv:o?o.iv:void 0});else if("audio"===i.type)i.fragmentDuration+=v;else if("caption"===i.type){let{cdatList:e,cdatTotalSize:s}=P.parseCLCPSample(t,R,b);if(R+=b,e.length){let t;if(1===e.length)t=new Uint8Array(e[0]);else if(e.length>1){let i=0;t=new Uint8Array(s);for(const s of e)t.set(s,i),i+=s.length}i.captionSamples.push({type:3,pts:d,bytes:t})}}c++,d+=v/l}}))}}))}))}))}static parseEmsg(e){let t,i,s,r,a,o,l="",h="",d=0;if(0===e[0]){for(;"\0"!==L.bin2str(e.subarray(d,d+1));)l+=L.bin2str(e.subarray(d,d+1)),d+=1;for(l+=L.bin2str(e.subarray(d,d+1)),d+=1;"\0"!==L.bin2str(e.subarray(d,d+1));)h+=L.bin2str(e.subarray(d,d+1)),d+=1;h+=L.bin2str(e.subarray(d,d+1)),d+=1,t=L.readUint32(e,12),i=L.readUint32(e,16),r=L.readUint32(e,20),a=L.readUint32(e,24),d=28}else{d+=4,t=L.readUint32(e,d),d+=4;let i=L.readUint32(e,d);d+=4;let o=L.readUint32(e,d);for(d+=4,s=Math.pow(2,32)*i+o,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,n.b.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")()),r=L.readUint32(e,d),d+=4,a=L.readUint32(e,d),d+=4;"\0"!==L.bin2str(e.subarray(d,d+1));)l+=L.bin2str(e.subarray(d,d+1)),d+=1;for(l+=L.bin2str(e.subarray(d,d+1)),d+=1;"\0"!==L.bin2str(e.subarray(d,d+1));)h+=L.bin2str(e.subarray(d,d+1)),d+=1;h+=L.bin2str(e.subarray(d,d+1)),d+=1}return{schemeIdUri:l,value:h,timeScale:t,presentationTime:s,presentationTimeDelta:i,eventDuration:r,id:a,payload:o=e.subarray(d,e.byteLength)}}static extractID3PayloadCreateID3Track(e,t,i){const s=new l(e.payload);let r,a=new Uint8Array(e.payload),o=a.byteLength,h=0,d=0;if(r=isNaN(e.presentationTime)?t+e.presentationTimeDelta/e.timeScale:e.presentationTime/e.timeScale,isNaN(r))return void n.b.error("No pts found in emsg info when extracting ID3 payload")();let c=e.eventDuration,u=a.subarray(0,10),f=L.bin2str(u.subarray(d,d+3));d+=3,"ID3"!==f&&n.b.error("No ID3 tag found when extracting ID3 payload")(),d+=2;let p=a.subarray(d,d+1),g=(p[0],64&p[0]),m=16&p[0];if(d+=1,l.readSynchSafeUint32(a.subarray(d,d+4)),d+=4,g){let e=l.readSynchSafeUint32(a.subarray(d,d+4));d+=4,d+=e}for(;d+2<o;){let e="";e+=L.bin2str(a.subarray(d,d+4)),d+=4;let t=l.readSynchSafeUint32(a.subarray(d,d+4));d+=4;let o=r+h*c,u={data:a,pts:o,dts:o,decryptdata:void 0,frames:s.frames};i.id3Samples.push(u),d+=t,h++,m&&("DI3"!==L.bin2str(a.subarray(d,d+3))&&n.b.error("End should be DI3 if footer present in extracting ID3 payload")(),d+=3,d+=7)}d+2===o&&0!==L.readUint16(a,d)&&n.b.warn("Padding should be 0 when extracting ID3 payload")()}append(e,t,i,n,a,o,l){let h=this.initData,d=0,c=0,u=!1,f=!1;void 0===h&&(this.resetInitSegment(e,0),h=this.initData);let p,g=this.initPtsTs;if(g||(p=P.getStartDtsTs(h,e),this.initPtsTs=g={baseTime:p.baseTime-Math.round(t*p.timescale),timescale:p.timescale},this.logger.info(`initPtsTs: ${g.baseTime}/${g.timescale}, sec: ${g.baseTime/g.timescale}, startDtsTs: ${p.baseTime}/${p.timescale} timeOffset: ${t}`)(),this.observer.trigger(s.b.INIT_PTS_FOUND,{initPTS90k:9e4*g.baseTime/g.timescale})),h.foundLargeTimescale&&P.has32BitTfdts(e)&&!l&&(e=R.remuxOverflowSegment(e)),l){let t=this._videoTrack.timescale;l=Math.ceil(l*t)/t,P.writeStartDTS(h,e,o)}else P.offsetStartDTS(h,e,g,this.audioPrimingDelay);p=P.getStartDtsTs(h,e);let m=L.findBox(e,["emsg"]);if(h.video&&h.video.encrypted&&!L.findBox(e,["moof","traf"]).find((function(e){return Boolean(L.findBox(e,["senc"])[0]||L.findBox(e,["saiz"])[0]&&L.findBox(e,["saio"])[0])}))&&(this.logger.warn("Missing subsample information for encrypted content codec="+h.videoCodec)(),h.videoCodec&&!w.b.isAVC(h.videoCodec))){let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"Missing subsample information for encrypted content"};this.observer.trigger(s.b.INTERNAL_ERROR,e)}else if(l){let t=(p.baseTime+this.audioPrimingDelay*p.timescale)/p.timescale;if(this._videoTrack&&this._audioTrack&&!this._silentAudioTrack){let e=D.getTrack(this.observer,this._audioTrack.id,this._audioTrack.codec,2);if(!e)throw"unable to create silent audio track for codec "+this._audioTrack.codec;this._silentAudioTrack=Object.assign(Object.assign({},e),{sequenceNumber:0});let t=E.a.initSegment([this._videoTrack,this._silentAudioTrack]);this.remuxedInitDataTrack={type:"audiovideo",container:"video/mp4",codec:this._silentAudioTrack.config.codec+","+this._videoTrack.codec,initSegment:t};const i={track:this.remuxedInitDataTrack};this.observer.trigger(s.b.FRAG_PARSING_INIT_SEGMENT,i)}P.parseSamples(t,e,this._videoTrack,l,!1,1),this.mp4Remuxer.remuxIFrame(t,this._videoTrack,this._silentAudioTrack,l,this.remuxedInitDataTrack),this._videoTrack.samples=[]}else if(m&&m.length>0){let i=(p.baseTime-this.audioPrimingDelay*p.timescale)/p.timescale;i=Math.max(0,i);let s=m.map(e=>{let t=P.parseEmsg(e);return"https://aomedia.org/emsg/ID3\0"!==t.schemeIdUri||this._id3Track||(this._id3Track={id3Samples:[],inputTimescale:9e4}),t});this._id3Track&&s.map(e=>{P.extractID3PayloadCreateID3Track(e,t,this._id3Track)}),this.mp4Remuxer.remuxEmsg(!!h.audio,!!h.video,this._id3Track,i,e),this._id3Track&&(this._id3Track.id3Samples=[])}else{let t=(p.baseTime-this.audioPrimingDelay*p.timescale)/p.timescale;t=Math.max(0,t),this._videoTrack&&(P.parseSamples(t,e,this._videoTrack,void 0,this.trySEICaptions,-1),d=this._videoTrack.fragmentDuration/this._videoTrack.timescale,u=!0,this._videoTrack.fragmentDuration=0,this.trySEICaptions?(P.extractSEICaptionsFromNALu(this._videoTrack.seiSamples,this._captionTrack),this._videoTrack.seiSamples=[]):this._captionTrack&&P.parseSamples(t,e,this._captionTrack,void 0,!1,Number.MAX_SAFE_INTEGER)),this._audioTrack&&(P.parseSamples(t,e,this._audioTrack,void 0,!1,-1),c=this._audioTrack.fragmentDuration/this._audioTrack.timescale,f=!0,this._audioTrack.fragmentDuration=0),this.mp4Remuxer.remuxRawData(c,f,d,u,this._captionTrack,t,e,this.remuxedInitDataTrack)}}static extractSEICaptionsFromNALu(e,t){if(e){for(let c=0;c<e.length;++c){let u=e[c],f=u.pts,p=0;p++;for(var i=0,s=0,r=!1,n=0;!r&&p<u.data.length;){i=0;do{if(p>=u.data.length)break;i+=n=u.data[p++]}while(255===n);s=0;do{if(p>=u.data.length)break;s+=n=u.data[p++]}while(255===n);let e=u.data.length-p;if(4===i&&p<u.data.length){if(r=!0,181===u.data[p++]){var a=L.readUint16(u.data,p);if(p+=2,49===a){var o=L.readUint32(u.data,p);if(p+=4,1195456820===o&&3===u.data[p++]){var l=u.data[p++];p++;var h=31&l,d=[];if(64&l)for(let e=0;e<h;e++){let e=u.data[p++];if(e===(252&e)){let t=3&e;if(0===t||1===t){let e=u.data[p++],t=u.data[p++];d.push(e),d.push(t)}}else p+=2}d.length>0&&t.captionSamples.push({type:3,pts:f,bytes:d})}}}}else if(s<e)p+=s;else if(s>e)break}}return t}}}var x=P,M=class{constructor(e){this.data=e,this._bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}get bytesAvailable(){return this._bytesAvailable}loadWord(){var e=this.data,t=this._bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");s.set(e.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*r,this._bytesAvailable-=r}skipBits(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this._bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&n.b.error("Cannot read more than 32 bits at a time")(),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this._bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){var e=this.skipLZ();return this.readBits(e+1)-1}readEG(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){var t,i=8,s=8;for(t=0;t<e;t++)0!==s&&(s=(i+this.readEG()+256)%256),i=0===s?i:s}readSPS(){var e,t,i,s,r,n,a,o=0,l=0,h=0,d=0,c=this.readUByte.bind(this),u=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),g=this.skipBits.bind(this),m=this.skipEG.bind(this),y=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(c(),e=c(),u(5),g(3),c(),y(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=f();if(3===_&&g(1),y(),y(),g(1),p())for(n=3!==_?8:12,a=0;a<n;a++)p()&&v(a<6?16:64)}y();var b=f();if(0===b)f();else if(1===b)for(g(1),m(),m(),t=f(),a=0;a<t;a++)m();y(),g(1),i=f(),s=f(),0===(r=u(1))&&g(1),g(1),p()&&(o=f(),l=f(),h=f(),d=f());let T=[1,1];if(p()&&p())switch(c()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(i+1)-2*o-2*l),height:(2-r)*(s+1)*16-(r?2:4)*(h+d),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}},O=class{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}},N=class extends p{constructor(e,t,i,s){super(e,t),this.typeSupported=i;const r=navigator.userAgent;this.isSafari=s&&s.indexOf("Apple")>-1&&r&&!r.match("CriOS"),this.currentInitTrack=void 0}resetTimeStamp(e){this._initPTS=this._initDTS=e}resetInitSegment(){this.currentInitTrack=void 0,this._silentAudioTrack=void 0}remuxEsTracks(e,t,i,r,a,o,l,h,d,c){var u;let f,p=void 0===d?a:d;if(!this.currentInitTrack){if(e&&e.config.codec&&(this._audioTrackInfo={id:e.info.id,codec:e.config.codec,channelCount:e.config.channelCount}),t&&c&&this._audioTrackInfo){let e=D.getTrack(this.observer,this._audioTrackInfo.id,this._audioTrackInfo.codec,this._audioTrackInfo.channelCount);e&&(this._silentAudioTrack=Object.assign(Object.assign({},e),{info:Object.assign(Object.assign({},e.info),{inputTimescale:9e4}),parsingData:{len:0,sequenceNumber:0,esSamples:[]}}),f=D.getSegment(this._silentAudioTrack,t.parsingData.sequenceNumber,p*this._silentAudioTrack.info.timescale,c),t.parsingData.sequenceNumber++)}else this._silentAudioTrack=void 0;this.updateInitPTSDTS(t,e,a),this.generateIS(this._silentAudioTrack?this._silentAudioTrack:e,t)}if(this.currentInitTrack){let i,r,d;if(t&&c&&this._silentAudioTrack&&!f&&(f=D.getSegment(this._silentAudioTrack,t.parsingData.sequenceNumber,Math.round((p+this.config.audioPrimingDelay)*this._silentAudioTrack.info.timescale),c)),e&&e.parsingData.esSamples.length){if(isNaN(e.info.timescale)&&(n.b.warn("regenerate InitSegment as audio detected")(),this.updateInitPTSDTS(t,e,a),this.generateIS(e,t)),i=this.remuxAudio(e,p,o,l,h),t&&t.parsingData.esSamples.length){let s;i&&(s=i.endPTS-i.startPTS),isNaN(t.info.timescale)&&(n.b.warn("regenerate InitSegment as video detected")(),this.updateInitPTSDTS(t,e,a),this.generateIS(e,t)),r=this.remuxVideo(t,p,o,s,c)}}else t&&t.parsingData.esSamples.length&&(r=this.remuxVideo(t,p,o,void 0,c)),r&&e&&e.config.codec&&(i=this.remuxEmptyAudio(e,p,o,l,r,h));f?d={data1:r.data1,data2:f,startDTS:r.startDTS,startPTS:r.startPTS,type:"audiovideo",track:this.currentInitTrack}:r&&i?d={data1:r.data1,data2:i.data1,startDTS:Math.min(r.startDTS,i.startDTS),startPTS:Math.min(r.startPTS,i.startPTS),endDTS:Math.max(r.endDTS,i.endDTS),endPTS:Math.max(r.endPTS,i.endPTS),type:"audiovideo",track:this.currentInitTrack}:r?d={data1:r.data1,startDTS:r.startDTS,startPTS:r.startPTS,endDTS:r.endDTS,endPTS:r.endPTS,type:"video",track:this.currentInitTrack}:i&&(d={data1:i.data1,startDTS:i.startDTS,startPTS:i.startPTS,endDTS:i.endDTS,endPTS:i.endPTS,type:"audio",track:this.currentInitTrack}),this.observer.trigger(s.b.FRAG_PARSING_DATA,d)}else n.b.error("failed to generate IS")();(null===(u=null==i?void 0:i.id3Samples)||void 0===u?void 0:u.length)&&this.remuxID3(i,p),r&&r.captionSamples.length&&this.remuxText(r,p),this.observer.trigger(s.b.FRAG_PARSED)}updateInitPTSDTS(e,t,i){let n=1/0,a=1/0,o=e?e.parsingData.esSamples:[],l=t?t.parsingData.esSamples:[];if(isNaN(this._initPTS)){if(t&&l.length&&(n=a=l[0].pts-t.info.inputTimescale*i),e&&o.length){const t=e.info.inputTimescale;e.info.timescale=t,n=Math.min(n,o[0].pts-t*i),a=Math.min(a,o[0].dts-t*i),this.observer.trigger(s.b.INIT_PTS_FOUND,{initPTS90k:n})}if(isNaN(n)||isNaN(a)){let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!1,reason:"invalid initPTS or initDTS"};this.observer.trigger(s.b.INTERNAL_ERROR,e)}else this._initPTS=n,this._initDTS=a}}generateIS(e,t){const i=this.observer,n=t?t.parsingData.esSamples:[],a=this.typeSupported;let o,l="audio/mp4";if(e&&t&&n.length){const i=t.info.inputTimescale;t.info.timescale=i,e.info.timescale=e.config.samplerate;const s=E.a.initSegment([t,e]);o={type:"audiovideo",container:"video/mp4",codec:`${t.config.codec},${e.config.codec}`,initSegment:s}}else if(e){switch(e.info.timescale=e.config.samplerate,e.config.segmentCodec){case"mp3":a.mpeg?(l="audio/mpeg",e.config.codec=""):a.mp3&&(e.config.codec="mp3")}const t="mp3"===e.config.segmentCodec&&a.mpeg?new Uint8Array:E.a.initSegment([e]);o={type:"audio",container:l,codec:e.config.codec,initSegment:t}}else if(t&&n.length){const e=t.info.inputTimescale;t.info.timescale=e;const i=E.a.initSegment([t]);o={type:"video",container:"video/mp4",codec:t.config.codec,initSegment:i}}if(o){this.currentInitTrack=o;let e={track:o};i.trigger(s.b.FRAG_PARSING_INIT_SEGMENT,e)}else{let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"};i.trigger(s.b.INTERNAL_ERROR,e)}}remuxVideo(e,t,i,a,o){var l,h,d,c,u,f,p,g=8,m=e.info.inputTimescale,y=e.parsingData.esSamples,v=[],_=y.length,b=this._PTSNormalize,T=this._initDTS,S=e.info.encrypted;let w;w=i?this.nextAvcDts:t*m,y.forEach((function(e){e.pts=b(e.pts-T,w),e.dts=b(e.dts-T,w)})),y.sort((function(e,t){const i=e.dts-t.dts,s=e.pts-t.pts;return i||s||e.id-t.id}));let I=y.reduce((e,t)=>Math.max(Math.min(e,t.pts-t.dts),-18e3),0);if(I<0){n.b.warn(`PTS < DTS detected in video samples, shifting DTS by ${Math.round(I/90)} ms to overcome this issue`)();for(let e=0;e<y.length;e++)y[e].dts+=I}let D=y[0];u=Math.max(D.dts,0),c=Math.max(D.pts,0),isNaN(o)||(u=t*m,c=t*m);let L=Math.round((u-w)/90);i&&L&&(u=w,y[0].dts=u,c=Math.max(c-L,w),y[0].pts=c,n.b.info(`Video/PTS/DTS adjusted: ${Math.round(c/90)}/${Math.round(u/90)},delta:${L} ms`)()),D=y[y.length-1],p=Math.max(D.dts,0),f=Math.max(D.pts,0,p),isNaN(o)||(p=t*m,f=t*m);const k=this.isSafari;k&&(l=Math.round((p-u)/(y.length-1)));let R=0,C=0;for(let s=0;s<_;s++){let e=y[s],t=e.units,i=t.length,r=0;for(let s=0;s<i;s++)r+=t[s].data.length;C+=r,R+=i,e.length=r,e.dts=k?u+s*l:Math.max(e.dts,u),e.pts=Math.max(e.pts,e.dts)}let A=C+4*R+8;try{h=new Uint8Array(A)}catch(e){let t,i={type:r.g.MUX_ERROR,details:r.d.REMUX_ALLOC_ERROR,fatal:!1,bytes:A,reason:"fail allocating video mdat "+A,response:r.f.InternalError};return i.level=t,void this.observer.trigger(s.b.INTERNAL_ERROR,i)}let P=new DataView(h.buffer);P.setUint32(0,A),h.set(E.a.types.mdat,4);for(let s=0;s<_;s++){let e,t=y[s],i=t.units,r=0,n=[],d=0;for(let s=0,a=i.length;s<a;s++){let e=i[s],t=e.data,a=e.data.byteLength;if(P.setUint32(g,a),g+=4,h.set(t,g),g+=a,r+=4+a,S)if(a<=48||1!==e.type&&5!==e.type)d+=4+a;else{let e=a-32;e%16==0&&(e-=16),n.push([d+36,e]),d=a-32-e}}if(d>0&&n.push([d,0]),k)e=Math.max(0,l*Math.round((t.pts-t.dts)/l));else{if(s<_-1)l=y[s+1].dts-t.dts;else{let e=this.config,i=t.dts-y[s>0?s-1:s].dts;if(e.stretchShortVideoTrack){let s=e.maxBufferHole,r=e.maxSeekHole,n=Math.floor(Math.min(s,r)*m),o=(a?c+a*m:this.nextAudioPts)-t.pts;o>n?(l=o-i)<0&&(l=i):l=i}else l=i}e=Math.round(t.pts-t.dts)}isNaN(o)||(e=0,l=o*m),v.push({size:r,duration:l,cts:e,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t.key?2:1,isNonSync:t.key?0:1,paddingValue:0},decryptdata:t.decryptdata,subsamples:n})}this.nextAvcDts=p+l;let x=e.parsingData.dropped;if(e.parsingData.dropped=0,v.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){let e=v[0].flags;e.dependsOn=2,e.isNonSync=0}let M={sequenceNumber:e.parsingData.sequenceNumber++,id:e.info.id,type:e.type,encrypted:e.info.encrypted,samples:v,defaultPerSampleIVSize:0};d=E.a.moof(u+this.config.audioPrimingDelay*m,M),e.parsingData.esSamples=[];let O=new Uint8Array(d.byteLength+h.byteLength);return O.set(d),O.set(h,d.byteLength),{data1:O,startPTS:c/m,endPTS:(f+l)/m,startDTS:u/m,endDTS:this.nextAvcDts/m,type:"video",dropped:x}}remuxAudio(e,t,i,a,o){const l=e.info.inputTimescale,d=l/e.info.timescale,c=("aac"===e.config.segmentCodec?1024:"mp3"===e.config.segmentCodec?1152:1536)*d,u=this._PTSNormalize,f=this._initDTS,p="mp3"===e.config.segmentCodec&&this.typeSupported.mpeg,g=e.info.encrypted;var m,y,v,_,b,T,S,w,I,D,L,k,R,C=p?0:8,A=[],P=[];let x=new h;if(P=e.parsingData.esSamples,R=this.nextAudioPts,(i=i||P.length&&R&&(a&&Math.abs(t-R/l)<.1||Math.abs(P[0].pts-R-f)<20*c))||(R=t*l),P.forEach((function(e){e.pts=e.dts=u(e.pts-f,R)})),P.sort((function(e,t){return e.pts-t.pts})),a&&"aac"===e.config.segmentCodec)for(let s=0,r=R;s<P.length;){var M,N=P[s];M=(I=N.pts)-r;const t=Math.abs(1e3*M/l);if(M<=-c)n.b.warn(`Dropping 1 audio frame @ ${(r/l).toFixed(3)}s due to ${t} ms overlap.`)(),P.splice(s,1),e.parsingData.len-=N.unit.length;else if(M>=c&&t<1e4&&r){var F=Math.round(M/c);n.b.warn(`Injecting ${F} audio frame @ ${(r/l).toFixed(3)}s due to ${Math.round(1e3*M/l)} ms gap.`)();for(var B=0;B<F;B++)k=Math.max(r,0),(L=O.getSilentFrame(e.config.codec,e.config.channelCount))||(n.b.warn("Unable to get silent frame for given audio codec; duplicating last frame instead.")(),L=N.unit.subarray(0)),P.splice(s,0,{unit:L,pts:k,dts:k,decryptdata:o}),e.parsingData.len+=L.length,r+=c,s+=1;N.pts=N.dts=r,r+=c,s+=1}else Math.abs(M),r+=c,N.pts=N.dts=0===s?R:P[s-1].pts+c,s+=1}for(let h=0,$=P.length;h<$;h++){if(v=(m=P[h]).unit,I=m.pts,D=m.dts,void 0!==w)y.duration=Math.round((D-w)/d);else{let t=Math.round(1e3*(I-R)/l),a=0;if(i&&"aac"===e.config.segmentCodec&&t){if(t>0&&t<1e4)(a=Math.round((I-R)/c))>0&&((L=O.getSilentFrame(e.config.codec,e.config.channelCount))||(L=v.subarray(0)),e.parsingData.len+=a*L.length);else if(t<-12){e.parsingData.len-=v.byteLength;continue}I=D=R}if(T=Math.max(0,I),S=Math.max(0,D),!(e.parsingData.len>0))return;{let t=p?e.parsingData.len:e.parsingData.len+8;try{_=new Uint8Array(t)}catch(e){let i,n={type:r.g.MUX_ERROR,details:r.d.REMUX_ALLOC_ERROR,fatal:!1,bytes:t,reason:"fail allocating audio mdat "+t,response:r.f.InternalError};return n.level=i,void this.observer.trigger(s.b.INTERNAL_ERROR,n)}p||(new DataView(_.buffer).setUint32(0,t),_.set(E.a.types.mdat,4))}for(let i=0;i<a;i++)k=I-(a-i)*c,(L=O.getSilentFrame(e.config.codec,e.config.channelCount))||(n.b.warn("Unable to get silent frame for given audio codec; duplicating this frame instead.")(),L=v.subarray(0)),_.set(L,C),C+=L.byteLength,y={size:L.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,paddingValue:0,isNonSync:0},decryptdata:m.decryptdata,subsamples:g?[[L.byteLength,0]]:[]},A.push(y)}_.set(v,C);let t=v.byteLength;C+=t;let a=[];if(g)if("ec3"===e.config.segmentCodec){let e=0;for(;e<v.byteLength;){let t=2*(x.bsReadAndUpdate(v,{byteOffset:e+2,usedBits:5},11)+1);e+=t;let i=Math.min(t,16);a.push([i,t-i])}}else{let e=Math.min(t,16);a.push([e,t-e])}y={size:t,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,paddingValue:0,isNonSync:0},decryptdata:m.decryptdata,subsamples:a},A.push(y),w=D}var U=0,V=A.length;if(V>=2&&(U=A[V-2].duration,y.duration=U),V){if(this.nextAudioPts=I+d*U,e.parsingData.len=0,p)b=new Uint8Array;else{let t={sequenceNumber:e.parsingData.sequenceNumber++,id:e.info.id,type:e.type,encrypted:e.info.encrypted,samples:A,defaultPerSampleIVSize:0};b=E.a.moof((S+this.config.audioPrimingDelay*l)/d,t)}let t=new Uint8Array(b.byteLength+_.byteLength);return t.set(b),t.set(_,b.byteLength),e.parsingData.esSamples=[],{data1:t,startPTS:T/l,endPTS:this.nextAudioPts/l,startDTS:S/l,endDTS:(D+d*U)/l,type:"audio"}}return null}remuxEmptyAudio(e,t,i,s,r,a){let o=e.info.inputTimescale,l=o/(e.config.samplerate?e.config.samplerate:o),h=this.nextAudioPts,d=(void 0!==h?h:r.startDTS*o)+this._initDTS,c=r.endDTS*o+this._initDTS,u=1024*l,f=Math.ceil((c-d)/u),p=O.getSilentFrame(e.config.codec,e.config.channelCount);if(n.b.warn("remux empty Audio")(),!p)return void n.b.error("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")();let g=[];for(var m=0;m<f;m++){var y=d+m*u;g.push({unit:p,pts:y,dts:y,decryptdata:a}),e.parsingData.len+=p.length}e.parsingData.esSamples=g,this.remuxAudio(e,t,i,s,a)}remuxID3(e,t){var i,r=e.id3Samples.length;const n=e.inputTimescale,a=this._initPTS,o=this._initDTS;if(r){for(var l=0;l<r;l++)(i=e.id3Samples[l]).pts=(i.pts-a)/n,i.dts=(i.dts-o)/n;this.observer.trigger(s.b.FRAG_PARSING_METADATA,{samples:e.id3Samples})}e.id3Samples=[]}remuxText(e,t){e.captionSamples.sort((function(e,t){return e.pts-t.pts}));var i,r=e.captionSamples.length;const n=e.inputTimescale,a=this._initPTS;if(r){for(var o=0;o<r;o++)(i=e.captionSamples[o]).pts=(i.pts-a)/n;this.observer.trigger(s.b.FRAG_PARSING_USERDATA,{samples:e.captionSamples})}e.captionSamples=[]}_PTSNormalize(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}};t.a=class{constructor(e,t,i,s){this.observer=e,this.typeSupported=t,this.config=i,this.vendor=s,this.logger=new n.a,this.logger.enable(i.debug,i.debugLevel)}destroy(){var e=this.demuxer;e&&e.destroy()}push(e,t,i,a,o,u,p,g,m,T,E,w){var I=this.demuxer;i=new Uint8Array(i);const D=new Uint8Array(e);if(!I||(o||u)&&!this.probeFn(D)){const{observer:e,typeSupported:t,config:i}=this,a=[{demux:class extends f{constructor(e,t,i,s,r){super(e,t,i,s,r)}static probe(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}resetInitSegment(e,t,i){this.pmtParsed=!1,this._pmtId=-1;const s={id:-1,inputTimescale:9e4,timescale:NaN,duration:0,encrypted:i&&i.isEncrypted,decryptdata:i},r={len:0,sequenceNumber:0};this._avcContext={info:Object.assign({},s),parsingData:Object.assign(Object.assign({},r),{esSamples:new Array,dropped:0}),config:{},container:"video/mp2t",type:"video"},this._audioContext={info:Object.assign({},s),parsingData:Object.assign(Object.assign({},r),{esSamples:new Array}),container:"video/mp2t",type:"audio"},this._id3Track={id:-1,inputTimescale:9e4,id3Samples:[]},this._txtTrack={inputTimescale:9e4,captionSamples:[]},this._duration=t,this._initSegment=e}append(e,t,i,n,a,o,l){var h,d,c,u,f,p=!1;this.contiguous=i;var g=this.pmtParsed,m=this._avcContext,y=this._audioContext,v=this._id3Track,_=m.info.id,b=y.info.id,T=v.id,S=this._pmtId,E=m.pesData,w=y.pesData,I=v.pesData;if(this.iframeMode=void 0!==l,this._initSegment&&this._initSegment.byteLength>0){let t=new Uint8Array(this._initSegment.byteLength+e.byteLength);t.set(this._initSegment),t.set(e,this._initSegment.byteLength),this._initSegment=void 0,e=t}let D,L,k=e.length;for(k-=k%188,h=0;h<k;h+=188){if(71!==e[h]){let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"};return void this.observer.trigger(s.b.INTERNAL_ERROR,e)}if(d=!!(64&e[h+1]),c=((31&e[h+1])<<8)+e[h+2],(48&e[h+3])>>4>1){if((u=h+5+e[h+4])===h+188)continue}else u=h+4;switch(c){case _:d&&(E&&(f=this._parsePES(E))&&this._parseAVCPES(f,!1),E={data:[],size:0,decryptdata:a}),E&&(E.data.push(e.subarray(u,h+188)),E.size+=h+188-u);break;case b:if(d&&!this.iframeMode){if(w&&(f=this._parsePES(w)))switch(y.segmentCodec){case"aac":this._parseAACPES(f);break;case"mp3":this._parseMPEGPES(f);break;case"ac3":case"ec3":this._parseDolbyPES(f)}w={data:[],size:0,decryptdata:a}}w&&(w.data.push(e.subarray(u,h+188)),w.size+=h+188-u);break;case T:d&&(I&&(f=this._parsePES(I))&&v.id3Samples.push(f),I={data:[],size:0}),I&&(I.data.push(e.subarray(u,h+188)),I.size+=h+188-u);break;case 0:d&&(u+=e[u]+1),S=this._pmtId=this._parsePAT(e,u);break;case S:d&&(u+=e[u]+1);let t=this._parsePMT(e,u,this.typeSupported);(_=t.avcId)>0&&(m.info.id=_,m.info.encrypted=t.videoEncrypted),(b=t.audioId)>0&&(y.info.id=b,y.segmentCodec=t.audioSegmentCodec,y.info.encrypted=t.audioEncrypted),(T=t.id3Id)>0&&(v.id=T),p&&!g&&(p=!1,h=-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}if(E&&(f=this._parsePES(E))?(this._parseAVCPES(f,!0),m.pesData=void 0):m.pesData=E,w&&(f=this._parsePES(w))){switch(y.segmentCodec){case"aac":this._parseAACPES(f);break;case"mp3":this._parseMPEGPES(f);break;case"ac3":case"ec3":this._parseDolbyPES(f)}y.pesData=void 0}else w&&w.size&&this.logger.warn("last AAC PES packet truncated,might overlap between fragments")(),y.pesData=w;I&&(f=this._parsePES(I))?(v.id3Samples.push(f),v.pesData=void 0):v.pesData=I,y.config&&y.segmentCodec&&(D={type:"audio",info:y.info,config:y.config,parsingData:y.parsingData});let R=m.config;var C;"string"==typeof(C=R).codec&&Array.isArray(C.sps)&&Array.isArray(C.pps)&&"number"==typeof C.width&&"number"==typeof C.height&&Array.isArray(C.pixelRatio)&&(L={type:"video",info:m.info,config:R,parsingData:m.parsingData}),this.esRemuxer.remuxEsTracks(D,L,v,this._txtTrack,t,i,n,a,o,l)}destroy(){this._duration=0}_parsePAT(e,t){return(31&e[t+10])<<8|e[t+11]}_parsePMT(e,t,i){var s,r;let n={audioId:-1,avcId:-1,id3Id:-1,audioEncrypted:!1,videoEncrypted:!1};for(s=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){switch(r=(31&e[t+1])<<8|e[t+2],e[t]){case 207:n.audioEncrypted=!0;case 15:-1===n.audioId&&(n.audioId=r,n.audioSegmentCodec="aac");break;case 21:-1===n.id3Id&&(n.id3Id=r);break;case 219:n.videoEncrypted=!0;case 27:-1===n.avcId&&(n.avcId=r);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?this.logger.warn("MPEG audio found, not supported in this browser for now")():-1===n.audioId&&(n.audioId=r,n.audioSegmentCodec="mp3");break;case 193:n.audioEncrypted=!0;case 129:!0!==i.ac3?this.logger.warn("AC-3 audio found, not supported in this browser for now")():-1===n.audioId&&(n.audioId=r,n.audioSegmentCodec="ac3");break;case 194:n.audioEncrypted=!0;case 135:!0!==i.ec3?this.logger.warn("EC-3 audio found, not supported in this browser for now")():-1===n.audioId&&(n.audioId=r,n.audioSegmentCodec="ec3");break;case 36:this.logger.warn("HEVC stream type found, not supported for now")();break;default:this.logger.warn("unkown stream type:"+e[t])()}t+=5+((15&e[t+3])<<8|e[t+4])}return n}_parsePES(e){var t,i,s,r,n,a,o=0,l=e.data,h=e.decryptdata;let d=NaN,c=NaN;if(e&&0!==e.size){for(;l[0].length<19&&l.length>1;){let e=new Uint8Array(l[0].length+l[1].length);e.set(l[0]),e.set(l[1],l[0].length),l[0]=e,l.splice(1,1)}if(1===((t=l[0])[0]<<16)+(t[1]<<8)+t[2]){if((s=(t[4]<<8)+t[5])&&s>e.size-6)return;192&(i=t[7])&&((d=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)>4294967295&&(d-=8589934592),64&i?((c=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>4294967295&&(c-=8589934592),d-c>54e5&&(this.logger.warn(Math.round((d-c)/9e4)+"s delta between PTS and DTS, align them")(),d=c)):c=d),a=(r=t[8])+9,e.size-=a,n=new Uint8Array(e.size);for(let e=0,i=l.length;e<i;e++){let i=(t=l[e]).byteLength;if(a){if(a>i){a-=i;continue}t=t.subarray(a),i-=a,a=0}n.set(t,o),o+=i}return s&&(s-=r+3),{data:n,pts:d,dts:c,len:s,decryptdata:h}}}}pushAccesUnit(e,t){let i=e.avcSample;if(i&&i.units.length&&i.frame){const s=e.parsingData.esSamples,r=s.length;!this.config.forceKeyFrameOnDiscontinuity||!0===i.key||e.config.sps&&(r||this.contiguous)?(i.id=r,i.decryptdata=t,e.info.encrypted&&i.units.forEach(e=>{if(e.data.byteLength>48)switch(e.type){case 1:case 5:e.data=this.discardEPB(e.data)}}),s.push(i)):e.parsingData.dropped++}i&&i.debug.length}_parseAVCPES(e,t){if(!e.data)throw"invalid pes data";var i,s,r,n=this._avcContext,a=this._parseAVCNALu(e.data),o=n.avcSample,l=e.decryptdata;e.data=void 0,a.forEach(t=>{switch(t.type){case 1:if(o&&!this.iframeMode){s=!0,o.frame=!0;let e=t.data;if(e.length>4){let t=new M(e).readSliceType();2!==t&&4!==t&&7!==t&&9!==t||(o.key=!0)}}break;case 5:s=!0,o&&(o||(o=n.avcSample=this._createAVCSample(!0,e.pts,e.dts,"")),o.key=!0,o.frame=!0);break;case 6:s=!0,(i=new M(this.discardEPB(t.data))).readUByte();for(var a=0,h=0,d=!1,c=0;!d&&i.bytesAvailable>1;){a=0;do{a+=c=i.readUByte()}while(255===c);h=0;do{h+=c=i.readUByte()}while(255===c);if(4===a&&0!==i.bytesAvailable){if(d=!0,181===i.readUByte()&&49===i.readUShort()&&1195456820===i.readUInt()&&3===i.readUByte()){var u=i.readUByte(),f=31&u,p=[u,i.readUByte()];for(r=0;r<f;r++)p.push(i.readUByte()),p.push(i.readUByte()),p.push(i.readUByte());this._insertSampleInOrder(this._txtTrack.captionSamples,{type:3,pts:e.pts,bytes:p})}}else if(h<i.bytesAvailable)for(r=0;r<h;r++)i.readUByte()}break;case 7:if(s=!0,!n.config.sps){var g=(i=new M(t.data)).readSPS();n.config.width=g.width,n.config.height=g.height,n.config.pixelRatio=g.pixelRatio,n.config.sps=[t.data],n.info.duration=this._duration;var m=t.data.subarray(1,4),y="avc1.";for(r=0;r<3;r++){var v=m[r].toString(16);v.length<2&&(v="0"+v),y+=v}n.config.codec=y}break;case 8:s=!0,n.config.pps||(n.config.pps=[t.data]);break;case 9:s=!1,o&&this.pushAccesUnit(n,l),o=n.avcSample=this._createAVCSample(!1,e.pts,e.dts,"");break;case 12:s=!1;break;default:s=!1,o&&(o.debug+="unknown NAL "+t.type+" ")}o&&s&&o.units.push(t)}),t&&o&&(this.pushAccesUnit(n,l),n.avcSample=void 0)}_createAVCSample(e,t,i,s){return{id:NaN,key:e,pts:t,dts:i,units:new Array,debug:s}}_insertSampleInOrder(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var s=i-1;s>=0;s--)if(t.pts<e[s].pts){e.splice(s,0,t);break}}else e.push(t)}_getLastNalUnit(){let e,t=this._avcContext,i=t.avcSample;if(!i||0===i.units.length){let e=t.parsingData.esSamples;i=e[e.length-1]}if(i){let t=i.units;e=t[t.length-1]}return e}_parseAVCNALu(e){var t,i,s,r,n=0,a=e.byteLength,o=this._avcContext,l=o.naluState||0,h=l,d=[],c=-1;for(-1===l&&(c=0,r=31&e[0],l=0,n=1);n<a;)if(t=e[n++],l)if(1!==l)if(t)if(1===t){if(c>=0)s={data:e.subarray(c,n-l-1),type:r},d.push(s);else{let t=this._getLastNalUnit();if(t&&(h&&n<=4-h&&t.state&&(t.data=t.data.subarray(0,t.data.byteLength-h)),(i=n-l-1)>0)){let s=new Uint8Array(t.data.byteLength+i);s.set(t.data,0),s.set(e.subarray(0,i),t.data.byteLength),t.data=s}}n<a?(c=n,r=31&e[n],l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(c>=0&&l>=0&&(s={data:e.subarray(c,a),type:r,state:l},d.push(s)),0===d.length){let t=this._getLastNalUnit();if(t){let i=new Uint8Array(t.data.byteLength+e.byteLength);i.set(t.data,0),i.set(e,t.data.byteLength),t.data=i}}return o.naluState=l,d}discardEPB(e){for(var t,i,s=e.byteLength,r=[],n=1;n<s-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;t=s-r.length,i=new Uint8Array(t);var a=0;for(n=0;n<t;a++,n++)a===r[0]&&(a++,r.shift()),i[n]=e[a];return i}_parseAACPES(e){var t,i,n,a,o,l,h,d,c=this._audioContext,u=e.data,f=e.pts,p=c.audioOverFlow,g=c.audioLastPTS,m=e.decryptdata;if(p){var y=new Uint8Array(p.byteLength+u.byteLength);y.set(p,0),y.set(u,p.byteLength),u=y}for(a=0,h=u.length;a<h-1&&(255!==u[a]||240!=(240&u[a+1]));a++);if(a){var v,_;a<h-1?(v="AAC PES did not start with ADTS header,offset:"+a,_=!1):(v="no ADTS header found in AAC PES",_=!0),this.logger.warn("parsing error:"+v)();let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:_,reason:v};if(this.observer.trigger(s.b.INTERNAL_ERROR,e),_)return}if(!c.config){let e=b(this.observer,u,a);if(!e)throw"unable to parse adts header";c.config=e}if(n=0,i=9216e4/c.config.samplerate,p&&g){var T=g+i;Math.abs(T-f)>1&&(f=T)}for(;a+5<h&&(o=1&u[a+1]?7:9,t=(3&u[a+3])<<11|u[a+4]<<3|(224&u[a+5])>>>5,(t-=o)>0&&a+o+t<=h);)for(l=f+n*i,d={unit:u.subarray(a+o,a+o+t),pts:l,dts:l,decryptdata:m},c.parsingData.esSamples.push(d),c.parsingData.len+=t,a+=t+o,n++;a<h-1&&(255!==u[a]||240!=(240&u[a+1]));a++);p=a<h?u.subarray(a,h):void 0,c.audioOverFlow=p,c.audioLastPTS=l}_parseMPEGPES(e){"mp3"===this._audioContext.segmentCodec&&S.parse(this._audioContext.parsingData,e.data,0,e.pts)}_parseDolbyPES(e){let t=this._audioContext,i=e.data,n=e.pts,a=e.decryptdata,o=0,l=0,h=t.audioOverFlow,u=t.audioLastPTS;if(!t.config){let e;if("ac3"===t.segmentCodec?e=v(this.observer,i,l):"ec3"===t.segmentCodec&&(e=c(this.observer,i,l)),!e)throw"unable to parse dolby header";t.config=e}if("ac3"!==t.config.segmentCodec&&"ec3"!==t.config.segmentCodec)throw"unexpected config type";const f=1536/t.config.samplerate*t.info.inputTimescale;if(h){var p=new Uint8Array(h.byteLength+i.byteLength);p.set(h,0),p.set(i,h.byteLength),i=p}let g=i.length;if(h&&u){var m=u+f;Math.abs(m-n)>1&&(n=m)}let y=0;for(;l+y<=g;){if(11!==i[l]||119!==i[l+1]){let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid dolby audio magic"};return void this.observer.trigger(s.b.INTERNAL_ERROR,e)}"ac3"===t.segmentCodec?y=_(this.observer,i,l):"ec3"===t.segmentCodec&&(y=d(this.observer,i,l));let e=n+o*f;t.audioLastPTS=e;let h={unit:i.subarray(l,l+y),pts:e,dts:e,decryptdata:a};t.parsingData.esSamples.push(h),t.info.duration=this._duration,t.parsingData.len+=y,l+=y,o++}h=l<g?i.subarray(l,g):void 0,t.audioOverFlow=h}},remux:N},{demux:class extends f{resetInitSegment(e,t){this.audioConfig=void 0,this.audioTrack=void 0,this.duration=t}static probe(e){let t=new l(e),i=t.length;return!(!t.hasTimeStamp||11!==e[i]||119!==e[i+1]||16!==(new h).bsReadAndUpdate(e,{byteOffset:i+5,usedBits:0},5))}append(e,t,i,s,r){const n=new l(e),a=90*n.timeStamp,o=e.length;let h=0,u=n.length;if(this.audioConfig||(this.audioConfig=c(this.observer,e,u)),!this.audioConfig)throw"failed to parse ec-3 config";if(!this.audioTrack){let e={id:258,inputTimescale:9e4,timescale:NaN,duration:this.duration,encrypted:!1,decryptdata:r},t={len:0,sequenceNumber:0,esSamples:[]};this.audioTrack={info:e,parsingData:t,type:"audio",config:this.audioConfig}}const f=y(this.audioConfig,this.audioTrack.info.inputTimescale);for("zec3"===n.audioType&&(this.audioTrack.info.encrypted=!0);u<o;){let t=d(this.observer,e,u),i=a+h*f,s={unit:e.subarray(u,u+t),pts:i,dts:i,decryptdata:r};this.audioTrack.parsingData.esSamples.push(s),this.audioTrack.parsingData.len+=t,u+=t,h++}this.esRemuxer.remuxEsTracks(this.audioTrack,void 0,{id3Samples:[{pts:a,dts:a,data:n.payload,frames:n.frames}],inputTimescale:this.audioTrack.info.inputTimescale},void 0,t,i,s,r)}},remux:N},{demux:class extends f{resetInitSegment(e,t){this.audioConfig=void 0,this.audioTrack=void 0,this.duration=t}static probe(e){const t=new l(e),i=t.length;return!!(t.hasTimeStamp&&11===e[i]&&119===e[i+1]&&(new h).bsReadAndUpdate(e,{byteOffset:i+5,usedBits:0},5)<16)}append(e,t,i,n,a){let o=new l(e),h=90*o.timeStamp,d=e.byteLength,c=0,u=o.length;if(this.audioConfig||(this.audioConfig=v(this.observer,e,u)),!this.audioConfig)throw"failed to parse ac3 config";if(!this.audioTrack){let e={id:258,inputTimescale:9e4,timescale:NaN,duration:this.duration,encrypted:!1,decryptdata:a},t={len:0,sequenceNumber:0,esSamples:[]};this.audioTrack={info:e,parsingData:t,type:"audio",config:this.audioConfig}}const f=y(this.audioConfig,this.audioTrack.info.inputTimescale);for("zac3"===o.audioType&&(this.audioTrack.info.encrypted=!0);u<d;){if(l.isHeader(e,u)&&(u+=new l(e.subarray(u)).length),11!==e[u]||119!==e[u+1]){let e={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ac-3 magic"};return void this.observer.trigger(s.b.INTERNAL_ERROR,e)}let t=_(this.observer,e,u),i=h+c*f,n={unit:e.subarray(u,u+t),pts:i,dts:i,decryptdata:a};this.audioTrack.parsingData.esSamples.push(n),this.audioTrack.parsingData.len+=t,u+=t,c++}this.esRemuxer.remuxEsTracks(this.audioTrack,void 0,{id3Samples:[{pts:h,dts:h,data:o.payload,frames:o.frames}],inputTimescale:this.audioTrack.info.inputTimescale},void 0,t,i,n,a)}},remux:N},{demux:class extends f{resetInitSegment(e,t){this.audioConfig=void 0,this.audioTrack=void 0,this.duration=t}static probe(e){let t,i;for(t=new l(e).length,i=Math.min(e.length-1,t+100);t<i;t++)if(255===e[t]&&240==(246&e[t+1]))return!0;return!1}append(e,t,i,s,r){const n=new l(e,this.logger),a=n.hasTimeStamp?90*n.timeStamp:9e4*t;let o,h,d,c,u,f,p,g;for(n.hasTimeStamp||this.logger.info("missing id3 timestamp at timeOffset "+t.toFixed(3))(),c=n.length,p=e.length;c<p-1&&(255!==e[c]||240!=(246&e[c+1]));c++);if(!this.audioConfig&&(this.audioConfig=b(this.observer,e,c),!this.audioConfig))throw"failed to parse adts config";if(!this.audioTrack){let e={id:258,inputTimescale:9e4,timescale:NaN,duration:this.duration,encrypted:!1,decryptdata:r},t={len:0,sequenceNumber:0,esSamples:[]};this.audioTrack={info:e,parsingData:t,type:"audio",config:this.audioConfig}}for("zaac"!==n.audioType&&"zach"!==n.audioType&&"zacp"!==n.audioType||(this.audioTrack.info.encrypted=!0),d=0,h=9216e4/this.audioConfig.samplerate;c+5<p&&(u=1&e[c+1]?7:9,o=(3&e[c+3])<<11|e[c+4]<<3|(224&e[c+5])>>>5,(o-=u)>0&&c+u+o<=p);)for(f=a+d*h,g={unit:e.subarray(c+u,c+u+o),pts:f,dts:f,decryptdata:r},this.audioTrack.parsingData.esSamples.push(g),this.audioTrack.parsingData.len+=o,c+=o+u,d++;c<p-1&&(255!==e[c]||240!=(246&e[c+1]));c++);let m=void 0,y=void 0,v=void 0;n.length&&(v=n.payload,n.frames.length&&(y=n.frames),m={id3Samples:[{pts:a,dts:a,data:v,frames:y}],inputTimescale:9e4}),this.esRemuxer.remuxEsTracks(this.audioTrack,void 0,m,void 0,t,i,s,r)}},remux:N},{demux:x,remux:R},{demux:class extends f{resetInitSegment(e,t){this.audioConfig=void 0,this.audioTrack=void 0,this.duration=t}static probe(e){let t,i,s=new l(e);if(s.hasTimeStamp)for(t=s.length,i=Math.min(e.length-1,t+100);t<i;t++)if(S.probe(e,t))return n.b.warn("MPEG Audio sync word found !")(),!0;return!1}append(e,t,i,s,r){const n=new l(e),a=90*n.timeStamp;let o,h;for(o=n.length,h=e.length;o<h-1&&(255!==e[o]||224!=(224&e[o+1])||0==(6&e[o+1]));o++);if(this.audioConfig||(this.audioConfig=S.getAudioConfig(e,n.length)),!this.audioConfig)throw"unable to parse mp3 header";if(!this.audioTrack){let e={id:258,inputTimescale:9e4,timescale:NaN,duration:this.duration,encrypted:!1,decryptdata:r},t={len:0,sequenceNumber:0,esSamples:[]};this.audioTrack={info:e,parsingData:t,type:"audio",config:this.audioConfig}}S.parse(this.audioTrack.parsingData,e,n.length,a),this.esRemuxer.remuxEsTracks(this.audioTrack,void 0,{id3Samples:[{pts:a,dts:a,data:n.payload,frames:n.frames}],inputTimescale:9e4},void 0,t,i,s)}},remux:N}];for(let s of a){const{probe:r}=s.demux;if(r(D)){this.remuxer=new s.remux(e,i,t,this.vendor),I=new s.demux(e,this.remuxer,i,t,this.logger),this.probeFn=r;break}}if(!I){let t={type:r.g.MEDIA_ERROR,details:r.d.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"};return void e.trigger(s.b.INTERNAL_ERROR,t)}this.demuxer=I}const L=this.remuxer;let k=!this.lastDecryptData||t&&"NONE"!==t.method&&this.lastDecryptData.uri!==t.uri;this.lastDecryptData=t,(o||u||k)&&(I.resetInitSegment(i,g,t,o),L.resetInitSegment()),o&&(I.resetTimeStamp(T),L.resetTimeStamp(T)),I.append(D,a,p,m,t,E,w)}}},function(e,t,i){"use strict";class s{constructor(e,t){this.subtle=e,this.iv=t}decrypt(e,t){const{iv:i,subtle:s}=this;return s.decrypt({name:"AES-CBC",iv:i},t,e)}}class r{constructor(e,t){this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC",length:null},!1,["encrypt","decrypt"])}}class n{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=Math.floor(t.byteLength/4),s=new Uint32Array(i);for(let r=0;r<i;r++)s[r]=t.getUint32(4*r);return s}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],r=i[1],n=i[2],a=i[3],o=this.invSubMix,l=o[0],h=o[1],d=o[2],c=o[3],u=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)u[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let i=p^p<<1^p<<2^p<<3^p<<4;i=i>>>8^255&i^99,e[f]=i,t[i]=f;const o=u[f],g=u[o],m=u[g];let y=257*u[i]^16843008*i;s[f]=y<<24|y>>>8,r[f]=y<<16|y>>>16,n[f]=y<<8|y>>>24,a[f]=y,y=16843009*m^65537*g^257*o^16843008*f,l[i]=y<<24|y>>>8,h[i]=y<<16|y>>>16,d[i]=y<<8|y>>>24,c[i]=y,f?(f=o^u[u[u[m^o]]],p^=u[u[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;let r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const n=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(n),h=this.invKeySchedule=new Uint32Array(n),d=this.sBox,c=this.rcon,u=this.invSubMix,f=u[0],p=u[1],g=u[2],m=u[3];let y,v;for(a=0;a<n;a++)a<r?y=l[a]=t[a]:(v=y,a%r==0?(v=d[(v=v<<8|v>>>24)>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v],v^=c[a/r|0]<<24):r>6&&a%r==4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v]),l[a]=y=(l[a-r]^v)>>>0);for(o=0;o<n;o++)a=n-o,v=3&o?l[a]:l[a-4],h[o]=o<4||a<=4?v:f[d[v>>>24]]^p[d[v>>>16&255]]^g[d[v>>>8&255]]^m[d[255&v]],h[o]=h[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],h=a[2],d=a[3],c=this.uint8ArrayToUint32Array_(i);let u=c[0],f=c[1],p=c[2],g=c[3];const m=new Int32Array(e),y=new Int32Array(m.length);let v,_,b,T,S,E,w,I,D,L,k,R;var C,A;const P=this.networkToHostOrderSwap;for(;t<m.length;){for(D=P(m[t]),L=P(m[t+1]),k=P(m[t+2]),R=P(m[t+3]),S=D^r[0],E=R^r[1],w=k^r[2],I=L^r[3],C=4,A=1;A<s;A++)v=o[S>>>24]^l[E>>16&255]^h[w>>8&255]^d[255&I]^r[C],_=o[E>>>24]^l[w>>16&255]^h[I>>8&255]^d[255&S]^r[C+1],b=o[w>>>24]^l[I>>16&255]^h[S>>8&255]^d[255&E]^r[C+2],T=o[I>>>24]^l[S>>16&255]^h[E>>8&255]^d[255&w]^r[C+3],S=v,E=_,w=b,I=T,C+=4;v=n[S>>>24]<<24^n[E>>16&255]<<16^n[w>>8&255]<<8^n[255&I]^r[C],_=n[E>>>24]<<24^n[w>>16&255]<<16^n[I>>8&255]<<8^n[255&S]^r[C+1],b=n[w>>>24]<<24^n[I>>16&255]<<16^n[S>>8&255]<<8^n[255&E]^r[C+2],T=n[I>>>24]<<24^n[S>>16&255]<<16^n[E>>8&255]<<8^n[255&w]^r[C+3],C+=3,y[t]=P(v^u),y[t+1]=P(T^f),y[t+2]=P(b^p),y[t+3]=P(_^g),u=D,f=L,p=k,g=R,t+=4}return y.buffer}destroy(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}var a=i(0),o=i(1),l=i(2);class h{constructor(e,t){this.observer=e,this.config=t,this.logEnabled=!0;try{const e=crypto||self.crypto;this.subtle=e.subtle||e.webkitSubtle}catch(e){l.b.error(e)()}this.disableWebCrypto=!this.subtle}isSync(){return this.disableWebCrypto&&this.config.enableSoftwareAES}decrypt(e,t,i,a){if(!this.disableWebCrypto||!this.config.enableSoftwareAES){this.logEnabled&&(this.logEnabled=!1);const n=this.subtle;return this.key!==t&&(this.key=t,this.fastAesKey=new r(n,t)),this.fastAesKey.expandKey().then(r=>{new s(n,i).decrypt(e,r).then(e=>{try{a(e)}catch(e){l.b.error(e)()}}).catch(s=>{this.onWebCryptoError(s,e,t,i,a)})}).catch(s=>{this.onWebCryptoError(s,e,t,i,a)})}{this.logEnabled&&(this.logEnabled=!1),this.decryptor||(this.decryptor=new n);const{decryptor:s}=this;s.expandKey(t),a(s.decrypt(e,0,i))}}onWebCryptoError(e,t,i,s,r){if(this.config.enableSoftwareAES)this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,s,r);else{l.b.error("decrypting error : "+e.message)();let t={type:a.g.MEDIA_ERROR,details:a.d.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message};this.observer.trigger(o.b.INTERNAL_ERROR,t)}}destroy(){this.decryptor&&(this.decryptor.destroy(),this.decryptor=void 0)}}i.d(t,"a",(function(){return d}));class d{constructor(e,t){this.observer=e,this.config=t}destroy(){this.decryptor&&this.decryptor.destroy()}decrypt(e,t,i){if(e.byteLength>0&&t&&t.key&&t.iv&&"AES-128"===t.method){null==this.decryptor&&(this.decryptor=new h(this.observer,this.config));try{performance.now()}catch(e){Date.now()}return this.decryptor.decrypt(e,t.key.buffer,t.iv.buffer,e=>{try{performance.now()}catch(e){Date.now()}i&&i(e)})}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"\u200e","&rlm;":"\u200f","&nbsp;":"\xa0"},r={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},n={v:"title",lang:"lang"},a={rt:"ruby"},o={"text-combine-upright":"-webkit-text-combine:horizontal; text-orientation: mixed;"};class l{static parseTimeStamp(e){function t(e){const[t,i,s,r]=e.map(e=>e?parseInt(""+e):0);return 3600*t+60*i+s+r/1e3}const i=/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/.exec(e);return i?i[3]?t([i[1],i[2],i[3].substring(1),i[4]]):parseInt(i[1])>59?t([i[1],i[2],null,i[4]]):t([null,i[1],i[2],i[4]]):null}static parseContent(e,t,i){let h=t.text;function d(){if(!h)return null;const e=/^([^<]*)(<[^>]+>?)?/.exec(h);return t=e[1]?e[1]:e[2],h=h.substr(t.length),t;var t}function c(e){return s[e]}function u(e,t){return!a[t.dataset.localName]||a[t.dataset.localName]===e.dataset.localName}function f(t,s,a){const l=r[t];if(!l)return null;const h=e.document.createElement(l);h.dataset.localName=l;const d=n[t];if(d&&a&&(h[d]=a.trim()),s)if(i[s]){const e=function(e){let t="";for(const i in e)t+=o[i]?o[i]:i+":"+e[i]+";";return t}(i[s]);h.setAttribute("style",e)}else console.info(`WebVTT: parseContent: Style referenced, but no style defined for '${s}'!`);return h}const p=e.document.createElement("div"),g=[];let m,y,v=p;for(;null!==(m=d());)if("<"!==m[0])v.appendChild(e.document.createTextNode(m.replace(/&(amp|lt|gt|lrm|rlm|nbsp);/g,c)));else{if("/"===m[1]){g.length&&g[g.length-1]===m.substr(2).replace(">","")&&(g.pop(),v=v.parentNode);continue}const t=l.parseTimeStamp(m.substr(1,m.length-2));let i;if(t){i=e.document.createProcessingInstruction("timestamp",t.toString()),v.appendChild(i);continue}if(!(y=/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/.exec(m)))continue;if(!(i=f(y[1],y[2],y[3])))continue;if(!u(v,i))continue;y[2],g.push(y[1]),v.appendChild(i),v=i}return p}}t.default=l},function(e,t,i){"use strict";t.a={hexDump:function(e){var t,i="";for(t=0;t<e.length;t++){var s=e[t].toString(16);s.length<2&&(s="0"+s),i+=s}return i}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0});const r=i(19),n=i(16);let a=class{constructor(e,t,i){this._id="",this._pauseOnExit=!1,this._region=null,this._vertical="",this._snapToLines=!0,this._line="auto",this._lineAlign="start",this._position=50,this._positionAlign="center",this._size=50,this._align="center",this.hasBeenReset=!1,this._startTime=e,this._endTime=t,this._text=i}get id(){return this._id}set id(e){this._id=""+e}get pauseOnExit(){return this._pauseOnExit}set pauseOnExit(e){this._pauseOnExit=!!e}get startTime(){return this._startTime}set startTime(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number: "+e);this._startTime=e,this.hasBeenReset=!0}get endTime(){return this._endTime}set endTime(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number: "+e);this._endTime=e,this.hasBeenReset=!0}get text(){return this._text}set text(e){this._text=""+e,this.hasBeenReset=!0}get region(){return this._region}set region(e){this._region=e,this.hasBeenReset=!0}get vertical(){return this._vertical}set vertical(e){if(!r.isValidDirectionSetting(e))throw new SyntaxError("An invalid or illegal string was specified for vertical: "+e);this._vertical=e,this.hasBeenReset=!0}get snapToLines(){return this._snapToLines}set snapToLines(e){this._snapToLines=!!e,this.hasBeenReset=!0}get line(){return this._line}set line(e){if(!r.isValidLineAndPositionSetting(e))throw new SyntaxError("An invalid number or illegal string was specified for line: "+e);this._line=e,this.hasBeenReset=!0}get lineAlign(){return this._lineAlign}set lineAlign(e){if(!r.isValidLineAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for lineAlign: "+e);this._lineAlign=e,this.hasBeenReset=!0}get position(){return this._position}set position(e){if(!r.isValidLineAndPositionSetting(e))throw new Error("Position must be between 0 and 100 or auto: "+e);this._position=e,this.hasBeenReset=!0}get positionAlign(){return this._positionAlign}set positionAlign(e){if(!r.isValidPositionAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for positionAlign: "+e);this._positionAlign=e,this.hasBeenReset=!0}get size(){return this._size}set size(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100: "+e);this._size=e,this.hasBeenReset=!0}get align(){return this._align}set align(e){if(!r.isValidAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for align: "+e);this._align=e,this.hasBeenReset=!0}getCueAsHTML(){return n.default.parseContent(window,this,{})}static create(e){if(!e.hasOwnProperty("startTime")||!e.hasOwnProperty("endTime")||!e.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");const t=new this(e.startTime,e.endTime,e.text);return Object.keys(e).forEach(i=>{t.hasOwnProperty(i)&&(t[i]=e[i])}),t}static fromJSON(e){return this.create(JSON.parse(e))}toJSON(){const e={};return Object.keys(this).forEach(t=>{this.hasOwnProperty(t)&&"getCueAsHTML"!==t&&"hasBeenReset"!==t&&"displayState"!==t&&(e[t]=this[t])}),e}};a=s([function(e){let t=e;return"undefined"!=typeof window&&null!=window.VTTCue&&((t=window.VTTCue).create=e.create,t.fromJSON=e.fromJSON,t.prototype.toJSON=e.prototype.toJSON),t}],a),t.VTTCue=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidPercentValue=function(e){return"number"==typeof e&&e>=0&&e<=100},t.isValidAlignSetting=function(e){return"string"==typeof e&&["start","center","end","left","right","middle"].includes(e)},t.isValidDirectionSetting=function(e){return"string"==typeof e&&["","rl","lr"].includes(e)},t.isValidLineAndPositionSetting=function(e){return"number"==typeof e||"auto"===e},t.isValidLineAlignSetting=function(e){return"string"==typeof e&&["start","center","end"].includes(e)},t.isValidPositionAlignSetting=function(e){return"string"==typeof e&&["line-left","center","line-right","auto","left","start","middle","end","right"].includes(e)},t.isValidScrollSetting=function(e){return["","up"].includes(e)}},function(e,s,r){"use strict";!function(e,t){if(!e.setImmediate){var s,r,n,a,o,l=1,h={},d=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?s=function(e){i.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?(a="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&p(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),s=function(t){e.postMessage(a+t,"*")}):e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){p(e.data)},s=function(e){n.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(r=c.documentElement,s=function(e){var t=c.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):s=function(e){setTimeout(p,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return h[l]=r,s(l),l++},u.clearImmediate=f}function f(e){delete h[e]}function p(e){if(d)setTimeout(p,0,e);else{var t=h[e];if(t){d=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(void 0,i)}}(t)}finally{f(e),d=!1}}}}}("undefined"==typeof self?"undefined"==typeof t?this:t:self)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(18);t.VTTCue=s.VTTCue;const r=i(22);t.VTTRegion=r.VTTRegion;const n=i(16);class a extends Error{constructor(e,t){super(),this.name="ParsingError",this.code="number"==typeof e?e:e.code,t?this.message=t:e instanceof a&&(this.message=e.message)}}t.ParsingError=a,a.Errors={BadSignature:new a(0,"Malformed WebVTT signature."),BadTimeStamp:new a(1,"Malformed time stamp.")};class o{constructor(){this.values={}}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return"object"==typeof t&&"string"==typeof i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(t.match(/^([\d]{1,3})(\.[\d]*)?%$/))try{const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}catch(e){return!1}return!1}}class l{constructor(e,t,i){this.window=e,this.state="INITIAL",this.styleCollector="",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[],this.onStylesParsedCallback=i,this._styles={}}static StringDecoder(){return{decode:e=>{if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}reportOrThrowError(e){if(!(e instanceof a&&"function"==typeof this.onparsingerror))throw e;this.onparsingerror(e)}parseOptions(e,t,i,s){const r=s?e.split(s):[e];for(const n of r){if("string"!=typeof n)continue;const e=n.split(i);2===e.length&&t(e[0],e[1])}}parseCue(e,t,i){const s=e,r=()=>{const t=n.default.parseTimeStamp(e);if(null===t)throw new a(a.Errors.BadTimeStamp,"Malformed timestamp: "+s);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t},l=()=>{e=e.replace(/^\s+/,"")};if(l(),t.startTime=r(),l(),"--\x3e"!==e.substr(0,3))throw new a(a.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+s);e=e.substr(3),l(),t.endTime=r(),l(),((e,t)=>{const s=new o;this.parseOptions(e,(e,t)=>{let r,n;switch(e){case"region":for(let r=i.length-1;r>=0;r--)if(i[r].id===t){s.set(e,i[r].region);break}break;case"vertical":s.alt(e,t,["rl","lr"]);break;case"line":n=(r=t.split(","))[0],s.integer(e,n),s.percent(e,n)&&s.set("snapToLines",!1),s.alt(e,n,["auto"]),2===r.length&&s.alt("lineAlign",r[1],["start","center","end"]);break;case"position":if(r=t.split(","),s.percent(e,r[0]),2===r.length){let e=["line-left","line-right","center","auto","left","start","middle","end","right"];s.alt("positionAlign",r[1],e)}break;case"size":s.percent(e,t);break;case"align":let a=["start","center","end","left","right","middle"];s.alt(e,t,a)}},/:/,/\s/),t.region=s.get("region",null),t.vertical=s.get("vertical",""),t.line=s.get("line",void 0===t.line?"auto":t.line),t.lineAlign=s.get("lineAlign","start"),t.snapToLines=s.get("snapToLines",!0),t.size=s.get("size",100);let r=s.get("align","center");t.align="middle"===r?"center":r,t.position=s.get("position","auto");let n=s.get("positionAlign",{start:"start",left:"start",center:"center",right:"end",end:"end"},t.align);t.positionAlign={start:"start","line-left":"start",left:"start",center:"center",middle:"center","line-right":"end",right:"end",end:"end"}[n]})(e,t)}parseRegion(e){const t=new o;if(this.parseOptions(e,(e,i)=>{switch(e){case"id":t.set(e,i);break;case"width":t.percent(e,i);break;case"lines":t.integer(e,i);break;case"regionanchor":case"viewportanchor":{const s=i.split(",");if(2!==s.length)break;const r=new o;if(r.percent("x",s[0]),r.percent("y",s[1]),!r.has("x")||!r.has("y"))break;t.set(e+"X",r.get("x")),t.set(e+"Y",r.get("y"));break}case"scroll":t.alt(e,i,["up"])}},/=/,/\s/),t.has("id")){const e=new r.VTTRegion;e.width=t.get("width",100),e.lines=t.get("lines",3),e.regionAnchorX=t.get("regionanchorX",0),e.regionAnchorY=t.get("regionanchorY",100),e.viewportAnchorX=t.get("viewportanchorX",0),e.viewportAnchorY=t.get("viewportanchorY",100),e.scroll=t.get("scroll",""),this.onregion&&this.onregion(e),this.regionList.push({id:t.get("id"),region:e})}}parseStyle(e){const t=e=>{const t={},i=e.split(";");for(let s=0;s<i.length;s++)if(i[s].includes(":")){const e=i[s].split(":",2),r=e[0].trim(),n=e[1].trim();""!==r&&""!==n&&(t[r]=n)}return t},i=e.split("}");i.pop();for(const s of i){let e=null,i=null;const r=s.split("{");r[0]&&(e=r[0].trim()),r[1]&&(i=t(r[1])),e&&i&&(this._styles[e]=i)}this.onStylesParsedCallback&&this.onStylesParsedCallback(this._styles)}parseHeader(e){this.parseOptions(e,(function(e,t){switch(e){case"Region":this.parseRegion(t)}}),/:/)}parse(e){e&&(this.buffer+=this.decoder.decode(e,{stream:!0}));const t=()=>{const e=this.buffer;let t=0;const i=(e,t)=>{const i={start:-1,length:-1};if("\r"===e[t])i.start=t,i.length=1;else if("\n"===e[t])i.start=t,i.length=1;else if("<"===e[t]&&t+1<e.length&&"b"===e[t+1]&&t+2<e.length&&"r"===e[t+2]){let s=t+2;for(;s<e.length&&">"!==e[s++];);i.start=t,i.length=s-t}return i};let s={start:e.length,length:0};for(;t<e.length;){const r=i(e,t);if(r.length>0){s=r;break}++t}const r=e.substr(0,s.start);return this.buffer=e.substr(s.start+s.length),r};try{let i;if("INITIAL"===this.state){if(!/\r\n|\n/.test(this.buffer))return this;i=t();const e=/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/.exec(i);if(!e||!e[0])throw new a(a.Errors.BadSignature);this.state="HEADER"}let r=!1;for(;this.buffer;){if(!/\r\n|\n/.test(this.buffer))return this;switch(r?r=!1:i=t(),this.state){case"HEADER":i.includes(":")?this.parseHeader(i):i||(this.state="ID");continue;case"NOTE":i||(this.state="ID");continue;case"STYLE":i?this.styleCollector+=i:(this.parseStyle(this.styleCollector),this.state="ID",this.styleCollector="");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){this.state="NOTE";break}if(/^STYLE($|[ \t])/.test(i)){this.state="STYLE";break}if(!i)continue;if(this.cue=new s.VTTCue(0,0,""),this.state="CUE",!i.includes("--\x3e")){this.cue.id=i;continue}case"CUE":try{this.parseCue(i,this.cue,this.regionList)}catch(e){this.reportOrThrowError(e),this.cue=null,this.state="BADCUE";continue}this.state="CUETEXT";continue;case"CUETEXT":{const e=i.includes("--\x3e");if(!i||e){r=!0,this.oncue&&this.oncue(this.cue),this.cue=null,this.state="ID";continue}this.cue.text&&(this.cue.text+="\n"),this.cue.text+=i;continue}case"BADCUE":i||(this.state="ID");continue}}}catch(e){this.reportOrThrowError(e),"CUETEXT"===this.state&&this.cue&&this.oncue&&this.oncue(this.cue),this.cue=null,this.state="INITIAL"===this.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new a(a.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}styles(){return this._styles}}t.default=l,t.WebVTTParser=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0});const r=i(19);let n=class{constructor(){this._id="",this._lines=3,this._regionAnchorX=0,this._regionAnchorY=100,this._scroll="",this._viewportAnchorX=0,this._viewportAnchorY=100,this._width=100}get id(){return this._id}set id(e){if("string"!=typeof e)throw new Error("ID must be a string.");this._id=e}get lines(){return this._lines}set lines(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");this._lines=e}get regionAnchorX(){return this._regionAnchorX}set regionAnchorX(e){if(!r.isValidPercentValue(e))throw new TypeError("RegionAnchorX must be between 0 and 100.");this._regionAnchorX=e}get regionAnchorY(){return this._regionAnchorY}set regionAnchorY(e){if(!r.isValidPercentValue(e))throw new TypeError("RegionAnchorY must be between 0 and 100.");this._regionAnchorY=e}get scroll(){return this._scroll}set scroll(e){if("string"==typeof e){const t=e.toLowerCase();if(r.isValidScrollSetting(t))return void(this._scroll=t)}throw new SyntaxError("An invalid or illegal string was specified.")}get viewportAnchorX(){return this._viewportAnchorX}set viewportAnchorX(e){if(!r.isValidPercentValue(e))throw new TypeError("ViewportAnchorX must be between 0 and 100.");this._viewportAnchorX=e}get viewportAnchorY(){return this._viewportAnchorY}set viewportAnchorY(e){if(!r.isValidPercentValue(e))throw new TypeError("ViewportAnchorY must be between 0 and 100.");this._viewportAnchorY=e}get width(){return this._width}set width(e){if(!r.isValidPercentValue(e))throw new TypeError("Width must be between 0 and 100.");this._lines=e}toJSON(){const e={};return Object.keys(this).forEach(t=>{this.hasOwnProperty(t)&&(e[t]=this[t])}),e}static create(e){const t=new this;return Object.keys(e).forEach(i=>{t.hasOwnProperty(i)&&(t[i]=e[i])}),t}static fromJSON(e){return this.create(JSON.parse(e))}};n=s([function(e){let t=e;return"undefined"!=typeof window&&null!=window.VTTRegion&&((t=window.VTTRegion).create=e.create,t.fromJSON=e.fromJSON,t.prototype.toJSON=e.prototype.toJSON),t}],n),t.VTTRegion=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(18);t.VTTCue=s.VTTCue;const r=i(16),n=[/^(::cue\()(\..*)(\))/,/^(::cue\()(#.*)(\))/,/^(::cue\()(c|i|b|u|ruby|rt|v|lang)(\))/],a=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];class o{applyStyles(e,t){t=t||this.div;for(const i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i])}formatStyle(e,t){return 0===e?"0":e+t}}t.StyleBox=o;class l extends o{constructor(e,t,i,s,n){super(),this.cue=t;let a={textAlign:{start:"left","line-left":"left",left:"left",center:"center",middle:"center","line-right":"right",right:"right",end:"right"}[t.positionAlign]||t.align,whiteSpace:"pre-line",position:"absolute"};a.direction=this.determineBidi(this.cueDiv),a.writingMode=this.directionSettingToWritingMode(t.vertical),a.unicodeBidi="plaintext",this.div=e.document.createElement("div"),this.applyStyles(a),a={backgroundColor:s.backgroundColor,display:"inline-block"},this.parseOpacity(a.backgroundColor)&&(a.padding="5px",a.borderRadius="5px"),this.backgroundDiv=e.document.createElement("div"),this.applyStyles(a,this.backgroundDiv),(a={color:i.color,backgroundColor:i.backgroundColor,textShadow:i.textShadow,fontSize:i.fontSize,fontFamily:i.fontFamily,position:"relative",left:"0",right:"0",top:"0",bottom:"0",display:"inline-block",textOrientation:"upright"}).writingMode=this.directionSettingToWritingMode(t.vertical),a.unicodeBidi="plaintext",this.cueDiv=r.default.parseContent(e,t,n),this.applyStyles(a,this.cueDiv),this.backgroundDiv.appendChild(this.cueDiv),this.div.appendChild(this.backgroundDiv);let o=0;if("number"==typeof t.position){let e=t.positionAlign||t.align;if(e)switch(e){case"start":case"left":o=t.position;break;case"center":case"middle":o=t.position-t.size/2;break;case"end":case"right":o=t.position-t.size}}""===t.vertical?this.applyStyles({left:this.formatStyle(o,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(o,"%"),height:this.formatStyle(t.size,"%")})}determineBidi(e){let t,i=[],s="";if(!e||!e.childNodes)return"ltr";function r(e,t){for(let i=t.childNodes.length-1;i>=0;i--)e.push(t.childNodes[i])}function n(e){if(!e||!e.length)return null;let t=e.pop(),i=t.textContent||t.innerText;if(i){const t=/^.*(\n|\r)/.exec(i);return t?(e.length=0,t[0]):i}return"ruby"===t.tagName?n(e):t.childNodes?(r(e,t),n(e)):void 0}function o(e,t){for(const i of t)if(e>=i[0]&&e<=i[1])return!0;return!1}for(r(i,e);s=n(i);)for(let e=0;e<s.length;e++)if(o(t=s.charCodeAt(e),a))return"rtl";return"ltr"}parseOpacity(e){if(!e||"string"!=typeof e)return null;const t=(e=e.replace(/ /g,"").replace("rgba(","").replace(")","")).split(",");return t&&t.length>=4?t[3]:null}directionSettingToWritingMode(e){return""===e?"horizontal-tb":"lr"===e?"vertical-lr":"vertical-rl"}move(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}t.CueStyleBox=l;class h{constructor(e){var t;let i,s,r,n,a,o;if(e instanceof l&&e.cue?(t=e.cue)&&""!==t.vertical?this.property="width":this.property="height":e instanceof h&&(this.property=e.property||"height"),e instanceof l&&e.div){r=e.div.offsetHeight,n=e.div.offsetWidth,a=e.div.offsetTop;const t=e.div.firstChild;if(i=(o=t?t.getBoundingClientRect():e.div.getBoundingClientRect())&&o[this.property]||null,t&&t.firstChild){const e=t.firstChild;e&&"string"==typeof e.textContent&&(s=i/this.calculateNewLines(e.textContent))}}else e instanceof h&&(o=e);this.left=o.left,this.right=o.right,this.top=o.top||a,this.height=o.height||r,this.bottom=o.bottom||a+(o.height||r),this.width=o.width||n,this.lineHeight=null!==i?i:o.lineHeight,this.singleLineHeight=null!==s?s:o.singleLineHeight,this.singleLineHeight||(this.singleLineHeight=41)}calculateNewLines(e){let t=1;for(let i=0;i<e.length;i++)"\n"===e[i]&&t++;return t}move(e,t){switch(t=void 0!==t?t:this.singleLineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}}overlaps(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top}overlapsAny(e){for(const t of e)if(this.overlaps(t))return!0;return!1}within(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right}moveIfOutOfBounds(e,t){switch(t){case"+x":this.left<e.left&&(this.left=e.left,this.right=this.left+this.width);break;case"-x":this.right>e.right&&(this.right=e.right,this.left=this.right-this.width);break;case"+y":this.top<e.top&&(this.top=e.top,this.bottom=this.top+this.height);break;case"-y":this.bottom>e.bottom&&(this.bottom=e.bottom,this.top=this.bottom-this.height)}}toCSSCompatValues(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}}static getSimpleBoxPosition(e){let t=null;e instanceof o&&e.div?t=e.div:e instanceof HTMLElement&&(t=e);let i=t.offsetHeight||0,s=t.offsetWidth||0,r=t.offsetTop||0,n=r+i,a=t.getBoundingClientRect();const{left:l,right:h}=a;return a.top&&(r=a.top),a.height&&(i=a.height),a.width&&(s=a.width),a.bottom&&(n=a.bottom),{left:l,right:h,top:r,height:i,bottom:n,width:s}}static getBoxPosition(e,t){if(e&&e.length>0){let i=0,s=e[0][t];for(let r=0;r<e.length;r++)t in["top","right"]?e[r][t]>s&&(i=r,s=e[r][t]):t in["bottom","left"]&&e[r][t]<s&&(i=r,s=e[r][t]);return e[i]}return null}static moveToMinimumDistancePlacement(e,t,i){"height"===e.property?"+y"===t?(e.top=i.topMostBoxPosition.bottom+0,e.bottom=e.top+e.height):"-y"===t&&(e.bottom=i.bottomMostBoxPosition.top-0,e.top=e.bottom-e.height):"width"===e.property&&("+x"===t?(e.left=i.rightMostBoxPosition.right+0,e.right=e.left+e.width):"-x"===t&&(e.right=i.leftMostBoxPosition.left-0,e.left=e.right-e.width))}static moveBoxToLinePosition(e,t,i){const s=e.cue;let r,n=new h(e),a=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;let t=0;const i=e.track,s=i.textTrackList;for(let r=0;r<s.length&&s[r]!==i;r++)"showing"===s[r].mode&&t++;return-1*++t}(s),o=[];if(s.snapToLines){let e=0;switch(s.vertical){case"":o=["+y","-y"],r="height";break;case"rl":o=["+x","-x"],r="width";break;case"lr":o=["-x","+x"],r="width"}const i=n.lineHeight,l=t[r]+i,h=o[0];if(a<0){let r=0;switch(s.vertical){case"":r=t.height-i-.05*t.height;break;case"rl":case"lr":r=-t.width+i+.05*t.width}e=r,o=o.reverse()}else{switch(s.vertical){case"":e=i*Math.round(a);break;case"rl":e=t.width-i*Math.round(a);break;case"lr":e=i*Math.round(a)}Math.abs(e)>l&&(e=e<0?-1:1,e*=Math.ceil(l/i)*i)}n.move(h,e)}else{const i=""===s.vertical?t.height:t.width,r=n.lineHeight/i*100;switch(s.lineAlign){case"center":a-=r/2;break;case"end":a-=r}switch(s.vertical){case"":e.applyStyles({top:e.formatStyle(a,"%")});break;case"rl":e.applyStyles({right:e.formatStyle(a,"%")});break;case"lr":e.applyStyles({left:e.formatStyle(a,"%")})}o=["+y","-y","+x","-x"],"+y"===s.axis?o=["+y","-y","+x","-x"]:"-y"===s.axis&&(o=["-y","+y","+x","-x"]),n=new h(e)}const l=function(e,s){let r;for(let n=0;n<s.length;n++){e.moveIfOutOfBounds(t,s[n]);let a=0,o=!1;for(;e.overlapsAny(i)&&!(a>9);)o?e.move(s[n]):(i&&i.length>0&&(r||(r={topMostBoxPosition:h.getBoxPosition(i,"top"),bottomMostBoxPosition:h.getBoxPosition(i,"bottom"),leftMostBoxPosition:h.getBoxPosition(i,"left"),rightMostBoxPosition:h.getBoxPosition(i,"right")}),h.moveToMinimumDistancePlacement(e,s[n],r)),o=!0),a++}return e}(n,o);e.move(l.toCSSCompatValues(t))}}t.BoxPosition=h;class d{constructor(e,t,i=!0){if(!e)return null;this.window=e,this.overlay=t,this.loggingEnabled=i,this.foregroundStyleOptions={fontFamily:"Helvetica",fontSize:"36px",color:"rgba(255, 255, 255, 1)",textShadow:"",backgroundColor:"rgba(0, 0, 0, 0)"},this.backgroundStyleOptions={backgroundColor:"rgba(0, 0, 0, 0.5)"},this.globalStyleCollection={};const s=e.document.createElement("div");s.style.position="absolute",s.style.left="0",s.style.right="0",s.style.top="0",s.style.bottom="0",s.style.margin="1.5%",this.paddedOverlay=s,t.appendChild(this.paddedOverlay),this.initSubtitleCSS()}initSubtitleCSS(){const e=[new s.VTTCue(0,0,"String to init CSS - Won't be visible to user")];this.paddedOverlay.style.opacity="0",this.processCues(e),this.processCues([]),this.paddedOverlay.style.opacity="1"}convertCueToDOMTree(e){return e?r.default.parseContent(this.window,e,this.globalStyleCollection):null}setStyles(e){function t(e,t,i){for(const s in t)t.hasOwnProperty(s)&&(!0===i&&void 0!==e[s]||!1===i)&&(e[s]=t[s])}for(const i in e){let s=!1,r=null;"::cue"===i?(r=this.foregroundStyleOptions,s=!0):"::-webkit-media-text-track-display"===i&&(r=this.backgroundStyleOptions,s=!0);const a=e[i];if(!0===s)t(r,a,s);else for(let e=0;e<n.length;e++){const r=n[e].exec(i);if(r&&4===r.length){const e=r[2],i={};t(i,a,s),this.globalStyleCollection[e]=i}}}this.initSubtitleCSS(),this.loggingEnabled&&(console.log("WebVTTRenderer setStyles foregroundStyleOptions: "+JSON.stringify(this.foregroundStyleOptions)),console.log("WebVTTRenderer setStyles backgroundStyleOptions: "+JSON.stringify(this.backgroundStyleOptions)),console.log("WebVTTRenderer setStyles globalStyleCollection: "+JSON.stringify(this.globalStyleCollection)))}processCues(e){if(!e)return;for(;this.paddedOverlay.firstChild;)this.paddedOverlay.removeChild(this.paddedOverlay.firstChild);if(!function(e){for(let t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(e)){for(let t=0;t<e.length;t++)this.paddedOverlay.appendChild(e[t].displayState);return}const t=[],i=h.getSimpleBoxPosition(this.paddedOverlay);e.length>1&&(e=function(e){const t=[];let i=0;for(let s=0;s<e.length;s++){let r=e[s];if("number"!=typeof r.line)return e;i+=r.line,t.push(r)}return(i/=e.length)>50?(t.forEach((function(e){e.axis="-y"})),t.sort((e,t)=>t.line-e.line)):(t.forEach((function(e){e.axis="+y"})),t.sort((e,t)=>e.line-t.line)),t}(e));for(let s=0;s<e.length;s++){let r=e[s],n=new l(this.window,r,this.foregroundStyleOptions,this.backgroundStyleOptions,this.globalStyleCollection);this.paddedOverlay.appendChild(n.div),h.moveBoxToLinePosition(n,i,t),r.displayState=n.div,t.push(h.getSimpleBoxPosition(n))}}setSize(e,t){e&&(this.overlay.style.width=e+"px"),t&&(this.overlay.style.height=t+"px")}getOverlay(){return this.overlay}}t.default=d,t.WebVTTRenderer=d},function(e,t,i){"use strict";function s(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var s=i(i.s=ENTRY_MODULE);return s.default||s}var r="[\\.|\\-|\\+|\\w|/|@]+",n="\\((/\\*.*?\\*/)?s?.*?("+r+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,s){var o={};o[s]=[];var l=t.toString(),h=l.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!h)return o;for(var d,c=h[1],u=new RegExp("(\\\\n|\\W)"+a(c)+n,"g");d=u.exec(l);)"dll-reference"!==d[3]&&o[s].push(d[3]);for(u=new RegExp("\\("+a(c)+'\\("(dll-reference\\s('+r+'))"\\)\\)'+n,"g");d=u.exec(l);)e[d[2]]||(o[s].push(d[1]),e[d[2]]=i(d[1]).m),o[d[2]]=o[d[2]]||[],o[d[2]].push(d[4]);for(var f,p=Object.keys(o),g=0;g<p.length;g++)for(var m=0;m<o[p[g]].length;m++)f=o[p[g]][m],isNaN(1*f)||(o[p[g]][m]=1*o[p[g]][m]);return o}function l(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},n=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},s={main:[]},r={main:{}};l(i);)for(var n=Object.keys(i),a=0;a<n.length;a++){var h=n[a],d=i[h].pop();if(r[h]=r[h]||{},!r[h][d]&&e[h][d]){r[h][d]=!0,s[h]=s[h]||[],s[h].push(d);for(var c=o(e,e[h][d],h),u=Object.keys(c),f=0;f<u.length;f++)i[u[f]]=i[u[f]]||[],i[u[f]]=i[u[f]].concat(c[u[f]])}}return s}(r,e),a="";Object.keys(n).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;n[e][t];)t++;n[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map((function(t){return JSON.stringify(t)+": "+r[e][t].toString()})).join(",")+"});\n"})),a=a+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map((function(e){return JSON.stringify(e)+": "+r.main[e].toString()})).join(",")+"}))(self);";var h=new window.Blob([a],{type:"text/javascript"});if(t.bare)return h;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),c=new window.Worker(d);return c.objectURL=d,c}},function(e,t,i){"use strict";i.r(t);var s=i(14),r=i(1),n=i(12),a=i(7),o=i(2),l=i(5);t.default=function(e){var t=new n.EventEmitter;t.trigger=function(e,i){t.emit(e,e,i)},t.off=(e,i)=>t.removeListener(e,i);const i=(t,i,s)=>e.postMessage({event:t,data:i},s);e.addEventListener("message",(function({data:r}){switch(r.cmd){case"init":let n=JSON.parse(r.config);e.demuxer=new s.a(t,r.typeSupported,n,r.vendor);try{o.b.enable(!0===n.debug,n.debugLevel),o.b.setStreamAndSessionIDs(r.options.sessionID,r.options.streamID)}catch(e){console.warn("demuxerWorker: unable to enable logs")}i(a.a.INIT,null);break;case"demux":e.demuxer.push(r.data,r.decryptdata,r.initSegment,r.timeOffset,r.discontinuity,r.trackSwitch,r.contiguous,r.duration,r.accurateTimeOffset,r.defaultInitPTS,r.iframeMediaStart,r.iframeDuration)}})),t.on(r.b.FRAG_DECRYPTED,i),t.on(r.b.FRAG_PARSING_INIT_SEGMENT,i),t.on(r.b.FRAG_PARSED,i),t.on(r.b.FRAG_PARSING_USERDATA,i),t.on(r.b.FRAG_PARSING_CAPTIONDATA,i),t.on(r.b.INIT_PTS_FOUND,i),t.on(r.b.FRAG_PARSING_DATA,(e,t)=>{const s=new l.a;t.data1&&s.add(t.data1.buffer),t.data2&&s.add(t.data2.buffer),i(e,t,s.transfer)}),t.on(r.b.FRAG_PARSING_METADATA,(t,i)=>{const s=new l.a;if(i.samples)for(const e of i.samples)if(e.data&&s.add(e.data.buffer),e.frames)for(const t of e.frames)t.data&&"string"!=typeof t.data&&s.add(t.data.buffer);e.postMessage({event:t,data:i},s.transfer)}),t.on(r.b.INTERNAL_ERROR,(t,i)=>{e.postMessage({event:t,data:i})})}},function(e,t,i){"use strict";i.r(t);var s=i(15),r=i(1),n=i(12),a=i(2);t.default=function(e){const t=new n.EventEmitter;t.trigger=(e,i)=>{t.emit(e,e,i)},t.off=(e,i)=>t.removeListener(e,i);const i=(t,i,s)=>{s?e.postMessage({event:t,fragObjId:i,data:s},[s]):e.postMessage({event:t,data:s})};e.addEventListener("message",({data:r})=>{switch(r.cmd){case"init":const n=JSON.parse(r.config);e.decryptor=new s.a(t,n);try{a.b.enable(!0===n.debug,n.debugLevel)}catch(e){console.warn("SegmentDecryptorWorker: unable to enable logs")}i("init",null);break;case"segment-decrypt":r=r,e.decryptor.decrypt(r.fragPayload,r.decryptdata,e=>{i("segment-decrypted",r.fragObjId,e)})}}),t.on(r.b.ERROR,(t,i)=>{e.postMessage({event:t,data:i})})}},function(e,t,i){"use strict";i.r(t);var n=i(1),a=i(0),o=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,l=/^([^\/;?#]*)(.*)$/,h=/(?:\/|^)\.(?=\/)/g,d=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g;const c={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var s=c.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=c.normalizePath(s.path),c.buildURLFromParts(s)}var r=c.parseURL(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=c.normalizePath(r.path),c.buildURLFromParts(r)):t;var n=c.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");if(!n.netLoc&&n.path&&"/"!==n.path[0]){var a=l.exec(n.path);n.netLoc=a[1],n.path=a[2]}n.netLoc&&!n.path&&(n.path="/");var o={scheme:n.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=n.netLoc,"/"!==r.path[0]))if(r.path){i.inheritQuery&&(r.query||(o.query=n.query));var h=n.path,d=h.substring(0,h.lastIndexOf("/")+1)+r.path;o.path=c.normalizePath(d)}else o.path=n.path,r.params||(o.params=n.params,r.query||(o.query=n.query));return null===o.path&&(o.path=i.alwaysNormalize?c.normalizePath(r.path):r.path),c.buildURLFromParts(o)},parseURL:function(e){var t=o.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(h,"");e.length!==(e=e.replace(d,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment},getHostName:function(e){var t;return e?t=(t=(t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0]).split("?")[0]:t}};var u=c,f=i(2);class p{constructor(e){this.logger=e,null!=e||(this.logger=f.b)}destroy(){this.abort()}abort(){clearTimeout(this.firstByteLoadTimeout),this.firstByteLoadTimeout=null,clearTimeout(this.fullLoadTimeout),this.fullLoadTimeout=null,clearTimeout(this.retryTimeout),this.retryTimeout=null}_relateServerInstanceInfoToRequest(e){this.context.collectServerInstanceInfo&&(this.context.serverInstanceInfo={},this.context.collectServerInstanceInfo.forEach(t=>{let i=e.getResponseHeader(t);i&&(this.context.serverInstanceInfo[t]=i)}))}load(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={aborted:!1,trequest:performance.now(),tfirst:0,loaded:0,retry:0},this.loadInternal()}loadsuccess(e,t){let i,s,r=this.context,n=this.stats;n.tload=Math.max(n.tfirst,performance.now()),s="arraybuffer"===r.responseType?(i=e.response).byteLength:(i=e.responseText).length,n.tdataack=performance.now(),n.loaded=n.total=s,n.contentType=e.getResponseHeader("Content-Type");let a={url:e.responseURL,data:i,len:s,contentLen:t};this._relateServerInstanceInfoToRequest(e),this.callbacks.onSuccess(a,n,r),n.retry=0}loaderror(e,t){if(this.abort(),this.retryConfig=this.config.errorRetry,!this.config.autoRetry||e>=400&&e<499||!this.scheduleRetry()){this.logger.error(`[QE Critical] ${e} while loading url type: ${this.type}`)();let i={code:e,text:t};this.callbacks.onError(i,this.context)}}scheduleRetry(){let e=this.stats,t=!1,i=this.retryConfig;if(clearTimeout(this.retryTimeout),e.retry<i.maxNumRetry){let s=Math.min(Math.pow(2,e.retry)*i.retryDelayMs,i.maxRetryDelayMs);e.retry++,e.aborted=!1,this.logger.warn(`[QE Critical] current retryCount ${e.retry} schedule retry in ${s} ms`)(),this.retryTimeout=setTimeout(this.loadInternal.bind(this),s),t=!0}return t}resetStats(){let e=this.stats;e.aborted=!1,e.tfirst=0,e.loaded=0,e.trequest=performance.now()}setupTimeouts(){isFinite(this.config.maxLoadTimeMs)&&this.config.maxLoadTimeMs>0&&(this.fullLoadTimeout=setTimeout(this.loadtimeout.bind(this,!1),this.config.maxLoadTimeMs)),isFinite(this.config.maxTimeToFirstByteMs)&&this.config.maxTimeToFirstByteMs>0&&(this.firstByteLoadTimeout=setTimeout(this.loadtimeout.bind(this,!0),this.config.maxTimeToFirstByteMs))}loadtimeout(e){this.abort();let t=e?"maxTimeToFirstByteMs":"maxLoadTimeMs";this.logger.warn(`[QE Critical] timeout while loading url type: ${this.type}, this.config.${t}: ${this.config[t]}`)(),this.retryConfig=this.config.timeoutRetry,this.callbacks.onTimeout(this.stats,this.context)}}var g=class extends p{constructor(e,t){super(t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}abort(){var e=this.request;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),this.request=null,super.abort()}get loader(){return this.request}overrideMimeType(e){this.request&&typeof this.request.overrideMimeType==typeof Function?this.request.overrideMimeType(e):this.mimeType=e}responseXML(){let e=null;return this.request&&this.request.responseXML&&(e=this.request.responseXML),e}loadInternal(){var e,t=this.context;"undefined"!=typeof XDomainRequest?e=this.request=new XDomainRequest:(e=this.request=new XMLHttpRequest,this.mimeType&&typeof this.request.overrideMimeType==typeof Function&&this.request.overrideMimeType(this.mimeType)),this.resetStats();const i=this.xhrSetup;let s=t.method?t.method:"GET";try{if(i)try{i(e,t.url)}catch(a){e.open(s,t.url,!0),i(e,t.url)}e.readyState||e.open(s,t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t)}t.sessionID&&e.setRequestHeader("X-Playback-Session-Id",t.sessionID),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.setupTimeouts(),"POST"===s&&t.payload?e.send(t.payload):e.send()}getByteRangeLength(e){let t=/([0-9]+)\-([0-9]+)\/([0-9]+)/.exec(e);return t?parseInt(t[2])-parseInt(t[1])+1:void 0}getContentLength(e){let t,i=e.getResponseHeader("Content-Encoding"),s=e.getResponseHeader("Transfer-Encoding"),r=!i||i&&"identity"===i.toLowerCase(),n=!s||s&&"identity"===s.toLowerCase();return r&&n&&(t=this.getByteRangeLength(e.getResponseHeader("Content-Range")),isNaN(t)&&(t=parseInt(e.getResponseHeader("Content-Length")))),t}readystatechange(e){var t=e.currentTarget,i=t.readyState,s=this.stats,r=(this.context,this.config);if(!s.aborted&&i>=2&&(0===s.tfirst&&(s.tfirst=Math.max(performance.now(),s.trequest)),this.firstByteLoadTimeout&&(clearTimeout(this.firstByteLoadTimeout),this.firstByteLoadTimeout=null),r.reportCDNServer&&(s.cdnServer=t.getResponseHeader("CDN-Server")),4===i)){this.fullLoadTimeout&&(clearTimeout(this.fullLoadTimeout),this.fullLoadTimeout=null);let e=t.status;e>=200&&e<300?this.loadsuccess(t,this.config.forceContentLenCheckIfNoHeader?this.getContentLength(t):void 0):this.loaderror(e,t.statusText)}}loadprogress(e){var t=e.currentTarget,i=this.stats;let s=this.callbacks.onProgress;s&&3===t.readyState&&(i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total),s(i,this.context,this.request.response))}get type(){let e=this.context;return e&&(e.frag&&e.frag.type||e.type)||""}},m=i(5),y=class extends p{constructor(e){super(e.logger),this.hls=e,this._loader=void 0}abort(){this.onuriloaded&&(this.hls.off(n.b.UNRESOLVED_URI_LOADED,this.onuriloaded),this.onuriloaded=void 0);var e=this._loader;e&&(e.abort(),this.stats.aborted=e.stats.aborted),this._loader=void 0,super.abort()}loadInternal(){var e=this.context;this.resetStats(),this.setupTimeouts(),this.onuriloaded=this.onUnresolvedUriLoaded.bind(this),this.hls.on(n.b.UNRESOLVED_URI_LOADED,this.onuriloaded);let t={uri:e.url,userAgent:navigator.userAgent};this.hls.trigger(n.b.UNRESOLVED_URI_LOADING,t)}onUnresolvedUriLoaded(e,t){let i=t.uri,s=t.response;this.context.url===i&&this.handleExternalResponse(s)}handleExternalResponse(e){if(this.hls.off(n.b.UNRESOLVED_URI_LOADED,this.onuriloaded),this.stats.aborted)return;let t=this.stats,i=this.context;0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),this.fullLoadTimeout&&(clearTimeout(this.fullLoadTimeout),this.fullLoadTimeout=null),this.firstByteLoadTimeout&&(clearTimeout(this.firstByteLoadTimeout),this.firstByteLoadTimeout=null);let s=e.status||200;if(s>=200&&s<300)this.loadsuccess({responseURL:i.url,response:e.data,get responseText(){return m.b.utf8arrayToStr(new Uint8Array(this.response))},getResponseHeader:()=>{}});else{let t;switch(s){case 300:case 302:case 303:case 305:t=e.uri}t?this.redirectRequest(t):this.loaderror(s,"Unable to load custom url")}}redirectRequest(e){let t=this.stats,i=this.config;this._loader=new g(this.hls.config);let s=function(e){let t=this.stats.trequest;this.stats=Object.assign({},e),this.stats.trequest=t}.bind(this),r=Object.assign({},this.context),n=Object.assign({},this.config),a={onSuccess:function(e,t){s(t),this.callbacks.onSuccess(e,this.stats,this.context)}.bind(this),onError:function(e){this.callbacks.onError(e,this.context)}.bind(this),onTimeout:function(e){s(e),this.loadtimeout(!1)}.bind(this),onProgress:function(e,t,i){this.stats.loaded=e.loaded,e.total&&(this.stats.total=e.total),this.callbacks.onProgress&&this.callbacks.onProgress(this.stats,this.context,i)}.bind(this)};r.url=e,n.maxLoadTimeMs=i.maxLoadTimeMs-(performance.now()-t.trequest),n.maxTimeToFirstByteMs=i.maxTimeToFirstByteMs-(performance.now()-t.trequest),!isFinite(i.maxLoadTimeMs)||i.maxLoadTimeMs<=0||n.maxLoadTimeMs>0&&n.maxTimeToFirstByteMs>0?this._loader.load(r,n,a):n.maxTimeToFirstByteMs<=0?this.loadtimeout(!0):n.maxLoadTimeMs<=0&&this.loadtimeout(!1)}get loader(){return this._loader?this._loader.loader:void 0}static isCustomUrl(e){let t=c.parseURL(e);return"http:"!==t.scheme&&"https:"!==t.scheme}overrideMimeType(e){}responseXML(){}get type(){return this.context?this.context.type:""}},v=i(6);const _={avc1:"video/mp4",avc3:"video/mp4",dvav:"video/mp4",dva1:"video/mp4",hev1:"video/mp4",hvc1:"video/mp4",dvh1:"video/mp4",dvhe:"video/mp4"};var b={mp4a:"audio/mp4","ac-3":"audio/mp4","ec-3":"audio/mp4"};var T=function(e,t,i){let s={videoCapabilities:new Array,audioCapabilities:new Array};return e&&e.forEach((function(e){let t=e.split(".")[0].trim();t in _&&s.videoCapabilities.push({contentType:_[t]+";codecs="+e,robustness:i&&i.videoRobustnessLevel?i.videoRobustnessLevel:""})})),t&&t.forEach((function(e){let t=e.split(".")[0].trim();t in b&&s.audioCapabilities.push({contentType:b[t]+";codecs="+e,robustness:i&&i.audioRobustnessLevel?i.audioRobustnessLevel:""})})),s},S=function(e){let t=function(e,t,i){let s=e[t];e[t]=e[i],e[i]=s};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)},E=function(e){let t=e.split(":"),i=null;if("data"===t[0]&&2===t.length){let e=t[1].split(";"),s=e[e.length-1].split(",");if(2===s.length){let t="base64"===s[0],r=s[1];t?(e.splice(-1,1),i=v.a.base64Decode(r)):i=function(e){let t=m.b.strToUtf8array(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(r)}}return i},w=function(e){let t={kids:e.map(v.a.base64UrlEncode)};return m.b.strToUtf8array(JSON.stringify(t))},I={id:"playready",systemStringPrefix:"com.microsoft.playready",keyFormatString:"com.microsoft.playready",securityLevels:{SL2000:0,SL3000:1}},D={id:"widevine",systemStringPrefix:"com.widevine.alpha",keyFormatString:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",securityLevels:{WIDEVINE_SOFTWARE:0,WIDEVINE_HARDWARE:1}};const L={NONE:"","AES-128":"","ISO-23001-7":"","SAMPLE-AES":"","SAMPLE-AES-CTR":""};let k={};class R{constructor(e,t,i,s,r){if(this.method=e,this.uri=t,this.iv=i,this.format=s,this.formatversions=r,this.isEncrypted=this.method&&"NONE"!==this.method,this.formatversions&&0!==this.formatversions.length||(this.formatversions=[1]),this.key=null,this.keyId=null,this.expiryPosition=1/0,!this.isEncrypted)return;let n=E(this.uri);if(n)switch(s){case I.keyFormatString:{this.pssh=n;let e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2);var a,o=String.fromCharCode.apply(null,e),l=o.substring(o.indexOf("<"),o.length),h=(new DOMParser).parseFromString(l,"text/xml").getElementsByTagName("KID")[0];if(h&&(a=h.childNodes[0]?h.childNodes[0].nodeValue:h.getAttribute("VALUE"))){let e=v.a.base64Decode(a).subarray(0,16);S(e),this.keyId=e}break}case D.keyFormatString:this.pssh=n,n.length>=22&&(this.keyId=n.subarray(n.length-22,n.length-6));break;default:{let e=n.subarray(0,16);if(16!==e.length){let t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=k[this.uri];if(!e){let t=Object.keys(k).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16),new DataView(e.buffer,12,4).setUint32(0,t),k[this.uri]=e}this.keyId=e}}static clearKeyUriToKeyIdMap(){k={}}}var C=R;const A={afr:"af",aka:"ak",amh:"am",ara:"ar",arg:"an",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bam:"bm",bel:"be",ben:"bn",bih:"bh",bod:"bo",bos:"bs",bre:"br",bul:"bg",cat:"ca",ces:"cs",cha:"ch",che:"ce",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",dan:"da",deu:"de",div:"dv",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fin:"fi",fra:"fr",fry:"fy",ful:"ff",gla:"gd",gle:"ga",glg:"gl",glv:"gv",grn:"gn",guj:"gu",hat:"ht",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mah:"mh",mal:"ml",mar:"mr",mkd:"mk",mlg:"mg",mlt:"mt",mol:"mo",mon:"mn",mri:"mi",msa:"ms",mya:"my",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",run:"rn",rus:"ru",san:"sa",sin:"si",slk:"sk",slv:"sl",sme:"se",snd:"sd",som:"so",spa:"es",sqi:"sq",srd:"sc",srp:"sr",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tir:"ti",ton:"to",tuk:"tk",tur:"tr",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",wln:"wa",yid:"yi",zha:"za",zho:"zh"},P={isLanguageCode:function(e){return e in A},shortenLanguageCode:function(e){let t;if(e){let i=e.indexOf("-"),s=i>=0?e.slice(0,i):e;P.isLanguageCode(s)&&(t=A[s]),t||(t=s),i>0&&(t+="-"+e.slice(i+1))}return t}};var x=P;class M{constructor(e){this._url=null,this._byteRange=null,this.inheritQuery=e,this.tagList=new Array,this.loadCounter=0,this.iframe=!1}equals(e){return e.sn===this.sn&&e.level===this.level}get url(){return!this._url&&this.relurl&&(this._url=c.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0,inheritQuery:this.inheritQuery})),this._url}set url(e){this._url=e}get programDateTime(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}get byteRange(){if(!this._byteRange){let e=new Array(2);if(this.rawByteRange){const t=this.rawByteRange.split("@",2);if(1===t.length){const t=this.lastByteRangeEndOffset;e[0]=t||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}this._byteRange=e}return this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get decryptdata(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}set decryptdata(e){this._decryptdata=e}static createInitializationVector(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}fragmentDecryptdataFromLevelkey(e,t){var i=e;if(e&&e.method&&e.uri&&!e.iv&&(!e.format||"identity"===e.format)){let s=M.createInitializationVector(t);i=new C(e.method,e.uri,s,e.format,e.formatversions)}return i}get rangeString(){return this.start>=0&&this.duration>=0?`${this.start.toFixed(2)}-${(this.start+this.duration).toFixed(2)}`:"N/A"}get fragTag(){return`sn/cc/level: ${this.sn}/${this.cc}/${this.level}`}}var O=M,N=class{constructor(e,...t){this.hls=e,this.destroyed=!1,this.hls=e,this.logger=e.logger,this.onEvent=this.onEvent.bind(this),this.handledEvents=t,this.registerListeners()}destroy(){this.destroyed=!0,this.unregisterListeners()}registerListeners(){for(const e of this.handledEvents)this.hls.on(e,this.onEvent)}unregisterListeners(){for(const e of this.handledEvents)this.hls.off(e,this.onEvent)}onEvent(e,t){if(this.destroyed)this.logger.warn("Event fired after event handler is destroyed! Event name: "+e)();else try{const i="on"+e.replace("hls",""),s=this[i];if("function"!=typeof s)throw new Error(`Event ${e} has no generic handler in this ${this.constructor.name} class (tried ${i})`);s.call(this,t)}catch(t){this.logger.error(`internal error happened while processing ${e}:${t.message} ${t.stack}`)();let i=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!1,t.message);i.response=a.f.InternalError,i.event=e,i.err=t,this.hls.trigger(n.a.ERROR,i)}}};const F={"com.apple.hls.chapters":!0};class B extends N{constructor(e){super(e,n.b.SESSION_DATA_LOADING),this.loader=null,this.nextSessionDataItemId=0}destroy(){this.loader&&this.loader.destroy(),N.prototype.destroy.call(this)}onSessionDataLoading(e){this.loadSessionData(e.sessionData)}loadSessionData(e){let t,i,s,r=!1;for(;!1===r&&e.itemList&&this.nextSessionDataItemId<e.itemList.length;){let n=e.itemList[this.nextSessionDataItemId];i=n["DATA-ID"],n.URI&&F[i]&&(t=u.buildAbsoluteURL(this.hls.baseurl,n.URI,{alwaysNormalize:!0}),s="",n.VALUE=null,r=!0,this.loadSessionDataItemWithURL(t,i,"")),this.nextSessionDataItemId=this.nextSessionDataItemId+1}!1===r&&function(e){if(!e.complete&&e.itemList){e.complete=!0;for(let t=0;t<e.itemList.length;++t){let i=e.itemList[t];if(F[i["DATA-ID"]]&&!i.VALUE&&!i._STATUS){e.complete=!1;break}}e.complete}return e.complete}(e)&&this.hls.trigger(n.b.SESSION_DATA_COMPLETE,{})}loadSessionDataItemWithURL(e,t,i){let s,r,n,a=this.loader,o=this.hls.config;a&&a.abort(),a=this.loader=y.isCustomUrl(e)?new y(this.hls):new o.loader(o),this.loader.overrideMimeType("application/xml"),s={type:"session",url:e,id:t,responseType:i,sessionID:o.useHTTPPlaybackSessionId?this.hls.sessionID:void 0},r=y.isCustomUrl(e)?o.fragLoadPolicy.customURL:o.fragLoadPolicy.default,n={onSuccess:this.onLoadSuccess.bind(this),onError:this.onLoadError.bind(this),onTimeout:this.onLoadTimeout.bind(this)},a.load(s,r,n)}stringIsXMLPlist(e){const t=/[\s]*<\?xml/i;let i,s;return t.lastIndex=0,(i=t.exec(e))||(s=/[\s]*<plist/i.exec(e)),i||s}stringIsJSONPlist(e){const t=/[\s]*[\{\[]/;return t.lastIndex=0,null!=t.exec(e)}onLoadSuccess(e,t,i){let s,r=this.hls,n=e.data,a=i.id,o=null;if(this.stringIsXMLPlist(n)&&(o=this.loader.responseXML()))s=this.convertPlisttoJSON(o),this.setSessionData(r.sessionData,a,"VALUE",s);else if(this.stringIsJSONPlist(n))try{s=JSON.parse(n),this.setSessionData(r.sessionData,a,"VALUE",s)}catch(e){this.setSessionData(r.sessionData,a,"VALUE",n),this.setSessionData(r.sessionData,a,"_STATUS",-1)}else this.setSessionData(r.sessionData,a,"VALUE",n);this.loadSessionData(this.hls.sessionData),this.loader=void 0}onLoadError(e,t){let i=t.url,s=t.id;this.loader=void 0,this.setSessionData(this.hls.sessionData,s,"_STATUS",e.code),this.hls.trigger(n.b.INTERNAL_ERROR,{type:a.g.NETWORK_ERROR,details:a.d.SESSION_DATA_LOAD_ERROR,fatal:!1,id:s,url:i,response:e})}onLoadTimeout(e,t){let i=t.url,s=t.id;this.loader=void 0,this.hls.trigger(n.b.INTERNAL_ERROR,{type:a.g.NETWORK_ERROR,details:a.d.SESSION_DATA_LOAD_TIMEOUT,fatal:!1,id:s,url:i})}setSessionData(e,t,i,s){if(e.itemList){let r;for(r=0;r<e.itemList.length;++r){let n=e.itemList[r];if(n["DATA-ID"]===t){n[i]=s;break}}e.itemList.length}}convertPlisttoJSON(e){var t=null,i=e.childNodes;if(i)if(e.tagName){if("plist"===e.tagName.toLowerCase()){t=[];for(let e=0;e<i.length;++e){let s=i[e];s.tagName&&t.push(this.convertPlisttoJSON(s))}1===t.length&&(t=t[0])}if("array"===e.tagName.toLowerCase()){t=[];for(let e=0;e<i.length;++e){let s=i[e];s.tagName&&t.push(this.convertPlisttoJSON(s))}}if("dict"===e.tagName.toLowerCase()){var s,r,n=0;t={};for(let e=0;e<i.length;e++)i[e].tagName&&(n%2==0?"key"===i[e].tagName.toLowerCase()&&(s=this.convertPlisttoJSON(i[e]),n++):(r=this.convertPlisttoJSON(i[e]),t[s]=r,s=null,r=null,n++));s&&(t[s]=r,s=null,r=null)}else"key"===e.tagName.toLowerCase()||"string"===e.tagName.toLowerCase()?t=i[0]?i[0].nodeValue:null:"integer"===e.tagName.toLowerCase()?t=i[0]?parseInt(i[0].nodeValue):0:"float"===e.tagName.toLowerCase()?t=i[0]?parseFloat(i[0].nodeValue):0:"date"===e.tagName.toLowerCase()?t=i[0]?new Date(i[0].nodeValue):null:"data"===e.tagName.toLowerCase()?t=i[0]?atob(i[0].nodeValue):null:"true"===e.tagName.toLowerCase()?t=!0:"false"===e.tagName.toLowerCase()&&(t=!1)}else if(0===i.length);else{t=[];for(let e=0;e<i.length;++e){let s=i[e];s.tagName&&t.push(this.convertPlisttoJSON(s))}1===t.length&&(t=t[0])}return t}}const U=6101,V=6110,$=6103,G=6106,H=6107,K=6108,j=6202,W=["PlayTimeWC","PlayTime","PlayType","StallCount","MediaEngineStallCount","InitTime","PauseTime","StallTime","LastPause","LastStall","LastMediaEngineStall","MediaEngineStallTime","ADT","SegmentProcessTime","SegmentParseTime","PlaylistADT","MaxPlaylistDT","MasterPlaylistADT","NwErrCount","PlayerErrCount","FatalNwErrCount","FatalPlayerErrCount","GroupViFrDr","GroupViFrDrEvtCount","SparseViFrDr","SparseViFrDrEvtCount","AvgVideoBitrate","AvgAudioBitrate","TWOBR","PerceivedTWOBR","NetTWOBR","PlayerTWIBR","PlayerTWIABR","TWBitRk","SwCnt","NetBytes","TargetDur","VariantList","PlaylistMimeType","SegmentMimeType","MediaRequestsSent","Rate","ReWd","ReHt","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],q=["EventCounter","PInterval","PlayTimeWC","PlayTime","PlayType","StallCount","MediaEngineStallCount","InitTime","PauseTime","StallTime","MediaEngineStallTime","ADT","SegmentProcessTime","SegmentParseTime","PlaylistADT","MaxPlaylistDT","MasterPlaylistADT","NwErrCount","PlayerErrCount","FatalNwErrCount","FatalPlayerErrCount","GroupViFrDr","GroupViFrDrEvtCount","SparseViFrDr","SparseViFrDrEvtCount","AvgVideoBitrate","AvgAudioBitrate","TWOBR","PerceivedTWOBR","NetTWOBR","PlayerTWIBR","PlayerTWIABR","TWBitRk","SwCnt","NetBytes","TargetDur","VariantList","MediaRequestsSent","Rate","ReWd","ReHt","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],z=["MediaDur","BitRnk","Codecs","PlayTime","PlayType","LastLikelyToKeepUp","LastSwitch","LastResume","NwErrTime","NwErrCode","LaSwDir","TargetDur","PlayerIABR","PlayerIBR","Rate","OBRLast","OBRMean","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],Y=["KeyFormat","CDMVersion","SPCRequestTime","SPCCreationTime","CKCResponseTime","CKCProcessTime","KeyDeliveryTime","CurrentMediaTime","KeyInitTime","KeyErrorType","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],X=["EventCounter","PlayType","PlayerIABR","PlayerIBR","MediaDur","BitRnk","Codecs","StartupTime","PlaylistADT","TargetDur","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],Q=["Rate","PlayType","StNPT","StartupTime","PlayerIABR","PlayerIBR","BitRnk","MediaDur","Codecs","LastPause","LastStall","LastMediaEngineStall","RateChangePlayTime","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],J=["ErrCode","ErrIsFatal","PlayerErrCount","ErrDomain","PlayType","BitRnk","MediaDur","PlayTime","PlayTimeWC","PlayerIABR","PlayerIBR","LastStall","LastMediaEngineStall","LastLikelyToKeepUp","LastSwitch","LastResume","VideoQltyIndex","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],Z=["MediaDur","BitRnk","Codecs","PlayTime","PlayType","LastLikelyToKeepUp","LastSwitch","LastResume","LaSwDir","TargetDur","PlayerIABR","PlayerIBR","Rate","OBRLast","OBRMean","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],ee=["FrBitRnk","ToBitRnk","TimeToBitrate","MediaDur","Rate","PlayType","SwFail","PlayerIBR","PlayerIABR","LastPlayerIBR","LastPlayerIABR","PlayTime","PlayTimeLastSW","BadSw","ReWd","ReHt","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],te=["Rate","PlayType","VarAvgBitrate","VarPeakBitrate","VarBitRk","VarSTTime","VarEndTime","VarPlayTime","VarPlayTimeWC","IFR","ODR","ReWd","ReHt","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],ie=["ErrCode","ErrReason","ErrIsFatal","NwErrCount","ErrDomain","PlayTime","PlayTimeWC","LastResume","BitRnk","PlayType","LastMediaCDNServer","MaxVideoQltyIndex","MaxReWd","MaxReHt","IsGapless","IsAudioOnly","IsFirstItem","ItemID","ServerInfo"],se="rtcStateInit",re="rtcStatePause",ne="rtcStatePlay",ae="rtcStateStall",oe="rtcStateMediaEngineStall",le="rtcStateStop",he=[G,$,K,j,H,U],de=["aapl","akam","llnw"],ce={avc1:1,avc3:1,hvc1:{SDR:2,HLG:10,PQ:11},hev1:{SDR:2,HLG:10,PQ:11},vp09:{SDR:3,HLG:14,PQ:13},dvh1:{PQ:12}};var ue={id:"fairplaystreaming",systemStringPrefix:"com.apple.fps",keyFormatString:"com.apple.streamingkeydelivery",securityLevels:{AppleBaseline:0,AppleMain:1,Main:1,Baseline:0}},fe=function(e,t){return(fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function pe(e,t){function i(){this.constructor=e}fe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function ge(e,t){var i,s,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}function me(e){return this instanceof me?(this.v=e,this):new me(e)}function ye(e){return"function"==typeof e}var ve=!1,_e={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else ve&&console.log("RxJS: Back to a better error behavior. Thank you. <3");ve=e},get useDeprecatedSynchronousErrorHandling(){return ve}};function be(e){setTimeout((function(){throw e}),0)}var Te={closed:!0,next:function(e){},error:function(e){if(_e.useDeprecatedSynchronousErrorHandling)throw e;be(e)},complete:function(){}},Se=Array.isArray||function(e){return e&&"number"==typeof e.length};function Ee(e){return null!==e&&"object"==typeof e}var we=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Ie=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var i=this._parentOrParents,s=this._unsubscribe,r=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof e)i.remove(this);else if(null!==i)for(var n=0;n<i.length;++n)i[n].remove(this);if(ye(s))try{s.call(this)}catch(e){t=e instanceof we?De(e.errors):[e]}if(Se(r)){n=-1;for(var a=r.length;++n<a;){var o=r[n];if(Ee(o))try{o.unsubscribe()}catch(e){t=t||[],e instanceof we?t=t.concat(De(e.errors)):t.push(e)}}}if(t)throw new we(t)}},e.prototype.add=function(t){var i=t;if(!t)return e.EMPTY;switch(typeof t){case"function":i=new e(t);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof e)){var s=i;(i=new e)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=i._parentOrParents;if(null===r)i._parentOrParents=this;else if(r instanceof e){if(r===this)return i;i._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return i;r.push(this)}var n=this._subscriptions;return null===n?this._subscriptions=[i]:n.push(i),i},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},e.EMPTY=((t=new e).closed=!0,t),e}();function De(e){return e.reduce((function(e,t){return e.concat(t instanceof we?t.errors:t)}),[])}var Le="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ke=function(e){function t(i,s,r){var n=e.call(this)||this;switch(n.syncErrorValue=null,n.syncErrorThrown=!1,n.syncErrorThrowable=!1,n.isStopped=!1,arguments.length){case 0:n.destination=Te;break;case 1:if(!i){n.destination=Te;break}if("object"==typeof i){i instanceof t?(n.syncErrorThrowable=i.syncErrorThrowable,n.destination=i,i.add(n)):(n.syncErrorThrowable=!0,n.destination=new Re(n,i));break}default:n.syncErrorThrowable=!0,n.destination=new Re(n,i,s,r)}return n}return pe(t,e),t.prototype[Le]=function(){return this},t.create=function(e,i,s){var r=new t(e,i,s);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Ie),Re=function(e){function t(t,i,s,r){var n,a=e.call(this)||this;a._parentSubscriber=t;var o=a;return ye(i)?n=i:i&&(n=i.next,s=i.error,r=i.complete,i!==Te&&(ye((o=Object.create(i)).unsubscribe)&&a.add(o.unsubscribe.bind(o)),o.unsubscribe=a.unsubscribe.bind(a))),a._context=o,a._next=n,a._error=s,a._complete=r,a}return pe(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;_e.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,i=_e.useDeprecatedSynchronousErrorHandling;if(this._error)i&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)i?(t.syncErrorValue=e,t.syncErrorThrown=!0):be(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;be(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var i=function(){return e._complete.call(e._context)};_e.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),_e.useDeprecatedSynchronousErrorHandling)throw e;be(e)}},t.prototype.__tryOrSetError=function(e,t,i){if(!_e.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,i)}catch(t){return _e.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(be(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(ke);function Ce(){}function Ae(e,t,i){return function(s){return s.lift(new Pe(e,t,i))}}var Pe=function(){function e(e,t,i){this.nextOrObserver=e,this.error=t,this.complete=i}return e.prototype.call=function(e,t){return t.subscribe(new xe(e,this.nextOrObserver,this.error,this.complete))},e}(),xe=function(e){function t(t,i,s,r){var n=e.call(this,t)||this;return n._tapNext=Ce,n._tapError=Ce,n._tapComplete=Ce,n._tapError=s||Ce,n._tapComplete=r||Ce,ye(i)?(n._context=n,n._tapNext=i):i&&(n._context=i,n._tapNext=i.next||Ce,n._tapError=i.error||Ce,n._tapComplete=i.complete||Ce),n}return pe(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ke),Me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pe(t,e),t.prototype.notifyNext=function(e,t,i,s,r){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(ke),Oe=function(e){function t(t,i,s){var r=e.call(this)||this;return r.parent=t,r.outerValue=i,r.outerIndex=s,r.index=0,r}return pe(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(ke),Ne=function(e){return function(t){for(var i=0,s=e.length;i<s&&!t.closed;i++)t.next(e[i]);t.complete()}},Fe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Be="function"==typeof Symbol&&Symbol.observable||"@@observable",Ue=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ve(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var $e=function(e){if(e&&"function"==typeof e[Be])return s=e,function(e){var t=s[Be]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(Ue(e))return Ne(e);if(Ve(e))return i=e,function(e){return i.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,be),e};if(e&&"function"==typeof e[Fe])return t=e,function(e){for(var i=t[Fe]();;){var s=i.next();if(s.done){e.complete();break}if(e.next(s.value),e.closed)break}return"function"==typeof i.return&&e.add((function(){i.return&&i.return()})),e};if(Symbol&&Symbol.asyncIterator&&e&&"function"==typeof e[Symbol.asyncIterator])return function(e){return function(t){(function(e,t){var i,s,r,n,a,o,l;return a=this,l=function(){var a,o;return ge(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),i=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],s=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=e[i]&&function(t){return new Promise((function(s,r){!function(e,t,i,s){Promise.resolve(s).then((function(t){e({value:t,done:i})}),t)}(s,r,(t=e[i](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,i.next()];case 2:if((s=l.sent()).done)return[3,4];a=s.value,t.next(a),l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),r={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),s&&!s.done&&(n=i.return)?[4,n.call(i)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function s(e){try{r(l.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(i,s)}r((l=l.apply(a,[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}}(e);var t,i,s,r=Ee(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Ge(e){return e}var He=function(){var e=this;this.resolve=null,this.reject=null,this.promise=new Promise((function(t,i){e.resolve=t,e.reject=i}))},Ke=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var s=this.operator,r=function(e,t,i){if(e){if(e instanceof ke)return e;if(e[Le])return e[Le]()}return e||t||i?new ke(e,t,i):new ke(Te)}(e,t,i);if(s?r.add(s.call(r,this.source)):r.add(this.source||_e.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),_e.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){_e.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,i=t.closed,s=t.destination,r=t.isStopped;if(i||r)return!1;e=s&&s instanceof ke?s:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var i=this;return new(t=je(t))((function(t,s){var r;r=i.subscribe((function(t){try{e(t)}catch(e){s(e),r&&r.unsubscribe()}}),s,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Be]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:(0===(i=e).length?Ge:1===i.length?i[0]:function(e){return i.reduce((function(e,t){return t(e)}),e)})(this);var i},e.prototype.toPromise=function(e){var t=this;return new(e=je(e))((function(e,i){var s;t.subscribe((function(e){return s=e}),(function(e){return i(e)}),(function(){return e(s)}))}))},e.create=function(t){return new e(t)},e}();function je(e){if(e||(e=_e.Promise||Promise),!e)throw new Error("no Promise impl found");return e}function We(e,t,i,s,r){if(void 0===r&&(r=new Oe(e,i,s)),!r.closed)return t instanceof Ke?t.subscribe(r):$e(t)(r)}function qe(e){return function(t){var i=new ze(e),s=t.lift(i);return i.caught=s}}Symbol&&Symbol.asyncIterator&&(Ke.prototype[Symbol.asyncIterator]=function(){return function(e){return function(e){return function(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=i.apply(e,t||[]),n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){r[e]&&(s[e]=function(t){return new Promise((function(i,s){n.push([e,t,i,s])>1||o(e,t)}))})}function o(e,t){try{(i=r[e](t)).value instanceof me?Promise.resolve(i.value.v).then(l,h):d(n[0][2],i)}catch(e){d(n[0][3],e)}var i}function l(e){o("next",e)}function h(e){o("throw",e)}function d(e,t){e(t),n.shift(),n.length&&o(n[0][0],n[0][1])}}(this,arguments,(function(){var t,i,s,r,n,a,o,l;return ge(this,(function(h){switch(h.label){case 0:t=[],i=[],s=!1,r=null,n=!1,a=e.subscribe({next:function(e){t.length>0?t.shift().resolve({value:e,done:!1}):i.push(e)},error:function(e){for(s=!0,r=e;t.length>0;)t.shift().reject(e)},complete:function(){for(n=!0;t.length>0;)t.shift().resolve({value:void 0,done:!0})}}),h.label=1;case 1:h.trys.push([1,16,17,18]),h.label=2;case 2:return i.length>0?[4,me(i.shift())]:[3,5];case 3:return[4,h.sent()];case 4:return h.sent(),[3,14];case 5:return n?[4,me(void 0)]:[3,7];case 6:return[2,h.sent()];case 7:if(!s)return[3,8];throw r;case 8:return o=new He,t.push(o),[4,me(o.promise)];case 9:return(l=h.sent()).done?[4,me(void 0)]:[3,11];case 10:return[2,h.sent()];case 11:return[4,me(l.value)];case 12:return[4,h.sent()];case 13:h.sent(),h.label=14;case 14:return[3,2];case 15:return[3,18];case 16:throw h.sent();case 17:return a.unsubscribe(),[7];case 18:return[2]}}))}))}(e)}(this)});var ze=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ye(e,this.selector,this.caught))},e}(),Ye=function(e){function t(t,i,s){var r=e.call(this,t)||this;return r.selector=i,r.caught=s,r}return pe(t,e),t.prototype.error=function(t){if(!this.isStopped){var i=void 0;try{i=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var s=new Oe(this,void 0,void 0);this.add(s);var r=We(this,i,void 0,void 0,s);r!==s&&this.add(r)}},t}(Me);function Xe(e){return function(t){return t.lift(new Qe(e))}}var Qe=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var i=new Je(e),s=We(i,this.notifier);return s&&!i.seenValue?(i.add(s),t.subscribe(i)):i},e}(),Je=function(e){function t(t){var i=e.call(this,t)||this;return i.seenValue=!1,i}return pe(t,e),t.prototype.notifyNext=function(e,t,i,s,r){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(Me),Ze=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),et=function(e){function t(t,i){var s=e.call(this)||this;return s.subject=t,s.subscriber=i,s.closed=!1,s}return pe(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var i=t.indexOf(this.subscriber);-1!==i&&t.splice(i,1)}}},t}(Ie),tt=function(e){function t(t){var i=e.call(this,t)||this;return i.destination=t,i}return pe(t,e),t}(ke),it=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return pe(t,e),t.prototype[Le]=function(){return new tt(this)},t.prototype.lift=function(e){var t=new st(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Ze;if(!this.isStopped)for(var t=this.observers,i=t.length,s=t.slice(),r=0;r<i;r++)s[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new Ze;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,i=t.length,s=t.slice(),r=0;r<i;r++)s[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ze;this.isStopped=!0;for(var e=this.observers,t=e.length,i=e.slice(),s=0;s<t;s++)i[s].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Ze;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Ze;return this.hasError?(e.error(this.thrownError),Ie.EMPTY):this.isStopped?(e.complete(),Ie.EMPTY):(this.observers.push(e),new et(this,e))},t.prototype.asObservable=function(){var e=new Ke;return e.source=this,e},t.create=function(e,t){return new st(e,t)},t}(Ke),st=function(e){function t(t,i){var s=e.call(this)||this;return s.destination=t,s.source=i,s}return pe(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Ie.EMPTY},t}(it);function rt(e,t){return new Ke(t?function(i){return t.schedule(nt,0,{error:e,subscriber:i})}:function(t){return t.error(e)})}function nt(e){var t=e.error;e.subscriber.error(t)}const at=["avc1.42E01E"],ot=["mp4a.40.2"];class lt extends N{constructor(e,t){super(e,n.b.MANIFEST_LOADING,n.b.MEDIA_ATTACHING,n.b.MEDIA_DETACHING),this.keyLoader=t,this.reset$=new it,this.protectionData={},this.keySystem=void 0,this.keySystemId=void 0,this.createMediaKeysPromise=void 0,!0===e.config.warmupCdms&&lt.warmupCDM()}static warmupCDM(){return yi.createMediaKeys(ue.id,at,ot,[],void 0)}destroy(){this.reset()}reset(){this.reset$.next(),this.keySystem&&(this.keySystem.shouldDestroyMediaKeys&&yi.destroyMediaKeys(),this.keySystem.destroy(),this.keySystem=void 0),this.keySystemId=void 0,this.createMediaKeysPromise=void 0}cleanMediaKeys(e){e.setMediaKeysPromise&&this.logger.warn("[Keys] cleanMediaKeys: setMediaKeysPromise is set, could be trashing existing promise")(),e.setMediaKeysPromise=e.setMediaKeys(null).then(()=>{e.setMediaKeysPromise=null}).catch(t=>{e.setMediaKeysPromise=null,this.handleKeySystemError(t)})}onManifestLoading(){this.hls.isPreloadingItem?this.logger.info("[gapless] don't reset in onManifestLoading")():this.reset()}onMediaAttaching(e){if(this.media=e.media,this.keySystem)this.setMediaKeys(this.keySystem.mediaKeys).catch(e=>{this.logger.warn("setMediaKeys onMediaAttach silent err:"+e.message)()});else if(this.hls.platformInfo&&this.hls.platformInfo.requiresCDMAttachOnStart&&!0===this.hls.platformInfo.requiresCDMAttachOnStart){let e=this.hls.config.keySystemPreference?yi.getKeySystemFormat(this.hls.config.keySystemPreference):ue.keyFormatString;this.createAndSetMediaKeys(new C("NONE",null,null,e,[1])).catch(e=>{this.logger.warn("createAndSetMediaKeys onMediaAttach silent err:"+e.message)()})}}onMediaDetaching(){let e=this.media;this.media=null,this.hls.config.clearMediaKeysOnPromise&&e.setMediaKeysPromise?e.setMediaKeysPromise.catch().then(()=>{this.media||this.cleanMediaKeys.bind(this,e)}):this.cleanMediaKeys(e)}ensureKeySystem(e){if(!this.keySystem&&this.keySystemId){this.keySystem=yi.make(this.keySystemId,this.hls,e,this.keyLoader);let t=this.protectionData&&this.protectionData[this.keySystemId];t&&(this.keySystem.setLicenseServer(t.licenseServerUrl),this.keySystem.setServerCertificate(t.certificate))}return this.keySystem}createAndSetMediaKeys(e){return this.ensureMediaKeys(e).then(e=>(this.ensureKeySystem(e),this.setMediaKeys(e)))}requestKey(e){return this.createAndSetMediaKeys(e).then(()=>this.keySystem.startKeyRequest(e))}updateItemId(e){this.keySystem.updateItemId(e)}removeKey(e){this.keySystem.removeKey(e)}abortKey(e){this.keySystem&&this.keySystem.abortKeyRequest(e)}onServerCertificateLoaded(e){let t=e.keysystem,i=e.certificate;this.protectionData[t].certificate=i,this.keySystem&&this.keySystemId===t&&this.keySystem.setServerCertificate(i)}get availableKeySystems(){return yi.availableKeySystems}initialize(e){this.protectionData,this.protectionData={};for(let t in e){if(!yi.availableKeySystems.includes(t)&&this.hls.config.keySystemPreference!==t){this.logger.warn(`Key system ${t} is not valid, ignoring`)();continue}let i=e[t],s=i.certificate,r=i.serverCertUrl;this.protectionData[t]={licenseServerUrl:i.licenseServerUrl,serverCertUrl:r,certificate:s},s?this.onServerCertificateLoaded({keysystem:t,certificate:s}):r&&this.keyLoader.loadCertificate(r,t).pipe(Ae(e=>this.onServerCertificateLoaded(e)),qe((e,t)=>(this.logger.error("Error loading cert: "+(e instanceof Error?e.message:""))(),this.hls.trigger(n.b.INTERNAL_ERROR,{type:a.g.NETWORK_ERROR,details:a.d.CERT_LOAD_ERROR,fatal:!1,url:r}),rt(e))),Xe(this.reset$)).subscribe()}}generateRequest(e,t){this.keySystem&&this.keySystem.setKeyRequestInfo(e,t)}setLicenseResponse(e,t){this.keySystem&&this.keySystem.setParsedResponse(e,t)}setMediaKeys(e){if(!this.media)return Promise.reject(new a.a("No media object attached, possibly detached before attach"));let t,i=this.media;return i.setMediaKeysPromise?(this.logger.warn("[Keys] setMediaKeysPromise set, adding to existing promise media.mediaKeys="+i.mediaKeys)(),t=i.setMediaKeysPromise.catch().then(()=>{if(this.media===i)return i.setMediaKeysPromise=i.setMediaKeys(e);throw new a.a(`[Keys] this.media=${this.media} not matching, possibly stopped before successful attach`)})):i.mediaKeys===e?t=Promise.resolve():(i.mediaKeys&&this.logger.warn("[Keys] setMediaKeys on non-null existing object")(),t=i.setMediaKeysPromise=i.setMediaKeys(e)),t.then(()=>{i.setMediaKeysPromise=null}).catch(e=>{if(i.setMediaKeysPromise=null,this.logger.error("[Keys] setMediaKeys err="+e.message)(),e instanceof a.a)throw e;this.handleKeySystemError(e)}),t}handleKeySystemError(e){let t=new a.n(a.g.KEY_SYSTEM_ERROR,a.d.KEY_SYSTEM_GENERIC_ERROR,!0,e.message,void 0,void 0,void 0,void 0,void 0);this.hls.upgradeInternalErrorIfNecessary(t)}ensureMediaKeys(e){if(!this.createMediaKeysPromise){let t=this.keySystemId=yi.getKeySystemIdForDecryptData(e),i=yi.createMediaKeys(t,at,ot,this.hls.platformInfo.keySystemConfig,this.hls.platformInfo.robustnessLevel);this.createMediaKeysPromise=i}return this.createMediaKeysPromise}}var ht=lt,dt=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}();function ct(e){return e&&"function"==typeof e.schedule}function ut(e,t){return new Ke((function(i){var s=new Ie,r=0;return s.add(t.schedule((function(){r!==e.length?(i.next(e[r++]),i.closed||s.add(this.schedule())):i.complete()}))),s}))}function ft(e,t){return t?ut(e,t):new Ke(Ne(e))}function pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[e.length-1];return ct(i)?(e.pop(),ut(e,i)):ft(e)}function gt(e,t){return function(i){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new mt(e,t))}}var mt=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new yt(e,this.project,this.thisArg))},e}(),yt=function(e){function t(t,i,s){var r=e.call(this,t)||this;return r.project=i,r.count=0,r.thisArg=s||r,r}return pe(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ke);function vt(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[Be]}(e))return function(e,t){return new Ke((function(i){var s=new Ie;return s.add(t.schedule((function(){var r=e[Be]();s.add(r.subscribe({next:function(e){s.add(t.schedule((function(){return i.next(e)})))},error:function(e){s.add(t.schedule((function(){return i.error(e)})))},complete:function(){s.add(t.schedule((function(){return i.complete()})))}}))}))),s}))}(e,t);if(Ve(e))return function(e,t){return new Ke((function(i){var s=new Ie;return s.add(t.schedule((function(){return e.then((function(e){s.add(t.schedule((function(){i.next(e),s.add(t.schedule((function(){return i.complete()})))})))}),(function(e){s.add(t.schedule((function(){return i.error(e)})))}))}))),s}))}(e,t);if(Ue(e))return ut(e,t);if(function(e){return e&&"function"==typeof e[Fe]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ke((function(i){var s,r=new Ie;return r.add((function(){s&&"function"==typeof s.return&&s.return()})),r.add(t.schedule((function(){s=e[Fe](),r.add(t.schedule((function(){if(!i.closed){var e,t;try{var r=s.next();e=r.value,t=r.done}catch(e){return void i.error(e)}t?i.complete():(i.next(e),this.schedule())}})))}))),r}))}(e,t);if(Symbol&&Symbol.asyncIterator&&"function"==typeof e[Symbol.asyncIterator])return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ke((function(i){var s=new Ie;return s.add(t.schedule((function(){var r=e[Symbol.asyncIterator]();s.add(t.schedule((function(){var e=this;r.next().then((function(t){t.done?i.complete():(i.next(t.value),e.schedule())}))})))}))),s}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof Ke?e:new Ke($e(e))}function _t(e,t,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),"function"==typeof t?function(s){return s.pipe(_t((function(i,s){return vt(e(i,s)).pipe(gt((function(e,r){return t(i,e,s,r)})))}),i))}:("number"==typeof t&&(i=t),function(t){return t.lift(new bt(e,i))})}var bt=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new Tt(e,this.project,this.concurrent))},e}(),Tt=function(e){function t(t,i,s){void 0===s&&(s=Number.POSITIVE_INFINITY);var r=e.call(this,t)||this;return r.project=i,r.concurrent=s,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return pe(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,i=this.index++;try{t=this.project(e,i)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,i)},t.prototype._innerSub=function(e,t,i){var s=new Oe(this,t,i),r=this.destination;r.add(s);var n=We(this,e,void 0,void 0,s);n!==s&&r.add(n)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,i,s,r){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(Me),St=function(e){function t(t,i){var s=e.call(this,t,i)||this;return s.scheduler=t,s.work=i,s.pending=!1,s}return pe(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(s,this.id,t),this},t.prototype.requestAsyncId=function(e,t,i){return void 0===i&&(i=0),setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,t,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var i=!1,s=void 0;try{this.work(e)}catch(e){i=!0,s=!!e&&e||new Error(e)}if(i)return this.unsubscribe(),s},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,i=t.actions,s=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==s&&i.splice(s,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,i){return e.call(this)||this}return pe(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(Ie)),Et=function(){function e(t,i){void 0===i&&(i=e.now),this.SchedulerAction=t,this.now=i}return e.prototype.schedule=function(e,t,i){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(i,t)},e.now=function(){return Date.now()},e}(),wt=new(function(e){function t(i,s){void 0===s&&(s=Et.now);var r=e.call(this,i,(function(){return t.delegate&&t.delegate!==r?t.delegate.now():s()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return pe(t,e),t.prototype.schedule=function(i,s,r){return void 0===s&&(s=0),t.delegate&&t.delegate!==this?t.delegate.schedule(i,s,r):e.prototype.schedule.call(this,i,s,r)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var i;this.active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}},t}(Et))(St),It=function(){function e(e,t,i,s){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=i,this.scheduler=s}return e.prototype.call=function(e,t){return t.subscribe(new Dt(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Dt=function(e){function t(t,i,s,r,n){var a=e.call(this,t)||this;return a.absoluteTimeout=i,a.waitFor=s,a.withObservable=r,a.scheduler=n,a.action=null,a.scheduleTimeout(),a}return pe(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(We(e,t))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},t}(Me);function Lt(e,t){return void 0===t&&(t=wt),function(e,t,i){return void 0===i&&(i=wt),function(s){var r,n=(r=e)instanceof Date&&!isNaN(+r),a=n?+e-i.now():Math.abs(e);return s.lift(new It(a,n,t,i))}}(e,rt(new dt),t)}function kt(){return function(e){return e.lift(new xt(e))}}var Rt,Ct,At,Pt,xt=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var i=this.connectable;i._refCount++;var s=new Mt(e,i),r=t.subscribe(s);return s.closed||(s.connection=i.connect()),r},e}(),Mt=function(e){function t(t,i){var s=e.call(this,t)||this;return s.connectable=i,s.connection=null,s}return pe(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var i=this.connection,s=e._connection;this.connection=null,!s||i&&s!==i||s.unsubscribe()}}else this.connection=null},t}(ke),Ot={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(Rt=function(e){function t(t,i){var s=e.call(this)||this;return s.source=t,s.subjectFactory=i,s._refCount=0,s._isComplete=!1,s}return pe(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Ie).add(this.source.subscribe(new Nt(this.getSubject(),this))),e.closed&&(this._connection=null,e=Ie.EMPTY)),e},t.prototype.refCount=function(){return kt()(this)},t}(Ke).prototype)._subscribe},_isComplete:{value:Rt._isComplete,writable:!0},getSubject:{value:Rt.getSubject},connect:{value:Rt.connect},refCount:{value:Rt.refCount}},Nt=function(e){function t(t,i){var s=e.call(this,t)||this;return s.connectable=i,s}return pe(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(tt);function Ft(){return new it}!function(e){function t(t,i){var s=e.call(this,t)||this;return s.connectable=i,s}pe(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var i=this.connection,s=e._connection;this.connection=null,!s||i&&s!==i||s.unsubscribe()}}else this.connection=null}}(ke),function(e){e.MustRequestResponse="MustRequestResponse",e.WaitingForKeyResponse="WaitingForKeyResponse",e.GotKeyResponse="GotKeyResponse"}(Ct||(Ct={}));class Bt extends Error{constructor(e,t){super(e),this.message=e,this.keyuri=t,this.name="KeyRequestTimeoutError",this.keyuri=t}}!function(e){e[e.InvalidState=0]="InvalidState",e[e.Abort=1]="Abort",e[e.OutputRestricted=2]="OutputRestricted",e[e.AlreadyFailedKey=3]="AlreadyFailedKey",e[e.HttpError=4]="HttpError",e[e.InternalError=5]="InternalError",e[e.LicenseServerError=6]="LicenseServerError",e[e.InsufficientCPC=7]="InsufficientCPC"}(At||(At={}));class Ut extends Error{constructor(e,t,i,s,r){super(e),this.message=e,this.keyuri=t,this.statusCode=i,this.isOkToRetry=s,this.keyErrorReason=r,this.name="KeyRequestError"}}class Vt{constructor(e){this.hls=e,this.reset$=new it,this.hls=e,this.logger=e.logger,this.keyUriToKeyInfo={},this.numberOfConsecutiveKeyErrors=0,this.activeDecryptData=[],this.pendingDecryptData=[],this.resetFn=this.reset.bind(this),this.hls.on(n.b.MEDIA_DETACHING,this.resetFn),void 0!==this.hls.config.useMultipleKeySessions&&this.hls.config.useMultipleKeySessions&&(this.setupFn=this.setupListeners.bind(this),this.hls.on(n.b.MEDIA_ATTACHING,this.setupFn)),this.keySystemController=new ht(e,this)}destroy(){this.keySystemController.destroy(),this.reset(),this.hls&&(this.hls.off(n.b.MEDIA_DETACHING,this.resetFn),void 0!==this.hls.config.useMultipleKeySessions&&this.hls.config.useMultipleKeySessions&&this.hls.off(n.b.MEDIA_ATTACHING,this.setupFn),this.hls=void 0)}reset(){this.media&&(this.media.removeEventListener("timeupdate",this.ontimeupdate),this.media=null),this.reset$.next(),this.keyUriToKeyInfo={},this.activeDecryptData=[],this.numberOfConsecutiveKeyErrors=0}setupListeners(e,t){let i=this.media=t.media;i&&i.addEventListener("timeupdate",this.ontimeupdate.bind(this))}ontimeupdate(){if(!this.media)return;let e=this.media.currentTime;this.activeDecryptData.forEach(function(t,i,s){e>t.expiryPosition+this.hls.config.keyHoldTimeAfterExpiry/1e3&&(s.splice(i,1),this.keySystemController.removeKey(t),this.keyUriToKeyInfo[t.uri]=void 0)}.bind(this))}_handleKeyRequestResolve(e,t){let i=this.keyUriToKeyInfo[e];i?i.state=t:this.logger.warn("Missing info keyuri="+this.hls.redactUrl(e))()}_handleKeyError(e,t){let i,s=this.keyUriToKeyInfo[e];if(!s)return new Error("Key doesn't exist in system");if(this.logger.error(`[Keys] Key request error keyuri=${this.hls.redactUrl(e)} ${t.message}`)(),s.state=Ct.MustRequestResponse,t)if(t instanceof $t)i=new a.n(a.g.KEY_SYSTEM_ERROR,a.d.KEY_SYSTEM_GENERIC_ERROR,!0,t.message,{code:t.code,text:t.message},s.decryptdata,s.stats,s.levelIds,void 0);else if(t instanceof Bt||t instanceof dt)i=new a.n(a.g.NETWORK_ERROR,a.d.KEY_LOAD_TIMEOUT,!1,t.message,a.f.CryptResponseReceivedSlowly,s.decryptdata,s.stats,s.levelIds,void 0);else if(t instanceof Ut){this.numberOfConsecutiveKeyErrors++;let e=!t.isOkToRetry&&this.numberOfConsecutiveKeyErrors>=this.hls.config.keyRetryCountOnError;s.stats.isOkToRetry=t.isOkToRetry,s.stats.statusCode=t.statusCode,i=new a.n(a.g.NETWORK_ERROR,a.d.KEY_LOAD_ERROR,e,t.message,{code:t.statusCode,text:t.message},s.decryptdata,s.stats,s.levelIds,t.keyErrorReason)}else i=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,t.message);return i}triggerKeyError(e,t){let i=this._handleKeyError(e,t);i&&this.hls.trigger(n.b.INTERNAL_ERROR,i)}getLevelIdsForKey(e){return this.keyUriToKeyInfo[e.uri]?this.keyUriToKeyInfo[e.uri].levelIds:new Set}getKeyFromDecryptData(e,t,i=!1){if(!e||!e.isEncrypted)return pt(e);let s=e.uri,r=this.keyUriToKeyInfo[s];if(r&&!isNaN(t)&&r.levelIds.add(t),r&&!r.stats.isOkToRetry)return rt(this._handleKeyError(s,new Ut("Key has already resulted in failure",s,r.stats.statusCode,!1,At.AlreadyFailedKey)));if(!r||i||r.state===Ct.MustRequestResponse){let i=!1;r?r.abort$.next():(i=!0,r=this.keyUriToKeyInfo[s]={state:Ct.WaitingForKeyResponse,decryptdata:e,stats:void 0,request:void 0,levelIds:new Set,abort$:new it}),r.state=Ct.WaitingForKeyResponse,r.decryptdata=e,isNaN(t)||r.levelIds.add(t);let a,o=performance.now();r.stats={trequest:o,tfirst:o,isOkToRetry:!0};let l=e.method;switch(l){case"SAMPLE-AES":case"ISO-23001-7":case"SAMPLE-AES-CTR":a=this._fetchKeyEME(r,e);break;case"AES-128":a=this.fetchKeyHTTP(e.uri,e,void 0);break;default:r.request=rt(new Error("Unexpected METHOD attribute "+l))}const h=this.hls.config,d=this.hls.streamController.targetDuration;let c=Math.max(this.hls.config.keyLoadingMinTimeout,d>0?2e3*d:h.keyLoadingDefaultTimeout);return r.request=a.pipe(Lt(c),_t(t=>(this._handleKeyRequestResolve(s,e?Ct.GotKeyResponse:Ct.MustRequestResponse),this.numberOfConsecutiveKeyErrors=0,!this.hls.config.gapless&&i&&"fairplaystreaming"===this.hls.config.keySystemPreference&&"AES-128"!==e.method&&(this.hls.isLive?this.pendingDecryptData.push(e):this.activeDecryptData.push(e)),r.decryptdata.key=t.decryptdata.key,this.hls.trigger(n.b.KEY_LOADED,t),pt(t.decryptdata))),qe(e=>rt(this._handleKeyError(s,e))),(function(e){return kt()((t=Ft,function(e){var i;i="function"==typeof t?t:function(){return t};var s=Object.create(e,Ot);return s.source=e,s.subjectFactory=i,s})(e));var t}),Xe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Number.POSITIVE_INFINITY,s=void 0,r=e[e.length-1];return ct(r)?(s=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(i=e.pop())):"number"==typeof r&&(i=e.pop()),!s&&1===e.length&&e[0]instanceof Ke?e[0]:function(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),_t(Ge,e)}(i)(ft(e,s))}(r.abort$,this.reset$))),r.request}return r.state===Ct.GotKeyResponse?pt(r.decryptdata):r.request}updateExpiryPosition(e,t,i=1/0){this.pendingDecryptData.forEach(function(s,r,n){s.uri===e.uri&&(n.splice(r,1),this.activeDecryptData.forEach(e=>{let s=this.keyUriToKeyInfo[e.uri];return e.expiryPosition===1/0&&s.levelIds.has(t)&&(e.expiryPosition=i),e}),this.activeDecryptData.push(s))}.bind(this))}stopRequest(e){let t=e.uri,i=this.keyUriToKeyInfo[t];i&&(i.abort$.next(),i.state=Ct.MustRequestResponse)}_fetchKeyEME(e,t){return new Ke(i=>(this.keySystemController.requestKey(t).then(t=>{let s=performance.now();if(!t)return this.logger.warn("fetchKeyEME got undefined decryptdata")(),void i.error(new a.a("Key request was aborted"));let r={timestamp:s,keyuri:t.uri,decryptdata:t,stats:{trequest:e.stats.trequest,tfirst:e.stats.tfirst,tload:s}};i.next(r),i.complete()}).catch(e=>{i.error(e)}),()=>{this.keySystemController.abortKey(t)}))}fetchKeyHTTP(e,t,i){return new Ke(s=>{let r=this.hls.config,n=y.isCustomUrl(e)?new y(this.hls):new r.loader(r),a={type:"key",url:e,method:"GET",decryptdata:t,responseType:"arraybuffer"},o={maxLoadTimeMs:isNaN(i)?0:i,maxTimeToFirstByteMs:0,autoRetry:!1,timeoutRetry:null,errorRetry:null},l={onSuccess:(e,i,r)=>{t.key=new Uint8Array(e.data);let n={decryptdata:t,keyuri:r.url,stats:{trequest:i.trequest,tfirst:i.tfirst,tload:i.tload},timestamp:performance.now()};s.next(n),s.complete()},onError:(e,t)=>{s.error(new Ut("Unable to load key",t.url,e.code,!0,At.HttpError))},onTimeout:(e,t)=>{s.error(new Bt("Key load timed out",t.url))}};return n.load(a,o,l),()=>{n.abort()}})}loadCertificate(e,t){return new Ke(i=>{let s,r=this.hls.config,n=y.isCustomUrl(e)?new y(this.hls):void 0!==r.fLoader?new r.fLoader(r):new r.loader(r),a={type:"cert",url:e,responseType:"arraybuffer"};s=y.isCustomUrl(e)?r.fragLoadPolicy.customURL:r.fragLoadPolicy.default;let o={onSuccess:(e,s,r)=>{i.next({keysystem:t,certificate:e.data}),i.complete()},onError:(e,t)=>{i.error(new Error("Certificate error "+e.code))},onTimeout:(e,t)=>{i.error(new dt)}};return n.load(a,s,o),()=>{n.abort()}})}}!function(e){e.GET_REQUEST_INFO="GET_REQUEST_INFO",e.GET_CHALLENGE="GET_CHALLENGE",e.GET_KEY_RESPONSE="GET_KEY_RESPONSE",e.PROCESS_LICENSE="PROCESS_LICENSE"}(Pt||(Pt={}));class $t extends Error{constructor(e,t,i,s){super(e),this.keyuri=t,this.code=i,this.keysystemstring=s,this.name="KeySystemError"}}class Gt{constructor(e,t,i,s){this.hls=e,this.mediaKeys=t,this.keyLoader=i,this.systemString=s,this.destroy$=new it,this.logger=e.logger,this.shouldDestroyMediaKeys=!1,this.itemId=e.loadingItem.itemId||"",this.sessions=[],this.keyIdToKeyInfo={},this.keyUriToKeyInfo={},this.sessionIdToKeyUri={},this.onkeystatuseschange=this.handleKeyStatusesChange.bind(this),this.onkeymessage=this.handleKeyMessage.bind(this),this.certLoadTimeout=void 0}removeAndCloseSessionInternal(e){return e.remove().catch(e=>{this.logger.error("Could not remove session: "+e.message)()}).then(()=>e.close()).catch(e=>{this.logger.error("Could not close session: "+e.message)()}).then(()=>{this.removeKeySessionListeners(e)})}destroy(){this.isDestroying=!0,this.destroy$.next(),clearTimeout(this.certLoadTimeout),this.certLoadTimeout=void 0;for(let i of Object.values(this.keyUriToKeyInfo))this.stopRenewal(i),this._abortKeyRequest(i);let e=[];this.sessions.forEach(t=>{let i=this.removeAndCloseSessionInternal(t);e.push(i)});let t=Promise.all(e).then(()=>{this.mediaKeys=void 0,this.keyIdToKeyInfo={},this.keyUriToKeyInfo={},this.sessionIdToKeyUri={}});return C.clearKeyUriToKeyIdMap(),t}setPromise(e,t,i){e.promise&&e.promise.reject(new Ut("Existing promise",e.decryptdata.uri,0,!0,At.InvalidState)),e.promiseType=t,e.promise=i}resolvePromise(e,t,i,s){e&&e.promise&&(e.promiseType===t?e.promise.resolve(i):(this.logger.warn(`wrong type ${t} ${e.promiseType} ${s}`)(),e.promise.reject(s)),e.promise=void 0,e.promiseType=void 0)}setServerCertificate(e=null){return this.needsCert?(this.setCertPromise||(this.setCertPromise=new Promise(function(e){this.onCertSet=e}.bind(this)).then(function(e){return this.mediaKeys.setServerCertificate(e)}.bind(this)).catch(function(e){throw this.logger.error("Failed setServerCertificate")(),this.setCert=!1,e}.bind(this))),e&&!this.setCert&&(this.setCert=!0,this.onCertSet(e)),this.setCertPromise):Promise.resolve()}setLicenseServer(e){this.licenseServerUrl||(this.licenseServerUrl=e)}ensureKeySessionForKeyInfo(e){if(e.session)return;let t=this.mediaKeys.createSession();t?(this.sessions.push(t),this.addKeySessionListeners(t)):this.logger.error(this.systemString+" FAIL: could not create MediaKeysSession")(),e.session=t}_checkForAbort(e){if(e.aborted)throw this.logger.warn("Aborted in the middle of key request")(),new Ut("Aborted",e.decryptdata.uri,0,!0,At.Abort)}startKeyRequest(e){let t=e.uri;this.keyUriToKeyInfo[t]||(this.keyUriToKeyInfo[t]={decryptdata:e,session:null,aborted:!1});let i=this.keyUriToKeyInfo[t];if(this.ensureKeySessionForKeyInfo(i),!i.session)return Promise.reject(new $t("Could not create key session",e.uri,0,this.systemString));let s=m.b.utf8arrayToStr(e.keyId);this.keyIdToKeyInfo[s]=i,i.aborted=!1,this.logger.info(`[QE Critical] [Keys] ${this.systemString} startKeyRequest uri=${this.hls.redactUrl(t)}`)();let r=new Promise((e,i)=>{this.certLoadTimeout||(this.certLoadTimeout=setTimeout(()=>{i(new $t("Certificate required, but not set",t,0,this.systemString))},1e4))});return Promise.all([this.getKeyRequestInfo(i),Promise.race([this.setServerCertificate(),r])]).then(e=>(clearTimeout(this.certLoadTimeout),this.certLoadTimeout=void 0,this._checkForAbort(i),e[0])).then(function(e){return this._checkForAbort(i),this.hls.eventReporter.notifyKeySessionEvent("spcsubmitted",{keyuri:t,keyFormat:this.systemString}),this.generateLicenseChallenge(i,e).catch(function(e){throw this.logger.error(`[Keys] ${this.systemString} generateLicenseChallenge Failed ${e.message} uri=${this.hls.redactUrl(t)}`)(),this.hls.eventReporter.notifyKeySessionEvent("spcerror",{keyuri:t}),e}.bind(this))}.bind(this)).then(function(e){return this._checkForAbort(i),this.logger.info(`[QE Critical] [Keys] ${this.systemString} challenge created uri=${this.hls.redactUrl(t)}`)(),this.hls.eventReporter.notifyKeySessionEvent("spccreated",{keyuri:t,cdmVersion:this.cdmVersion}),this.getKeyRequestResponse(i,e)}.bind(this)).then(function(e){return this._checkForAbort(i),this.logger.info(`[QE Critical] [Keys] ${this.systemString} onKeyResponseParsed uri=${this.hls.redactUrl(t)}`)(),this.hls.eventReporter.notifyKeySessionEvent("ckcsubmitted",{keyuri:t}),this.handleParsedKeyResponse(i,e).catch(function(e){throw this.hls.eventReporter.notifyKeySessionEvent("ckcerror",{keyuri:t}),e}.bind(this))}.bind(this)).then(function(){return this.logger.info(`[QE Critical] [Keys] ${this.systemString} New usable key: keyuri=${this.hls.redactUrl(t)} CDMVersion=${this.cdmVersion}`)(),this.hls.eventReporter.notifyKeySessionEvent("ckcprocessed",{keyuri:t}),e}.bind(this)).catch(e=>{clearTimeout(this.certLoadTimeout),this.certLoadTimeout=void 0;let t=!i.aborted;if(this.handleKeyExchangeError(i),t)throw e})}abortKeyRequest(e){let t=this.keyUriToKeyInfo[e.uri];this._abortKeyRequest(t)}_abortKeyRequest(e){if(e){let t=e.decryptdata.uri;e.aborted=!0,e.promise&&(this.logger.warn("[Keys] Aborting key "+this.hls.redactUrl(t))(),this.hls&&this.hls.eventReporter&&this.hls.eventReporter.notifyKeySessionEvent("keyaborted",{keyuri:t}),e.promise.reject(new Ut("Aborted",t,0,!0,At.Abort)),e.promise=void 0,e.promiseType=void 0)}}handleKeyExchangeError(e){}stopRenewal(e){e&&e.renewalTimer&&(clearTimeout(e.renewalTimer),e.renewalTimer=void 0)}updateItemId(e){this.itemId=e}removeKey(e){this.logger.info("[Keys] removing key "+this.hls.redactUrl(e.uri))();let t=this.keyUriToKeyInfo[e.uri];if(t&&t.session){this._abortKeyRequest(t),this.stopRenewal(t),this.removeSession(t.session,e);let i=m.b.utf8arrayToStr(e.keyId);this.keyIdToKeyInfo[i]=void 0,this.keyUriToKeyInfo[e.uri]=void 0}}removeSession(e,t){var i=this.sessions.indexOf(e);i>-1&&this.sessions.splice(i,1),this.removeAndCloseSessionInternal(e),this.sessionIdToKeyUri[e.sessionId]=void 0}getKeyRequestInfo(e){return Promise.resolve({})}setKeyRequestInfo(e,t){}sanitizeRequest(e){return e}generateLicenseChallengeInternal(e,t,i){return new Promise((s,r)=>{let n,a=e.decryptdata,o=e.session,l=a.uri,h=a.keyId;if(this.setPromise(e,Pt.GET_CHALLENGE,{resolve:s,reject:r}),o.generateRequestPromise)n=o.generateRequestPromise.then(this.generateRequestInitialized.bind(this,e,"usable"===i));else{let i=this.generateInitData(h,a,t);o.generateRequestPromise=o.generateRequest(i.initDataType,i.initData),n=o.generateRequestPromise.then(function(){this.sessionIdToKeyUri[o.sessionId]=l}.bind(this)).catch(function(t){throw this.logger.error(`${this.systemString} FAIL: generateRequest fail keyuri=${this.hls.redactUrl(e.decryptdata.uri)} message=${t.message}`)(),new $t(t.message,e.decryptdata.uri,0,this.systemString)}.bind(this))}n.catch(r)})}generateRequestInitialized(e,t){}generateLicenseChallenge(e,t){let i,s,r=e.decryptdata,n=e.session,a=r.uri,o=r.keyId;if(this.logger.info(`[QE Critical] [Keys] ${this.systemString} generateLicenseChallenge uri=${this.hls.redactUrl(a)}`)(),e.licenseChallenge&&this.resolvePromise(e,Pt.GET_CHALLENGE,e.licenseChallenge,new Ut("Unexpected challenge",a,0,!0,At.InvalidState)),t=this.sanitizeRequest(t),e.requestInfo=t,this.itemId=this.hls.inGaplessMode?this.hls.loadingItem.itemId:this.itemId,this.sessionId=this.sessionId||t&&t.sessionId||this.itemId,this.systemString===I.systemStringPrefix){let e=new Uint8Array(o);S(e),i=n.keyStatuses.get(e)}else i=n.keyStatuses.get(o);switch(i){case"status-pending":case"usable":case"expired":case void 0:s=this.generateLicenseChallengeInternal(e,t,i);break;default:s=Promise.reject(new $t("Bad internal state state="+i,a,0,this.systemString))}return s}setParsedResponse(e,t){let i=this.keyUriToKeyInfo[e];this.resolvePromise(i,Pt.GET_KEY_RESPONSE,t,new Ut("Unexpected response received",e,0,!0,At.InvalidState))}addKeySessionListeners(e){e&&(e.addEventListener("keystatuseschange",this.onkeystatuseschange),e.addEventListener("message",this.onkeymessage))}removeKeySessionListeners(e){e&&(e.removeEventListener("keystatuseschange",this.onkeystatuseschange),e.removeEventListener("message",this.onkeymessage))}handleKeyStatusesChange(e){e.target.keyStatuses.forEach((e,t)=>{let i=new Uint8Array(t);this.systemString===I.systemStringPrefix&&S(i);let s=m.b.utf8arrayToStr(i),r=this.keyIdToKeyInfo[s];this.handleKeyStatusForKey(e,r)})}handleKeyStatusForKey(e,t){if(!t)return;let i=t.decryptdata.uri;switch(e){case"internal-error":this.logger.error(`[Keys] ${this.systemString} internal-error for keyuri=${this.hls.redactUrl(i)} promiseType=${t.promiseType}`)(),t.promise&&(t.promise.reject(new Ut("Got internal error from key system",i,0,!1,At.InternalError)),t.promise=void 0);break;case"usable":t.promiseType===Pt.PROCESS_LICENSE&&this.resolvePromise(t,Pt.PROCESS_LICENSE,{},new Ut("Wrong key status",i,0,!0,At.InvalidState));break;case"output-restricted":if(this.logger.error(`[Keys] ${this.systemString} output-restricted for keyuri=${this.hls.redactUrl(i)}`)(),t.session){var s=this.sessions.indexOf(t.session);s>-1&&this.sessions.splice(s,1),this.removeAndCloseSessionInternal(t.session)}t.promise?(t.promise.reject(new Ut("output-restricted",i,0,!1,At.OutputRestricted)),t.promise=void 0):this.keyLoader.triggerKeyError(i,new Ut("output-restricted",i,0,!1,At.OutputRestricted));break;default:this.logger.info(`[Keys] key status uri=${this.hls.redactUrl(i)} ${e}`)()}}}const Ht={initDataTypes:["keyids","cenc"]},Kt={initDataTypes:["cenc"]},jt=new Uint8Array([148,206,134,251,7,255,79,67,173,184,147,210,250,150,140,162]);var Wt;!function(e){e[e.CENC=1667591779]="CENC",e[e.CBCS=1667392371]="CBCS"}(Wt||(Wt={}));class qt extends Gt{constructor(e,t,i,s,r){super(e,t,i,s),this.singleRenewalTimer=r,this.renewalTimer=void 0}destroy(){if(this.isDestroying=!0,this.singleRenewalTimer)this.stopRenewal(void 0);else for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e];this.stopRenewal(t)}return super.destroy()}static get systemId(){return jt}static get requestAccessConfig(){return Kt}get needsCert(){return!0}stopRenewal(e){this.singleRenewalTimer?(clearTimeout(this.renewalTimer),this.renewalTimer=void 0):e&&(clearTimeout(e.renewalTimer),e.renewalTimer=void 0)}sanitizeRequest(e){return{assetId:e&&e.assetId?new Uint8Array(e.assetId):void 0,ssc:e&&e.ssc?new Uint8Array(e.ssc):void 0,sessionId:e&&e.sessionId?e.sessionId:void 0}}setKeyRequestInfo(e,t){let i=this.keyUriToKeyInfo[e];i?this.resolvePromise(i,Pt.GET_REQUEST_INFO,t,new Ut("Unexpected requestInfo",e,0,!0,At.InvalidState)):this.logger.error("Unexpected key requested "+this.hls.redactUrl(e))()}handleParsedKeyResponse(e,t){let i=e.decryptdata.uri,s=t.statusCode;if(!(0!==s||t.ckc&&t.ckc.byteLength))return Promise.reject(new Ut("License request resulted in HTTP Error",i,t.statusCode,!0,At.HttpError));if(0!==s)return Promise.reject(new Ut("License server responded with error",i,t.statusCode,!1,At.LicenseServerError));if(!t.ckc||!t.ckc.byteLength)return Promise.reject(new Ut("License server responded with invalid license",i,t.statusCode,!1,At.LicenseServerError));let r=t.renewalDate,n=new Date,a=r>n?r.getTime()-n.getTime():0;if(a>0){let t=!1;this.singleRenewalTimer?this.renewalTimer||(t=!0,this.renewalTimer=setTimeout(()=>{this.forceStartKeyRequest(e,!0).subscribe()},a)):(t=!0,clearTimeout(e.renewalTimer),e.renewalTimer=setTimeout(()=>{this.forceStartKeyRequest(e,!0).subscribe()},a)),t&&this.logger.info(`[Keys] ${this.systemString} Scheduling renewal in ${a} ms`)()}let o=this.makeProcessLicenseRequestMessage(e,t,a);return new Promise((t,i)=>{this.setPromise(e,Pt.PROCESS_LICENSE,{resolve:t,reject:i});let s=e.session;s.update(o).then(t=>{let i=e.decryptdata.keyId,r=s.keyStatuses.get(i);this.handleKeyStatusForKey(r,e)}).catch(t=>{i(new $t(t.message,e.decryptdata.uri,0,this.systemString)),e.promise=void 0})})}forceStartKeyRequest(e,t){return t&&this.stopRenewal(e),this.abortKeyRequest(e.decryptdata),this.keyLoader.getKeyFromDecryptData(e.decryptdata,void 0,!0).pipe(Xe(this.destroy$))}makeKeyRequests(e){let t=[];for(let i in e){let s=e[i],r=s.decryptdata,n=s.requestInfo,a=r.keyId;t.push({keyId:a,assetId:n?n.assetId:void 0,ssc:n?n.ssc:void 0,versionList:r.formatversions})}return t}getSchemeAndFlags(e){let t="ISO-23001-7"===e.method?Wt.CENC:Wt.CBCS,i=0;return this.hls.playingItem.secureStop&&(i|=1),{scheme:t,flags:i}}generateInitData(e,t,i){let{scheme:s,flags:r}=this.getSchemeAndFlags(t),n=this.makeKeyRequests([{decryptdata:t,requestInfo:i}]);return{initData:this.makeFpsKeySystemInitData(s,r,n),initDataType:"cenc"}}generateRequestInitialized(e,t){let i=this.makeKeyRequestMessage(e,t);return i?e.session.update(i).then(function(){e.requestInfo=void 0}.bind(this)).catch(function(t){throw this.logger.error(`[Keys] ${this.systemString} FAIL: generateRequestInitialized keyuri=${this.hls.redactUrl(e.decryptdata.uri)} message=${t.message}`)(),new $t(t.message,e.decryptdata.uri,0,this.systemString)}.bind(this)):Promise.reject(new Ut("Unable to generate request using existing keySession",e.decryptdata.uri,0,!0,At.InvalidState))}getKeyRequestResponse(e,t){return new Promise(function(i,s){let r=e.decryptdata.uri;this.setPromise(e,Pt.GET_KEY_RESPONSE,{resolve:i,reject:s}),this.hls.trigger(n.b.LICENSE_CHALLENGE_CREATED,{keyuri:r,licenseChallenge:t,keysystem:this.systemString})}.bind(this))}resolveSPCPromise(e,t){let i=e.decryptdata.uri;this.resolvePromise(e,Pt.GET_CHALLENGE,t,new Ut("Unexpected challenge",i,0,!0,At.InvalidState))}}var zt=i(4);const Yt={SessionId:"AirPlayPlaybackSessionID",APIProvider:"APIProviderID",MovieID:"PlaybackSessionID",SecureStopSPC:"SecureStopSPC",SessionLifespanSPC:"SessionLifespanSPC"};function Xt(e,t,i){if(i+4>e.byteLength)return;let s=t.getUint32(i);if((i+=4)+s>e.byteLength)return;let r=e.slice(i,i+s);return{pos:i+=s,data:r}}function Qt(e){let t={},i=new DataView(e.buffer),s=4;var r=i.getUint32(s);s+=4;for(let n=0;n<r&&s<e.byteLength&&!(s+16>e.byteLength);++n){let r=e.slice(s,s+16);if((s+=16)+4>e.byteLength)break;let n=Xt(e,i,s);if(!n)break;s=n.pos,t[m.b.utf8arrayToStr(r)]=n.data}return t}function Jt(e,t,i,s){let r=s?s.byteLength:0;return t.setUint32(i,r),r&&e.set(s,i+4),i+(4+r)}function Zt(e){let t=4;for(let i in e)t+=28+(e[i].assetId?e[i].assetId.byteLength:0)+(e[i].ssc?e[i].ssc.byteLength:0)+(e[i].versionList?4*e[i].versionList.length:0);return t}function ei(e,t,i,s){t.setUint32(i,s.length),i+=4;for(let r in s){let n=s[r];if(e.set(n.keyId,i),i=Jt(e,t,i=Jt(e,t,i+=16,n.assetId),n.ssc),t.setUint32(i,n.versionList?n.versionList.length:0),i+=4,n.versionList)for(let e in n.versionList)t.setUint32(i,n.versionList[e]),i+=4}return i}class ti extends qt{constructor(e,t,i,s){super(e,t,i,s,void 0===e.config.useMultipleKeySessions||!e.config.useMultipleKeySessions)}ensureKeySessionForKeyInfo(e){if(!e.session)if(this.singleRenewalTimer&&0!==this.sessions.length)e.session=this.sessions[0];else{let t=this.mediaKeys.createSession();t?(this.sessions.push(t),this.addKeySessionListeners(t)):this.logger.error(this.systemString+" FAIL: could not create MediaKeysSession")(),e.session=t}}getKeyRequestInfo(e){return new Promise(function(t,i){let s=e.decryptdata,r=s.uri;this.setPromise(e,Pt.GET_REQUEST_INFO,{resolve:t,reject:i}),this.hls.trigger(n.b.KEY_REQUEST_STARTED,{keyuri:r,decryptdata:s,timestamp:Date.now()})}.bind(this))}makeProcessLicenseRequestMessage(e,t,i){let s=new Uint8Array(t.ckc);return function(e){let t=0;for(let n in e)t+=24+e[n].ckc.byteLength;let i=0,s=new Uint8Array(8+t),r=new DataView(s.buffer);r.setUint32(0,1667982195),r.setUint32(4,e.length),i+=8;for(let n in e){let t=e[n];s.set(t.keyId,i),i+=16,r.setUint32(i,t.expirySec),i=Jt(s,r,i+=4,t.ckc)}return s}([{keyId:e.decryptdata.keyId,expirySec:i/1e3,ckc:s}])}makeFpsKeySystemInitData(e,t,i){let s=function(e,t,i,s){let r=Zt(s),n=0,a=new Uint8Array(8+r),o=new DataView(a.buffer);return o.setUint32(n,e),o.setUint32(n+4,1<<24|16777215&i),n=ei(a,o,n+=8,s),a}(e,0,t,i);return zt.a.pssh(ti.systemId,[],s)}makeKeyRequestMessage(e){return function(e){let t=Zt(e),i=0,s=new Uint8Array(4+t),r=new DataView(s.buffer);return r.setUint32(0,1668442994),i=ei(s,r,i+=4,e),s}([{keyId:e.decryptdata.keyId,assetId:e.requestInfo?e.requestInfo.assetId:void 0,ssc:e.requestInfo?e.requestInfo.ssc:void 0,versionList:e.decryptdata.formatversions}])}handleKeyMessage(e){if(e.message.byteLength<4)return void this.logger.error("Unexpected message")();let t=new Uint8Array(e.message),i=new DataView(e.message),s=i.getUint32(0);if(this.isDestroying&&1919710053!==s)this.logger.warn("In the middle of destroying, ignore command: "+s.toString(16))();else switch(s){case 1667592820:this.logger.warn("Certificate not set!")();break;case 1919837559:{let e=Qt(t);for(let t in e){let e=this.keyIdToKeyInfo[t];this.forceStartKeyRequest(e,!0).subscribe()}break}case 1936745331:{let e=Qt(t);for(let t in e){let i=this.keyIdToKeyInfo[t],s=e[t];this.resolveSPCPromise(i,s)}break}case 1919710053:this._handleLicenseRelease(t);break;case 1667525993:{let e=Xt(t,i,4);if(e){let t=this.cdmVersion=m.b.utf8arrayToStr(e.data);this.logger.info(`[Keys] ${this.systemString} CDM Version :  ${t}`)()}break}}}_handleLicenseRelease(e){let t={},i=new DataView(e.buffer);switch(i.getUint32(4)){case 1936946288:{if(!Yt){this.logger.error("No secure stop keys defined")();break}t[Yt.SessionId]=this.sessionId;let s=8;if(s+4>e.byteLength)break;t[Yt.APIProvider]=i.getUint32(s)===Wt.CENC?"EC396D13-FB13-4993-9D0D-71518ACF3D6F":"F19BF03B-7470-41A4-9655-86D078307D59";let r=Xt(e,i,s+=4);if(!r)break;if(s=r.pos,t[Yt.MovieID]=m.b.utf8arrayToStr(r.data),!(r=Xt(e,i,s)))break;if(s=r.pos,t[Yt.SecureStopSPC]=r.data,!(r=Xt(e,i,s)))break;s=r.pos,t[Yt.SessionLifespanSPC]=r.data;break}}this.hls.trigger(n.b.LICENSE_RELEASED,{keysystem:this.systemString,itemId:this.itemId,releaseRecord:t})}}var ii=ti;const si={fpsd:m.b.strToUtf8array("fpsd"),fpsi:m.b.strToUtf8array("fpsi"),fpsk:m.b.strToUtf8array("fpsk"),fkri:m.b.strToUtf8array("fkri"),fkai:m.b.strToUtf8array("fkai"),fkcx:m.b.strToUtf8array("fkcx"),fkvl:m.b.strToUtf8array("fkvl")};function ri(e,t,i,s){let r=[si.fpsk],n=zt.a.box(si.fkri,new Uint8Array([0,0,0,0]),e);if(r.push(n),t&&t.byteLength&&r.push(zt.a.box(si.fkai,t)),i&&i.byteLength&&r.push(zt.a.box(si.fkcx,i)),s&&s.length){let e=new Uint8Array(4*s.length),t=0;for(let i of s)zt.a.set32(i,e,t),t+=4;r.push(zt.a.box(si.fkvl,e))}return zt.a.box.apply(null,r)}var ni={initDataTypes:["cenc"]};const ai=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);class oi extends Gt{constructor(e,t,i,s){super(e,t,i,s),this.hls=e,this.shouldDestroyMediaKeys=!0}static get systemId(){return ai}static get requestAccessConfig(){return ni}get needsCert(){return!1}generateInitData(e,t){let i=t.pssh;return{initData:zt.a.pssh(oi.systemId,[],i),initDataType:"cenc"}}removeKey(e){let t=this.keyUriToKeyInfo[e.uri];t&&(t.oldSessions.forEach(t=>{this.removeSession(t,e)}),t.oldSessions=[],super.removeKey(e))}ensureKeySessionForKeyInfo(e){e.session&&(e.oldSessions.push(e.session),e.session=null),super.ensureKeySessionForKeyInfo(e)}startKeyRequest(e){let t=e.uri;return this.keyUriToKeyInfo[t]||(this.keyUriToKeyInfo[t]={decryptdata:e,session:null,aborted:!1,oldSessions:[]}),super.startKeyRequest(e)}_startKeyRenewal(e){this.stopRenewal(e),this.keyLoader.getKeyFromDecryptData(e.decryptdata,void 0,!0).pipe(Xe(this.destroy$)).subscribe()}getKeyRequestResponse(e,t){return new Promise(function(i,s){let r=e.decryptdata.uri;this.setPromise(e,Pt.GET_KEY_RESPONSE,{resolve:i,reject:s}),this.hls.trigger(n.b.LICENSE_CHALLENGE_CREATED,{keyuri:r,licenseChallenge:t,keysystem:this.systemString,keyId:e.decryptdata.keyId})}.bind(this))}generateRequestInitialized(e){let t=e.decryptdata.uri,i=e.licenseChallenge;e.requestInfo=void 0,this.resolvePromise(e,Pt.GET_CHALLENGE,i,new Ut("Unexpected challenge",t,0,!0,At.InvalidState))}handleParsedKeyResponse(e,t){if(!this.isDestroying)return new Promise((i,s)=>{let r=e.decryptdata.uri;if(0!==t.statusCode)return s(new Ut("License server responded with error",r,t.statusCode,!1,At.LicenseServerError));if(!t.license||!t.license.byteLength)return s(new Ut("License server responded with invalid license",r,t.statusCode,!1,At.LicenseServerError));if(t.renewalDate){let i=t.renewalDate,s=new Date,r=i>s?i.getTime()-s.getTime():0;r>0&&(clearTimeout(e.renewalTimer),e.renewalTimer=setTimeout(this._startKeyRenewal.bind(this,e),r))}this.setPromise(e,Pt.PROCESS_LICENSE,{resolve:i,reject:s}),e.session.update(t.license).then(function(){this.resolvePromise(e,Pt.PROCESS_LICENSE,{},new Ut("Wrong key status",r,0,!0,At.InvalidState))}.bind(this)).catch(t=>{this.logger.error(`${this.systemString} FAIL: Failed to update with key response message=${t.message}`)(),e.promise.reject(new $t(t.message,e.decryptdata.uri,0,this.systemString)),e.promise=void 0})});this.logger.warn("In the middle of destroying, ignore key message")()}handleKeyMessage(e){if(this.isDestroying)return void this.logger.warn("In the middle of destroying, ignore key message")();var t=new DOMParser;let i="utf16"===this.hls.config.playReadyMessageFormat?new Uint16Array(e.message.buffer||e.message):new Uint8Array(e.message.buffer||e.message),s=String.fromCharCode.apply(null,i),r=t.parseFromString(s,"application/xml").getElementsByTagName("PlayReadyKeyMessage")[0];if(!r||"LicenseAcquisition"!==r.getAttribute("type"))return void this.logger.warn(this.systemString+" unrecognized message ignore it")();let n=t.parseFromString(s,"application/xml").getElementsByTagName("Challenge")[0];if(!n||"base64encoded"!==n.getAttribute("encoding")||0===n.childNodes.length)return void this.logger.error(this.systemString+" wrong challenge format or empty challenge")();let a=v.a.base64Decode(n.childNodes[0].nodeValue),o=m.b.utf8arrayToStr(a),l=t.parseFromString(o,"application/xml").getElementsByTagName("KID")[0];var h;h=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");let d=v.a.base64Decode(h).subarray(0,16);S(d);let c=this.keyIdToKeyInfo[m.b.utf8arrayToStr(d)],u=c.decryptdata.uri;c.licenseChallenge=a,this.resolvePromise(c,Pt.GET_CHALLENGE,a,new Ut("Unexpected challenge",u,0,!0,At.InvalidState))}}var li=oi;const hi={initDataTypes:["cenc","keyids"],distinctiveIdentifier:"optional",persistentState:"required"},di=new Uint8Array([237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237]),ci={clearkey:{id:"clearkey",systemStringPrefix:"org.w3.clearkey",keyFormatString:"org.w3.clearkey",securityLevels:{NONE:0}},fairplaystreaming:ue,playready:I,widevine:D},ui={clearkey:[["org.w3.clearkey",class extends Gt{constructor(e,t,i,s){super(e,t,i,s),this.abort$=new it}static get requestAccessConfig(){return Ht}get needsCert(){return!1}getKeyRequestInfo(e){return new Promise(function(t,i){let s=e.decryptdata,r=s.uri;this.setPromise(e,Pt.GET_REQUEST_INFO,{resolve:t,reject:i}),this.hls.trigger(n.b.KEY_REQUEST_STARTED,{keyuri:r,decryptdata:s,timestamp:Date.now()})}.bind(this))}setKeyRequestInfo(e,t){let i=this.keyUriToKeyInfo[e];i&&this.resolvePromise(i,Pt.GET_REQUEST_INFO,t,new Ut("Unexpected requestInfo",e,0,!0,At.InvalidState))}getKeyRequestResponse(e,t){let i=e.decryptdata.uri;return this.keyLoader.fetchKeyHTTP(i,e.decryptdata,this.hls.config.keyLoadingDefaultTimeout).pipe(gt(e=>({response:this.parseResponse(t,e.decryptdata.key),statusCode:0,license:void 0,renewalDate:void 0})),Xe(this.abort$)).toPromise()}parseResponse(e,t){var i={kty:"oct",kid:e,k:v.a.base64UrlEncode(t)};return m.b.strToUtf8array(JSON.stringify({keys:[i]}))}handleParsedKeyResponse(e,t){if(!this.isDestroying)return new Promise((i,s)=>{let r=t.response;this.setPromise(e,Pt.PROCESS_LICENSE,{resolve:i,reject:s}),e.session.update(r).then(()=>{this.resolvePromise(e,Pt.PROCESS_LICENSE,{},new Ut("Wrong key status",e.decryptdata.uri,0,!0,At.InvalidState))}).catch(t=>{this.logger.error(`${this.systemString} FAIL: Failed to update with key response message=${t.message}`)(),e.promise.reject(new $t(t.message,e.decryptdata.uri,t.code,this.systemString)),e.promise=void 0})});this.logger.warn("In the middle of destroying, ignore key message")()}generateInitData(e){return{initData:w([e]),initDataType:"keyids"}}_abortKeyRequest(e){this.abort$.next(),super._abortKeyRequest(e)}sanitizeRequest(e){return e}handleKeyMessage(e){if(this.isDestroying)return void this.logger.warn("In the middle of destroying, ignore key message")();if("license-request"!==e.messageType)return;let t=new Uint8Array(e.message),i=JSON.parse(m.b.utf8arrayToStr(t).trim());if(1!==i.kids.length)return;let s=v.a.base64Decode(i.kids[0]),r=this.keyIdToKeyInfo[m.b.utf8arrayToStr(s)];if(r){let e=r.decryptdata.uri;this.resolvePromise(r,Pt.GET_CHALLENGE,i.kids[0],new Ut("Unexpected challenge",e,0,!0,At.InvalidState))}}}]],fairplaystreaming:[["com.apple.fps.3_0",class extends qt{constructor(e,t,i,s){super(e,t,i,s,!1),this.sessions=[],this.keyIdToKeyInfo={},this.keyUriToKeyInfo={},this.sessionIdToKeyUri={}}static get needsCert(){return!0}startKeyRequest(e){let t=e.uri;return this.keyUriToKeyInfo[t]||(this.keyUriToKeyInfo[t]={decryptdata:e,session:null,aborted:!1,licenseChallenge:null}),super.startKeyRequest(e)}handleKeyExchangeError(e){this.removeKey(e.decryptdata)}makeFpsKeySystemInitData(e,t,i){return function(e,t,i){let s=[si.fpsd,function(e,t){let i=new Uint8Array(4);return zt.a.set32(e,i,0),zt.a.box(si.fpsi,new Uint8Array([0,t>>16&255,t>>8&255,255&t]),i)}(e,t)];for(let n of i)s.push(ri(n.keyId,n.assetId,n.ssc,n.versionList));let r=zt.a.box.apply(null,s);return zt.a.pssh(qt.systemId,null,r)}(e,t,i)}makeKeyRequestMessage(e,t){if(t)return m.b.strToUtf8array("renew")}makeProcessLicenseRequestMessage(e,t,i){let s=JSON.stringify([{keyID:v.a.base64Encode(e.decryptdata.keyId),payload:v.a.base64Encode(t.ckc)}]);return m.b.strToUtf8array(s)}handleKeyMessage(e){let t,i=e.target,s=i.sessionId,r=e.messageType,n=this.sessionIdToKeyUri[s];if(n)t=this.keyUriToKeyInfo[n];else for(let a of Object.values(this.keyUriToKeyInfo))a&&a.session===i&&(t=a);if(t)switch(r){case"license-request":{let i=new Uint8Array(e.message),s=m.b.utf8arrayToStr(i);try{JSON.parse(s).forEach(e=>{let t,i=v.a.base64DecodeToStr(e.keyID),s=v.a.base64Decode(e.payload);t=this.keyIdToKeyInfo[i],this.resolveSPCPromise(t,s)})}catch(e){this.logger.warn("[Keys] got unexpected license-request format")(),this.resolveSPCPromise(t,i)}break}case"license-renewal":{let i=new Uint8Array(e.message);this.resolveSPCPromise(t,i);break}case"license-release":this._handleLicenseRelease(i);break;default:this.logger.error("[Keys] Unexpected messageType "+r)()}else this.logger.warn("[Keys] No key associated with session")()}_handleLicenseRelease(e){e.update(m.b.strToUtf8array("acknowledged"))}}],["com.apple.fps",ii]],playready:[["com.microsoft.playready.recommendation",li]],widevine:[["com.widevine.alpha",class extends Gt{constructor(e,t,i,s){super(e,t,i,s),this.hls=e,this.shouldDestroyMediaKeys=!0}static get systemId(){return di}static get requestAccessConfig(){return hi}get needsCert(){return!0}getKeyRequestResponse(e,t){return new Promise(function(i,s){let r=e.decryptdata.uri;this.setPromise(e,Pt.GET_KEY_RESPONSE,{resolve:i,reject:s}),this.hls.trigger(n.b.LICENSE_CHALLENGE_CREATED,{keyuri:r,licenseChallenge:t,keysystem:this.systemString,keyId:e.decryptdata.keyId})}.bind(this))}handleParsedKeyResponse(e,t){if(!this.isDestroying)return new Promise((i,s)=>{e.licenseChallenge=void 0;let r=e.decryptdata.uri;return 0!==t.statusCode?s(new Ut("License server responded with error",r,t.statusCode,!1,At.LicenseServerError)):t.license&&t.license.byteLength?(this.setPromise(e,Pt.PROCESS_LICENSE,{resolve:i,reject:s}),void e.session.update(t.license).then(function(){let t=e.decryptdata.keyId;"usable"===e.session.keyStatuses.get(t)&&this.resolvePromise(e,Pt.PROCESS_LICENSE,{},new Ut("Wrong key status",r,0,!0,At.InvalidState))}.bind(this)).catch(function(t){this.logger.error(`${this.systemString} FAIL: Failed to update with key response code=${t.code} message=${t.message}`)(),e.promise.reject(new $t(t.message,e.decryptdata.uri,t.code,this.systemString)),e.promise=void 0}.bind(this))):s(new Ut("License server responded with invalid license",r,t.statusCode,!1,At.LicenseServerError))});this.logger.warn("In the middle of destroying, ignore key message")()}generateInitData(e,t){return{initData:t.pssh,initDataType:"cenc"}}generateRequestInitialized(e){let t=e.decryptdata.uri,i=e.licenseChallenge;e.requestInfo=void 0,this.resolvePromise(e,Pt.GET_CHALLENGE,i,new Ut("Unexpected challenge",t,0,!0,At.InvalidState))}handleKeyMessage(e){if(this.isDestroying)return void this.logger.warn("In the middle of destroying, ignore key message")();let t=e.target,i=null,s=null;if(t.sessionId in this.sessionIdToKeyUri)switch(i=this.sessionIdToKeyUri[t.sessionId],s=this.keyUriToKeyInfo[i],e.messageType){case"license-request":{let t=new Uint8Array(e.message);s.licenseChallenge=t,this.resolvePromise(s,Pt.GET_CHALLENGE,t,new Ut("Unexpected challenge",i,0,!0,At.InvalidState));break}case"license-renewal":{let t=new Uint8Array(e.message);s.licenseChallenge=t,this.keyLoader.getKeyFromDecryptData(s.decryptdata,void 0,!0).pipe(Xe(this.destroy$)).subscribe();break}}else this.logger.error(this.systemString+" empty keyuri and keyInfo")()}}]]},fi=ue.id;var pi,gi,mi,yi=(()=>{class e{static createMediaKeys(t,i,s,r,n){let a=e.idToMediaKeysInfoMap[t];if(!a){let o;f.b.info(`[Keys] ${t} requesting key system access`)();let l=T(i,s,n);o=e.requestKeySystemAccess(t,l,r).then((function(i){return e.idToMediaKeysInfoMap[t].keySystemAccess=i,f.b.info(`[Keys] ${t} creating CDM`)(),i.createMediaKeys()})).then((function(e){return f.b.info(`[Keys] ${t} created CDM`)(),e})).catch((function(e){throw f.b.error(`[Keys] FAIL: could not initialize ${t} key system: ${e.message}`)(),new $t("could not initialize key system: "+e.message,void 0,0,t)})),a=e.idToMediaKeysInfoMap[t]={promise:o,keySystemAccess:null}}return a.promise}static destroyMediaKeys(){e.idToMediaKeysInfoMap={}}static getKeySystemIdForDecryptData(e){let t;if(e){t=fi;let i=e.format;for(let e in ci)if(ci[e].keyFormatString===i){t=e;break}}if(!t)throw Error("No matching key system");return t}static requestKeySystemAccess(t,i,s){if("undefined"==typeof navigator||void 0===navigator.requestMediaKeySystemAccess)return Promise.reject(new $t("navigator undefined",void 0,0,t));let r=ui[t],n=Promise.reject(new $t("no key systems to try",void 0,0,t));for(let a of r){let t=a[0],r=a[1],o=void 0===s||0===s.length?r.requestAccessConfig:s,l=[Object.assign({},o,i)];n=n.catch(e.requestKeySystemInternal.bind(null,t,l))}return n}static requestKeySystemInternal(e,t){return navigator.requestMediaKeySystemAccess(e,t)}static make(t,i,s,r){let n,a=e.idToMediaKeysInfoMap[t].keySystemAccess;if(!a)throw new $t("No keySystemAccess for "+t,void 0,0,t);let o=ci[t].systemStringPrefix;for(let e of ui[t])if(e[0]===a.keySystem){n=e[1];break}if(!n)throw new $t("No constructor associated with "+t,void 0,0,o);return new n(i,s,r,o)}static get availableKeySystems(){return Object.keys(ci)}static getKeySystemFormat(e){let t=ci[e];return t?t.keyFormatString:""}static getKeySystemSecurityLevel(e){let t=ci[e];return t?t.securityLevels:void 0}}return e.idToMediaKeysInfoMap={},e})();function vi(e){return void 0!==e&&Object.values(mi).includes(e)}!function(e){e.UNKNOWN="unkn",e.VIDEO="vide",e.AUDIO="soun",e.SUBTITLE="sbtl",e.CLOSEDCAPTION="clcp"}(pi||(pi={})),function(e){e[e.NO=0]="NO",e[e.YES=1]="YES"}(gi||(gi={})),function(e){e.None="NONE",e.Type0="TYPE-0",e.Type1="TYPE-1",e.Type2="TYPE-2"}(mi||(mi={}));const _i=/^(\d+)x(\d+)$/,bi=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Ti={NAME:"",TYPE:"",DEFAULT:"",AUTOSELECT:"",FORCED:"",LANGUAGE:"",URI:"",AUDIO:"","VIDEO-RANGE":"","CLOSED-CAPTIONS":"",CODECS:"",BYTERANGE:"","INSTREAM-ID":"","GROUP-ID":"",CHANNELS:"",CHARACTERISTICS:"",KEYFORMAT:"",KEYFORMATVERSIONS:"","DATA-ID":"",VALUE:"",METHOD:"","HDCP-LEVEL":"","ALLOWED-CPC":""},Si={BANDWIDTH:NaN,"AVERAGE-BANDWIDTH":NaN},Ei={"TIME-OFFSET":NaN,"FRAME-RATE":NaN},wi={IV:null},Ii={RESOLUTION:null};class Di{constructor(e){this.validTags=e}isKey(e){return e in this.validTags}trySetValue(e,t,i){return!!this.isKey(e)&&(i[e]=this.parseFunc(t),!0)}}let Li=(()=>{class e{static parseTags(t){let i,s={};if(!t)return s;for(bi.lastIndex=0;null!==(i=bi.exec(t));){const t=i[1].toUpperCase(),r='"';let n=i[2];0===n.indexOf(r)&&n.lastIndexOf(r)===n.length-1&&(n=n.slice(1,-1));for(let i of e.tagParsers)if(i.trySetValue(t,n,s))break}return s}}return e.tagParsers=[new class extends Di{parseFunc(e){return e}}(Ti),new class extends Di{parseFunc(e){let t=parseInt(e);return t>Number.MAX_SAFE_INTEGER?1/0:t}}(Si),new class extends Di{constructor(){super(...arguments),this.parseFunc=parseFloat}}(Ei),new class extends Di{parseFunc(e){let t=(e||"0x").slice(2);t=(1&t.length?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++){let e=parseInt(t.slice(2*s,2*s+2),16);if(isNaN(e))return;i[s]=e}return i}}(wi),new class extends Di{parseFunc(e){const t=_i.exec(e);let i;return null!==t&&(i={width:parseInt(t[1],10),height:parseInt(t[2],10)}),i}}(Ii)],e})();var ki,Ri,Ci,Ai,Pi,xi,Mi,Oi=i(3);!function(e){e[e.SDR=0]="SDR",e[e.HDR=1]="HDR",e[e.HDR10=2]="HDR10",e[e.DolbyVision=3]="DolbyVision",e[e.HLG=4]="HLG"}(ki||(ki={})),function(e){e[e.H264=16]="H264",e[e.HEVC=64]="HEVC"}(Ri||(Ri={})),function(e){e[e.DOVI=4]="DOVI",e[e.HEVC=3]="HEVC",e[e.VP09=2]="VP09",e[e.AVC=1]="AVC",e[e.UNKNOWN=0]="UNKNOWN"}(Ci||(Ci={})),function(e){e[e.PQ=3]="PQ",e[e.HLG=2]="HLG",e[e.SDR=1]="SDR",e[e.UNKNOWN=0]="UNKNOWN"}(Ai||(Ai={})),function(e){e[e.EC3=4]="EC3",e[e.AC3=3]="AC3",e[e.AAC=2]="AAC",e[e.MP3=1]="MP3",e[e.UNKNOWN=0]="UNKNOWN"}(Pi||(Pi={})),function(e){e[e.VALID=1]="VALID",e[e.INVALID=0]="INVALID"}(xi||(xi={}));class Ni{constructor(...e){this.identifier=e}ensureSameIdentifierLength(e){if(this.identifier.length!==e.identifier.length)throw new Error(`Identifiers have non-matching lengths! (${this.identifier.length} vs ${e.identifier.length})`)}isGreaterThan(e){this.ensureSameIdentifierLength(e);for(let t=0;t<this.identifier.length;++t){if(this.identifier[t]<e.identifier[t])return!1;if(this.identifier[t]>e.identifier[t])return!0}return!1}isEqualTo(e){return this.ensureSameIdentifierLength(e),this.identifier.every((t,i)=>t===e.identifier[i])}}function Fi(e,t,i){let s,r=t.length,n=i.length;if(r!==n){let e=t.filter(e=>!i.includes(e));s=`playlist has ${n} levels left, removed persistentIds:${JSON.stringify(e.map(e=>e.persistentId))}`}else s="no levels were removed";f.b.info(`Applied ${e} Filtering, ${s}`)()}function Bi(e){return Oi.b.isDolby(e)?Ci.DOVI:Oi.b.isHEVC(e)?Ci.HEVC:Oi.b.isVP09(e)?Ci.VP09:Oi.b.isAVC(e)?Ci.AVC:Ci.UNKNOWN}function Ui(e){return Oi.b.isEC3(e)?Pi.EC3:Oi.b.isAC3(e)?Pi.AC3:Oi.b.isAAC(e)?Pi.AAC:Oi.b.isMP3(e)?Pi.MP3:Pi.UNKNOWN}function Vi(e,t,i){const{targetDuration:s,targetStartupMs:r}=i;return e.bandwidth<=t.avgBandwidth&&(e.avgBandwidth||e.bandwidth)*s/t.avgBandwidth*1e3+t.avgLatencyMs<=r}function $i(e,t,i,s){const r=function(e,t,i){const s=(e,t,i)=>(e-t)*(e-i)<=0;return s(e,i.minValidBitrate,i.maxValidBitrate)&&s(t,i.minValidHeight,i.maxValidHeight)}(e.bitrate,e.height,t)?xi.VALID:xi.INVALID,n="PQ"===(a=e.videoRange)?Ai.PQ:"HLG"===a?Ai.HLG:"SDR"===a?Ai.SDR:Ai.UNKNOWN;var a;const{videoCodecRank:o,audioCodecRank:l}=function(e){return{videoCodecRank:Bi(e.videoCodec),audioCodecRank:Ui(e.audioCodec)}}(e),h=e.bitrate<=t.maxPreferredBitrate?xi.VALID:xi.INVALID,d=e.audioChannelCount||1,c=i&&s&&!Vi(e,i,s)?xi.INVALID:xi.VALID;return new Ni(r,n,o,d,l,c,h,e.height)}function Gi(e){if(!e||!e.length)return;const t=e.sort((e,t)=>Bi(t)-Bi(e));return t&&t.length?t[0]:void 0}function Hi(e){if(!e||!e.length)return;const t=e.sort((e,t)=>Ui(t)-Ui(e));return t&&t.length?t[0]:void 0}function Ki(e,t){if(!e||!t||!t.length)return;let i=void 0;const s=t.filter(t=>t.groupId===e);if(s&&s.length){const e=s.sort((e,t)=>Oi.b.getChannelCount(t.channels)-Oi.b.getChannelCount(e.channels));e&&e.length&&(i=e[0].channels)}return i}function ji(e,t,i){var s=function(i,s){return function(i,s){let r=s?"audio":"video";e.has(i)||t.has(i)||(function(e,t){let i=MediaSource.isTypeSupported(`${e}/mp4;codecs=${t}`);return"mp4a.40.34"!==t||i||(i=MediaSource.isTypeSupported(e+"/mpeg")),i}(r,i)?e.add(i):t.add(i))}(i,s),t.has(i)};let r=!1;return i.audioCodecList&&(r=i.audioCodecList.some(e=>s(e,!0))),!r&&i.videoCodecList&&(r=i.videoCodecList.some(e=>s(e,!1))),!r}function Wi(e,t){let i=yi.getKeySystemSecurityLevel(t);return void 0!==e&&void 0!==i&&void 0!==i[e]}function qi(e,t){for(let i in e)if(e[i].type===t)return e[i];return{}}function zi(e,t){return isNaN(e)||isNaN(t)||e<=t}function Yi(e){return e.every(e=>e.iframes)}function Xi(e,t,i,s){let r=i?i.maxHdcpLevel:void 0,n=Array.from(e);r&&vi(r)&&(n=function(e,t){let i=function(e){switch(e){case mi.None:return 0;case mi.Type0:return 1;case mi.Type1:return 2;case mi.Type2:return 3;default:return 4}},s=i(r),n=e.filter((function(e){let t=e.hdcpLevel;return!t||i(t)<=s}));return Fi("HDCP",e,n),n}(n));let o=i?i.maxSecurityLevel:void 0,l=s?s.keySystemPreference:void 0;o&&l&&Wi(o,l)&&(n=function(e,t,i){let s=yi.getKeySystemSecurityLevel(i),r=yi.getKeySystemFormat(i),n=function(e){return Wi(e,i)?s[e]:-1},a=n(t),o=e.filter(e=>{let t=e.allowedCPCMap&&e.allowedCPCMap.has(r)?e.allowedCPCMap.get(r):[],i=!0;for(let s of t)if(!(i=n(s)<=a))break;return i});return Fi("Security Level",e,o),o}(n,o,l)),n.forEach(e=>{if(e.audioCodecList&&e.audioGroupId){let i=t.find(t=>t.groupId===e.audioGroupId),s=i?i.channels:void 0;s&&(e.audioChannelCount=parseInt(s))}});let h,d=!!s&&s.useMediaKeySystemAccessFilter&&l&&navigator&&"function"==typeof navigator.requestMediaKeySystemAccess,c=i?i.robustnessLevel:void 0;return(h=d?function(e,t,i){let s=new Array,r=new Map;return e.forEach(e=>{let n=Array();!function(e,t,s){let n,a=T(t.videoCodecList,t.audioCodecList,i),o=JSON.stringify(a);r.has(o)?n=r.get(o):(n=yi.requestKeySystemAccess(e,a,[]).then(e=>!0).catch(e=>(f.b.warn("Request key system error: "+e.message)(),!1)),r.set(o,n)),s.push(n)}(t,e,n);let a=Promise.all(n).then(t=>{if(void 0===t.find(e=>!1===e))return e});s.push(a)}),Promise.all(s).then(e=>e.filter(e=>Boolean(e)))}(n,l,c):Promise.resolve(n)).then(e=>{if(0===e.length||Yi(e))throw new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_INCOMPATIBLE_CODECS_ERROR,void 0,"no level with compatible codecs found in manifest",void 0);d&&Fi("Key System Support",n,e);let r,o=navigator&&navigator.mediaCapabilities,l=!!s&&s.useMediaCapabilities&&o&&"function"==typeof o.decodingInfo;return l?r=function(e,t){let i=navigator&&navigator.mediaCapabilities,s=new Array,r=new Set,n=new Set,a=new Map;function o(e,t,s,r,n){let o={type:"media-source"};r?o.video=function(e,t){let i={contentType:"video/mp4;codecs="+e,width:t.width,height:t.height,bitrate:t.avgBandwidth,framerate:t.iframes?8:t.frameRate};if(t.videoRange)switch(t.videoRange){case"PQ":Oi.b.isDolby(e)?(i.hdrMetadataType=Mi.DoVi,i.colorGamut="rec2020"):(Oi.b.isHEVC(e)||Oi.b.isVP09(e))&&(i.hdrMetadataType=Mi.HDR10,i.colorGamut="rec2020"),i.transferFunction="pq";break;case"HLG":i.colorGamut="rec2020",i.transferFunction="hlg"}return i}(s,e):o.audio=function(e,t,i){let s={contentType:"audio/mp4;codecs="+e},r=Ki(t.audioGroupId,i);if(r){let e=r.split("/"),t=e[0];s.channels=t,e.find(e=>"JOC"===e)&&(s.spatialRendering=!0)}return s}(s,e,t);let l,h=JSON.stringify(o);if(a.has(h))l=a.get(h);else{try{l=i.decodingInfo(o).then(e=>{let t=e.configuration||e.supportedConfiguration,i=t instanceof Object&&(!o.video||void 0===Object.keys(o.video).find(e=>!(e in t.video)))&&(!o.audio||void 0===Object.keys(o.audio).find(e=>!(e in t.audio))),s=e.supported&&(!r||e.powerEfficient)&&i;return s||f.b.warn(`Unsupported config ${e.supported}/${e.powerEfficient}/${i} ${JSON.stringify(o)} supportedConfig=${JSON.stringify(t)}`)(),s})}catch(e){l=Promise.reject(e)}a.set(h,l)}n.push(l)}function l(e){f.b.info("Unsupported level "+JSON.stringify(e,["avgBandwidth","audioCodecList","videoCodecList","videoRange","frameRate","width","height","iframes"]))()}for(let h of e){let e=Array();if(h.videoCodecList)for(let s of h.videoCodecList)o(h,t,s,!0,e);if(h.audioCodecList&&h.audioCodecList.length>0){const i=Hi(h.audioCodecList);o(h,t,i,!1,e)}let i=Promise.all(e).then(e=>{if(void 0===e.find(e=>!1===e))return h;l(h)}).catch(e=>{if(f.b.warn("decodingInfo error: "+e.message)(),ji(r,n,h))return h;l(h)});s.push(i)}return Promise.all(s).then(e=>e.filter(e=>Boolean(e)))}(e,t):(e=function(e,t){let i=new Set,s=new Set,r=!MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"; channels="-1"'),n=r&&!MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"; channels="2"; features="INVALID"');f.b.info(`Platform support for channels: ${r}; features: ${n}`)();let a=e.filter((function(e){let a=!1;if(e.audioCodecList&&e.audioGroupId){const o=Ki(e.audioGroupId,t);o&&(a=function(e,t){let a=Oi.b.isDolbyAtmos(e,t);if(n||r&&!a){!function(e,t){let r=e+"/"+t;i.has(r)||s.has(r)||(function(e,t){let i,s,r=t.split("/"),n=parseInt(r[0]);r.length>1?(i=`audio/mp4;codecs="${e}";channels="${n}";features="${r[1]}"`,s=`audio/mp4;codecs="${e}";channels="8";features="${r[1]}"`):i=`audio/mp4;codecs="${e}";channels="${n}"`;let a=MediaSource.isTypeSupported(i);return!a&&s&&(a=MediaSource.isTypeSupported(s),f.b.info(`Using mimeCodecAlternate, isSupported: ${a}; mimeCodecAlternate: ${s}`)()),a}(e,t)?i.add(r):s.add(r))}(e,t);let r=e+"/"+t;return s.has(r)}return!!a}(Hi(e.audioCodecList),o))}return!a}));return Fi("Richest Audio Codec Selection",e,a),a}(e=function(e){let t=new Set,i=new Set,s=e.filter(ji.bind(null,t,i));return Fi("Platform Supported Media Codec",e,s),s}(e),t),r=Promise.resolve(e)),r.then(e=>{if(0===e.length||Yi(e))throw new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_INCOMPATIBLE_CODECS_ERROR,void 0,"no level with compatible codecs found in manifest",void 0);if(0===(e=function(e){const t=e.filter(e=>!e.iframes||!e.width||!e.height||e.width*e.height<=2488320);return Fi("1080p iFrame",e,t),t}(e=function(e,t){let i=e.filter(e=>{const{highestPlayablePeakBitRate:i,highestPlayableAverageBitRate:s,highestPlayableWidth:r,highestPlayableHeight:n,highestPlayableFrameRate:a}=function(e,t){if(!t)return{highestPlayableAverageBitRate:void 0,highestPlayablePeakBitRate:void 0,highestPlayableWidth:void 0,highestPlayableHeight:void 0,highestPlayableFrameRate:void 0};let i=e.videoCodec,s=e.videoRange,r=t.videoDynamicRangeFormats,n=t.videoCodecs;return function(e,t,i,s){if(!s&&!i)return{};let r,n,a=i?qi(i,t):{},o=s?qi(s,e):{};switch(e){case ki.SDR:r=a,n=o;break;default:r=o,n=a}let l=Object.assign({},r);return l.highestPlayableAverageBitRate||l.highestPlayablePeakBitRate||(l.highestPlayableAverageBitRate=n.highestPlayableAverageBitRate,l.highestPlayablePeakBitRate=n.highestPlayablePeakBitRate),l.highestPlayableWidth||l.highestPlayableHeight||l.highestPlayableFrameRate||(l.highestPlayableWidth=n.highestPlayableWidth,l.highestPlayableHeight=n.highestPlayableHeight,l.highestPlayableFrameRate=n.highestPlayableFrameRate),l}(function(e,t){let i=ki.SDR;return"PQ"===e&&Oi.b.isDolby(t)?i=ki.DolbyVision:"PQ"===e&&Oi.b.isHEVC(t)?i=ki.HDR10:"HLG"===e&&-1!==t.indexOf("hvc1")&&(i=ki.HLG),i}(s,i),function(e){let t=Ri.H264;return(Oi.b.isHEVC(e)||Oi.b.isDolby(e))&&(t=Ri.HEVC),t}(i),n,r)}(e,t);return zi(e.bandwidth,i)&&zi(e.avgBandwidth,s)&&zi(e.width,r)&&zi(e.height,n)&&zi(e.frameRate,a)});return Fi("Highest Playable Platform Caps",e,i),i}(e,i))).length||Yi(e))throw new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_INCOMPATIBLE_CODECS_ERROR,void 0,"no level with compatible codecs found in manifest",void 0);let t=i?i.videoDynamicRangeFormats:void 0;l&&!t&&(t=[{type:ki.SDR},{type:ki.HDR},{type:ki.HDR10},{type:ki.DolbyVision},{type:ki.HLG}]);let{hdrLevels:s,sdrLevels:r}=function(e,t){let i=new Array,s=new Array,r=function(e){let t=!1,i=!1,s=!1;if(e&&e.length>0)for(let r=0;r<e.length;++r)switch(e[r].type){case ki.DolbyVision:t=!0;break;case ki.HDR10:i=!0;break;case ki.HLG:s=!0}return{doViSupported:t,hdr10Supported:i,hlgSupported:s}}(t),{doViSupported:n,hdr10Supported:a,hlgSupported:o}=r;return f.b.info(`Supported videoDynamicRangeFormats DoVi/HDR10/HLG: ${n}/${a}/${o}`)(),e.forEach(e=>{let t=e.videoRange,r=e.videoCodec;switch(t){case"PQ":r&&(n&&Oi.b.isDolby(r)||a&&Oi.b.isHEVC(r))&&i.push(e);break;case"HLG":r&&o&&-1!==r.indexOf("hvc1")&&i.push(e);break;default:s.push(e)}}),{hdrLevels:i,sdrLevels:s}}(e,t);if(0===s.length&&0===r.length||Yi(s)&&Yi(r))throw new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_INCOMPATIBLE_VIDEO_RANGE_ERROR,void 0,"level with compatible VIDEO-RANGE not found in manifest",void 0);return{hdrLevels:s,sdrLevels:r}})}).catch(e=>{throw e instanceof a.q&&(e.fatal=!0,e.response=a.f.IncompatibleAsset),e})}!function(e){e.HDR10="smpteSt2086",e.DoVi="smpteSt2094-10",e.HDR10Plus="smpteSt2094-40"}(Mi||(Mi={}));const Qi=/{\$(.*?)}/g,Ji=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#EXT-X-BITRATE:(.+)|#.*/g,Zi=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:#EXT-X-(I-FRAMES)-ONLY)|(?:#EXT-X-(DEFINE):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,es=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-I-FRAME-STREAM-INF:([^\r\n]+)|#EXT-X-DEFINE:([^\n\r]*)/g,ts=/#EXT-X-MEDIA:(.*)/g,is=/#EXT-X-SESSION-DATA[^:]*:(.*)/g,ss=/(NAME|VALUE)=\"(.*)\",(NAME|VALUE)=\"(.*)\"|(IMPORT)=\"(.*)\"/;let rs=function(e,t,i){return c.buildAbsoluteURL(t,e,{alwaysNormalize:!0,inheritQuery:i})},ns=function(e){return e?e.split(/\s*,\s*/):new Array},as=function(e,t,i){if(void 0===e)return-1;let s=e.MediaSelectionGroupOptions,r=s.find((function(e){return e.MediaSelectionOptionsMediaType===t.mediaType&&e.MediaSelectionOptionsName===t.name&&e.MediaSelectionOptionsExtendedLanguageTag===t.lang}));return r||(r={MediaSelectionOptionsMediaType:t.mediaType,MediaSelectionOptionsExtendedLanguageTag:t.lang,MediaSelectionOptionsIsDefault:t.default,MediaSelectionOptionsName:t.name,MediaSelectionOptionsPersistentID:i,MediaSelectionOptionsTaggedMediaCharacteristics:t.characteristics},t.mediaType===pi.SUBTITLE&&(r.MediaSelectionOptionsDisplaysNonForcedSubtitles=t.forced?gi.NO:gi.YES),i++,s.push(r)),t.persistentID=r.MediaSelectionOptionsPersistentID,i},os=function(e){let t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},ls=function(e){let t;try{t=JSON.parse(v.a.base64DecodeToStr(e))}catch(i){f.b.error(`Error ${i} decoding metadata value: '${e}'`)(),t=e}return t},hs=function(e,t){let i,s=!1;return e&&t&&(i=e.replace(Qi,(function(e){Qi.lastIndex=0;let i=Qi.exec(e)[1];if(i&&t.hasOwnProperty(i))return t[i];s=!0}))),{updatedString:i,error:s}};const ds=e=>"DATA-ID"in e;class cs{constructor(e,t,i){this.config=e,this.registerProgramDateTime=i,this._masterVariableList={},this.itemId=t}destroy(){this._masterVariableList={}}get query(){return this.inheritQuery}set query(e){this.inheritQuery=e}static isValidPlaylist(e){return 0===e.indexOf("#EXTM3U")}static isMediaPlaylist(e){return e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-PLAYLIST-TYPE:")>0}_shouldSelectKeyTag(e,t){return"AES-128"===t||"NONE"===t||void 0===this.config||void 0===this.config.keySystemPreference||e===yi.getKeySystemFormat(this.config.keySystemPreference)}_addDefaultClosedCaptionOption(e,t,i){let s={id:0,mediaType:pi.CLOSEDCAPTION,inStreamID:"CC1",groupId:"cc",name:"English-CC",type:"CLOSED-CAPTIONS",default:!1,autoselect:!1,forced:!1,lang:"en",characteristics:["public.accessibility.transcribes-spoken-dialog","public.accessibility.describes-music-and-sound"],persistentID:i,unchangedLevelCount:0};e.push(s),as(t,s,i)}optOutClosedCaption(e){let t=!1,i=!1;if(e)for(let s=0;s<e.length;++s){let r=e[s];if(r.videoCodec&&(i=!0,!0!==r.iframes&&r.closedcaption&&"none"===r.closedcaption.toLowerCase())){t=!0;break}}return!i||t}parseMasterPlaylistMedia(e,t,i){let s,r,n={MediaSelectionGroupAllowEmptySelection:1,MediaSelectionGroupMediaCharacteristics:["public.audible"],MediaSelectionGroupMediaType:pi.AUDIO,MediaSelectionGroupOptions:[]},o={MediaSelectionGroupAllowEmptySelection:1,MediaSelectionGroupMediaCharacteristics:["public.legible"],MediaSelectionGroupMediaType:pi.SUBTITLE,MediaSelectionGroupOptions:[]},l={videoTracks:[],audioTracks:[],subtitleTracks:[],audioMediaSelectionGroup:n,subtitleMediaSelectionGroup:o},h=0;for(ts.lastIndex=0;null!=(s=ts.exec(e));){let e=hs(s[1],this._masterVariableList);if(e.error){r=new a.q(a.g.MEDIA_ERROR,a.d.LEVEL_LOAD_ERROR,!0,"encountered undefined/not imported EXT-X-DEFINE property",a.f.FormatError);break}let d,c,u,f,p=Li.parseTags(e.updatedString),g=pi.UNKNOWN,m=ns(p.CHARACTERISTICS),y=p["GROUP-ID"],v=p.CHANNELS;switch(p.TYPE){case"VIDEO":g=pi.VIDEO,c=l.videoTracks;break;case"AUDIO":g=pi.AUDIO,c=l.audioTracks,u=n;let e=i.find((function(e){return e.audioGroupId===y}));f=e?e.audioCodecList:[];break;case"SUBTITLES":g=pi.SUBTITLE,c=l.subtitleTracks,u=o;break;case"CLOSED-CAPTIONS":g=pi.CLOSEDCAPTION,d=p["INSTREAM-ID"],c=l.subtitleTracks,u=o}let _={mediaType:g,groupId:y,channels:v,groupCodecList:f,name:p.NAME,type:p.TYPE,default:"YES"===p.DEFAULT,autoselect:"YES"===p.AUTOSELECT,forced:"YES"===p.FORCED,characteristics:m,persistentID:h,id:c?c.length:0,lang:x.shortenLanguageCode(p.LANGUAGE),unchangedLevelCount:0};p.URI&&(_.url=rs(p.URI,t,this.inheritQuery)),_.name||(_.name=_.lang,_.mediaType===pi.CLOSEDCAPTION&&(_.name+=" CC")),c&&(_.id=c.length,c.push(_)),h=as(u,_,h)}return 0!==l.subtitleTracks.length||this.optOutClosedCaption(i)||this._addDefaultClosedCaptionOption(l.subtitleTracks,o,h),{parsedMasterPlaylistMedia:l,playlistParsingError:r}}static parseSessionData(e,t){let i,s=[],r=new Set;for(is.lastIndex=0;null!=(i=is.exec(e));){let e,t=Li.parseTags(i[1]);t.LANGUAGE=x.shortenLanguageCode(t.LANGUAGE),e=t.LANGUAGE?t["DATA-ID"]+"|"+t.LANGUAGE:void 0,ds(t)?e&&r.has(e)||("com.apple.hls.other-tags"===t["DATA-ID"]&&(t.VALUE=ls(t.VALUE)),s.push(t),e&&r.add(e)):f.b.error(`Error processing DATA-ID ${t["DATA-ID"]} and LANGUAGE ${t.LANGUAGE}`)()}return{itemList:s,baseUrl:t}}parseLevelPlaylist(e,t,i,s,r){let n,o,l,h,d,u,p=0,g=0,m={type:"",version:0,url:i,initSegments:{},fragments:[],live:!0,startSN:0,endSN:0,iframesOnly:!1,targetduration:0,totalduration:0,averagetargetduration:0},y=new R("NONE",i,null,null,null),v=!1,_=!1,b=0,T=null,S=new O(this.inheritQuery),E=0,w={},I=!0,D=Object(Oi.c)(e)?e:0;Ji.lastIndex=0;let k=()=>new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"Invalid key system preference for the playlist",a.f.IncompatibleAsset);for(;null!==(n=Ji.exec(t));){const e=n[1];if(e){S.duration=parseFloat(e);const t=(" "+n[2]).slice(1);S.title=t||null,S.tagList.push(t?["INF",e,t]:["INF",e])}else if(n[3]){if(Object(Oi.c)(S.duration)){const e=p++;if(S.type=r,S.start=g+D,S.levelkey=y,_&&!v){d=k();break}if(v=!1,_=!1,S.sn=e,S.level=s,S.cc=b,S.iframe=m.iframesOnly,S.baseurl=i,(h=hs((" "+n[3]).slice(1),w)).error){d=new a.q(a.g.MEDIA_ERROR,a.d.LEVEL_LOAD_ERROR,!0,"encountered undefined/not imported EXT-X-DEFINE property",a.f.FormatError);break}if(S.relurl=h.updatedString,S.bitrate=Object(Oi.c)(S.byteRangeEndOffset)?8*(S.byteRangeEndOffset-S.byteRangeStartOffset)/S.duration:E,S.rawProgramDateTime?(this.registerProgramDateTime(S.rawProgramDateTime,S.start),l=null):l&&(S.rawProgramDateTime=l,S.tagList.push(["PROGRAM-DATE-TIME",S.rawProgramDateTime]),this.registerProgramDateTime(S.rawProgramDateTime,S.start),l=null),m.fragments.push(S),T=S,g+=S.duration,I&&!m.initSegments[b])if(m.iframesOnly&&S.byteRangeStartOffset>0){let e=new O(this.inheritQuery);if(e.url=S.url,e.rawByteRange=Math.min(S.byteRangeStartOffset,1316)+"@0",e.baseurl=i,e.level=s,e.type=r,e.sn="initSegment",e.cc=b,e.decryptdata=y,_&&!v){d=k();break}v=!1,_=!1,m.initSegments[b]=e,f.b.info("generated implicit initSegment in cc "+b)()}else if(u){let e=Object.assign(new O(this.inheritQuery),u);e.cc=b,f.b.info(`assume initSegment from ${u.cc} in cc ${b}`)(),u=m.initSegments[b]=e}I=!1,S=new O(this.inheritQuery)}}else if(n[4]){if(S.rawByteRange=(" "+n[4]).slice(1),T){const e=T.byteRangeEndOffset;e&&(S.lastByteRangeEndOffset=e)}}else if(n[5])S.rawProgramDateTime=(" "+n[5]).slice(1),S.tagList.push(["PROGRAM-DATE-TIME",S.rawProgramDateTime]);else if(n[6]){let e=parseInt(n[6]);Object(Oi.c)(e)&&(E=1e3*e)}else{for(n=n[0].match(Zi),o=1;o<n.length&&void 0===n[o];o++);let e=hs((" "+n[o+1]).slice(1),w),t=hs((" "+n[o+2]).slice(1),w);if(e.error||t.error){d=new a.q(a.g.MEDIA_ERROR,a.d.LEVEL_LOAD_ERROR,!0,"encountered undefined/not imported EXT-X-DEFINE property",a.f.FormatError);break}const h=e.updatedString,T=t.updatedString;switch(n[o]){case"#":S.tagList.push(T?[h,T]:[h]);break;case"PLAYLIST-TYPE":m.type=h.toUpperCase();break;case"MEDIA-SEQUENCE":0===m.fragments.length?p=m.startSN=parseInt(h):f.b.warn(`Ignore MEDIA-SEQUENCE:${h} tag. Must appear before first fragment.`)();break;case"TARGETDURATION":m.targetduration=parseFloat(h);break;case"VERSION":m.version=parseInt(h);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"DIS":b++,S.tagList.push(["DIS"]),I=!0;break;case"DISCONTINUITY-SEQ":b=parseInt(h);break;case"KEY":let e=h;_=!0;let t=Li.parseTags(e),o=t.METHOD in L?t.METHOD:void 0,E=t.URI,D=t.IV?t.IV:null,C=t.KEYFORMAT,A=(t.KEYFORMATVERSIONS?t.KEYFORMATVERSIONS:"1").split("/").map(Number).filter(isFinite);if(o)if(!v&&this._shouldSelectKeyTag(C,o)){let e;e=E?c.buildAbsoluteURL(i,E,{alwaysNormalize:!0}):i,"NONE"!==y.method&&(y.expiryPosition=g),y=new R(o,e,D,C,A),E&&t.IV&&!D&&((d=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"Invalid IV: "+t.IV,a.f.PlaylistErrorInvalidEntry)).url=i),v=!0}else f.b.warn(`[Keys] Not selecting EXT-X-KEY tag : ${e}, IsKeySystemSelected: ${v}`)();else f.b.warn("Invalid EXT-X-KEY tag: "+e)();break;case"START":let P=h,x=Li.parseTags(P)["TIME-OFFSET"];Object(Oi.c)(x)&&(m.startTimeOffset=x);break;case"I-FRAMES":m.iframesOnly=!0;break;case"MAP":let M=Li.parseTags(h);if(S.relurl=M.URI,S.rawByteRange=M.BYTERANGE,S.baseurl=i,S.level=s,S.type=r,S.sn="initSegment",S.levelkey=y,_&&!v){d=k();break}v=!1,_=!1,S.rawProgramDateTime&&(l=S.rawProgramDateTime),S.cc=b,u=m.initSegments[b]=S,S=new O(this.inheritQuery);break;case"DEFINE":let N=ss.exec(h),F="NAME"===N[1]?N[2]:N[4],B="VALUE"===N[1]?N[2]:N[4],U=N[5],V=N[6];if(F||B||"IMPORT"!==U||!this._masterVariableList.hasOwnProperty(V)){if(!F||U||N[1]===N[3]||w.hasOwnProperty(F)){d=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"IMPORT references variable not in master playlist and/or NAME",a.f.FormatError);break}w[F]=B}else w[V]=this._masterVariableList[V];break;default:f.b.warn("line parsed but not handled: "+n)()}}S.itemId=this.itemId}return(S=T)&&!S.relurl&&(m.fragments.pop(),g-=S.duration),m.live||(S.isLastFragment=!0),m.live||this.config.gapless?m.fragments.forEach(e=>{e.levelkey&&(e.levelkey.expiryPosition=1/0)}):"NONE"!==y.method&&(y.expiryPosition=g),m.totalduration=g,m.averagetargetduration=g/m.fragments.length,m.endSN=p-1,{levelDetails:m,playlistParsingError:d}}parseMasterPlaylist(e,t){let i,s,r,n,o=[];for(es.lastIndex=0;null!=(i=es.exec(e));)if(i[4]){let e="NAME"===(i=ss.exec(i[4]))[1]?i[2]:i[4],t="VALUE"===i[1]?i[2]:i[4],s=i[5];if(!e||this._masterVariableList.hasOwnProperty(e)||s||i[1]===i[3]){n=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"invalid EXT-X-DEFINE tag in manifest",a.f.FormatError);break}this._masterVariableList[e]=t}else{r=hs(i[1]||i[3],this._masterVariableList);let e=Li.parseTags(r.updatedString);if(s=hs(i[2]||e.URI,this._masterVariableList),r.error||s.error){n=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"manifest encountered undefined/not imported EXT-X-DEFINE property",a.f.FormatError);break}let h=e.BANDWIDTH,d=e["AVERAGE-BANDWIDTH"],c=d||h,u={persistentId:(c||0)+o.length%1e3/1e3,attrs:e,url:rs(s.updatedString,t,this.inheritQuery),name:e.NAME,audioGroupId:e.AUDIO,iframes:!!i[3],bandwidth:h,avgBandwidth:d,bitrate:c,videoRange:e["VIDEO-RANGE"]?e["VIDEO-RANGE"]:"SDR",frameRate:e["FRAME-RATE"],unchangedLevelCount:0,allowedCPCMap:cs.parseAllowedCPC(e["ALLOWED-CPC"]),closedcaption:e["CLOSED-CAPTIONS"],levelCodec:e.CODECS},p=e["HDCP-LEVEL"];vi(p)?u.hdcpLevel=p:f.b.warn("Unrecognized HDCP-LEVEL "+p)();let g=e.RESOLUTION;if(g&&(u.width=g.width,u.height=g.height),e.CODECS){u.videoCodecList=new Array,u.audioCodecList=new Array;let t=e.CODECS.split(/[ ,]+/);var l=t.length;for(let e=0;e<l;e++){const i=t[e];switch(i.slice(0,4)){case"avc1":u.videoCodec=os(i),u.videoCodecList.push(u.videoCodec);break;case"avc3":case"dvav":case"dva1":case"hev1":case"hvc1":case"dvh1":case"dvhe":case"vp09":u.videoCodec=i,u.videoCodecList.push(u.videoCodec);break;case"mp4a":case"ec-3":case"ac-3":u.audioCodec=i,u.audioCodecList.push(u.audioCodec);break;default:f.b.warn("Unrecognized codec "+i)(),u.audioCodec=i,u.audioCodecList.push(u.audioCodec)}}u.audioCodecList.length>1&&(u.audioCodec=Hi(u.audioCodecList)),u.videoCodecList.length>1&&(u.videoCodec=Gi(u.videoCodecList))}o.push(u)}return{levels:o,playlistParsingError:n}}static parseAllowedCPC(e){if("string"!=typeof e)return;let t=new Map;return e.split(",").forEach(e=>{let i,s,r=e.split(":");if(2===r.length)i=r[0].trim(),s=r[1].trim();else{if(!(r.length>2))return;s=r[r.length-1].trim(),r.pop(),i=r.join(":")}if(t.has(i))return;let n=new Array;""!==s&&(n=s.split("/").map(e=>e.trim())),t.set(i,n)}),t}}var us=cs,fs=class{constructor(e){this.hls=e,this.logger=e.logger,this.loaders={}}destroy(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy()}this.loaders={},this.hls=void 0}loadManifest(e,t){var i,s,r,n;if(!this.hls)return void console.warn("loadManifest called without hls object");let a=(null===(i=this.hls.playingItem)||void 0===i?void 0:i.itemId)===(null===(s=this.hls.loadingItem)||void 0===s?void 0:s.itemId)?null===(r=this.hls.playingItem)||void 0===r?void 0:r.itemId:null===(n=this.hls.loadingItem)||void 0===n?void 0:n.itemId;return this.playlistParser=new us(this.hls.config,a,this.registerProgramDateTime.bind(this)),this.playlistParser.query=Boolean(t.inheritQuery),new Promise((t,i)=>{this.load(e,{type:"manifest",promise:{resolve:t,reject:i}})})}retryPlaylistRequest(e){let t=e.loader;if(!t)return;const i=new Promise((i,s)=>{t.context.promise={resolve:i,reject:s},e.retrying=t.scheduleRetry()});return e.retrying?i:void 0}isLoadingLevel(e){return this.loaders.level&&this.loaders.level.context&&this.loaders.level.context.level===e}loadLevel(e,t){return new Promise((i,s)=>{this.load(e,{type:"level",level:t,promise:{resolve:i,reject:s}})})}abort(e){let t=this.loaders[e];t&&(t.abort(),this.loaders[e]=void 0)}isLoadingAudioTrack(e){return this.loaders.audioTrack&&this.loaders.audioTrack.context&&this.loaders.audioTrack.context.id===e}loadAudioTrack(e,t){return new Promise((i,s)=>this.load(e,{type:"audioTrack",id:t,promise:{resolve:i,reject:s}}))}isLoadingSubtitleTrack(e){return this.loaders.subtitleTrack&&this.loaders.subtitleTrack.context&&this.loaders.subtitleTrack.context.id===e}loadSubtitleTrack(e,t){return new Promise((i,s)=>{this.load(e,{type:"subtitleTrack",id:t,promise:{resolve:i,reject:s}})})}load(e,t){let i=this.loaders[t.type];if(i){let s=i.context;if(s&&s.url===e&&s.level===t.level)return;this.logger.warn("abort previous loader for type:"+t.type)(),i.abort()}let s,r,a=this.hls.config;switch(t.type){case"manifest":s=y.isCustomUrl(e)?a.manifestLoadPolicy.customURL:a.manifestLoadPolicy.default;break;case"level":case"audioTrack":case"subtitleTrack":s=y.isCustomUrl(e)?a.playlistLoadPolicy.customURL:a.playlistLoadPolicy.default,this.logger.info(`[QE Critical] loading playlist for ${t.type} ${t.level||t.id}`)();break;default:return void this.logger.warn("Load for unexpected type "+t.type)()}if(i=this.loaders[t.type]=t.loader=y.isCustomUrl(e)?new y(this.hls):void 0!==a.pLoader?new a.pLoader(a):new a.loader(a),t.sessionID=a.useHTTPPlaybackSessionId?this.hls.sessionID:void 0,t.url=e,t.responseType="",r={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},this.hls&&this.hls.trigger){let e;switch(t.type){case"manifest":e={event:n.b.MANIFEST_LOADING,payload:{url:t.url}};break;case"level":e={event:n.b.LEVEL_LOADING,payload:{url:t.url,level:t.level}};break;case"audioTrack":e={event:n.b.AUDIO_TRACK_LOADING,payload:{url:t.url,id:t.id}};break;case"subtitleTrack":e={event:n.b.SUBTITLE_TRACK_LOADING,payload:{url:t.url,id:t.id}}}e&&this.hls.trigger(e.event,e.payload)}i.load(t,s,r)}get parsedSessionData(){return this.sessionData}registerProgramDateTime(e,t){this.hls.registerProgramDateTime&&this.hls.registerProgramDateTime(e,t)}loadsuccess(e,t,i){var s=e.data,r=e.url,o=i.type,l=i.level,h=this.hls,d=this.playlistParser;if(this.logger.info(`[QE Critical] [Playlist]loadsuccess url/type/level ${this.hls.redactUrl(r)}, ${o}, ${l}`)(),this.loaders[o]=void 0,void 0!==r&&0!==r.indexOf("data:")||(r=i.url),t.tload=performance.now(),us.isValidPlaylist(s))if(us.isMediaPlaylist(s)){let e="audioTrack"!==o&&"subtitleTrack"!==o?isNaN(l)?0:l:isNaN(i.id)?0:i.id,c=isNaN(h.loadingItem.startTime)?0:h.loadingItem.startTime;this.logger.info("shift playlist by "+c)();let u="audioTrack"===o?"audio":"subtitleTrack"===o?"subtitle":"main",f=d.parseLevelPlaylist(c,s,r,e,u),p=f.levelDetails,g=f.playlistParsingError;if(g)return void h.trigger(n.b.INTERNAL_ERROR,g);if(p.tload=t.tload,p.targetduration)switch(p.trequest=t.trequest,h.loadingItem.totalduration=p.totalduration,o){case"manifest":{p.isInitialMediaPlaylist=!0,h.updatePlaylistAttributes(p);let e={levels:[{persistentId:0,url:r,details:p,iframes:p.iframesOnly,bandwidth:void 0,bitrate:void 0,name:void 0,unchangedLevelCount:0,levelCodec:void 0}],audioTracks:[],url:r,stats:t,isMediaPlaylist:!0};i.promise.resolve(e);break}case"level":{t.tparsed=performance.now();let{playlistType:s}=h.updatePlaylistAttributes(p);i.promise.resolve({details:p,level:l||0,id:e||0,stats:t,playlistType:s});break}case"audioTrack":case"subtitleTrack":t.tparsed=performance.now(),i.promise.resolve({details:p,id:e,stats:t})}else{let e=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"invalid targetduration",a.f.PlaylistErrorBadTargetDuration);e.url=r,h.trigger(n.b.INTERNAL_ERROR,e)}}else{let e=d.parseMasterPlaylist(s,r),o=e.levels,l=e.playlistParsingError;if(l&&h.trigger(n.b.INTERNAL_ERROR,l),this.sessionData=us.parseSessionData(s,r),h.baseurl=r,o.length){let e=d.parseMasterPlaylistMedia(s,r,o),a=e.parsedMasterPlaylistMedia,l=e.playlistParsingError;l&&h.trigger(n.b.INTERNAL_ERROR,l);let c=a.audioTracks,u=a.subtitleTracks,f=a.audioMediaSelectionGroup,p=a.subtitleMediaSelectionGroup,g=!1;if(c.length){let e=!1;c.forEach(t=>{t.url||(e=!0)}),!1===e&&o[0].audioCodec&&!o[0].audioGroupId&&(this.logger.info("audio codec signaled in quality level, but no embedded audio track signaled, create one")(),c.unshift({type:"main",name:"main"}))}i.promise.resolve({levels:o,audioTracks:c,subtitleTracks:u,url:r,stats:t,audioMediaSelectionGroup:f,subtitleMediaSelectionGroup:p,isMediaPlaylist:g})}else(l=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"no level found in manifest",a.f.PlaylistErrorInvalidEntry)).url=r,h.trigger(n.b.INTERNAL_ERROR,l)}else{let e=new a.q(a.g.NETWORK_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"no EXTM3U delimiter",a.f.PlaylistErrorMissingEXTM3U);e.url=r,h.trigger(n.b.INTERNAL_ERROR,e)}}loaderror(e,t){var i,s,r=t.loader;switch(t.type){case"manifest":i=a.d.MANIFEST_LOAD_ERROR,s=!1;break;case"level":i=a.d.LEVEL_LOAD_ERROR,s=!1;break;case"audioTrack":i=a.d.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case"subtitleTrack":i=a.d.SUBTITLE_TRACK_LOAD_ERROR,s=!1}r&&(r.abort(),this.loaders[t.type]=void 0);let n=new a.p(a.g.NETWORK_ERROR,i,s,"Playlist load error",e,t.url,r,t);t.promise.reject(n)}loadtimeout(e,t){var i,s,r=t.loader,n=a.f.PlaylistNotReceived;switch(t.type){case"manifest":i=a.d.MANIFEST_LOAD_TIMEOUT,s=!1;break;case"level":i=a.d.LEVEL_LOAD_TIMEOUT,s=!1;break;case"audioTrack":i=a.d.AUDIO_TRACK_LOAD_TIMEOUT,s=!1;break;case"subtitleTrack":i=a.d.SUBTITLE_TRACK_LOAD_TIMEOUT,s=!1}r&&(r.abort(),this.loaders[t.type]=void 0);let o=new a.p(a.g.NETWORK_ERROR,i,s,"Playlist load timeout",n,t.url,r,t);t.promise.reject(o)}loadprogress(e,t,i){var s=t.loader;if(s&&s.loader&&200===s.loader.status&&(""===s.loader.responseType||"text"===s.loader.responseType)&&i&&i.length>10)if(us.isValidPlaylist(i))this.logger.info("deregister for further progress updates")(),s.callbacks.onProgress=null;else{this.logger.error("[Playlist] response doesn't have #EXTM3U tag")(),s.abort(),this.loaders[t.type]=void 0;let e=new a.q(a.g.NETWORK_ERROR,a.d.MANIFEST_PARSING_ERROR,!0,"response doesnt have #EXTM3U tag",a.f.PlaylistErrorMissingEXTM3U);e.url=t.url,this.hls.trigger(n.b.INTERNAL_ERROR,e)}}},ps=i(12);class gs{constructor(e,t){this.hls=e,this.id=t,this.uriToDecryptingFragments={},this.logger=e.logger,this._onWorkerMessage=this._onWorkerMessage.bind(this),this._ensureHandlerFunc()}_setupInlineHandler(e){return this.observer=new ps.EventEmitter,this.observer.trigger=(e,t)=>{this.observer.emit(e,e,t)},this.observer.off=(e,t)=>this.observer.removeListener(e,t),this.decryptor=new e.SegmentDecryptorInline(this.observer,this.hls.config),e=>{this.decryptor.decrypt(e.data,e.frag.decryptdata,t=>this._onDecryptComplete(e,t))}}_setupWorkerHandler(e){let t;try{(t=e.createDecryptorWorker()).addEventListener("message",this._onWorkerMessage),t.onerror=e=>{let t=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,e.message+" ("+e.filename+":"+e.lineno+")");t.event="decryptorWorker",t.err={message:e.message+" ("+e.filename+":"+e.lineno+")"},this.hls.trigger(n.b.INTERNAL_ERROR,t)},t.postMessage({cmd:"init",id:this.id,config:JSON.stringify(this.hls.config)}),this.worker=t}catch(e){throw t&&URL.revokeObjectURL(t.objectURL),e}return e=>{const i=e.frag.url;if(this.uriToDecryptingFragments[i])return;this.uriToDecryptingFragments[i]=e;const s=e.data,{decryptdata:r}=e.frag;t.postMessage({cmd:"segment-decrypt",fragPayload:s,decryptdata:r,fragObjId:i},[s])}}_genHandlerFunc(){return Promise.resolve().then(i.bind(null,28)).then(e=>{if(this.hls.config.enableWorker&&"undefined"!=typeof Worker)try{return this._setupWorkerHandler(e)}catch(e){this.logger.error("error while initializing SegmentDecryptorWorker, fallback on DecryptorInline")()}return this._setupInlineHandler(e)})}_ensureHandlerFunc(){return this.handlerPromise||(this.handlerPromise=this._genHandlerFunc()),this.handlerPromise}destroy(){return this.handlerPromise?this.handlerPromise.then(()=>this._destroy()):(this._destroy(),Promise.resolve())}_destroy(){this.handlerPromise=null;const{worker:e,decryptor:t,observer:i}=this;e&&(e.removeEventListener("message",this._onWorkerMessage),e.terminate(),this.worker=null),t&&(t.destroy(),this.decryptor=null),i&&(i.removeAllListeners(),this.observer=null)}decrypt(e,t,i,s){const{decryptdata:r}=t,n={frag:t,data:e,stats:i,onComplete:s};return this._ensureHandlerFunc().then(e=>{r.key?e(n):this.logger.error("Decrypt called on fragment without valid key")()})}_onDecryptComplete(e,t){e.onComplete&&e.onComplete({decryptedData:t,frag:e.frag,stats:e.stats,id:this.id})}_onWorkerMessage({data:e}){switch(e.event){case"init":URL.revokeObjectURL(this.worker.objectURL);break;case"segment-decrypted":if(!gs.isError(e)){const t=this.uriToDecryptingFragments[e.fragObjId];t&&t.onComplete&&(this._onDecryptComplete(t,e.data),delete this.uriToDecryptingFragments[e.fragObjId])}break;case n.b.ERROR:if(gs.isError(e)){let t=e.data;if(t&&t.details===a.d.FRAG_DECRYPT_ERROR){let i=new a.i(t.type,t.details,t.fatal,t.reason);this.hls.trigger(e.event,i)}}}}static isError(e){return e.data&&"details"in e.data}}var ms=class{constructor(e){this.hls=e,this.destroy$=new it,this.logger=e.logger,this.loaders={},this.serverInfoReported=!1}destroy(){this.destroy$.next();let e=this.loaders;for(let t in e){let i=e[t];i&&i.destroy()}this.loaders={}}loadFragment(e){return new Promise((t,i)=>{let s,r,a,o=e.type,l=this.loaders[o],h=this.hls.config;e.loaded=0,l&&(this.logger.warn("abort previous fragment loader for type:"+o)(),l.abort()),l=this.loaders[o]=e.loader=y.isCustomUrl(e.url)?new y(this.hls):void 0!==h.fLoader?new h.fLoader(h):new h.loader(h),s={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1,promise:{resolve:t,reject:i},type:o,sessionID:h.useHTTPPlaybackSessionId?this.hls.sessionID:void 0,collectServerInstanceInfo:this.serverInfoReported||"main"!==e.type||"number"!=typeof e.sn?void 0:h.fragLoadPolicy.default.reportHTTPResponseHeaders};let d=e.byteRangeStartOffset,c=e.byteRangeEndOffset;isNaN(d)||isNaN(c)||(s.rangeStart=d,e.byteRange&&e.decryptdata&&"AES-128"===e.decryptdata.method&&("initSegment"===e.sn?c+=(c-d)%16?16-(c-d)%16:16:e.iframe&&(c+=(c-d)%16?16-(c-d)%16:16,d=d>=16?d-16:d,s.rangeStart=d,s.iframe=!0)),s.rangeEnd=c),r=y.isCustomUrl(e.url)?h.fragLoadPolicy.customURL:h.fragLoadPolicy.default,a={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},this.hls.trigger(n.b.FRAG_LOADING,{frag:e}),l.load(s,r,a)})}loadsuccess(e,t,i){let s=e.data,r=i.frag;if(!isNaN(e.contentLen)&&e.contentLen!==e.len){let t=`fragment is shorter than expected. content len ${e.contentLen} vs actual len ${e.len}`;return this.logger.error(t)(),void this.loaderror({code:409,text:t},i)}i.serverInstanceInfo&&(this.serverInfoReported=!0),r.loader=void 0,r.loadSuccess=!0,this.loaders[r.type]=void 0,r.decryptdata&&"AES-128"===r.decryptdata.method?(this.segmentDecryptor||(this.segmentDecryptor=new gs(this.hls,"main")),i.iframe&&i.rangeStart&&(r.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),this.hls.keyLoader.getKeyFromDecryptData(r.decryptdata,void 0).pipe(Ae(e=>{r.decryptdata.key=e.key,this.segmentDecryptor.decrypt(s,r,t,e=>{i.promise.resolve({payload:new Uint8Array(e.decryptedData),frag:e.frag,stats:e.stats})})}),Xe(this.destroy$)).subscribe()):i.promise.resolve({payload:s,frag:r,stats:t,serverInfo:i.serverInstanceInfo})}loaderror(e,t){let i=this.loaders[t.type];i&&i.abort();let s=new a.l(a.g.NETWORK_ERROR,a.d.FRAG_LOAD_ERROR,!1,"Frag load error",e,i,t.frag);t.promise.reject(s)}loadtimeout(e,t){let i=this.loaders[t.type];i&&i.abort();let s=new a.l(a.g.NETWORK_ERROR,a.d.FRAG_LOAD_TIMEOUT,!1,"Frag load timeout",a.f.NoResponseFromMediaRequest,i,t.frag);t.promise.reject(s)}loadprogress(e,t,i){let s=t.frag;s.loaded=e.loaded,this.hls.trigger(n.b.FRAG_LOAD_PROGRESS,{frag:s,stats:e})}};function ys(e){return e&&"id"in e}function vs(e){return e&&"bitrate"in e}class _s{constructor(e,t,i){this.observer=e,this.mediaType=t,this.variantList=i||[]}destroy(){this.validVariantListInternal=void 0,this.variantListInternal=[],this.idToVariantListMap.clear(),this.idToPenaltyBoxExpiry.clear(),this.whiteListFilters=[],this.blackListFilters=[],void 0!==this.penaltyBoxTimer&&(clearTimeout(this.penaltyBoxTimer),this.penaltyBoxTimer=void 0)}reset(){this.validVariantListInternal=void 0,this.variantListInternal=[],this.idToVariantListMap=new Map,this.idToPenaltyBoxExpiry=new Map,this.whiteListFilters=[],this.blackListFilters=[[Number.POSITIVE_INFINITY,e=>this.isRemovedOrInPenaltyBox(e)]],this.stopTimers()}stopTimers(){void 0!==this.penaltyBoxTimer&&(clearTimeout(this.penaltyBoxTimer),this.penaltyBoxTimer=void 0)}startTimers(){this.penaltyBoxTimer||this.setOrResetPenaltyBoxTimer(this.getMinExpiry())}getMediaType(){return this.mediaType}get variantList(){return this.variantListInternal}set variantList(e){this.reset(),this.variantListInternal=_s.sortVariants(Array.from(e)),this.variantListInternal.forEach(e=>{this.idToVariantListMap.set(_s.getUniqueId(e),e)})}get validVariantList(){return this.validVariantListInternal||(this.validVariantListInternal=this.variantListInternal.filter(e=>this.isValidVariant(e))),this.validVariantListInternal}markValidListDirty(){this.validVariantListInternal=void 0}getVariantInfo(e){return this.idToVariantListMap.get(e)}getVariantInfoIfValid(e){let t=this.idToVariantListMap.get(e);if(void 0!==t&&this.isValidVariant(t))return t}getVariantListPosition(e){let t=this.validVariantList.findIndex(t=>_s.getUniqueId(t)===e);return t>=0?t:void 0}isRemovedOrInPenaltyBox(e){let t=performance.now(),i=_s.getUniqueId(e),s=this.idToPenaltyBoxExpiry.get(i);return void 0!==s&&t<s}isValidVariant(e){let t=performance.now();return this.blackListFilters.every(i=>{let s=t<i[0],r=i[1];return!s||!r(e)})&&this.whiteListFilters.every(t=>t(e))}addWhitelistFilter(e){this.whiteListFilters.push(e),this.markValidListDirty()}addBlacklistFilter(e,t){this.blackListFilters.push([e,t]),this.markValidListDirty(),void 0===this.penaltyBoxTimer&&this.setOrResetPenaltyBoxTimer(e)}moveAllMatchingHostsToPenaltyBoxOrRemovePermanently(e,t){let i=this.idToVariantListMap.get(e);if(void 0===i||void 0===i.url)return;let s=c.getHostName(i.url),r=performance.now()+12e4,n=t?Number.POSITIVE_INFINITY:r;this.addBlacklistFilter(n,t=>{let i=t.url;return _s.getUniqueId(t)!==e&&void 0!==i&&c.getHostName(i)===s})}addLevelToPenaltyBoxInternal(e,t){this.idToPenaltyBoxExpiry.has(e)&&f.b.warn(`add a variant ${e} to penalty box, current expiry: ${this.idToPenaltyBoxExpiry.get(e)}, now: ${performance.now()} new expiry: ${t}`)(),this.idToPenaltyBoxExpiry.set(e,t),this.markValidListDirty(),f.b.info(`variant ${e} in penalty box until ${t}`)(),void 0===this.penaltyBoxTimer&&this.setOrResetPenaltyBoxTimer(t)}addLevelToPenaltyBox(e){if(f.b.info(`addLevelToPenaltyBox(${e}) containsVariant=${this.idToVariantListMap.has(e)}`)(),!this.idToVariantListMap.has(e))return;let t=performance.now()+12e4;this.addLevelToPenaltyBoxInternal(e,t),this.triggerLevelChangeEvent(!1)}removeLevelPermanentlyInternal(e){this.idToPenaltyBoxExpiry.set(e,Number.POSITIVE_INFINITY),this.markValidListDirty(),f.b.info(`variant ${e} removed permanently`)()}removeLevelPermanently(e){this.idToVariantListMap.has(e)&&(this.removeLevelPermanentlyInternal(e),this.triggerLevelChangeEvent(!1))}removeAllMatchingHDCPLevelsPermanently(e){this.removeLevelPermanently(e)}getMinExpiry(){let e=Number.POSITIVE_INFINITY;return performance.now(),this.blackListFilters.forEach(t=>{let i=t[0];e=Math.min(e,i)}),this.idToPenaltyBoxExpiry.forEach(t=>{e=Math.min(e,t)}),e}handlePenaltyBoxTimer(){let e=performance.now(),t=!1;this.blackListFilters=this.blackListFilters.filter(i=>{let s=i[0],r=e<s;return t=t||!r,r}),this.idToPenaltyBoxExpiry.forEach((i,s,r)=>{e>=i&&(r.delete(s),f.b.info(`remove variant ${s} from penalty box`)(),t=!0)}),this.markValidListDirty(),this.setOrResetPenaltyBoxTimer(this.getMinExpiry()),t&&this.triggerLevelChangeEvent(!1)}setOrResetPenaltyBoxTimer(e){this.penaltyBoxTimer&&(clearTimeout(this.penaltyBoxTimer),this.penaltyBoxTimer=void 0);let t=performance.now();isFinite(e)&&(this.penaltyBoxTimer=setTimeout(this.handlePenaltyBoxTimer.bind(this),Math.max(0,Math.ceil(e-t))))}triggerLevelChangeEvent(e){if(this.observer&&this.mediaType===pi.AUDIO){let e={audioTracks:this.validVariantList};this.observer.trigger(n.b.AUDIO_TRACKS_UPDATED,e)}}static sortVariants(e){return e.sort((function(e,t){return vs(e)&&vs(t)?e.bitrate-t.bitrate:ys(e)&&ys(t)?e.id-t.id:1})),e}static getUniqueId(e){let t=NaN;return vs(e)?t=e.persistentId:ys(e)&&(t=e.id),t}}var bs=_s;class Ts{constructor(e,t,i){this.levelManager=e,this.loadFn=t,this.abortFn=i}destroy(){this.stop()}loadLevel(e,t=!0,i=0){let s=this.levelManager.getVariantInfoIfValid(e);if(!s)return void f.b.warn(`level ${e} invalid`)();let r=s.details;(!r||r.live&&Ts.needToRefreshLevel(r))&&(t&&(this._levelLoadTimer=null),0===i?this._loadLevelInternal(s):this._levelLoadTimer=setTimeout(this._loadLevelInternal.bind(this,s),i))}_loadLevelInternal(e){e.details&&(e.details.trequest=performance.now()),this.loadFn(e)}stop(){this._levelLoadTimer=null,this.abortFn()}static getLiveRefreshInterval(e){return 1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration)}static needToRefreshLevel(e){let t=Ts.getLiveRefreshInterval(e),i=performance.now()-e.trequest;return e.live&&i>=t}handleLevelLoad(e,t,i,s=0){let r=this.levelManager.getVariantInfoIfValid(e),n=r.details,o={success:!0,error:null};if(t.live){let l=Ts.getLiveRefreshInterval(t);!t.isInitialMediaPlaylist&&n&&t.endSN===n.endSN?(l/=2,l=Math.max(l,5e3),r.unchangedLevelCount++,f.b.info(`level ${e} unchangedLevelCount ${r.unchangedLevelCount}`)()):r.unchangedLevelCount=0,r.unchangedLevelCount>=2?(o.success=!1,o.error=a.f.LivePlaylistUpdateError,this._levelLoadTimer=null):(l-=performance.now()-i.trequest,l+=s,f.b.info("reloadInterval: "+l)(),l=Math.max(1e3,Math.round(l)),f.b.info(`level ${e} reload in ${l} ms`)(),this._levelLoadTimer=setTimeout(this.loadLevel.bind(this,e),l))}else this._levelLoadTimer=null;return o}set _levelLoadTimer(e){this._levelLoadTimerInternal&&clearTimeout(this._levelLoadTimerInternal),this._levelLoadTimerInternal=e}}var Ss=Ts,Es=class extends N{constructor(e,...t){super(e,...t),this.hls=e}_handleMediaPlaylistNetworkError(e,t){let i,s,r,n=e.response,a=n?n.code:n,o=Object(Oi.c)(e.context.id)?e.context.id:e.context.level;return i=this.hls.networkErrorHandler.getActionForPlaylistNetworkError(e,this,t),this.logger.warn(`variant ${o} encountered error ${a} errorAction ${i.errorAction} prefetch=${t}`)(),i.errorAction===Rs.RetryRequest?(r=this._attemptRetry(e,t))||(e.fatal=!0):s=this.hls.networkErrorHandler.handleNetworkError(i.errorAction,i.errorActionFlags,e,o,void 0,this.variantManager,this),e.fatal&&!this.hls.bufferEndPromiseWrapper&&this.hls.fatalErrorRequiresAction(e)&&this.hls.bufferDryPromise.then(()=>{this.hls.upgradeInternalErrorIfNecessary(e)}).catch(e=>{this.logger.error("get an error in buffer dry promise "+e.message)()}),r}};function ws(e){return"PQ"===e.videoRange||"HLG"===e.videoRange}var Is=class extends bs{constructor(e,t,i){super(e,pi.VIDEO),this.variantList=t,this.hdrMode=i}reset(){super.reset(),this.compatibleVariants=new Set,this.addWhitelistFilter(e=>ws(e)===this.hdrMode),this.addWhitelistFilter(e=>0===this.compatibleVariants.size||this.compatibleVariants.has(bs.getUniqueId(e)))}set variantList(e){this.hasHDRLevels=e.some(e=>ws(e)),this.hasIframeLevels=e.some(e=>e.iframes),super.variantList=e,this.validCodecList=new Set;for(let t=0;t<e.length;t++){let i=e[t].videoCodecList;if(i)for(let e=0;e<i.length;e++)this.validCodecList.add(i[e])}}get variantList(){return super.variantList}removeAllMatchingHDCPLevelsPermanently(e){const t=this.idToVariantListMap.get(e);if(!t)return;let i=t.hdcpLevel,s=Number.POSITIVE_INFINITY;this.addBlacklistFilter(s,t=>{let s=bs.getUniqueId(t),r=t.hdcpLevel;return void 0===i&&s===e||void 0!==r&&r===i}),this.triggerLevelChangeEvent(!0)}set hdrMode(e){this.hdrModeInternal!==e&&(this.clearStartingVariant(),this.hdrModeInternal=e,this.markValidListDirty())}get hdrMode(){return this.hdrModeInternal}getHighestCodecByFamily(e){let t=e.split(".")[0],i=new Set([...this.validCodecList].filter(e=>e.includes(t)));switch(t){case"avc1":case"avc3":i.forEach(t=>{let i=e.split("."),s=t.split(".");i[0]===s[0]&&s[1]>i[1]&&(e=t)});break;case"vp09":i.forEach(t=>{t>e&&(e=t)}),e=e.substring(0,13);break;case"hvc1":case"hev1":i.forEach(t=>{let i=e.split("."),s="H"===i[3].substring(0,1)?1:0,r=i[3].substring(1),n=t.split("."),a="H"===n[3].substring(0,1)?1:0,o=n[3].substring(1);i[0]===n[0]&&(n[1]>i[1]||n[2]>i[2]||a>s||o>r)&&(e=t)});break;case"dvhe":case"dvh1":i.forEach(t=>{let i=e.split("."),s=t.split(".");i[0]===s[0]&&(s[1]>i[1]||s[2]>i[2])&&(e=t)})}return e}clearStartingVariant(){f.b.info("setting startingId undefined")(),this.startingVariant=void 0,this.compatibleVariants=new Set,this.compatibleAudioGroups=new Set}set startingId(e){let t=this.getVariantInfoIfValid(e);if(!t)return void f.b.warn("Invalid starting variant selected "+e)();let{levels:i,audioGroups:s}=function(e,t){let i=new Set;return{levels:e.filter((function(e){let s=function(e,t){let i=!0;e.videoCodec&&t.videoCodec&&(i=Oi.b.isCompatibleVideoCodec(e.videoCodec,t.videoCodec));let s=!1;e.videoRange&&t.videoRange?s=e.videoRange===t.videoRange:e.videoRange||t.videoRange||(s=!0);let r=!0;return e.audioCodec&&t.audioCodec&&(r=Oi.b.isCompatibleAudioCodec(e.audioCodec,t.audioCodec)),r&&i&&s}(t,e);if(s){let t=e.audioGroupId;t&&i.add(t)}return s})),audioGroups:i}}(this.variantList,t);this.startingVariant=t,this.compatibleVariants=new Set(i.map(bs.getUniqueId)),this.compatibleAudioGroups=s,this.markValidListDirty()}get startingId(){return this.startingVariant?bs.getUniqueId(this.startingVariant):NaN}triggerLevelChangeEvent(e){if(!this.observer)return;let t={requiresReset:e,levels:this.validVariantList};this.observer.trigger(n.b.LEVELS_CHANGED,t)}};const Ds={minValidBitrate:2e6,maxValidBitrate:5e6,maxPreferredBitrate:3e6,minValidHeight:480,maxValidHeight:720};function Ls(e){return JSON.stringify(e,["persistentId","bitrate","bandwidth","avg-bandwidth","width","height","videoCodec","audioCodec","videoRange","iframes","frameRate"])}class ks extends Es{constructor(e,t){super(e,n.b.LEVEL_PTS_UPDATED,n.b.LEVEL_UPDATED,n.b.PREFERRED_HOST_CHANGED),this.playlistLoader=t,this._manualLevel=-1,this._loadediframeLevelIds=[],this._lastPreloadIFrameLevelId=void 0,this.dynamicRangeListener=this.onDynamicRangeQueryChange.bind(this)}destroy(){this.reset(),this.stopDynamicRangeQuery(),this._manualLevel=-1,this.levelLoader&&this.levelLoader.destroy(),this.variantManager&&this.variantManager.destroy(),super.destroy()}reset(){this.stopLoad(),this._loadediframeLevelIds=[],this._lastPreloadIFrameLevelId=null}resetLoadSource(){this._levelInfo=void 0}cleanupLevels(){let e=this.validLevels;this.levelRetryCount=0,e&&e.forEach(e=>{const t=e.details;t&&t.live&&(e.unchangedLevelCount=0)})}startLoad(){this.cleanupLevels()}stopLoad(){this.levelLoader&&this.levelLoader.stop(),this.cleanupLevels()}isSameLevel(e,t){return void 0===e==(void 0===t)&&e.persistentId===t.persistentId}get displaySupportsHdr(){return this.startDynamicRangeQuery(),!this.dynamicRangeQuery||this.dynamicRangeQuery.matches}startDynamicRangeQuery(){if(!this.dynamicRangeQuery&&"function"==typeof matchMedia){let e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");e.media!==t.media&&(this.dynamicRangeQuery=e,this.dynamicRangeQuery.addListener(this.dynamicRangeListener))}}stopDynamicRangeQuery(){this.dynamicRangeQuery&&(this.dynamicRangeQuery.removeListener(this.dynamicRangeListener),this.dynamicRangeQuery=null)}onDynamicRangeQueryChange(){this.logger.info("HDR display support changed = "+this.displaySupportsHdr)(),this.setHDRMode(this.displaySupportsHdr,!0)}setHDRMode(e,t){if(e!==this.variantManager.hdrMode)if(!e||this.variantManager.hasHDRLevels)try{if(this.stopLoad(),this.startLoad(),this.variantManager.hdrMode=e,this.chooseFirstLevel(),t){let e={requiresReset:!0,levels:this.validLevels};this.hls.trigger(n.b.LEVELS_CHANGED,e)}}catch(t){let i=new a.q(a.g.MEDIA_ERROR,a.d.MANIFEST_INCOMPATIBLE_VIDEO_RANGE_ERROR,!0,"No levels matching display hdrMode="+e,a.f.IncompatibleAsset);this.hls.trigger(n.b.INTERNAL_ERROR,i)}else this.logger.info("No hdr levels, not switching to hdr")();else this.logger.info("No change in hdr mode")()}setFirstLevelOnManager(e){let t=this.hls.config.targetStartupMs-(performance.now()-this.hls.tloadsource);this.hls.hasPlaybackEverStarted&&t<0&&(t=this.hls.config.targetStartupMs);let i=function(e,t,i,s){if(!e||0===e.length||Yi(e))return void f.b.warn("no non-iframe level found in levels")();let r=function(e,t,i,s){let r,n;for(let l=0;l<e.length;++l){var a,o=e[l];o.iframes||(a=$i(o,t,i,s),(!r||a.isGreaterThan(n)||a.isEqualTo(n)&&o.bitrate>r.bitrate)&&(r=o,n=a))}return r}(e,t,i,s);if(r)return r;f.b.warn("no valid first level found in levels")()}(e.validVariantList,Ds,this.hls.config.enableAdaptiveStartup?this.hls.bandwidthHistoryController.getEstimate():void 0,this.hls.config.enableAdaptiveStartup?{targetDuration:this.hls.config.defaultTargetDuration,targetStartupMs:t,metricsOverride:this.hls.config.adaptiveStartupMetricsOverride}:void 0);if(!i)throw Error("No first level found");return e.startingId=i.persistentId,i}chooseFirstLevel(){if(!this.variantManager)throw Error("variantManager undefined");let e=this.setFirstLevelOnManager(this.variantManager);this.hls.preferredHostName=c.getHostName(e.url),this.hls.nextAutoLevel=this.variantManager.startingId,this.logger.info(`First level ${e.persistentId}: ${Ls(e)}`)();let t=this.variantManager.validVariantList.filter(e=>un.hasAllowedHost(e.url,this.hls.preferredHostName)).length,i=this.variantManager.validVariantList.length-t;this.logger.info(`Primary/Backup levels: ${t}/${i}`)()}parseManifestLoadedData(e){const t=this.hls,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase());let s=[],r=e.audioTracks,{audioMediaSelectionGroup:n,subtitleMediaSelectionGroup:a}=e,o=!1,l=!1,h=!1,d=t.platformInfo;for(let c=0;c<e.levels.length;++c){let t=e.levels[c];o=o||Boolean(t.videoCodec),i&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),l=l||Boolean(t.audioCodec)||Boolean(t.audioGroupId),h=h||t.iframes,s.push(t)}return o&&l&&(s=s.filter(({videoCodec:e})=>Boolean(e))),this.logger.info(`playlist has ${s.length} levels, ${Ls(s)}`)(),Xi(s,r,d,this.hls.config).then(t=>{let{hdrLevels:i,sdrLevels:s}=t,h=i.concat(s);this.logger.info(`[QE Critical] manifest loaded, ${h.length} valid levels found, levels ${Ls(h)}`)(),this.logger.info(`valid levels: hdr=${i.length} sdr=${s.length} supportsHdr=${this.displaySupportsHdr}`)();let d=new Is(this.hls,h,this.displaySupportsHdr&&i.length>0);this.setFirstLevelOnManager(d);let c=d.compatibleAudioGroups,u=new Array,f=new Set,p=!1;r.forEach(e=>{c.has(e.groupId)&&(e.id=u.length,f.add(e.persistentID),u.push(e),p||(p=!!e.url))}),r=u;let g=new bs(this.hls,pi.AUDIO,r),m=n?n.MediaSelectionGroupOptions:void 0;if(m){let e=new Array;m.forEach(t=>{f.has(t.MediaSelectionOptionsPersistentID)&&e.push(t)}),n.MediaSelectionGroupOptions=e}let y={levels:d,audioTracks:g,subtitleTracks:new bs(this.hls,pi.SUBTITLE,e.subtitleTracks),isMediaPlaylist:e.isMediaPlaylist,audioCodecFound:l,videoCodecFound:o,altAudio:p,audioMediaSelectionGroup:n,subtitleMediaSelectionGroup:a};return Promise.resolve(y)})}setVariantManager(e){this.reset(),this.levelLoader&&this.levelLoader.destroy(),this.variantManagerInternal=e,e.hdrMode=this.displaySupportsHdr&&e.hasHDRLevels,this.levelLoader=new Ss(e,e=>this._loadLevelInternal(e),()=>{this.playlistLoader.abort("level")}),e.variantList.length>0&&this.chooseFirstLevel()}get variantManager(){return this.variantManagerInternal}get validLevels(){return this.variantManager&&this.variantManager.validVariantList||[]}get hasIframeLevels(){return!!this.variantManager&&this.variantManager.hasIframeLevels}get level(){return this._levelInfo?this._levelInfo.persistentId:void 0}get currentVariantId(){return this.level}get levelInfo(){return this._levelInfo}static isSwitchUp(e,t){let i=!1;return e&&t&&(i=e.bitrate<t.bitrate&&e.iframes===t.iframes),i}addToLoadedLevels(e){this._loadediframeLevelIds.push(e),this._loadediframeLevelIds.sort((function(e,t){return t-e}))}preloadiFrameLevelPlaylists(){if(this.playlistLoader.isLoadingLevel(this._lastPreloadIFrameLevelId)||!this.validLevels.some(e=>e.iframes))return;let e=this.hls.abrController.findNextABRAutoLevelInMode(!0),t=this.getLevelWithPersistentId(e).levelInfo;return t?(void 0===t.details&&(this.logger.info("[iframes] preloading iframe playlist for level: "+e)(),this._lastPreloadIFrameLevelId=e,this.levelLoader.loadLevel(e,!1)),e):void 0}doesLevelMatchIframeMode(e){return e&&e.iframes===this.hls.iframeMode}getLevelWithPersistentId(e){let t,i;return isNaN(e)||e<0?this.logger.warn("invalid levelID "+e)():this.variantManager&&(t=this.variantManager.getVariantInfoIfValid(e),i=this.variantManager.getVariantListPosition(e)),{levelInfo:t,levelListPosition:i}}containsFallbackVariant(e){return e=e||this.hls.preferredHostName,this.containsFallbackVariantForMode(this.hls.iframeMode,e)}containsFallbackVariantForMode(e,t){return this.validLevels.filter(i=>i&&i.iframes===e&&un.hasAllowedHost(i.url,t)).length>1}isCurrentLevelNonSDR(){return this._levelInfo.videoRange&&"SDR"!==this._levelInfo.videoRange}lowestBitrateLevel(e){let t=this,i=e.find((function(e){return t.doesLevelMatchIframeMode(e)}));return void 0!==i?i.persistentId:void 0}getTrickPlayResumeLevel(e){let t=this.validLevels,i=this.hls.config.targetStartupMs,s=1,r=this.hls.config.defaultTargetDuration,n=this.variantManager.getVariantListPosition(e);if(n){let e=t[n];e&&e.details&&(r=e.details.targetduration,s=Math.ceil(i/(1e3*r)))}const a={avgLatencyMs:1500,avgBandwidth:this.hls.abrController.getBandwidthEstimate()},o={targetDuration:r*s,targetStartupMs:i,metricsOverride:{maxValidHeight:0,maxValidBitrate:0,maxPreferredBitrate:0}};this.logger.info(`Revising trickplay resume level based on targetStartUpMs/targetDuration/bandWidth : ${o.targetStartupMs}/${o.targetDuration}/${a.avgBandwidth}`)();let l=t.filter(e=>!e.iframes&&(!e.width||!e.height||e.width*e.height<=2488320)),h=e;l.length>0&&(h=l[0].persistentId);let d=l.filter(e=>Vi(e,a,o));return this.logger.info(`Picking resume level from validLevels/regLevels/resumeLevels ${t.length}/${l.length}/${d.length}`)(),d.length>0&&(h=d[d.length-1].persistentId),h}set level(e){const t=this.hls;if(!this.validLevels)return;let i=this.getLevelWithPersistentId(e).levelInfo;i&&this.doesLevelMatchIframeMode(i)?this.setLevelInternal(i):t.trigger(n.b.INTERNAL_ERROR,{type:a.g.OTHER_ERROR,details:a.d.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx, or level doesnt match iframe mode",response:a.f.CantSwitchInTime})}setLevelInternal(e){const t=this.hls;let i=!1;if(!1===this.isSameLevel(this._levelInfo,e)){let s=void 0!==this._levelInfo?this._levelInfo.persistentId:this._levelInfo,r=void 0!==this._levelInfo?this._levelInfo.bitrate:this._levelInfo;this.logger.info(`switching from ${s}:${r} to level ${e.persistentId}:${e.bitrate}`)(),i=ks.isSwitchUp(this._levelInfo,e),this._levelInfo=e,t.trigger(n.b.LEVEL_SWITCH,e),t.trigger(n.b.LEVEL_SWITCHING,e)}this.levelLoader.loadLevel(e.persistentId),i&&(this.logger.info(`Switched to a new level: ${e.persistentId} attemptSafeNextLevelSwitch`)(),this.hls.streamController.attemptSafeNextLevelSwitch())}_loadLevelInternal(e){this.playlistLoader.loadLevel(e.url,e.persistentId).then(e=>{this.onLevelLoaded(e)}).catch(t=>{this._handleMediaPlaylistNetworkError(t,e.iframes!==this.hls.iframeMode)})}_attemptRetry(e,t){let i=this.hls.playlistLoader.retryPlaylistRequest(e);return i?i.then(e=>{this.onLevelLoaded(e)}).catch(e=>{this._handleMediaPlaylistNetworkError(e,t)}):void 0}get manualLevel(){return this._manualLevel}set manualLevel(e){this._manualLevel=e,void 0!==this._startLevel||this.hls.iframeMode||-1===e||(this._startLevel=e),-1!==e&&(this.level=e)}set firstLevel(e){this.variantManager&&(this.variantManager.startingId=e)}get firstLevel(){return this.variantManager?this.variantManager.startingId:NaN}get startLevel(){if(void 0===this._startLevel){let e=this.hls.config.startLevel;return void 0!==e?e:this.firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}_startedLoadingLevels(){return void 0!==this._levelInfo}_checkIfLevelExpired(e){let t=this.getLevelWithPersistentId(e).levelInfo,i=this.hls.media;if(!(t&&t.details&&i&&i.readyState))return;let s=t.details;if(this.levelIsExpired(s)){let r,n=s.fragments[0].start,o=n+s.totalduration;this.logger.error(`level ${e} behind currentTime=${i.currentTime} range:${n.toFixed(3)}-${o.toFixed(3)}`)();let l={type:"level",level:e,id:void 0},h=new a.p(a.g.NETWORK_ERROR,a.d.LEVEL_LOAD_ERROR,!1,a.f.LivePlaylistUpdateError.text,a.f.LivePlaylistUpdateError,this.hls.url,r,l),d=t.iframes!==this.hls.iframeMode;this._handleMediaPlaylistNetworkError(h,d)}}levelIsExpired(e){let t=this.hls.media;return t&&t.readyState&&e.fragments.length>0&&e.live&&e.PTSKnown&&e.fragments[0].start+e.totalduration<t.currentTime}onLevelUpdated(e){this._checkIfLevelExpired(e.level)}onLevelPtsUpdated(e){this._checkIfLevelExpired(e.level)}onLevelLoaded(e){var t;const i=e.level;let s=this.getLevelWithPersistentId(i).levelInfo,r=e.details;if(void 0!==s&&s.iframes&&this.addToLoadedLevels(s.persistentId),!this._startedLoadingLevels()&&r.isInitialMediaPlaylist||i===(null===(t=this._levelInfo)||void 0===t?void 0:t.persistentId)){let t=this.hls.isLive?this.hls.streamController.getLivePlaylistRefreshDelay(r):0,n=this.levelLoader.handleLevelLoad(i,r,e.stats,t);if(n.success)this.levelRetryCount=0;else switch(n.error){case a.f.LivePlaylistUpdateError:let t;e.livePlaylistUpdateError=!0;let r={type:"level",level:i,id:e.id},n=new a.p(a.g.NETWORK_ERROR,a.d.LEVEL_LOAD_ERROR,!1,a.f.LivePlaylistUpdateError.text,a.f.LivePlaylistUpdateError,this.hls.url,t,r),o=s.iframes!==this.hls.iframeMode;this._handleMediaPlaylistNetworkError(n,o)}}this.hls.trigger(n.b.LEVEL_LOADED,e)}get nextLoadLevel(){if(-1!==this._manualLevel)return this._manualLevel;if(this.hls.iframeMode&&this._loadediframeLevelIds.length>0){let e=this.hls.nextAutoLevel,t=this._loadediframeLevelIds.find((function(t){return t<=e}));return void 0!==t?t:e}return this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this._manualLevel&&(this.hls.nextAutoLevel=e)}getLowerAutoLevel(e){let t;for(let i=e-1;i>=0;i--)if(this.doesLevelMatchIframeMode(this.validLevels[i])&&un.hasAllowedHost(this.validLevels[i].url,this.hls.preferredHostName)){t=this.validLevels[i].persistentId;break}return t}setNextAutoVariant(e){this.hls.nextAutoLevel=e}getNextBestAutoVariant(e,t){if(!this.variantManager)return;if(t=t||this.hls.preferredHostName,!this.doesLevelMatchIframeMode(this.variantManager.getVariantInfo(e)))return this.logger.warn("getNextBestAutoVariant: non-matching i-frame mode, using current level")(),this.currentVariantId;let i=this.variantManager.getVariantListPosition(e),s=this.getLowerAutoLevel(i);if("number"!=typeof s)for(let r=i+1;r<this.validLevels.length;++r){let e=this.validLevels[r];if(this.doesLevelMatchIframeMode(e)&&un.hasAllowedHost(e.url,t)){s=this.validLevels[r].persistentId;break}}return s}onPreferredHostChanged(e){if(e.mediaType===pi.VIDEO||isNaN(this.level)||0===this.variantManager.variantList.length)return;let t,i=this.variantManager.getVariantInfo(this.level);(t=this.variantManager.validVariantList.find(e=>e.bandwidth===i.bandwidth&&un.hasAllowedHost(e.url,this.hls.preferredHostName)))&&(this.logger.warn("preemptively switching video host to "+this.hls.preferredHostName)(),this.level=t.persistentId)}handleError(e){if("frag"in e&&e.frag&&"main"!==e.frag.type)return;let t;if(e instanceof a.j)t=e.frag&&Object(Oi.c)(e.frag.level)?e.frag.level:this._levelInfo.persistentId;else if(e instanceof a.k)t=e.frag&&Object(Oi.c)(e.frag.level)?e.frag.level:this._levelInfo.persistentId;else{if(!(e instanceof a.o))return;t=e.level}if(!isNaN(t)){let{levelInfo:i,levelListPosition:s}=this.getLevelWithPersistentId(t);if(!i)return void this.logger.warn(t+" in penalty box, skip")();this.hls.networkErrorHandler.handleError(e,i,t,s,this.variantManager,this)}}resetAndLoadSDRLevels(){try{this.logger.info("Falling back to SDR")(),this.setHDRMode(!1,!0)}catch(e){return!1}return!0}}var Rs,Cs,As=ks;!function(e){e[e.DoNothing=0]="DoNothing",e[e.SendEndCallback=1]="SendEndCallback",e[e.SendAlternateToPenaltyBox=2]="SendAlternateToPenaltyBox",e[e.RemoveAlternatePermanently=3]="RemoveAlternatePermanently",e[e.InsertDiscontinuity=4]="InsertDiscontinuity",e[e.RetryRequest=5]="RetryRequest",e[e.DefaultToSDR=6]="DefaultToSDR",e[e.AbortRequest=7]="AbortRequest",e[e.RemoveAllMatchingHDCPLevelsPermanently=8]="RemoveAllMatchingHDCPLevelsPermanently"}(Rs||(Rs={})),function(e){e[e.MoveAllAlternatesMatchingHost=2]="MoveAllAlternatesMatchingHost"}(Cs||(Cs={}));var Ps=class extends N{constructor(e){super(e,n.b.FRAG_LOADED),this.hls=e,this.consecutiveSendAlternateToPenaltyBox=new Map,this.consecutiveSendAlternateToPenaltyBox.set(pi.VIDEO,{val:0}),this.consecutiveSendAlternateToPenaltyBox.set(pi.AUDIO,{val:0}),this.consecutiveSendAlternateToPenaltyBox.set(pi.SUBTITLE,{val:0})}destroy(){super.destroy()}_modifyErrorActionIfLastValidVariantInternal(e,t){switch(e){case Rs.SendAlternateToPenaltyBox:e=Rs.RetryRequest,401!==t&&403!==t&&407!==t||(e=Rs.SendEndCallback);break;case Rs.RemoveAlternatePermanently:e=Rs.SendEndCallback}return e}_shouldFindAlternateHost(e){return this.hls.hasFallBack()&&0!=(e.errorActionFlags&Cs.MoveAllAlternatesMatchingHost)}_modifyActionForSwitchingHosts(e,t){let{errorAction:i,errorActionFlags:s}=e,r=this.hls.preferredHostName;if(this._shouldFindAlternateHost(e)){let e=this._findAlternateHost(t.variantManager,t.currentVariantId);r=(null==e?void 0:e.hostName)||r,this.logger.info("[errorHandling] candidate hostName="+r)(),r===this.hls.preferredHostName&&(s&=~Cs.MoveAllAlternatesMatchingHost)}return{errorAction:i,errorActionFlags:s,containsFallbackVariant:t.containsFallbackVariant(r)}}_modifyErrorActionIfCurrentLevelIsLastValidLevel(e,t,i,s){let{errorAction:r,errorActionFlags:n,containsFallbackVariant:a}=this._modifyActionForSwitchingHosts(e,i),o=e.errorAction;if(!a){if(r=this._modifyErrorActionIfLastValidVariantInternal(r,t),s&&i instanceof As){let e=i.isCurrentLevelNonSDR(),t=this.hls.hasPlaybackEverStarted;s&&!t&&e&&(r=Rs.DefaultToSDR)}n=0,this.logger.info(`fallbackVariantAvailable ${a} changing action from ${o} to ${r}`)()}return{errorAction:r,errorActionFlags:n}}_modifyErrorActionIfCurrentLevelIsLastValidiFrameLevel(e,t){let{errorAction:i,errorActionFlags:s,containsFallbackVariant:r}=this._modifyActionForSwitchingHosts(e,t);return r||(i=Rs.AbortRequest,s=0),{errorAction:i,errorActionFlags:s}}_getActionForCommonNetworkError(e){let t,i;switch(e){case 500:case 502:case 503:case 504:case 404:case 409:case 401:case 403:case 407:case-12888:case-12884:t=Rs.SendAlternateToPenaltyBox,i=Cs.MoveAllAlternatesMatchingHost;break;case 410:t=Rs.RemoveAlternatePermanently,i=Cs.MoveAllAlternatesMatchingHost;break;default:t=Rs.SendAlternateToPenaltyBox,i=0}return{errorAction:t,errorActionFlags:i}}_findAlternateHost(e,t){let i,s,r=this.hls.preferredHostName,n=e.validVariantList,a=e.getVariantInfoIfValid(t);for(let o=0;o<n.length;o++){let e=n[o],t=c.getHostName(e.url);if(r!==t&&this.hls.isValidCDN(t)&&(vs(a)&&vs(e)&&a.bandwidth===e.bandwidth||ys(a)&&ys(e)&&a.persistentID===e.persistentID)){i=e,s=t;break}}return i?{hostName:s,candidateVariantId:bs.getUniqueId(i)}:null}_modifyActionOnTimeout(e,t,i){let s=this._getMediaTypeFourCC(e),r=this.consecutiveSendAlternateToPenaltyBox.get(s),{errorAction:n,errorActionFlags:o}=t;switch(e.details){case a.d.LEVEL_LOAD_TIMEOUT:case a.d.AUDIO_TRACK_LOAD_TIMEOUT:case a.d.SUBTITLE_TRACK_LOAD_TIMEOUT:case a.d.FRAG_LOAD_TIMEOUT:!i&&++r.val>=this.hls.config.maxNumAddLevelToPenaltyBox&&(this.logger.warn("Hit max consecutive penalty due to timeout count: "+e.details)(),n=Rs.SendEndCallback)}return{errorAction:n,errorActionFlags:o}}getActionForManifestError(e){let{errorAction:t,errorActionFlags:i}=this._getActionForCommonNetworkError(e.response.code);return t=this._modifyErrorActionIfLastValidVariantInternal(t),i=0,this.logger.info("Manifest error "+t)(),{errorAction:t,errorActionFlags:i}}getActionForPlaylistNetworkError(e,t,i){var s;let r=e.response.code,n=e.details,o=this._getActionForCommonNetworkError(r);if(i)o.errorActionFlags&=~Cs.MoveAllAlternatesMatchingHost;else{let e=n===a.d.LEVEL_LOAD_ERROR||n===a.d.LEVEL_LOAD_TIMEOUT;o=this.hls.iframeMode?this._modifyErrorActionIfCurrentLevelIsLastValidiFrameLevel(o,t):this._modifyErrorActionIfCurrentLevelIsLastValidLevel(o,r,t,e)}return o=this._modifyActionOnTimeout(e,o,i),this.logger.info(`[${null===(s=e.context)||void 0===s?void 0:s.type}] Got playlist error ${r} ${e.message} ${JSON.stringify(o)}`)(),o}getActionForMediaFragNetworkError(e,t,i){var s;let r=e.response.code,n=e.frag,a=this._getActionForCommonNetworkError(r);if(i)a.errorActionFlags&=~Cs.MoveAllAlternatesMatchingHost;else if("main"===n.type&&this.hls.iframeMode)a=this._modifyErrorActionIfCurrentLevelIsLastValidiFrameLevel(a,t);else{let e="main"===n.type;a=this._modifyErrorActionIfCurrentLevelIsLastValidLevel(a,r,t,e)}return a=this._modifyActionOnTimeout(e,a,i),e.errorAction=a.errorAction,this.logger.info(`[${null===(s=e.frag)||void 0===s?void 0:s.type}] Got fragment error ${r} ${e.message} prefetch=${i} ${JSON.stringify(a)}`)(),a}getActionForCryptKeyNetworkError(e,t,i,s){let r,n=Boolean(!e.stats||e.stats.isOkToRetry),a=Boolean(e.keyErrorReason&&e.keyErrorReason===At.OutputRestricted),o=Rs.DoNothing;return o=a?Rs.RemoveAllMatchingHDCPLevelsPermanently:n?i?Rs.SendAlternateToPenaltyBox:(r=this._getActionForCommonNetworkError(e.response.code)).errorAction:Rs.RemoveAlternatePermanently,t&&!s&&(o=this._modifyErrorActionIfLastValidVariantInternal(o)),this.logger.info(`[Keys] Got crypt key error isCurrentLevel=${t} isTimeout=${i} hasFallback=${s}, errorAction ${o}`)(),{errorAction:o,errorActionFlags:0}}getActionForSessionDataNetworkError(){return Rs.DoNothing}handleError(e,t,i,s,r,n){let o,l;if((e instanceof a.k||e instanceof a.o)&&n.containsFallbackVariant()&&(l=this.handleNetworkError(Rs.SendAlternateToPenaltyBox,Cs.MoveAllAlternatesMatchingHost,e,i,void 0,r,n)),r)if(r.validVariantList&&0!==r.validVariantList.length){if(l&&!l.errorHandled)if(o=n.getNextBestAutoVariant(i),-1===n.manualLevel&&o)this.logger.warn(`level controller,${e.details}: switch to next best level for next fragment`)(),n.setNextAutoVariant(o);else if(!(e instanceof a.j)){let t=n.playTillEndOfBufferAndRetry(this.hls.media);e.retrying=t.retry,e.fatal=t.fatal}}else this.logger.error("No more variants left after error handling")(),e.fatal=!0,l.errorHandled=!0}_handleMoveMatchingHostFlag(e,t,i){t.moveAllMatchingHostsToPenaltyBoxOrRemovePermanently(e,i);let s=this._findAlternateHost(t,e),r=this.hls.preferredHostName;if(this.hls.removeCDNFromWhiteList(r),s){let{candidateVariantId:e,hostName:i}=s;return this.logger.warn(`Backup host found, switching from ${r} to ${i}`)(),this.hls.preferredHostName=i,this.hls.trigger(n.b.PREFERRED_HOST_CHANGED,{mediaType:t.getMediaType()}),e}return NaN}handleNetworkError(e,t,i,s,r,n,o){var l;let h,d=!0,c=i.details;switch(isNaN(s)&&c!==a.d.MANIFEST_LOAD_ERROR&&this.logger.warn(`invalid variantId:${s}, could be ignoring error details:${c}`)(),e){case Rs.RemoveAlternatePermanently:case Rs.SendAlternateToPenaltyBox:{if(isNaN(s))break;let i=n.getVariantInfoIfValid(s);if(!i){this.logger.warn(`handleNetworkError: ${s} not valid`)();break}let r,a=this._shouldFindAlternateHost({errorAction:e,errorActionFlags:t});!y.isCustomUrl(i.url)&&a&&(r=this._handleMoveMatchingHostFlag(s,n,e===Rs.RemoveAlternatePermanently)),isNaN(r)&&(r=o.getNextBestAutoVariant(s)),e===Rs.RemoveAlternatePermanently?n.removeLevelPermanently(s):n.addLevelToPenaltyBox(s),this.logger.info("setting nextAutoVariant to "+r)(),o.setNextAutoVariant(r),this.hls.iframeMode&&(o.manualLevel=r);break}case Rs.RemoveAllMatchingHDCPLevelsPermanently:isNaN(s)||n.removeAllMatchingHDCPLevelsPermanently(s);break;case Rs.RetryRequest:r?h=r():d=!1;break;case Rs.AbortRequest:(i instanceof a.p||i instanceof a.l)&&(null===(l=i.loader)||void 0===l||l.abort());break;case Rs.SendEndCallback:i.fatal=!0;break;case Rs.DefaultToSDR:if(!(d=o.resetAndLoadSDRLevels())){let e=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,"no valid alternates found in fallback");e.response=a.f.NoValidAlternates,this.hls.upgradeInternalErrorIfNecessary(e),d=!0}break;case Rs.DoNothing:default:d=!1}return{errorHandled:d,retryPromise:h}}_getMediaTypeFourCC(e){let t,i;switch("frag"in e?i=e.frag.type:"type"in e.context&&(i=e.context.type),i){case"level":case"main":t=pi.VIDEO;break;case"audioTrack":case"audio":t=pi.AUDIO;break;case"subtitleTrack":case"subtitle":t=pi.SUBTITLE;break;default:t=pi.UNKNOWN}return t}onFragLoaded(e){let t=this._getMediaTypeFourCC(e);this.consecutiveSendAlternateToPenaltyBox.get(t).val=0}},xs=function(e,t){let i,s,r=0,n=e.length-1;for(;r<=n;){let a=t(s=e[i=(r+n)/2|0]);if(a>0)r=i+1;else{if(!(a<0))return s;n=i-1}}return null};const Ms={isBuffered:function(e,t){if(e){let i=e.buffered;for(let e=0;i&&e<i.length;e++)if(t>=i.start(e)&&t<=i.end(e))return!0}return!1},bufferInfo:function(e,t,i){if(e){var s=this.buffered(e);return this.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,nextStart:void 0}},buffered:function(e){var t=[];if(e){var i,s=e.buffered;for(t=[],i=0;s&&i<s.length;i++)t.push({start:s.start(i),end:s.end(i)})}return t},subtitleBufferInfo:function(e,t,i){if(e){var s=this.bufferedCues(e);return this.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,nextStart:void 0}},fragmentsBufferedInfo:function(e,t,i){const s=[];for(const r of e)s.push({start:r.start,end:r.start+r.duration});return this.bufferedInfo(s,t,i)},bufferedCues:function(e){var t,i=[];if(e)for(i=[],t=0;t<e.length;t++)i.push({start:e[t].startTime,end:e[t].endTime});return i},bufferedInfo:function(e,t,i){var s,r,n,a,o,l=[];for(e.sort((function(e,t){return e.start-t.start||t.end-e.end})),o=0;o<e.length;o++){var h=l.length;if(h){var d=l[h-1].end;e[o].start-d<i?e[o].end>d&&(l[h-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,s=0,r=n=t;o<l.length;o++){var c=l[o].start,u=l[o].end;if(t+i>=c&&t<u)r=c,s=(n=u)-t;else if(t+i<c){a=c;break}}return{len:s,start:r,end:n,nextStart:a}},toRangeString:e=>`[${e.start.toFixed(3)},${e.end.toFixed(3)}]`,canContinuePlaybackWithoutGap(e,t,i,s,r){if("LIVE"!==s)return!0;if(!e||!r||!r.PTSKnown)return!1;let n=performance.now()+(r.tload-r.trequest);return r.fragments[0].start+(n-r.tload)/1e3<=Ms.bufferInfo(e,t,i).end}};var Os,Ns,Fs=Ms;!function(e){e.AlmostDryWaterLevel="AlmostDryWaterLevel",e.LowWaterLevel="LowWaterLevel",e.HighWaterLevel="HighWaterLevel"}(Os||(Os={})),function(e){e.VideoAudio="VideoAudio",e.Video="Video",e.Audio="Audio",e.Subtitle="Subtitle"}(Ns||(Ns={}));class Bs extends N{constructor(e,t,i,s,r,a,o,l){super(e,n.b.DESIRED_RATE_CHANGED),this.media=t,this.getEstimatedWaterLevel=i,this.bufferMonitorType=s,this.maxBufferHole=r,this.almostDryWaterLevelSeconds=l,this._maxBufferSeconds=a,this._targetDuration=o,this.listenerMap={seeking:this.stopBufferMonitor.bind(this),seeked:this.startBufferMonitor.bind(this)},this.addListeners()}destroy(){this.removeListeners(),this.stopBufferMonitor(),this.media=null,this.listenerMap=null,this.getEstimatedWaterLevel=null,super.destroy()}addListeners(){let e=this.media;if(e)for(let t in this.listenerMap){let i=this.listenerMap[t];e.addEventListener(t,i)}}removeListeners(){let e=this.media;if(e&&this.listenerMap)for(let t in this.listenerMap){let i=this.listenerMap[t];e.removeEventListener(t,i)}}set targetDuration(e){this._targetDuration!==e&&(this._targetDuration=e,this.startBufferMonitor())}get targetDuration(){return this._targetDuration}set maxBufferSeconds(e){this._maxBufferSeconds!==e&&(this._maxBufferSeconds=e,this.startBufferMonitor())}get maxBufferSeconds(){return this._maxBufferSeconds}notifyWaterLevelChanged(){this.startBufferMonitor()}get highWaterLevelSeconds(){return Math.max(this.maxBufferSeconds-this.targetDuration,this.lowWaterLevelSeconds)}get lowWaterLevelSeconds(){return this.targetDuration}onDesiredRateChanged(e){const t=e.oldRate,i=e.newRate;t!==i&&(0===t?this.startBufferMonitor():0===i&&this.stopBufferMonitor())}stopBufferMonitor(){clearTimeout(this.bufferChangeTimer)}startBufferMonitor(){let e=this.media;if(this.stopBufferMonitor(),!this.hls||!e||e.paused||e.seeking)return void this.logger.info("Not arming buffer monitor")();let t,i,s=e.currentTime,r=this.getEstimatedWaterLevel();if(r>this.highWaterLevelSeconds)t=this.highWaterLevelSeconds,i=Os.HighWaterLevel;else if(r>this.lowWaterLevelSeconds)t=this.lowWaterLevelSeconds,i=Os.LowWaterLevel;else{if(!(r>this.almostDryWaterLevelSeconds))return void this.logger.info(`Not arming buffer monitor buffer:${r}s @${s}`)();t=this.almostDryWaterLevelSeconds,i=Os.AlmostDryWaterLevel}let n=1e3*(r-t);this.bufferChangeTimer=setTimeout(this.checkBufferLevel.bind(this,t,i),n)}checkBufferLevel(e,t){this.media,this.getEstimatedWaterLevel()<=e&&(this.logger.info("buffer fell below "+t)(),this.hls.trigger(n.b.BUFFER_CHANGED,{reason:t,bufferType:this.bufferMonitorType})),this.startBufferMonitor()}}var Us=i(7);const Vs={getIframeStartMediaTime:function(e,t,i,s){return Vs.getIframeMediaTime(e.start+(s>1?0:e.duration),t,i,s)},getIframeEndMediaTime:function(e,t,i,s){return Vs.getIframeMediaTime(e.start+(s<0?0:e.duration),t,i,s)},getIframeMediaTime:function(e,t,i,s){return(e-i)/s+t},getIframeRealTime:function(e,t,i,s){return((e=Math.max(e,t))-t)*s+i}};var $s=Vs;const Gs={findFragmentBySNAndBuffer:function(e,t,i=0,s=0,r=0){let n;const a=e?t[e.sn-t[0].sn+1]:null;return i<s?(i>s-r&&(r=0),n=a&&!this.fragmentWithinToleranceTest(i,r,a)?a:xs(t,this.fragmentWithinToleranceTest.bind(null,i,r))):n=t[t.length-1],n},fragmentWithinToleranceTest:function(e,t,i){let s=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-s<=e?1:i.start-s>e&&i.start?-1:0},startFragmentInCC(e,t,i){let s=t-i.cc;if(0===s){let t=e[i.sn-e[0].sn-1];s=t&&t.cc===i.cc?-1:0}return s},endFragmentInCC(e,t,i){let s=t-i.cc;if(0===s){let t=e[i.sn-e[0].sn+1];s=t&&t.cc===i.cc?1:0}return s},findStartEndFragmentsInCC:function(e,t){let i,s;return e&&e.length>0&&!isNaN(t)&&(i=xs(e,Gs.startFragmentInCC.bind(null,e,t)),s=xs(e,Gs.endFragmentInCC.bind(null,e,t))),i&&isNaN(i.cc)&&(i=void 0),s&&isNaN(s.cc)&&(s=void 0),[i,s]},getTimeRangeForCC:function(e,t){let i=Gs.findStartEndFragmentsInCC(e,t),s=i[0],r=i[1],n=[];return s&&r&&(n=[s.startPTS?s.startPTS:s.start,r.endPTS?r.endPTS:r.start+r.duration]),n},snapToCCTimeRange:function(e,t,i){let s=e,r=Gs.getTimeRangeForCC(t,i);return!isNaN(r[0])&&s<r[0]&&(s=r[0]),s},_fragmentMediaTimeTest(e,t,i,s,r){let n=$s.getIframeStartMediaTime(r,t,i,s),a=s>1?1:-1;return $s.getIframeEndMediaTime(r,t,i,s)<=e?a:n>e?-1*a:0},findNextIframe:function(e,t,i,s,r,n){let a;if(e&&e.iframe){let o=i>1?1:-1,l=Math.max(0,Math.min(e.sn-n[0].sn+o,n.length-1));if(e.sn!==n[l].sn)do{if(a=n[l],$s.getIframeStartMediaTime(a,s,r,i)>=t)break;l+=o}while(l>0&&l<n.length)}else a=xs(n,this._fragmentMediaTimeTest.bind(this,t,s,r,i));return a}};var Hs=Gs;class Ks extends ps.EventEmitter{trigger(e,t){this.emit(e,e,t)}}class js{constructor(e,t){this.hls=e,this.logger=e.logger,this.id=t,this.typeSupported={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:MediaSource.isTypeSupported('audio/mp4; codecs="ac-3"'),ec3:MediaSource.isTypeSupported('audio/mp4; codecs="ec-3"')},this.onWorkerMessage=this.onWorkerMessage.bind(this),this._ensureHandlerFunc()}_setupInlineHandler(e){const t=this.observer=new Ks;t.trigger=(e,i)=>t.emit(e,e,i),t.off=(e,i)=>t.removeListener(e,i);const i=(e,t)=>this.onWorkerMessage({data:{event:e,data:t}});[n.b.FRAG_DECRYPTED,n.b.FRAG_PARSING_INIT_SEGMENT,n.b.FRAG_PARSING_DATA,n.b.FRAG_PARSED,n.b.INTERNAL_ERROR,n.b.FRAG_PARSING_METADATA,n.b.FRAG_PARSING_USERDATA,n.b.FRAG_PARSING_CAPTIONDATA,n.b.INIT_PTS_FOUND].forEach(e=>t.on(e,i));const s=this.demuxer=new e.DemuxerInline(t,this.typeSupported,this.hls.config,navigator.vendor);return s.push.bind(s)}_setupWorkerHandler(e){const{vendor:t}=navigator;let i;this.logger.info("demuxing in webworker")();try{(i=e.createDemuxerWorker()).addEventListener("message",this.onWorkerMessage),i.onerror=e=>{let t=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,e.message+" ("+e.filename+":"+e.lineno+")");t.response=a.f.InternalError,t.event="demuxerWorker",t.err={message:e.message+" ("+e.filename+":"+e.lineno+")"},this.hls.trigger(n.b.INTERNAL_ERROR,t)},i.postMessage({cmd:"init",typeSupported:this.typeSupported,vendor:t,id:this.id,config:JSON.stringify(this.hls.config),options:{streamID:this.hls.streamID,sessionID:this.hls.sessionID}}),this.worker=i}catch(e){throw i&&URL.revokeObjectURL(i.objectURL),e}return(e,t,s,r,n,a,o,l,h,d,c,u)=>{e instanceof Uint8Array&&(e=e.buffer),i.postMessage({cmd:"demux",data:e,decryptdata:t,initSegment:s,timeOffset:r,discontinuity:n,trackSwitch:a,contiguous:o,duration:l,accurateTimeOffset:h,defaultInitPTS:d,iframeMediaStart:c,iframeDuration:u},[e])}}_genHandlerFunc(){return Promise.resolve().then(i.bind(null,28)).then(e=>{if(this.hls.config.enableWorker&&"undefined"!=typeof Worker)try{return this._setupWorkerHandler(e)}catch(e){this.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline")()}return this._setupInlineHandler(e)})}_ensureHandlerFunc(){return this.handlerPromise||(this.handlerPromise=this._genHandlerFunc()),this.handlerPromise}destroy(){this.handlerPromise?this.handlerPromise.then(()=>{this._destroy()}):this._destroy()}_destroy(){this.handlerPromise=null;const{worker:e,demuxer:t,observer:i}=this;e&&(e.removeEventListener("message",this.onWorkerMessage),e.terminate(),this.worker=null),t&&(t.destroy(),this.demuxer=null),i&&(i.removeAllListeners(),this.observer=null)}push(e,t,i,s,r,n){this._ensureHandlerFunc().then(a=>{const o=void 0!==i.startDTS?i.startDTS:i.start,l=i.decryptdata,h=this.frag,d=!(h&&i.cc===h.cc),c=!(h&&i.level===h.level),u=h&&"number"==typeof h.sn&&i.sn===h.sn+1,f=!c&&u,p=void 0!==i.iframeMediaStart?i.iframeMediaStart:void 0,g=void 0!==i.iframeMediaDuration?i.iframeMediaDuration:void 0;this.frag=i,this.iframeMediaStart=p,this.accurateTimeOffset=r,a(e,l,t,o,d,c,f,s,r,n,p,g)})}isValidFragParsingData(e,t,i,s,r){let n,a;Object(Oi.c)(s)?(a=s,n=.01,isFinite(a)&&isFinite(r)&&(a+=r)):i?(a=void 0!==e.startDTS?e.startDTS:e.start,Math.abs(t.startDTS-a)>.5&&this.logger.warn(`Significant DTS drift vs playlist sn=${e.sn} startDTS=${t.startDTS} expectedDTS=${a}`)(),n=e.duration):this.logger.warn("accurateTimeOffset==false, bypass DTS check startDTS=="+t.startDTS)();const o=t.startPTS>=0&&t.startDTS>=0&&e.duration>0&&(!Object(Oi.c)(t.endPTS)||t.endPTS>=t.startPTS)&&(!Object(Oi.c)(t.endDTS)||t.endDTS>=t.startDTS)&&(void 0===a||void 0!==n&&Math.abs(t.startDTS-a)<=n);if(!o){const i=Object(Oi.c)(t.endPTS)?t.endPTS.toFixed(3):"undefined",s=Object(Oi.c)(t.endDTS)?t.endDTS.toFixed(3):"undefined",o=void 0===a?"undefined":a.toFixed(3);this.logger.error(`${t.type}: ${e.type} frag ${e.sn} failed demuxer sanity check PTS:[${t.startPTS.toFixed(3)},${i}] DTS:[${t.startDTS.toFixed(3)},${s}] expectedStartDTS=${o} dur=${e.duration.toFixed(3)} iframe=${e.iframe} fudge=${n} audioPrimingDelay=${r}`)()}return o}onWorkerMessage({data:{event:e,data:t}}){const{hls:i,id:s,frag:r}=this;let o;if(t=Object.assign(Object.assign({},t),{id:s,frag:r}),js.checkWorkerMessageType(t,e,Us.a.INIT))this.worker&&URL.revokeObjectURL(this.worker.objectURL);else{if(js.checkWorkerMessageType(t,e,n.b.FRAG_PARSING_DATA)){const{frag:i}=this;!this.isValidFragParsingData(i,t,this.accurateTimeOffset,this.iframeMediaStart,this.hls.config.audioPrimingDelay)&&isNaN(this.iframeMediaStart)&&(e=n.b.INTERNAL_ERROR,o=new a.k(a.g.MEDIA_ERROR,a.d.FRAG_PARSING_ERROR,!1,"Failed demuxer sanity check",i))}else js.checkWorkerMessageType(t,e,n.b.INTERNAL_ERROR)&&(t&&t.details===a.d.FRAG_PARSING_ERROR?o=new a.k(t.type,t.details,t.fatal,t.reason,this.frag):t&&t.details===a.d.REMUX_ALLOC_ERROR&&"bytes"in t&&(o=new a.o(t.type,t.details,t.fatal,t.reason,t.response,t.bytes,r)));i.trigger(e,o||t)}}static checkWorkerMessageType(e,t,i){return t===i}}var Ws=js;const qs={mergeDetails:function(e,t){var i,s=Math.max(e.startSN,t.startSN)-t.startSN,r=Math.min(e.endSN,t.endSN)-t.startSN,n=t.startSN-e.startSN,a=e.fragments,o=t.fragments,l=0;for(let c=s;c<=r;++c)if(a[n+c]&&o[c]){l=a[n+c].cc-o[c].cc;break}e.initSegments=e.initSegments||{},t.initSegments=t.initSegments||{};let h={};for(let c in o){let s=a[n+c],r=o[c],d=r.cc+l;t.initSegments[r.cc]&&(h[d]=t.initSegments[r.cc],h[d].cc=d,e.initSegments[d]&&(h[d].data=e.initSegments[d].data)),r.cc=d,s&&!isNaN(s.startPTS)&&(r.sn===s.sn?(r.start=r.startPTS=s.startPTS,r.endPTS=s.endPTS,r.duration=s.duration,r.backtracked=s.backtracked,r.dropped=s.dropped,i=r):f.b.warn(`mismatch in sn during merge newFrag.sn: ${r.sn} vs oldFrag.sn: ${s.sn}`)())}if(t.initSegments=h,i)qs.updateFragPTSDTS(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS);else if(n>=0&&n<a.length){var d=a[n].start;for(let e in o)o[e].start+=d}t.PTSKnown=s<=r&&Boolean(e.PTSKnown)},getExpiredFragmentsRange:function(e,t){if(e.startSN>=t.startSN)return{start:void 0,end:void 0};var i,s,r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,o=e.fragments;return n<r&&o.length>0&&!isNaN(r)&&r<o.length?(i=o[r].start,s=o[o.length-1].start+o[o.length-1].duration):a&&o.length>0&&!isNaN(r)&&!isNaN(a)&&r<o.length&&(i=o[r].start,s=o[r+a-1].start+o[r+a-1].duration),{start:i,end:s}},updateFragPTSDTS:function(e,t,i,s,r,n){if(!isNaN(t.startPTS)){let e=Math.abs(t.startPTS-i);isNaN(t.deltaPTS)?t.deltaPTS=e:t.deltaPTS=Math.max(e,t.deltaPTS),i=Math.min(i,t.startPTS),s=Math.max(s,t.endPTS),r=Math.min(r,t.startDTS),n=Math.max(n,t.endDTS)}const a=i-t.start;t.start=t.startPTS=i,t.endPTS=s,t.startDTS=r,t.endDTS=n,t.duration=s-i;const o=t.sn;if(!e||o<e.startSN||o>e.endSN)return 0;let l=o-e.startSN,h=e.fragments,d=h[l];t!==d&&(f.b.warn(`frag may be copy input:${JSON.stringify(t,["level","id","sn","cc"])} details:${JSON.stringify(d,["level","id","sn","cc"])}`)(),d.start=t.start,d.endPTS=t.endPTS,d.startPTS=t.startPTS,d.startDTS=t.startDTS,d.endDTS=t.endDTS,d.duration=t.duration,d.deltaPTS=t.deltaPTS);for(let c=l;c>0;c--)qs.updatePTS(h,c,c-1);for(let c=l;c<h.length-1;c++)qs.updatePTS(h,c,c+1);return e.PTSKnown=!0,a},updatePTS:function(e,t,i){var s=e[t],r=e[i],n=r.startPTS;isNaN(n)?r.start=i>t?s.start+s.duration:Math.max(s.start-r.duration,0):i>t?(s.duration=n-s.start,s.duration<0&&f.b.warn(`negative duration computed for frag ${s.sn},level ${s.level}, there should be some duration drift between playlist and fragment!`)()):(r.duration=s.start-n,r.duration<0&&f.b.warn(`negative duration computed for frag ${r.sn},level ${r.level}, there should be some duration drift between playlist and fragment!`)())}};var zs,Ys=qs,Xs=function(e){for(var t="",i=e.length,s=0;s<i;s++)t+="["+e.start(s).toFixed(3)+","+e.end(s).toFixed(3)+"]";return t},Qs=i(9);!function(e){e.STOPPED="STOPPED",e.IDLE="IDLE",e.KEY_LOADING="KEY_LOADING",e.FRAG_LOADING="FRAG_LOADING",e.PLAYLIST_LOADING="PLAYLIST_LOADING",e.FRAG_LOADING_WAITING_RETRY="FRAG_LOADING_WAITING_RETRY",e.PARSING="PARSING",e.PARSED="PARSED",e.BUFFER_FLUSHING="BUFFER_FLUSHING",e.BUFFER_FLUSHING_WAITING_PLAYLIST="BUFFER_FLUSHING_WAITING_PLAYLIST",e.ENDED="ENDED",e.ERROR="ERROR",e.WAITING_INIT_PTS="WAITING_INIT_PTS",e.WAITING_DISCONTINUITY="WAITING_DISCONTINUITY"}(zs||(zs={}));var Js=class extends N{constructor(e,t,...i){super(e,...i),this.hls=e,this.name=t,this.destroy$=new it,this.logger=e.logger,this.config=e.config,this._state=zs.STOPPED,this.maxBufferAheadSec=this.config&&this.config.maxBufferLength||30}destroy(){this.destroy$.next(),super.destroy()}startLoad(e){}set state(e){this.state!==e&&(this.state,this._state=e)}get state(){return this._state}get curVariantId(){return this.variantController.currentVariantId}retryFragRequest(e){let t=e.frag;var i=this.fragLoadError;i?i++:i=1;let s=this.config,r=e.details===a.d.FRAG_LOAD_ERROR?s.fragLoadPolicy.default.errorRetry:s.fragLoadPolicy.default.timeoutRetry;if(i<=r.maxNumRetry){this.fragLoadError=i,t.loadCounter=0;var n=Math.min(Math.pow(2,i-1)*r.retryDelayMs,r.maxRetryDelayMs);this.logger.warn(`${this.constructor.name}: frag loading failed, retry in ${n} ms`)(),this.retryDate=performance.now()+n,this.state=zs.FRAG_LOADING_WAITING_RETRY,e.retrying=!0}else this.logger.error(this.constructor.name+": reaches max retry, redispatch as fatal ...")(),e.fatal=!0,e.retrying=!1}_handleFragmentNetworkError(e,t){let i,s,r;e.frag&&Object(Oi.c)(e.frag.level)?(i=e.frag.level,r=this.hls.networkErrorHandler.getActionForMediaFragNetworkError(e,this.variantController,t),s=this.hls.networkErrorHandler.handleNetworkError(r.errorAction,r.errorActionFlags,e,i,this.retryFragRequest.bind(this,e),this.variantController.variantManager,this.variantController)):this.logger.warn("fragment network error could not be handled for the invalid frag or frag without variant id")(),e.fatal&&!this.hls.bufferEndPromiseWrapper?this.hls.fatalErrorRequiresAction(e)&&this.hls.bufferDryPromise.then(()=>{this.hls.upgradeInternalErrorIfNecessary(e)}).catch(e=>{this.logger.error("get an error in buffer dry promise")()}):e.fatal||this.state===zs.IDLE||this.state===zs.FRAG_LOADING_WAITING_RETRY||this.logger.error(`[${this.name}] State not IDLE after error handling ${this.state} ${i} errorAction=${null==r?void 0:r.errorAction} currentVariantId:${this.variantController.currentVariantId}`)()}handleBufferFullError(e,t,i,s,r,n){if(e.parent===t&&(this.state===zs.PARSING||this.state===zs.PARSED)){if(r){let{trackType:r}=e,n=1e3*this.targetDuration,a=Rs.RetryRequest;1e3*s.len<n&&(this.variantController.containsFallbackVariant()?a=Rs.SendAlternateToPenaltyBox:(this.logger.warn(`${t} buffer too small to sustain playback @${i}`)(),a=Rs.SendEndCallback)),this.logger.info(`${t} handleBufferFullError errorAction:${a} ${n}ms`)(),a===Rs.RetryRequest?this.hls.bufferController.scheduleAppendRetry(r,n):(this.hls.bufferController.abortPendingAppendsByParent("main",0,Number.POSITIVE_INFINITY),this.hls.networkErrorHandler.handleNetworkError(a,0,e,i,void 0,this.variantController.variantManager,this.variantController))}else this.logger.warn(t+" buffer full and not buffered. flush everything")(),n();e.fatal&&(this.state=zs.ERROR)}}logFragmentTiming(e,t){e&&this.config.enablePerformanceLogging&&this.logger.info("[timing] "+JSON.stringify({t:performance.now(),name:this.name,level:e.level,sn:e.sn,cc:e.cc,stage:t}))()}escalateInternalError(e){this.hls.upgradeInternalErrorIfNecessary(e)?(this.state=zs.ERROR,this.logger.error(`${this.constructor.name}: ${e.type}, ${e.details}, ${e.response}, switch to ${this.state} state ...`)()):(this.state=zs.IDLE,this.tick())}handleInternalError(e){return this.state===zs.ERROR||!!e.fatal&&(this.escalateInternalError(e),!0)}};const Zs=["audio","video","audiovideo"];function er(e){return Zs.includes(e)}var tr=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return pe(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var i=e.prototype._subscribe.call(this,t);return i&&!i.closed&&t.next(this._value),i},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ze;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(it);function ir(e){return!Se(e)&&e-parseFloat(e)+1>=0}function sr(e){var t=e.index,i=e.period,s=e.subscriber;if(s.next(t),!s.closed){if(-1===i)return s.complete();e.index=t+1,this.schedule(e,i)}}var rr=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new nr(e,this.notifier,this.source))},e}(),nr=function(e){function t(t,i,s){var r=e.call(this,t)||this;return r.notifier=i,r.source=s,r.errors=null,r.retries=null,r.retriesSubscription=null,r}return pe(t,e),t.prototype.error=function(t){if(!this.isStopped){var i=this.errors,s=this.retries,r=this.retriesSubscription;if(s)this.errors=null,this.retriesSubscription=null;else{i=new it;try{s=(0,this.notifier)(i)}catch(t){return e.prototype.error.call(this,t)}r=We(this,s)}this._unsubscribeAndRecycle(),this.errors=i,this.retries=s,this.retriesSubscription=r,i.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,i,s,r){var n=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=n,this.source.subscribe(this)},t}(Me),ar=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new or(e,this.callback))},e}(),or=function(e){function t(t,i){var s=e.call(this,t)||this;return s.add(new Ie(i)),s}return pe(t,e),t}(ke),lr=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new hr(e,this.total))},e}(),hr=function(e){function t(t,i){var s=e.call(this,t)||this;return s.total=i,s.count=0,s}return pe(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(ke);class dr extends Js{constructor(e,t,...i){super(e,t,n.a.FRAG_PARSING_DATA,n.a.FRAG_PARSED,n.a.BUFFER_SOURCE_RESETTING,...i),this.hls=e,this.sbid=t,this.waitingForKey=new tr(null),this.bufferController=e.bufferController}cancelCurrentLoad(){let e=this.fragCurrent;e&&this.state===zs.FRAG_LOADING&&(e.loader&&e.loader.abort(),this.fragCurrent=null,this.state=zs.IDLE)}clearPendingData(){this.pendingParsedData&&(this.pendingParsedData.frag.loadCounter=0,this.pendingParsedData=null)}ensurePendingDataForSeek(e,t){if(this.state===zs.WAITING_DISCONTINUITY&&this.pendingParsedData){const i=this.pendingParsedData.frag;(t===i.cc&&e<i.start-this.config.discontinuitySeekTolerance||e>i.start+i.duration)&&(this.logger.info(`[${this.sbid}] clearing pending data, seekToPos: ${e}, frag: ${i.fragTag}, range: ${i.rangeString}`)(),this.clearPendingData(),this.state=zs.IDLE)}}pushPendingData(){const e=!!this.pendingParsedData;if(e){const e=this.pendingParsedData,t=e.frag;this.fragCurrent=t,this.state=zs.PARSING,this.appended=!1,this.stats.cached=!0,this.clearPendingData(),this.handleFragParsingData(e,!0),this.state===zs.PARSING&&(this.state=zs.PARSED,this.nextLoadPosition=t.start+t.duration,this.logger.info(`[${t.type}] re-parse pendingParsedData from cached frag data ${t.fragTag} range: ${t.rangeString}, nextLoadPosition: ${this.nextLoadPosition}`)())}return e}ensureInitSegmentForFragInfo(e,t,i){this.bufferController.sourceBufferHasProperInitSegment(this.sbid,e)||this.doCreateSbAndAppendInitSegment(e,t,i)}doCreateSbAndAppendInitSegment(e,t,i){const{codec:s,container:r,type:n}=t,{cc:a,level:o}=e;if("yes"===this.bufferController.isCompatibleTransition(a)){this.bufferController.createBuffer(this.sbid,n,a,s,r,i);const l=t.initSegment;if(this.logger.info(`[${this.sbid}] doCreateSbAndAppend track:${t.type}, container:${t.container}, codecs[level/parsed]=[${i}/${t.codec}]`)(),l){this.appended=!0,this.pendingBuffering=!0;let i={level:o,sn:"initSegment",cc:a,decryptdata:{keyId:e.decryptdata?e.decryptdata.keyId:null}};this.logFragmentTiming(e,"appending"),this.bufferController.appendBuffer(t.type,l,NaN,NaN,this.sbid,"initSegment",i),this.logFragmentTiming(e,"parsed")}}}setWaitingDiscontinuity(e){this.clearPendingData(),this.pendingParsedData=e,this.state=zs.WAITING_DISCONTINUITY}onBufferSourceResetting(){this.onMediaDetachingInternal(!1)}onFragParsingData(e){const t=this.fragCurrent,i=e.frag;t&&e.id===this.sbid&&i.sn===t.sn&&i.level===t.level&&(this.handleFragParsingData(e,!1),this.tick())}onFragParsed(e){const t=this.fragCurrent,i=e.frag;t&&e.id===this.sbid&&i.sn===t.sn&&i.level===t.level&&this.state===zs.PARSING&&(this.logFragmentTiming(t,"parsed"),this.stats.tparsed=performance.now(),this.state=zs.PARSED,(this.hls.isLive||this.hls.config.gapless)&&i.decryptdata&&i.decryptdata.isEncrypted&&this.hls.keyLoader.updateExpiryPosition(i.decryptdata,i.level,i.start),this.checkAppendedParsed()),this.tick()}fetchKey(e){let t=e.decryptdata;return t.uri!==this.waitingForKey.value&&this.waitingForKey.next(t.uri),this.hls.keyLoader.getKeyFromDecryptData(e.decryptdata,e.level,!1).pipe((s=e=>e.pipe(_t((e,t)=>e instanceof a.n&&this._handleKeyError(e,this.variantController.currentVariantId)?function(e,t,i){void 0===e&&(e=0);var s=-1;return ir(void 0)?s=Number(void 0)<1?1:Number(void 0):ct(void 0)&&(i=void 0),ct(i)||(i=wt),new Ke((function(t){var r=ir(e)?e:+e-i.now();return i.schedule(sr,r,{index:0,period:s,subscriber:t})}))}(this.config.keyLoadingRetryDelay*Math.min(t+1,5)):rt(e))),function(e){return e.lift(new rr(s,e))}),Lt(3e4),_t(()=>(this.state===zs.KEY_LOADING&&(this.state=zs.IDLE,this.tick()),pt(!0))),qe((i,s)=>{if(this.logger.warn(`[${this.name}] got key error state=${this.state}`)(),i instanceof a.n);else if(i instanceof dt){let i=this.hls.keyLoader.getLevelIdsForKey(t),s=i.has(this.variantController.currentVariantId)&&!this.variantController.containsFallbackVariant(),r=new a.n(a.g.NETWORK_ERROR,a.d.KEY_LOAD_TIMEOUT,s,"Key load timed out",a.f.CryptResponseReceivedSlowly,e.decryptdata,{isOkToRetry:!s},i);this._handleKeyError(r,this.variantController.currentVariantId)}else this.logger.warn("Unhandled error "+i.message)();return pt(!1)}),(i=()=>{this.waitingForKey.next(null)},function(e){return e.lift(new ar(i))}),Xe(this.waitingForKey.pipe((function(e){return e.lift(new lr(1))}))),Xe(this.destroy$));var i,s}_handleKeyError(e,t){let i=new Array,s=!1;e.levelIds.forEach((function(e){e===t?s=!0:i.push(e)})),s?i.push(t):this.logger.warn(`Other levels got key error keyuri=${this.hls.redactUrl(e.decryptdata.uri)} levelIds=${JSON.stringify(i)}`)();let r=this.variantController.variantManager,n=!1;return i.forEach(i=>{let s=i===t,o=this.variantController.containsFallbackVariant(),{errorAction:l,errorActionFlags:h}=this.hls.networkErrorHandler.getActionForCryptKeyNetworkError(e,s,e.details===a.d.KEY_LOAD_TIMEOUT,o);n=n||s&&l===Rs.RetryRequest,this.hls.networkErrorHandler.handleNetworkError(l,h,e,i,void 0,r,this.variantController)}),r.validVariantList&&0!==r.validVariantList.length||(this.logger.warn(this.name+" no valid levels left")(),e.fatal=!0),e.fatal?(this.escalateInternalError(e),n=!1):n||(this.resetNextLoadPositionState(),this.state===zs.KEY_LOADING&&(this.state=zs.IDLE)),n}handleInternalError(e){return!!super.handleInternalError(e)||e instanceof a.n&&(this._handleKeyError(e,this.curVariantId),!0)}}var cr=class extends dr{constructor(e){super(e,"main",n.b.MEDIA_ATTACHING,n.b.MEDIA_DETACHING,n.b.MANIFEST_LOADING,n.b.LEVEL_LOADED,n.b.FRAG_LOAD_EMERGENCY_ABORTED,n.b.FRAG_PARSING_INIT_SEGMENT,n.b.INTERNAL_ERROR,n.b.AUDIO_TRACK_SWITCHING,n.b.AUDIO_TRACK_SWITCHED,n.b.BUFFER_CREATED,n.b.BUFFER_APPENDED,n.b.BUFFER_FLUSHED,n.b.BUFFER_SOURCE_RESET,n.b.LEVELS_CHANGED,n.b.BANDWIDTH_CHANGED,n.b.BUFFER_CHANGED,n.b.STALLED),this.gaplessAllowed=!0,this.config=e.config,this._state=zs.STOPPED,this.ontick=this.doTick.bind(this),this.firstPlaybackStarted=!1,this.pendingPlayPromises=[],this.startTargetDurationFactor=this.config&&this.config.startTargetDurationFactor?this.config.startTargetDurationFactor:1,this.config.audioStreamController&&(this.audioStreamController=new this.config.audioStreamController(e,this.tick)),this.config.subtitleStreamController&&(this.subtitleStreamController=new this.config.subtitleStreamController(e,this.tick))}destroy(){this.stopLoad(),this.tickInterval&&(clearInterval(this.tickInterval),this.tickInterval=null),this.clearTickImmediate(),this.clearReadyForNextItem(),this.state=zs.STOPPED,super.destroy()}get loadingItemStartTime(){return this.hls.loadingItem.startTime}get playingItemStartTime(){return this.hls.playingItem.startTime}get targetDuration(){return this.bufferMonitor&&this.bufferMonitor.targetDuration}get highWaterLevel(){return this.bufferMonitor&&this.bufferMonitor.highWaterLevelSeconds}get levels(){return this.hls.levels}startLoad(e){var t;if(this.logger.info(`startLoad(${e})`)(),this.levels&&this.levels.length>0){let t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.tickInterval||(this.tickInterval=setInterval(this.ontick,100)),!this.config.useFirstLevelAtIncompatDiscontinuity||this.iframeMode||this.pendingParsedData||(this.levelId=-1),this.fragLoadError=0,!this.startFragRequested){let e=i.startLevel;-1===e&&(e=this.hls.levelController.firstLevel,this.bitrateTest=!0),(!this.levelId||this.levelId<0)&&(this.levelId=i.nextLoadLevel=e),this.loadedmetadata=!1}t>0&&-1===e&&(e=t),this.state=zs.IDLE,this.hls.isPreloadingItem||this.seek(e),this.tick()}else this.forceStartLoad=!0,this.state=zs.STOPPED;this.iframeEOS=!1,this.autoPausedRestartTime=void 0,null===(t=this.subtitleStreamController)||void 0===t||t.startLoad()}stopLoad(){var e,t;this.state!==zs.STOPPED&&(this.cancelCurrentLoad(),this.fragPrevious=null,this._destroyDemuxer(),this.state=zs.STOPPED,this.forceStartLoad=!1,null===(e=this.audioStreamController)||void 0===e||e.stopLoad(),null===(t=this.subtitleStreamController)||void 0===t||t.stopLoad())}signalReadyForNextItem(e){this.nextItemImmediate||(this.nextItemImmediate=Object(Qs.setImmediate)(this.readyForNextItem.bind(this,e)))}clearReadyForNextItem(){Object(Qs.clearImmediate)(this.nextItemImmediate),this.nextItemImmediate=null}readyForNextItem(e){this.clearReadyForNextItem(),this.altAudio=!1,this.logger.info(`[gapless] item fully appended @ ${e}; media.duration ${this.media.duration}s`)(),this.hls.trigger(n.b.READY_FOR_NEXT_ITEM,{duration:e})}tick(){this.tickImmediate||(this.tickImmediate=Object(Qs.setImmediate)(this.doTick.bind(this)))}clearTickImmediate(){Object(Qs.clearImmediate)(this.tickImmediate),this.tickImmediate=null}doTick(){var e,t;switch(this.clearTickImmediate(),this.state){case zs.BUFFER_FLUSHING:this.fragLoadError=0;break;case zs.IDLE:this.hls.bufferController.evictItemCompleted()&&this._doTickIdle();break;case zs.PLAYLIST_LOADING:if(!this.hls.playlistLoader.isLoadingLevel(this.levelId)){var i=this.hls.levelWithPersistentId(this.levelId).levelInfo;i&&i.details&&(this.state=zs.IDLE)}break;case zs.FRAG_LOADING_WAITING_RETRY:var s=performance.now(),r=this.retryDate;(!r||s>=r||this.media&&this.media.seeking)&&(this.state=zs.IDLE);break;case zs.WAITING_DISCONTINUITY:this.checkDiscontinuityState(!1);break;case zs.PARSED:this._ensureAudioStartLoad(this.fragCurrent);break;case zs.ERROR:case zs.STOPPED:case zs.FRAG_LOADING:case zs.KEY_LOADING:case zs.PARSING:case zs.BUFFER_FLUSHING_WAITING_PLAYLIST:case zs.ENDED:}this._checkIfLoadedMetadata(),this._checkIfPlaybackLikelyToKeepUp(),this.immediateSwitchCanEnd&&this.immediateLevelSwitchEnd(),this._checkFragmentChanged(),this._loadSessionDataIfNecessary(),null===(e=this.audioStreamController)||void 0===e||e.doTick(),null===(t=this.subtitleStreamController)||void 0===t||t.doTick()}checkDiscontinuityState(e){var t,i;if(this.state!==zs.WAITING_DISCONTINUITY)return;const s=this.pendingParsedData.frag,r=s.cc;if("yes"===this.bufferController.isCompatibleTransition(r))return this.logger.error("[main] no longer waiting for compatibility update, going back to IDLE state, cc: "+r)(),void(this.state=zs.IDLE);if(this.altAudio&&this.audioStreamController.state!==zs.WAITING_DISCONTINUITY)return;let n;const a=this._getPlaybackPos();if(this.media.seeking){if(this.logger.info(`[main] checkDiscontinuityState seeking, seekToPos: ${a}, pendingFrag: ${s.fragTag}, range: ${s.rangeString}`)(),a>=s.start-this.config.discontinuitySeekTolerance&&a<=s.start+s.duration){const e=this.calculateStartTime();this.logger.info(`[main] seeking into disco seekToPos: ${a}, resetting to latest frag start ${e}`)(),n=e}}else if(e){const e=this.calculateStartTime(),t=e+s.duration,i=this.targetDuration;e<t&&Math.abs(e-a)<i&&(n=e)}return!!Object(Oi.c)(n)&&(this.logger.info(`[QE Critical] [main] checkDiscontinuityState *** resetting source buffer *** cc: ${r}, seekToPos: ${n}, stalled: ${e}, seeking: ${null===(t=this.media)||void 0===t?void 0:t.seeking}, currentTime: ${null===(i=this.media)||void 0===i?void 0:i.currentTime}, playbackPos: ${a}`)(),this.resetMediaSource({seekToPos:n,cc:r},!0),!0)}calculateStartTime(){var e,t,i,s;const r=null!==(i=null===(t=null===(e=this.audioStreamController)||void 0===e?void 0:e.pendingDataInfo)||void 0===t?void 0:t.startPTS)&&void 0!==i?i:-1,n=null===(s=this.pendingParsedData)||void 0===s?void 0:s.startPTS;return this.logger.info(`[main] calculateStartTime: audioStartPTS: ${-1===r?"no alt":r}, mainStartPTS: ${n}`)(),Math.max(r,n)}_doTickIdle(){const e=this.hls,t=e.config,i=this.media;if(this.pushPendingData())return;if(void 0!==this.levelLastLoaded&&!i&&(this.startFragRequested||!t.startFragPrefetch))return;if(this.hls.isLive&&0===this.desiredRate)return;let s;if(s=this.loadedmetadata?i.currentTime:this.nextLoadPosition,Object(Oi.c)(this.needsResetForCC)){const e=this.needsResetForCC;return this.needsResetForCC=null,void this.resetMediaSource({seekToPos:s,cc:e},!0)}const r=this.getSourceBufferInfo(s);let{len:n,end:a}=r;if(n>this.highWaterLevel)return void this._prefetchIframes(s,a);let o=!this.levelAtSwitch||this.iframeMode?e.nextLoadLevel:this.levelAtSwitch,l=this.hls.levelWithPersistentId(o).levelInfo;if(!l)return;this.levelId=e.nextLoadLevel=o;const h=l.details;if(h&&(this.bufferMonitor.targetDuration=h.targetduration),e.playlistLoader.isLoadingLevel(o)&&this.state===zs.BUFFER_FLUSHING)return void(this.state=zs.BUFFER_FLUSHING_WAITING_PLAYLIST);if(e.playlistLoader.isLoadingLevel(o))return void(this.state=zs.PLAYLIST_LOADING);let d=this.fragPrevious;if(!h.live&&d&&d.isLastFragment&&!l.iframes){const e=Math.min(i.duration,d.start+d.duration);let t=this.playingItemStartTime,n=0===r.len&&s!==e;if(e-Math.max(r.end,d.start)<=Math.max(.2,d.duration)&&!n)return this.logger.info(`check ending: ${JSON.stringify(r)} = this.getSourceBufferInfo(${s}); playingItemStartTime ${t}`)(),this.logger.info(`check ending: fragPrevious.sn ${d.sn} ${d.startPTS} ${d.isLastFragment}`)(),this.logger.info(`check ending: ${e-Math.max(r.end,d.start)} = ${e} - Math.max(${r.end}, ${d.start}) <= Math.max(0.2, ${d.duration})`)(),void(this.hls.config.gapless&&this.gaplessAllowed?this.hls.playingItem.itemId!==this.hls.loadingItem.itemId?this.logger.info(`[gapless] delay readyForNextItem because item ${this.hls.playingItem.itemId} is still playing and item ${this.hls.loadingItem.itemId} hasn't started`)():this.signalReadyForNextItem(r.end):(this.logger.info("video: item fully appended")(),this.hls.bufferController.endBuffer(this.altAudio?"video":void 0),this.state=zs.ENDED))}this._flushingBuffer&&!this.iframeMode&&(a=this._startOffsetOfBufferFlush,n=void 0),this._fetchPayloadOrEos(s,a,n,h)}_prefetchIframes(e,t){if(!1===this.config.enableIFramePreloading)return;let i=this.hls.levelController.preloadiFrameLevelPlaylists();if(!i)return;let s=this.hls.levelController.getLevelWithPersistentId(i).levelInfo;if(!s||!s.iframes)return void this.logger.warn("Non-iframe level was preloaded ${iFrameLevel} ${iFrameLevelInfo?.iframes}")();let r=s.details;if(r&&this.fragPrevious){let s=this.fragPrevious.cc;r.initSegments[s]&&!r.initSegments[s].data&&(this._loadFragmentOrKey(r.initSegments[s],r,e,t),this.hls.keyLoader.getKeyFromDecryptData(r.initSegments[s].decryptdata,i).pipe(Xe(this.destroy$)).subscribe())}}getSourceBufferInfo(e,t=this.config.maxBufferHole){return Ms.bufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,e,t)}_getVideoAudioSourceBufferInfo(){let e;return e=this.loadedmetadata?this._getPlaybackPos():this.nextLoadPosition,Ms.bufferInfo(this.media?this.media:this.mediaBuffer,e,this.config.maxBufferHole)}combinedBufferEmpty(){let e=this._getVideoAudioSourceBufferInfo().len<this.config.almostDryBufferSec,t=e;if(this.subtitleStreamController.isSubtitleTrackEnabled()){let i=this.subtitleStreamController.estimateCurrentWaterLevel()<this.config.almostDryBufferSec;t=e||i}return t}estimateCurrentWaterLevel(){return this._getVideoAudioSourceBufferInfo().len}_getPlaybackPos(){return Object(Oi.c)(this.seekToPos)?this.seekToPos:this.media.currentTime}resetNextLoadPositionState(){this.loadedmetadata||(this.nextLoadPosition,this.seekToPos,this.logger.info("_resetNextLoadPositionState")(),this.seek(this.seekToPos),this.startFragRequested=!1)}_fetchPayloadOrEos(e,t,i,s){var r;const n=this.fragPrevious,a=s.fragments,o=a.length;if(0===o)return;let l,h=a[0].start,d=a[o-1].start+a[o-1].duration;if(s.live){let e=this.config.initialLiveManifestSize;if(o<e)return void this.logger.warn(`Can not start playback of a level, reason: not enough fragments ${o} < ${e}`)();if(null===(l=this._ensureFragmentAtLivePoint(s,t,h,d,n,a,o)))return}else t<h&&(l=a[0]);let c=this.hls.levelWithPersistentId(this.levelId).levelInfo;if(!l)if(c.iframes&&this.iframeMode){const e=this.iframeReferenceClockTime,o=this.media.currentTime,h=this.desiredRate,d=i<2?this.hls.config.initialIframeFPS:this.hls.config.desiredIframeFPS,c=this.hls.config.leftMediaTimeToAutoPause;let u=this.media.seekable,f=u.start(0),p=u.end(u.length-1);if(h>1&&p-e<c)return this.logger.info(`[iframes] near the end of media, resuming normal playback, bufferLen: ${i}, maxTime ${p}, ifrct ${e}`)(),this.autoPausedRestartTime=p-c,this.hls.setRate(0),void this.tick();if(h<0&&e-f<h/-2)return this.logger.info(`[iframes] near the start of media, pausing playback at ${this.autoPausedRestartTime} left, bufferLen: ${i}, minTime ${f}, ifrct ${e}`)(),this.autoPausedRestartTime=f,this.hls.setRate(1),void this.tick();if(this.iframeEOS)return;let g=n&&n.iframe&&Object(Oi.c)(this.iframeBaseTime)?n:void 0;if(this.logger.info(`[iframes] prev sn: ${n?n.sn:"N/A"}, level: ${n?n.level:"N/A"}, cc: ${n?n.cc:"N/A"}, iframe: ${n?n.iframe:"N/A"}, mt: ${o.toFixed(3)}, ifrct: ${e.toFixed(3)}, ifrate: ${h}, iffps: ${d}, buffered: ${this.bufferedRangeString}, bufferLen: ${i.toFixed(3)}, seeking: ${this.media.seeking}, readyState: ${this.media.readyState}`)(),isNaN(this.iframeMediaAnchorTime)){this._resetIframeFragments(),this.iframeEOS=!1;let t=Hs.findNextIframe(void 0,e,h,e,e,a);if(!t)return this.logger.info(`[iframes] no anchorFrag for time ${e}, setting iframeEOS`)(),void(this.iframeEOS=!0);let i=Hs.getTimeRangeForCC(a,t.cc),s=Math.abs(h);const n=2;if(h>1&&(i[1]-e)/s<n)return void this.logger.info(`[iframes] FF too close to end of ccRange: ${i[0].toFixed(3)}-${i[1].toFixed(3)}, at ifrct: ${e.toFixed(3)}, wait to anchor`)();if(h<0&&(e-i[0])/s<n)return void this.logger.info(`[iframes] RW too close to start of ccRange: ${i[0].toFixed(3)}-${i[1].toFixed(3)}, at ifrct: ${e.toFixed(3)}, wait to anchor`)();let o;this.ccRange=i,this.iframeBaseTime=e;let l="N/A";if(h>1)o=this.iframeBaseTime;else{let e=this.audioStreamController?this.audioStreamController.getAudioTimeRangeForCC(t.cc):void 0;e.length?(o=Math.max(e[0],i[0]),l=e?`${e[0].toFixed(3)}-${e[1].toFixed(3)}`:"N/A"):o=i[0]+this.config.maxBufferHole}if(this.iframeMediaAnchorTime=Math.ceil(o),this.logger.info(`[iframes] setting initial ifbt: ${e.toFixed(3)}, startCCTime: ${o.toFixed(3)}, ccRange: ${i[0].toFixed(3)}-${i[1].toFixed(3)}, audioCCRange: ${l}, for cc: ${t.cc}`)(),"no"===this.bufferController.isCompatibleTransition(t.cc)){const e={seekToPos:this.iframeMediaAnchorTime,cc:t.cc};return this.logger.info("[iframes] resetting source buffer for incompatible cc")(),this.fragPrevious=void 0,this.iframeMediaAnchorTime=void 0,void this.resetMediaSource(e,!0)}return null===(r=this.audioStreamController)||void 0===r||r.startLoadAtTargetTime({cc:t.cc,seekToPos:this.iframeMediaAnchorTime}),this.immediateLevelSwitch(!0),void this.seek(this.iframeMediaAnchorTime)}if(this.ccRange&&(this.ccRange[0]>e||this.ccRange[1]<e))return this.logger.info(`[iframes] ifrct: ${e.toFixed(3)} is outside of ccRange: ${this.ccRange[0].toFixed(3)}-${this.ccRange[1].toFixed(3)}, clearing iframeMediaAnchorTime`)(),this.fragPrevious=void 0,this.iframeMediaAnchorTime=void 0,void(this.altAudio&&this.audioStreamController&&this.audioStreamController.flushAudioBuffer(0,Number.POSITIVE_INFINITY));if(!this.media.seeking){const e=Math.abs(h)/4;this.maxIframeRealTime=$s.getIframeRealTime(t,this.iframeMediaAnchorTime,this.iframeBaseTime,this.desiredRate);let i=this.iframeLagTime;i>e&&(i=h>1?i:-1*i,this.iframeMediaAnchorTime=t,this.iframeBaseTime=this._getBoundedTime(this.maxIframeRealTime+i),this.logger.info(`[iframes] catch-up mode, max_ifrt ${this.maxIframeRealTime.toFixed(3)}, diff from reference: ${i.toFixed(3)}, new ifmat: ${this.iframeMediaAnchorTime.toFixed(3)}, new ifbt: ${this.iframeBaseTime.toFixed(3)}`)())}const m=this.iframeMediaAnchorTime,y=this.iframeBaseTime,v=1/d;if(this.logger.info(`[QE Critical] [iframes] picked frag params maxMediaTime: ${t}, ifmat: ${m}, ifbt: ${y}`)(),(l=Hs.findNextIframe(g,t,h,m,y,a))&&n&&l.cc!==n.cc)return;l?s.initSegments[l.cc]&&!s.initSegments[l.cc].data?(l=s.initSegments[l.cc],this.logger.info("[iframes] loading init segment")()):(this.scaledFragments||(this.scaledFragments=[]),s.live&&(this.ccRange=Hs.getTimeRangeForCC(a,l.cc)),l.iframeMediaStart=t,l.iframeMediaDuration=Math.max(l.duration/Math.abs(h),v),this.logger.info(`[iframes] picked frag sn: ${l.sn}, level: ${l.level}, cc: ${l.cc}, range: ${l.rangeString}, iframeMediaStart ${l.iframeMediaStart.toFixed(3)}, iframeMediaDuration: ${l.iframeMediaDuration.toFixed(3)}, ifmat: ${m.toFixed(3)}, ifbt: ${y.toFixed(3)}`)(),this.scaledFragments.push(l)):g?(this.logger.error("[iframes] no more frags, but we should have found an end fragment, so set iframeEOS")(),this.iframeEOS=!0):(this.logger.error("[iframes] no initial iframe frag, so go back to rate 1")(),this.hls.setRate(1))}else l=this._findFragment(n,a,t,d,s);if(l){l.decryptdata&&l.decryptdata.isEncrypted&&this.fetchKey(l).subscribe();let i=s.initSegments[l.cc];i&&!i.data&&(l=i);const r=this.bufferController.isCompatibleTransition(l.cc),a="no"!==r,o=!a&&!this.pendingParsedData;let h="initSegment"===l.sn||a||o;n&&n.cc!==l.cc&&("no"===r&&this.pendingParsedData?this.logger.error(`[${this.sbid}} why are we back in idle you crazy controller? not compatible, already have cached frag ${l.fragTag}`)():h&&this.logger.info(`[${this.sbid}] loading into discontuity, frag ${l.fragTag}, isCompatible: ${r}, need to cache: ${o}, loadedmetadata: ${this.loadedmetadata}`)()),h&&(this.levelAtSwitch&&!this.iframeMode&&(this.levelAtSwitch=void 0),this._loadFragmentOrKey(l,s,e,t))}}_loadSessionDataIfNecessary(){let e=this.media;if(!this.sessionDataLoading&&e&&e.readyState>=e.HAVE_ENOUGH_DATA&&this.playbackLikelyToKeepUp){let e=this.hls.sessionData;if(!e||e&&!e.itemList)return;this.hls.trigger(n.b.SESSION_DATA_LOADING,{sessionData:e}),this.sessionDataLoading=!0}}get waitingForIncompatibleCC(){return this.state===zs.WAITING_DISCONTINUITY}resetMediaSource(e,t=!1){this.startFragRequested=!1,this.needsResetForCC=void 0,this._bufferedFrags=[],this.tstalled=void 0,this.nudgeRetry=0,this.onMediaDetachingInternal(!1),this.bufferResetResumeLoadInfo=e;const{cc:i,seekToPos:s}=e;this.logger.error(`[main] resetting media source for cc ${i}, seekToPos ${s}`)(),this.hls.bufferController.resetMediaSource(t),this.hls.timelineController&&this.hls.timelineController.resetTracks()}setNeedsResetForCC(e){var t;this.cancelCurrentLoad(),null===(t=this.audioStreamController)||void 0===t||t.cancelCurrentLoad(),this.needsResetForCC=e}_ensureFragmentAtLivePoint(e,t,i,s,r,n,a){const o=this.hls.config,l=this.media;let h,d=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-o.maxFragLookUpTolerance,s-d)){let s=this.liveSyncPosition=this.computeLivePosition(i,e);t=s,l&&l.readyState&&l.duration>s&&(this.logger.info("adjust currentTime to liveSyncPosition")(),l.currentTime=s)}if(e.PTSKnown&&t>s&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(r){var c=r.sn+1;c>=e.startSN&&c<=e.endSN&&(h=n[c-e.startSN])}h||(h=n[Math.min(a-1,Math.round(a/2))])}return h}_findFragment(e,t,i,s,r){const n=this.hls.config;let a,o,l=n.maxFragLookUpTolerance;if((o=Hs.findFragmentBySNAndBuffer(e,t,i,s,l))&&"initSegment"!==o.sn){const i=o.sn-r.startSN,s=e&&o.level===e.level,l=t[i-1],h=t[i+1];if(a=o,e&&a.sn===e.sn)if(s&&!a.backtracked)if(a.sn<r.endSN){let t=e.deltaPTS;t&&t>n.maxBufferHole&&e.dropped&&i?(a=l,this.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")(),e.loadCounter--):a=h}else a=null;else a.backtracked&&(h&&h.backtracked?(this.logger.warn(`Already backtracked from fragment ${h.sn}, will not backtrack to fragment ${a.sn}. Loading fragment ${h.sn}`)(),a=h):(this.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe")(),a.dropped=0,l?(l.loadCounter&&l.loadCounter--,(a=l).backtracked=!0):a=null))}return a}_ensureDemuxer(){this.demuxer||(this.demuxer=new Ws(this.hls,"main"))}_destroyDemuxer(){Object(Qs.clearImmediate)(this.demuxImmediate),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null)}_loadFragmentOrKey(e,t,i,s){const r=this.hls,o=r.config;if(this.logger.info(`${e.type} loading ${e.fragTag} of [${t.startSN},${t.endSN}], iframe:${t.iframesOnly} range: ${e.rangeString}, currentTime: ${this.media.currentTime}, pos:${i?i.toFixed(3):"undefined"}, bufferEnd:${s?s.toFixed(3):"undefined"}, loadCount:${e.loadCounter} URL ${this.hls.redactUrl(e.relurl)} `)(),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;let t=o.fragLoadingLoopThreshold;if(e.loadCounter>t&&Math.abs(this.fragLoadIdx-e.loadIdx)<t){let t=new a.j(a.g.MEDIA_ERROR,a.d.FRAG_LOOP_LOADING_ERROR,!1,"Frag has already been loaded more than 3 times",a.f.CorruptStream,e);return t.iframe=e.iframe,void r.trigger(n.b.INTERNAL_ERROR,t)}}else e.loadCounter=1;e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,"initSegment"!==e.sn&&(e.iframe?this.nextLoadPosition=e.iframeMediaStart+e.iframeMediaDuration:this.nextLoadPosition=e.start+e.duration),e.autoLevel=r.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.logFragmentTiming(e,"loading"),r.fragmentLoader.loadFragment(e).then(function(t){this.logFragmentTiming(e,"loaded"),this._processLoadedFrag(t)}.bind(this)).catch(function(e){this._handleFragmentError(e)}.bind(this)),this.demuxImmediate=Object(Qs.setImmediate)(this._ensureDemuxer.bind(this)),this.state=zs.FRAG_LOADING}set state(e){const t=this.state;super.state=e,this.hls.trigger(n.b.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}get state(){return super.state}getBufferedFrag(e){return xs(this._bufferedFrags,(function(t){let i=t.iframe?t.iframeMediaStart:t.startPTS,s=t.iframe?t.iframeMediaStart+t.iframeMediaDuration:t.endPTS;return e<i?-1:e>s?1:0}))}get currentLevel(){let e=this.media;if(e){const t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}get nextBufferedFrag(){let e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}followingBufferedFrag(e){return e?this.getBufferedFrag(e.endPTS+.5):null}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}_checkFragmentChanged(){var e,t,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((t=i.currentTime)>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),Ms.isBuffered(i,t)?e=this.getBufferedFrag(t):Ms.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var s=e;if(s!==this.fragPlaying){this.hls.trigger(n.b.FRAG_CHANGED,{frag:s});const e=s.level;(!this.fragPlaying||this.fragPlaying.level!==e||this.hls.inGaplessMode&&this.fragPlaying.itemId!==s.itemId)&&this.hls.trigger(n.b.LEVEL_SWITCHED,{level:e}),this.fragPlaying=s}}}_resetIframeFragments(){if(!this.scaledFragments)return;let e=this.scaledFragments;for(let t=0;t<e.length;t++){let i=e[t];i.loadCounter=0,Object(Oi.c)(i.iframeMediaStart)&&(i.iframeMediaStart=void 0,i.iframeMediaDuration=void 0)}this.scaledFragments=void 0}get seeking(){return Object(Oi.c)(this.seekToPos)||this.media&&this.media.seeking}adjustSeekPosition(e){let t=this.media,i=Ms.bufferInfo(t,e,0),s=e;if(0===i.len){let t=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(s=this._ensureNudgeStartTimeForIncompatibleCC(i.nextStart,e,t,this.state))&&this.logger.warn(`adjusted seek for incompatible cc nudge ${e}->${s}`)()}else Object(Oi.c)(i.nextStart)&&i.nextStart-e<this.config.maxBufferHole&&(this.logger.warn(`close to small buffer hole, adjusted seek ${e}->${i.nextStart}`)(),s=i.nextStart);if(!Object(Oi.c)(s)){const t=this.ccForTime(e),i=this.getMinTimeForCC(t);e<i&&(s=i,this.logger.warn(`adjusted seek for jagged cc start ${e}->${s}`)())}return s}seek(e,t=!0){var i,s;if(isNaN(e))return;if(e<0)return void(this.seekToPos=void 0);if(this.media&&t){let t=this.adjustSeekPosition(e);Math.abs(e-t)>=Number.EPSILON&&(e=t)}let r=isNaN(this.seekToPos)||Math.abs(e-this.seekToPos)>=Number.EPSILON;if(this.nextLoadPosition=this.lastCurrentTime=this.seekToPos=e,this.playbackLikelyToKeepUp=!1,this.media){if(r){if(null===(i=this.audioStreamController)||void 0===i?void 0:i.hasInitialSeekToPos){const t=this.ccForTime(e);this.logger.info(`[main] audioStreamController issuing seek to: ${e}, cc: ${t}`)(),null===(s=this.audioStreamController)||void 0===s||s.startLoadAtTargetTime({cc:t,seekToPos:e})}this.iframeMode||(this.logger.info(`startSeek(${e})`)(),this.hls.trigger(n.b.SEEKING))}this.media.paused||this._mediaPause(),t&&e>=0&&this.loadedmetadata&&this.media.currentTime!==e&&!this._flushingBuffer&&(this.logger.info("adjust currentTime seekToPos="+e)(),this.iframeModeSeek=this.iframeMode,this.mediaSeekFn?this.mediaSeekFn(e):this.media.currentTime=e)}}completeSeek(){!Object(Oi.c)(this.seekToPos)||this.media.seeking||this._flushingBuffer||(this.logger.info(`completeSeek(${this.seekToPos}) currentTime=${this.media.currentTime}`)(),this.seekToPos=void 0,this.iframeModeSeek||this.hls.trigger(n.b.SEEKED),this.iframeModeSeek=!1)}set playbackLikelyToKeepUp(e){this._playbackLikelyToKeepUp!==e&&(this._playbackLikelyToKeepUp=e,this.hls.trigger(n.b.PLAYER_STATE_CHANGE,{playbackLikelyToKeepUp:e}))}get playbackLikelyToKeepUp(){return Boolean(this._playbackLikelyToKeepUp)}get _avgBufferAppendMs(){return!this._numAppends||this._numAppends<2?400:this._totalBufferAppendMs/this._numAppends}updateAppendBufferAvg(e){(isNaN(this._numAppends)||isNaN(this._totalBufferAppendMs))&&(this._numAppends=0,this._totalBufferAppendMs=0),this._totalBufferAppendMs+=e,++this._numAppends}get _avgParseBw(){return this._totalParseSec?this._totalParsedBits/this._totalParseSec:0}updateParseBwAvg(e,t){this._totalParseSec||(this._totalParsedBits=0,this._totalParseSec=0),this._totalParsedBits+=8*e,this._totalParseSec+=t/1e3}_likelyToAppendFragInTime(e,t,i,s){let r=t.len,n=this.mediaBuffer?this.getSourceBufferInfo(e):t,a=!1,o=1/0;if(n.len>=s)o=0;else if(this.fragCurrent&&Math.abs(this.fragCurrent.start-n.end)<=this.hls.config.maxBufferHole){let e=this._avgBufferAppendMs/1e3;if(this.fragCurrent.loader){let e=this.fragCurrent.loader.stats,t=i.realBitrate?Math.max(i.realBitrate,i.bitrate):i.bitrate,s=e.total?8*e.total:Math.ceil(this.fragCurrent.duration*t),r=8*e.loaded,n=s-r,a=r/(performance.now()-e.tfirst)*1e3;o=n/(a?Math.min(this.hls.abrController.getBandwidthEstimate(),a):this.hls.abrController.getBandwidthEstimate())}else if(this.state===zs.PARSING){let e=(performance.now()-this.stats.tload)/1e3,t=8*this.stats.total/this._avgParseBw;o=Math.max(0,t-e)}else this.state===zs.PARSED&&this.pendingBuffering&&(o=0);o+=e}return(a=o<=r)&&!this.playbackLikelyToKeepUp&&this.logger.info(`[main] Probably haveEnough bufferLen=${r} nextFragAppendedDur=${o.toFixed(3)}`)(),a}_checkIfPlaybackLikelyToKeepUp(){var e;if(!this.media||!this.loadedmetadata)return void(this.playbackLikelyToKeepUp=!1);let t=this.levelId,i=this.hls.levelWithPersistentId(t).levelInfo,s=i?i.details:void 0;if(!i||!s)return;let r=Object(Oi.c)(this.seekToPos)?this.seekToPos:this.media.currentTime,n=Ms.bufferInfo(this.media,r,this.hls.config.maxBufferHole),a=n.len;if(a<=0)return void(this.playbackLikelyToKeepUp=!1);let o=Math.min(s.targetduration,15);this.fragPrevious&&(o=Math.min(this.fragPrevious.duration,o));let l=Math.max(1,o*this.startTargetDurationFactor),h=this.iframeMode||a>=o||a>=l,d=s.fragments[s.fragments.length-1],c=s.fragments[0].start+s.totalduration,u="yes"!==this.bufferController.isCompatibleTransition(null===(e=this.fragCurrent)||void 0===e?void 0:e.cc)||this.fragCurrent&&this.fragPrevious&&this.fragCurrent.cc!==this.fragPrevious.cc;h&&s.live?h=r<=c-d.duration:s.live||(h=h||r>=c-o),h=h||u||this._likelyToAppendFragInTime(r,n,i,o),this.media&&!this.media.ended&&this.media.paused&&h&&0!==this.desiredRate&&!this._flushingBuffer&&(this.logger.info(`[main] haveEnough desiredRate=${this.desiredRate} bufferLen=${a} discontinuity=${u}`)(),this._mediaPlay()),h?this.completeSeek():this.media.controls&&this.seeking&&!this.media.paused&&(this.logger.warn("Seeking but not enough buffer !media.paused bufferLen="+a)(),this._mediaPause()),this.playbackLikelyToKeepUp=h&&this.media&&this.media.readyState>=this.media.HAVE_ENOUGH_DATA}_mediaPlay(){if(this.media){if(this.playPromise||this._flushingBuffer)return void this.logger.warn(`Ignoring play command playPromise/flushing ${Boolean(this.playPromise)}/${this._flushingBuffer}`)();this._expectPlayEvent=this._expectPlayEvent||this.media.paused,this.logger.info("play() expectPlayEvent="+this._expectPlayEvent)(),this.playPromise=this.media.originalPlay(),this.playPromise&&this.playPromise.then(function(){this.playPromise=null,this._handlePendingPlayPromises()}.bind(this)).catch(function(e){this.playPromise=null,this._expectPlayEvent=!1,this._handlePendingPlayPromises(e||new Error("Play rejected for unknown reason")),"NotAllowedError"===e.name?(this.logger.warn("play() not allowed, going back to rate 0")(),this.hls.desiredRate=0):this.logger.error(e.message)()}.bind(this))}}_handlePendingPlayPromises(e){let t=this.pendingPlayPromises,i=t.length;if(e)for(let s=0;s<i;s++)t[s].reject(e);else for(let s=0;s<i;s++)t[s].resolve();this.pendingPlayPromises=[]}_mediaPauseInternal(){this._expectPauseEvent=this._expectPauseEvent||!this.media.paused,this.logger.info("pause() expectPauseEvent="+this._expectPauseEvent)(),this.media.originalPause()}_mediaPause(){this.media&&(this.logger.info("pause() playPromise="+Boolean(this.playPromise))(),this.playPromise?this.playPromise.then(()=>{(0===this.desiredRate||this.seeking&&!this.playbackLikelyToKeepUp)&&this._mediaPauseInternal()}):this._mediaPauseInternal())}_getBoundedTime(e){return isNaN(this.lastMediaDuration)?Math.max(0,e):Math.min(this.lastMediaDuration,Math.max(0,e))}_getIframeReferenceClockTime(e){let t=(e-this.iframeReferenceClockStart)*this.desiredRate/1e3+this.iframeReferenceClockMediaTimeBase;return this._getBoundedTime(t)}get iframeReferenceClockTime(){return this._getIframeReferenceClockTime(performance.now())}get iframeLagTime(){return isNaN(this.maxIframeRealTime)?0:this.desiredRate>1?Math.max(0,this.iframeReferenceClockTime-this.maxIframeRealTime):this.desiredRate<0?Math.max(0,this.maxIframeRealTime-this.iframeReferenceClockTime):void 0}get realCurrentTime(){return this.iframeMode?this.iframeReferenceClockTime:Object(Oi.c)(this.seekToPos)?this.hls.isPreloadingItem?this.seekToPos-this.playingItemStartTime:this.seekToPos:this.media?this.hls.isPreloadingItem?this.media.currentTime-this.playingItemStartTime:this.media.currentTime:void this.logger.info("invalid realCurrentTime")()}set realCurrentTime(e){let t=this.hls.isPreloadingItem?this.playingItemStartTime:0;this.logger.info("[gapless] set realCurrentTime = "+(e+t))(),this.media.currentTime=e+t}get iframeMode(){return this.isIframeRate(this.desiredRate)}get effectiveRate(){return this.media?this.iframeMode?this.desiredRate:this.media.paused?0:1:0}isIframeRate(e){return 0!==e&&1!==e}get canContinuePlaybackWithoutGap(){let e=this.hls.nextLoadLevel,t=this.hls.levelWithPersistentId(e).levelInfo,i=t?t.details:void 0;return Ms.canContinuePlaybackWithoutGap(this.mediaBuffer||this.media,this.media.currentTime,this.config.maxBufferHole,this.hls.playlistType,i)&&(!this.altAudio||!this.audioStreamController||this.audioStreamController.canContinuePlaybackWithoutGap)}get desiredRate(){return void 0!==this._desiredRate?this._desiredRate:0}set desiredRate(e){if(!this.media)return;const t=this.desiredRate,i=this.isIframeRate(e),s=this.isIframeRate(this.desiredRate);if(!i&&!s||t===e)return this.logger.info(`Ordinary rate change ${t} -> ${e}`)(),this._desiredRate=e,this.hls.isLive&&t!==e&&(0===e?(this.hls.levelController.stopLoad(),this.altAudio&&this.hls.audioTrackController&&this.hls.audioTrackController.stopLoad()):this.canContinuePlaybackWithoutGap||(this._mediaPause(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY),this.pendingExpiredLiveBufferRange=null,this.altAudio&&this.audioStreamController&&this.audioStreamController.flushAudioBuffer(0,Number.POSITIVE_INFINITY),this.hls.levelController.cleanupLevels())),0!==e||this.media.paused?1===e&&this.media.paused&&this._checkIfPlaybackLikelyToKeepUp():this._mediaPause(),void(t!==e&&this.hls.trigger(n.b.DESIRED_RATE_CHANGED,{oldRate:t,newRate:e}));const r=performance.now(),a=this.realCurrentTime,o=this.media.currentTime;let l,h,d;if(s&&(h=this._getIframeReferenceClockTime(r),d=this.getSourceBufferInfo(this.iframeMediaAnchorTime).end,l=this.getBufferedFrag(Math.min(o,d)-.001)),this._resetIframeFragments(),this.iframeEOS=!1,this.iframeMediaAnchorTime=void 0,this.iframeBaseTime=void 0,this.iframeRateSetTime=r,this.fragPrevious=void 0,this._desiredRate=e,this.logger.info(`[iframes] rate change ${t} -> ${e}, rct: ${a.toFixed(3)}, mt: ${o.toFixed(3)}, ifrct: ${s?h.toFixed(3):"N/A"}`)(),i){let t=this.media.seekable.end(this.media.seekable.length-1);if(e>1&&t-o<this.hls.config.leftMediaTimeToAutoPause)return void this.logger.info("[iframes] not setting FF iframe rate, too close to end of media")();let i=!s;if(this.iframeReferenceClockStart=r,this.iframeReferenceClockMediaTimeBase=a,i){this.iframeSwitchTime=performance.now();let e=this.hls.levelWithPersistentId(this.levelId).levelInfo;e&&!e.iframes?this.levelAtSwitch=this.levelId:this.logger.warn(`currentLevel is in penalty or an i-frame level ${this.levelId} levelAtSwitch:${this.levelAtSwitch}`)(),isNaN(this.levelAtSwitch)&&(this.levelAtSwitch=this.hls.startLevel),this.muteValueAtSwitch=this.hls.media.muted,this.hls.media.muted=!0,this.iframesInSourceBuffer=void 0,this.hls.abrController.nextAutoLevel=-1;let t=this.hls.levelController.nextLoadLevel,i=this.hls.levelWithPersistentId(t).levelInfo,s=i&&i.width&&i.height?`${i.width}x${i.height}`:"N/A";this.hls.loadLevel=t,this.logger.info(`[QE Critical] [iframes] entering iframe mode, levelAtSwitch: ${this.levelAtSwitch}, iframeLevel: ${t}, resolution: ${s}, bandwidth: ${i?i.bandwidth:"undefined levelInfo"}`)()}else this.logger.info("[iframes] staying in iframe mode with rate switch")();this.immediateLevelSwitch(!0)}else if(s){let e,t=this.levelAtSwitch;this.logger.info(`[QE Critical]  [iframes] leaving iframe mode, iframeReferenceClockTime: ${h.toFixed(3)}, buffered: ${this.bufferedRangeString}, bufferEnd: ${d}, currentFrag: ${l?l.rangeString:"N/A"}, resume level: ${t}`)(),void 0!==this.autoPausedRestartTime?(this.logger.info("[iframes] setting resumePosition to autoPausedRestartTime: "+this.autoPausedRestartTime.toFixed(3))(),e=this.autoPausedRestartTime,this.autoPausedRestartTime=void 0):(this.logger.info("[iframes] setting resumePosition to iframeReferenceClockTime: "+h.toFixed(3))(),e=h),t=this.variantController.getTrickPlayResumeLevel(this.levelAtSwitch),this.logger.info(`[iframes] level before/during/after trickplay : ${this.levelAtSwitch}/${this.variantController.level}/${t}`)(),this.hls.media.muted=this.muteValueAtSwitch,this.hls.loadLevel=-1,this.hls.nextAutoLevel=t,this.levelAtSwitch=t,this.iframeSwitchTime=performance.now(),this.immediateLevelSwitch(!0),this.seek(e),this.hls.media.muted=this.muteValueAtSwitch}this.hls.trigger(n.b.DESIRED_RATE_CHANGED,{oldRate:t,newRate:e}),this.tick()}immediateLevelSwitch(e=!1){let t=this.media;this.immediateSwitch||(this.immediateSwitch=!0,t&&this._mediaPause());var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.pendingParsedData=void 0,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY,e),this.relaxHighBufferStallRule=0,this.immediateSwitchCanEnd=!0}immediateLevelSwitchEnd(){let e=this.media;if(!e||!this.loadedmetadata||!this.immediateSwitchCanEnd)return;let t=e&&e.buffered.length,i=performance.now()-this.iframeSwitchTime,s=!e.seeking||i>=this.config.iframeMaxExitSeekDuration;t&&s&&this.state!==zs.BUFFER_FLUSHING&&(this.immediateSwitchCanEnd=!1,this.iframeSwitchTime=void 0,void 0!==this.iframeRateSetTime&&(this.logger.info(`[iframes] level switch to ${this.levelId} for (${this.desiredRate}x) playback, spentTime = ${performance.now()-this.iframeRateSetTime}`)(),this.iframeRateSetTime=void 0),this.relaxHighBufferStallRule=this.config.iframeStallMaxRetry,this.immediateSwitch=!1,Object(Oi.c)(this.seekToPos)||Ms.isBuffered(e,e.currentTime)&&(e.currentTime=Math.max(0,e.currentTime-1e-4),this.logger.info(`immediateLevelSwitchEnd nudged currentTime to ${e.currentTime} seekable ${JSON.stringify(this.media.seekable)} readyState ${this.media.readyState}`)()))}nextLevelSwitch(){let e=this.media;if(e&&e.readyState){let n,a,o;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,(a=this.getBufferedFrag(e.currentTime))&&a.startPTS>1&&this.flushMainBuffer(0,a.startPTS-1),e.paused)n=0;else{var t=this.hls.nextLoadLevel,i=this.hls.levelWithPersistentId(t).levelInfo,s=this.fragLastKbps;n=s&&this.fragCurrent?this.fragCurrent.duration*i.bitrate/(1e3*s)+1:0}if((o=this.getBufferedFrag(e.currentTime+n))&&(o=this.followingBufferedFrag(o))){var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(o.startPTS,Number.POSITIVE_INFINITY)}}}attemptSafeNextLevelSwitch(){if(!1===this.hls.config.allowFastSwitchUp||this.hls.iframeMode)return;let e=this.media;if(e&&e.readyState&&this.hls.abrController.isSafeToFlushExcessBuffer()){let i,s;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,i=this.hls.abrController.getSafeBufferFlushPosition()+this.hls.config.maxStarvationDelay,s=this.getBufferedFrag(e.currentTime+i)){let e=this.followingBufferedFrag(s);if(e){var t=this.fragCurrent;t&&t.loader&&t.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(e.startPTS,Number.POSITIVE_INFINITY),this.hls.isLive&&(this.fragPrevious=s,this.preserveFragPrevious=!0)}}}}flushMainBuffer(e,t,i=!1,s,r){this.state=zs.BUFFER_FLUSHING,this._flushingBuffer=!0,this._startOffsetOfBufferFlush=e,this.hls.bufferController.flushBufferRange(e,t,this.altAudio?"video":void 0,i,s,r)}installMediaFunctions(e){if(e&&e.play&&e.pause){let t,i;t=e.originalPlay?e.originalPlay:e.originalPlay=e.play.bind(e),i=e.originalPause?e.originalPause:e.originalPause=e.pause.bind(e),e.play=function(){let e=this.media;return e&&e.paused&&!e.seeking&&e.duration&&e.currentTime&&e.currentTime>=e.duration-this.hls.config.maxTotalDurationTolerance&&(this.fragPrevious=void 0,this.seek(0)),this.hls.desiredRate=1,e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2?Promise.resolve():new Promise((e,t)=>{this.pendingPlayPromises.push({resolve:e,reject:t})})}.bind(this),e.pause=function(){this.hls.desiredRate=0}.bind(this),"function"==typeof HTMLMediaElement&&(Object.defineProperty(e,"currentTime",{enumerable:!0,configurable:!0,get:function(){return Object.getPrototypeOf(this),Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime").get.call(this)},set:this.seek.bind(this)}),this.mediaSeekFn=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime").set.bind(e)),this.config.overridePlaybackRate&&Object.defineProperty(e,"playbackRate",{enumerable:!0,configurable:!0,get:function(){return 1},set:function(e){Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"playbackRate").set.call(this,e)}})}}uninstallMediaFunctions(){let e=this.media;e&&(e.originalPlay&&(e.play=e.originalPlay,delete e.originalPlay),e.originalPause&&(e.pause=e.originalPause,delete e.originalPause),this.mediaSeekFn&&(delete e.currentTime,this.mediaSeekFn=null),this.config.overridePlaybackRate&&(e.playbackRate=1,delete e.playbackRate))}onMediaAttaching(e){let t=this.hls,i=-1;if(this.levels&&this.levels.length>0)if(t.pendingSeekToDate)i=t.resolvePendingSeekToDate(),t.pendingSeekToDate=void 0;else{let e=this.config;e.autoStartLoad&&(i=e.startPosition)}this.playPromise=null,this._expectPauseEvent=this._expectPlayEvent=!1,this._attachMedia(e.media,i)}_attachMedia(e,t=NaN){let i=this.hls;this.media=this.mediaBuffer=e,this.mediaEventListeners={seeking:this.onMediaSeeking.bind(this),seeked:this.onMediaSeeked.bind(this),ended:this.onMediaEnded.bind(this),playing:this.onMediaPlaying.bind(this),play:this.onMediaPlay.bind(this),pause:this.onMediaPause.bind(this),durationchange:this.onMediaDurationChange.bind(this),timeupdate:this.onMediaTimeUpdate.bind(this)};for(let s in this.mediaEventListeners)e.addEventListener(s,this.mediaEventListeners[s]);void 0===this._desiredRate&&(this._desiredRate=e.autoplay?1:e.paused?0:1,this.logger.info("Setting desiredRate based on media state "+this._desiredRate)()),e.autoplay&&this._mediaPause(),this.bufferMonitor&&this.bufferMonitor.destroy(),this.bufferMonitor=new Bs(this.hls,this.media,()=>this.estimateCurrentWaterLevel(),Ns.VideoAudio,this.config.maxBufferHole,this.maxBufferAheadSec,this.config.defaultTargetDuration,this.config.almostDryBufferSec),this.stallMonitor&&this.stallMonitor.destroy(),this.stallMonitor=new class extends N{constructor(e,t,i,s,r,a){super(e,n.b.BUFFER_APPENDED,n.b.DESIRED_RATE_CHANGED),this.media=t,this.lowBufferThreshold=i,this.lowBufferWatchdogPeriod=s,this.highBufferWatchdogPeriod=r,this.seekWatchdogPeriod=a,this.listenerMap={seeking:this.onseeking.bind(this),seeked:this.onseeked.bind(this),timeupdate:this.ontimeupdate.bind(this),ended:this.onended.bind(this),playing:this.onplaying.bind(this)},this.seekOrWaitingForPlay=t.seeking||t.paused||t.readyState<t.HAVE_FUTURE_DATA,this.addListeners()}destroy(){this.removeListeners(),this.stop(),this.media=null,this.listenerMap=null,super.destroy()}addListeners(){let e=this.media;if(e)for(let t in this.listenerMap){let i=this.listenerMap[t];e.addEventListener(t,i)}}removeListeners(){let e=this.media;if(e&&this.listenerMap)for(let t in this.listenerMap){let i=this.listenerMap[t];e.removeEventListener(t,i)}}set lastCurrentTime(e){this.tlastCurrentTime=performance.now(),this._lastCurrentTime=e,this.start()}get lastCurrentTime(){return this._lastCurrentTime}ontimeupdate(){if(!this.media)return;let e=this.media.currentTime;e<this.lastCurrentTime&&!this.media.seeking&&this.logger.warn(`[stall] timeupdate went backward but not seeking ${e} ${this.lastCurrentTime}`)(),this.lastCurrentTime!==e&&(this.lastCurrentTime=e)}onseeking(){let e=!this.seekOrWaitingForPlay||Math.abs(this.media.currentTime-this.lastCurrentTime)>=Number.EPSILON;this.seekOrWaitingForPlay=!0,this.updateSeekWatchdogStart(e),e?this.lastCurrentTime=this.media.currentTime:this.start()}onseeked(){this.updateSeekWatchdogStart(!0),this.lastCurrentTime=this.media.currentTime}onplaying(){this.seekOrWaitingForPlay=!1,this.tseekWatchdogStart=void 0,this.lastCurrentTime=this.media.currentTime}onended(){this.stop()}onDesiredRateChanged(e){const t=e.oldRate,i=e.newRate;t!==i&&(0===t?(this.updateSeekWatchdogStart(!0),this.lastCurrentTime=this.media.currentTime):0===i&&this.stop())}onBufferAppended(){this.updateSeekWatchdogStart(),this.start()}onBufferFlushed(){this.start()}updateSeekWatchdogStart(e=!1){let t=this.media;(e||!isFinite(this.tseekWatchdogStart))&&this.seekOrWaitingForPlay&&t&&Fs.isBuffered(t,t.currentTime)&&(this.tseekWatchdogStart=performance.now())}stop(){this.stallMonitorTimer&&(clearTimeout(this.stallMonitorTimer),this.stallMonitorTimer=null)}get tstalled(){return this.seekOrWaitingForPlay?this.tseekWatchdogStart:this.tlastCurrentTime}start(){let e=this.media,t=e.currentTime;if(this.stop(),!e||0===this.hls.desiredRate||e.ended||0===e.buffered.length||e.seeking&&!Fs.isBuffered(e,t)||void 0===this.tlastCurrentTime||t!==this.lastCurrentTime)return;let i,s=performance.now(),r=this.tstalled;if(i=this.seekOrWaitingForPlay?this.seekWatchdogPeriod:Fs.bufferInfo(e,t,0).len<=this.lowBufferThreshold?this.lowBufferWatchdogPeriod:this.highBufferWatchdogPeriod,!isFinite(r))return;let n=Math.max(100,1e3*i-(s-r));this.stallMonitorTimer=setTimeout(this.checkForStall.bind(this),n)}checkForStall(){let e,t=performance.now(),i=this.media,s=i.currentTime;if(s===this.lastCurrentTime){let r=this.tstalled,n=t-r,a=Fs.bufferInfo(i,s,0),o=a.len<=this.lowBufferThreshold,l=this.seekOrWaitingForPlay?Us.b.Seek:o?Us.b.LowBuffer:Us.b.HighBuffer;(l===Us.b.Seek&&n>=1e3*this.seekWatchdogPeriod||l===Us.b.HighBuffer&&n>=1e3*this.highBufferWatchdogPeriod||l===Us.b.LowBuffer&&n>=1e3*this.lowBufferWatchdogPeriod)&&(e={type:l,isLowBufferStall:o,bufferInfo:a,tstalled:r,stallDurationMs:n})}e?(this.logger.warn(`stall detected ${Math.round(e.stallDurationMs)}ms type:${e.type}`)(),this.hls.trigger(n.b.STALLED,e)):this.start()}}(this.hls,this.media,.5,this.hls.config.lowBufferWatchdogPeriod,this.hls.config.highBufferWatchdogPeriod,this.hls.config.seekWatchdogPeriod),Object(Oi.c)(t)&&i.startLoad(t)}onMediaDetaching(){this.onMediaDetachingInternal(!0)}onMediaDetachingInternal(e){var t=this.media;t&&t.ended&&this.seek(0);var i=this.levels;if(i&&i.length>0&&i.forEach(e=>{e.details&&e.details.fragments.forEach(e=>{e.loadCounter=void 0,e.backtracked=void 0})}),t){for(let e in this.mediaEventListeners)t.removeEventListener(e,this.mediaEventListeners[e]);this.mediaEventListeners={}}e&&(this._handlePendingPlayPromises(new Error("Media was detached")),this.pendingPlayPromises=[]),this.playPromise=null,this._expectPauseEvent=this._expectPlayEvent=!1,this.media=this.mediaBuffer=null,this.bufferMonitor&&(this.bufferMonitor.destroy(),this.bufferMonitor=null),this.stallMonitor&&(this.stallMonitor.destroy(),this.stallMonitor=null),this.loadedmetadata=!1,this.stopLoad()}onMediaDurationChange(){let e=this.media;e?this.lastMediaDuration=e.duration:this.logger.warn("Listening to media.durationchanged but this.media == null")()}onBufferSourceReset(e){const{cc:t,seekToPos:i}=this.bufferResetResumeLoadInfo;this.logger.info(`[QE Critical] Buffer source fully reset, starting load at seekToPos: ${i}, cc: ${t}`)(),this._attachMedia(e.media,i)}evictLoadingItem(e,t){let i=this.hls.loadingItem;this.flushMainBuffer(e,Number.POSITIVE_INFINITY,!0,{duration:e},e=>{this.hls.bufferController.updateDurationAfterEvictItem(e.duration),this.hls.trigger(n.b.ITEM_EVICTED,{url:i.url,evictedItemId:i.itemId,reason:t})})}dequeueSource(e=a.m.ApplicationInitiated){let t=this.playingItemStartTime,i=this.loadingItemStartTime;if(Object(Oi.c)(i)&&Object(Oi.c)(t)&&i>t){this.logger.info(`[gapless] dequeue preloaded url '${this.hls.loadingItem.url}' from ${i}s; playingItemStartTime ${t}`)();let s=this.media.currentTime;this.hls.stopLoad(),this.evictLoadingItem(i,e),this.hls.reloadSource(s)}}endSource(){this.logger.info("[gapless] end source")(),this.gaplessAllowed=!1,this.hls.bufferController.endBuffer(this.altAudio?"video":void 0),this.state=zs.ENDED}shouldReloadLameDuck(e,t){if(!this.hls.config.gapless||this.hls.loadingItem===this.hls.playingItem)return!1;let i=this.loadingItemStartTime,s=0===e.len&&i&&i>t,r=e.len>0&&e.end<i;return s?this.logger.info(`[gapless] seek to unbuffered time range @ ${t}. bufferInfo ${JSON.stringify(e)} next item start time ${i}`)():r&&this.logger.info(`[gapless] seek to buffered time range @ ${t} but there are unloaded fragments after ${e.end}s. bufferInfo ${JSON.stringify(e)} next item start time ${i}`)(),s||r}onMediaSeeking(){const e=this.media,t=this.config,i=e?e.currentTime:void 0,s=this.ccForTime(i);if(!e)return void this.logger.warn("Listening to media.onseeking but this.media == null")();if(this.iframeModeSeek&&!this.iframeMode&&Object(Oi.c)(this.seekToPos))return void this.logger.info("received seeking event for wrong mode type, don't overwrite existing seekToPos")();Object(Oi.c)(i)&&this.logger.info("media seeking to "+i.toFixed(3))();let r=this.loadingItemStartTime,o=this.playingItemStartTime,l=this.getSourceBufferInfo(i);if(i<o&&l.end<o){this.logger.info(`[gapless] seeked out of playable range ${i} ${o}`)(),this.state=zs.ERROR;let e=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,"seeked out of playable range");this.hls.trigger(n.b.ERROR,e)}else{if(this.shouldReloadLameDuck(l,i))return this.logger.info(`[gapless] seek back to unfinished playing item ${i}; loadingItemStartTime ${r} playingItemStartTime ${o}`)(),this.hls.stopLoad(),this.evictLoadingItem(r,a.m.SeekToUnbufferedTimeRanges),void this.hls.reloadSource(i);if(this.state===zs.FRAG_LOADING){let e=this.fragCurrent;if(0===l.len&&e){let r=t.maxFragLookUpTolerance,n=e.start-r,a=e.start+e.duration+r;this.iframeModeSeek&&(n=e.iframeMediaStart-r,a=e.iframeMediaStart+e.iframeMediaDuration+r),(e.cc!==s||i<n||i>a)&&(e.loader&&e.loader.abort(),this.fragCurrent=null,this.fragPrevious=null,this.state=zs.IDLE)}}else if(this.state===zs.ENDED)0===l.len&&(this.fragPrevious=void 0),this.state=zs.IDLE;else if(this.state===zs.WAITING_DISCONTINUITY){if(this.pendingParsedData){const e=this.pendingParsedData.frag.cc;this.logger.info(`[main] seeking while waiting for discontinuity pending, seekToCC: ${s}, pendingCC: ${e}`)(),this.ensurePendingDataForSeek(i,s)}}else!this.iframeMode&&this.appended&&(this.state===zs.PARSING||this.state===zs.PARSED)&&this.fragCurrent&&(i<this.fragCurrent.startPTS||i>this.fragCurrent.endPTS)&&(this.hls.bufferController.abortPendingAppendsByParent("main",0,Number.POSITIVE_INFINITY),this.hls.bufferController.hasPendingAppends("main")||(this.appended=!1,this.pendingBuffering=!1,this.state=zs.IDLE));this.state!==zs.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*t.fragLoadingLoopThreshold),this.seek(i,!1),this.tick()}}onMediaSeeked(){const e=this.media,t=e?e.currentTime:void 0;Object(Oi.c)(t)&&this.logger.info("[QE Critical]  media seeked to "+t.toFixed(3))(),Math.abs(t-this.seekToPos)>=Number.EPSILON&&this.logger.warn(`currentTime ${t} doesn't match last seekToPos ${this.seekToPos}`)(),this._checkIfPlaybackLikelyToKeepUp(),this.tick()}onMediaEnded(){}onMediaPlaying(){this.firstPlaybackStarted||(this.firstPlaybackStarted=!0),this._checkIfPlaybackLikelyToKeepUp()}onMediaPlay(){this._expectPlayEvent||(this.logger.warn("Unexpected play event received seeking="+this.seeking)(),this.media.controls&&!this.seeking&&(this.logger.info("Assumed play came from controls, setting rate 1")(),this.hls.setRate(1))),this._expectPlayEvent=!1}onMediaPause(){this._expectPauseEvent||(this.logger.warn("Unexpected pause event received seeking="+this.seeking)(),this.media.controls&&!this.seeking&&(this.logger.info("Assumed pause came from controls, setting rate 0")(),this.hls.setRate(0))),this._expectPauseEvent=!1}resetLoadSource(){this.fragCurrent=null,this.fragPrevious=null,this.altAudio=!1,this._destroyDemuxer(),this.onManifestLoading()}onManifestLoading(){this.hls.isPreloadingItem||this.hls.bufferController.resetBuffer(),this._bufferedFrags=[],this.tstalled=void 0,this.hls.isPreloadingItem||this.seek(0),this.clearPendingData(),this.gaplessAllowed=!0,this.startFragRequested=!1}startItemLoad(e,t,i,s){var r=e.some(e=>e.audioCodecList&&e.audioCodecList.some(e=>-1!==e.indexOf("mp4a.40.2")));let n=e.some(e=>e.audioCodecList&&e.audioCodecList.some(e=>-1!==e.indexOf("mp4a.40.5")));this.shouldOverrideCodec=r&&n,this.shouldOverrideCodec&&this.logger.warn("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")();let a=this.config;(a.autoStartLoad||this.forceStartLoad)&&(isNaN(s)&&(this.hls.pendingSeekToDate&&t?(s=this.hls.resolvePendingSeekToDate(),this.hls.pendingSeekToDate=void 0):s=a.startPosition),this.hls.startLoad(s))}_mergeLiveExpiredBufferRange(e,t){if(!e.start&&!e.end&&!this.pendingExpiredLiveBufferRange)return e;var i={start:void 0,end:void 0};if(this.pendingExpiredLiveBufferRange){var s=e.start?Math.min(this.pendingExpiredLiveBufferRange.start,e.start):this.pendingExpiredLiveBufferRange.start,r=e.end?Math.max(this.pendingExpiredLiveBufferRange.end,e.end):this.pendingExpiredLiveBufferRange.end;t>this.pendingExpiredLiveBufferRange.end&&t>e.end?(i={start:s,end:r},this.pendingExpiredLiveBufferRange=void 0):t<=this.pendingExpiredLiveBufferRange.end&&t<=e.end?this.pendingExpiredLiveBufferRange={start:s,end:r}:(i=this.pendingExpiredLiveBufferRange,this.pendingExpiredLiveBufferRange=e)}else t>e.end?i=e:this.pendingExpiredLiveBufferRange=e;return i}onLevelLoaded(e){var t=e.details,i=e.level,s=this.hls.levelWithPersistentId(i).levelInfo,r=t.totalduration,a=0;if(!(e.livePlaylistUpdateError||this.hls.isLive&&0===this.desiredRate)&&this.media){if(this.levelLastLoaded=i,t.live){var o=s.details;if(o&&t.fragments.length>0){let e=Ys.getExpiredFragmentsRange(o,t);if(Ys.mergeDetails(o,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,o),t.PTSKnown,this.config.liveFlushExpiredFrags){var l=this._mergeLiveExpiredBufferRange(e,this.media.currentTime);l.start&&l.end&&this.flushMainBuffer(l.start,l.end)}}else t.PTSKnown=!1}else t.PTSKnown=!1;if(s.details=t,this.hls.trigger(n.b.LEVEL_UPDATED,{details:t,level:i}),!1===this.startFragRequested&&!this.hls.isPreloadingItem&&(void 0===this.seekToPos||-1===this.seekToPos||-1===this.lastCurrentTime||t.live&&0===this.seekToPos)){let e,i=t.startTimeOffset;this.hls.pendingSeekToDate&&(i=this.hls.resolvePendingSeekToDate(),this.hls.pendingSeekToDate=void 0),Object(Oi.c)(i)?(i<0&&(i=a+r+i),e=i):e=t.live?this.computeLivePosition(a,t):0,this.seek(e)}this.state===zs.PLAYLIST_LOADING?this.state=zs.IDLE:this.state===zs.BUFFER_FLUSHING_WAITING_PLAYLIST&&(this.state=zs.BUFFER_FLUSHING),this.tick()}}_processLoadedFrag(e){var t=this.fragCurrent,i=e.frag;if(this.state===zs.FRAG_LOADING&&t&&"main"===i.type&&i.level===t.level&&i.sn===t.sn){let s=e.stats,r=this.hls.levelWithPersistentId(t.level).levelInfo;if(!r)return void(this.state=zs.IDLE);let a=r.details;if(this.logger.info(`[QE Critical]  ${t.type} Loaded  ${t.sn} of [${a.startSN},${a.endSN}], level: ${t.level}, cc: ${t.cc}, start: ${t.start} URL ${this.hls.redactUrl(t.relurl)}, bytesLoaded: ${s.loaded}, fragLoadMs: ${s.tload-s.trequest}`)(),this.bitrateTest=!1,this.stats=s,!0===i.bitrateTest&&this.hls.nextLoadLevel)this.state=zs.IDLE,this.startFragRequested=!1,s.tparsed=s.tbuffered=performance.now(),this.hls.trigger(n.b.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else if("initSegment"===i.sn)this.state=zs.IDLE,s.tparsed=s.tbuffered=performance.now(),a.initSegments[i.cc].data=e.payload,this.hls.trigger(n.b.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else{this.state=zs.PARSING;let s=a.totalduration,r=t.level,n=t.sn;this.pendingBuffering=!0,this.appended=!1,this.logger.info(`${t.type} Parsing ${n} of [${a.startSN} ,${a.endSN}],level ${r}, cc ${t.cc} URL ${this.hls.redactUrl(t.relurl)}`)();let o=this.media,l=!(o&&o.seeking)&&(a.PTSKnown||!a.live),h=a.initSegments[i.cc]?a.initSegments[i.cc].data:new Uint8Array;this._ensureDemuxer(),this.logFragmentTiming({level:r,sn:"initSegment",cc:t.cc},"parsing"),this.logFragmentTiming(t,"parsing"),this.demuxer.push(e.payload,h,t,s,l,void 0)}}this.fragLoadError=0,this.hls.trigger(n.b.FRAG_LOADED,e)}onFragParsingInitSegment(e){var t;const i=this.fragCurrent,s=e.frag;if(i&&"main"===e.id&&s.sn===i.sn&&s.level===i.level&&this.state===zs.PARSING){const i=e.track,{codec:r,type:n}=i,a=this.bufferController.updateKnownCodecs(n,s.cc,r,void 0),o=this.bufferController.getCurrentInitInfoForParent(this.sbid),l=null===(t=this.hls.levelWithPersistentId(this.levelId))||void 0===t?void 0:t.levelInfo;"video"!==i.type&&"audiovideo"!==i.type||(this.logger.info("[gapless] disallowing gapless for non-audio track")(),this.gaplessAllowed=!1),this.logger.info(`[${s.type}] onFragParsingInitSegment, trackType: ${i.type}, frag: ${s.fragTag}, currentSbInitInfo: ${o?JSON.stringify(o):"N/A"}`)(),a||s.cc!==(null==o?void 0:o.cc)?this.doCreateSbAndAppendInitSegment(s,i,null==l?void 0:l.levelCodec):(this.logger.warn(`[${this.sbid}] incompatible codecs[parsed]=[${i.codec}] on track switch, will wait for a source buffer reset`)(),this.setNeedsResetForCC(s.cc))}}_ensureAudioStartLoad(e){var t,i;if(e&&(null===(t=this.audioStreamController)||void 0===t?void 0:t.waitingToStart)){const t=this.config.firstAudioMustOverlapVideoStart,s=this._getPlaybackPos();this.logger.info(`[main] received first frag ${e.fragTag}, and audioStreamController is waiting to start, frag startPTS: ${e.startPTS&&e.startPTS.toFixed(3)}, playbackPos: ${s}, mustOverlap: ${t}`)();const r=t?e.startPTS:s;if(isNaN(r)||r<0)return void this.logger.warn(`${this.name} ${e.fragTag} invalid seekToPos ${r} for audio start`)();null===(i=this.audioStreamController)||void 0===i||i.startLoadAtTargetTime({cc:e.cc,seekToPos:r})}}handleFragParsingData(e,t){var i,s;const r=e.frag,a=null===(i=this.hls.levelWithPersistentId(this.levelId))||void 0===i?void 0:i.levelInfo;t&&this.logger.info(`[${this.sbid}] handleFragParsingData parsing cached data for frag ${r.fragTag}`)();let o=this.hls.bufferController.isCompatibleTransition(r.cc);if("yes"!==o)this.logger.info(`[${this.sbid}] caching frag ${r.fragTag}, compatible: ${o}, seeking: ${null===(s=this.media)||void 0===s?void 0:s.seeking}, wasCached: ${t}`)(),this.setWaitingDiscontinuity(e);else if(this.state===zs.PARSING)if(null!=this.waitingForKey.value)this.clearPendingData(),this.pendingParsedData=e,this.state=zs.KEY_LOADING,this.logger.info(`[main] cached ${e.type} data from frag ${r.fragTag} to handle KEY_LOADING`)();else{let t=r;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),this._ensureAudioStartLoad(t),this.ensureInitSegmentForFragInfo(r,e.track,void 0),"video"===e.type)if(t.dropped=e.dropped,t.dropped)if(t.backtracked)this.logger.warn("Already backtracked on this fragment, appending with the gap")();else{if(this.fragPrevious&&this.fragPrevious.cc===t.cc)return this.logger.warn("missing video frame(s), backtracking fragment in "+t.cc)(),t.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=zs.IDLE,this.fragPrevious=t,void this.tick();this.logger.warn(`missing video frame(s) in new cc ${t.cc}), reset dropped count and restart @ frag ${t.sn}`)(),e.dropped=0}else t.backtracked=!1;let i=this.hls;if(!this.iframeMode){let s=Ys.updateFragPTSDTS(a.details,t,e.startPTS,e.endPTS,e.startDTS,e.endDTS);i.trigger(n.b.LEVEL_PTS_UPDATED,{details:a.details,level:this.levelId,drift:s,type:e.type,start:e.startPTS,end:e.endPTS})}[e.data1,e.data2].forEach(s=>{er(e.type)?s&&s.length&&this.state===zs.PARSING&&(this.appended=!0,this.pendingBuffering=!0,this.iframeMode&&(this.media.currentTime,this.iframeBaseTime,t.start,this.iframeBaseTime,"video"===e.type||e.type),this.logFragmentTiming(r,"appending"),i.bufferController.appendBuffer(e.type,s,e.startPTS,e.endPTS,"main","data",r)):this.logger.warn("not appending data because of trackType "+e.type)()})}}onAudioTrackSwitching(e){var t=!!e.url,i=e.id;if(!t){if(this.mediaBuffer!==this.media){this.mediaBuffer=this.media;let e=this.fragCurrent;e.loader&&e.loader.abort(),this.fragCurrent=null,this.fragPrevious=null,this._destroyDemuxer(),this.state=zs.IDLE}let e=this.hls;this.hls.bufferController.flushBufferRange(0,Number.POSITIVE_INFINITY,"audio"),e.trigger(n.b.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}}onAudioTrackSwitched(e){var t=e.id,i=this.hls.audioTrackController.resolveTrackId(t).trackInfo;if(!i)return;let s=!!i.url;if(s){let e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.mediaBuffer=e)}this.altAudio=s,this.tick()}onBufferCreated(e){let t,i,s,r=e.tracks,n=!1;for(s in r){let e=r[s];"main"===e.id?(i=s,t=e,"video"===s&&(this.videoBuffer=r[s].buffer)):n=!0}this.mediaBuffer=n&&t?t.buffer:this.media}onBufferAppended(e){let t=this.media;if(t.seeking&&t.paused&&t.buffered.length){let e=this.adjustSeekPosition(this.media.currentTime);Math.abs(t.currentTime-e)>=Number.EPSILON&&(t.currentTime=e)}if("main"===e.parent){e.frag&&this.logFragmentTiming(e.frag,"appended");const t=this.state;t!==zs.PARSING&&t!==zs.PARSED||(this.pendingBuffering=e.pending>0,this.checkAppendedParsed())}this.bufferMonitor.notifyWaterLevelChanged()}addIframeToCurrentLevel(e){e&&Object(Oi.c)(e.iframeMediaStart)&&(this.iframesInSourceBuffer&&this.iframesInSourceBuffer.level===e.level?this.iframesInSourceBuffer.buffered++:this.iframesInSourceBuffer={level:e.level,buffered:1,loading:0})}countIframesInCurrentLevel(e){let t=this.iframesInSourceBuffer&&e===this.iframesInSourceBuffer.level?this.iframesInSourceBuffer.buffered:0,i=0,s=this.fragCurrent;return s&&s.iframeMediaStart&&s.level===e&&i++,{level:e,loading:i,buffered:t}}checkAppendedParsed(){if(!(this.state!==zs.PARSED||this.appended&&this.pendingBuffering)){const e=this.fragCurrent;if(e){const t=this.mediaBuffer?this.mediaBuffer:this.media;let i;this.logger.info(`main buffered: ${Xs(t.buffered)} media.currentTime=${this.media.currentTime}`)(),e.iframe?(this.media.currentTime,this.iframeBaseTime,e.start,this.iframeBaseTime,(i=this._bufferedFrags.filter(e=>Ms.isBuffered(t,(e.iframeMediaStart+e.iframeMediaStart+e.iframeMediaDuration)/2))).push(e),this.addIframeToCurrentLevel(e),this._bufferedFrags=i.sort((function(e,t){return e.iframeMediaStart-t.iframeMediaStart}))):((i=this._bufferedFrags.filter(e=>Ms.isBuffered(t,(e.startPTS+e.startPTS+e.duration)/2))).push(e),this._bufferedFrags=i.sort((function(e,t){return e.startPTS-t.startPTS}))),this.fragPrevious=e;const s=this.stats;s&&!s.cached&&(s.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*s.total/(s.tbuffered-s.tfirst)),this.updateAppendBufferAvg(s.tbuffered-s.tparsed),this.updateParseBwAvg(s.total,s.tparsed-s.tload)),this.hls.trigger(n.b.FRAG_BUFFERED,{stats:s,frag:e,id:"main"}),this.state=zs.IDLE}this.tick()}}_handleFragmentError(e){if(e instanceof a.l){e.details;let t=this.variantController.variantManager.getVariantInfo(e.frag.level),i=(null==t?void 0:t.iframes)!==this.iframeMode;this._handleFragmentNetworkError(e,i),e instanceof a.l&&!e.fatal&&e.frag.iframe&&e.errorAction===Rs.AbortRequest&&(this.state=zs.IDLE),this.resetNextLoadPositionState(),e.fatal&&this.escalateInternalError(e)}else this.logger.warn("Unexpected error "+e.message)()}onInternalError(e){if(super.handleInternalError(e))return;let t;if((e instanceof a.l||e instanceof a.k||e instanceof a.j||e instanceof a.o)&&(t=e.frag||this.fragCurrent)&&"main"!==t.type)return;this.hls.levelController.handleError(e);let i=this.media,s=i&&Ms.isBuffered(i,i.currentTime)&&Ms.isBuffered(i,i.currentTime+.5);if(e instanceof a.j)e.fatal||(t.iframe?this.state=zs.IDLE:this.retryFragRequest(e));else if(e instanceof a.b){let t=this._getVideoAudioSourceBufferInfo();this.handleBufferFullError(e,"main",this.levelId,t,s,()=>{this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)})}else e instanceof a.k&&(this.state=e.fatal?zs.ERROR:zs.IDLE,this.logger.warn(`streamcontroller: ${e.details} while parsing frag,switch to ${this.state} state ...`)())}getMinTimeForCC(e){var t,i,s;const r=null===(s=null===(i=null===(t=this.hls.levelWithPersistentId(this.levelId))||void 0===t?void 0:t.levelInfo)||void 0===i?void 0:i.details)||void 0===s?void 0:s.fragments;let n=0;if(Object(Oi.c)(e)&&r){const t=Hs.getTimeRangeForCC(r,e);if(t){const i=this.audioStreamController?this.audioStreamController.getAudioTimeRangeForCC(e):void 0;n=(null==i?void 0:i.length)?Math.max(i[0],t[0]):t[0]}}return n}_ensureNudgeStartTimeForIncompatibleCC(e,t,i,s){let r=e;if(void 0===r&&s===zs.WAITING_DISCONTINUITY){let e=this.fragCurrent?this.fragCurrent:this.fragPlaying;if(e){let i=this.hls.levelController.getLevelWithPersistentId(e.level).levelInfo,s=i?i.details.fragments:void 0,n=e.start+e.duration;s&&(e.start>t?r=e.start:n>t?r=n:this.logger.warn(`Cannot nudge to frag.sn ${e.sn} [${e.start},${n}] at incompatible discontinuity. nextBufferStart ${r} currentTime ${t}`)())}}if(Object(Oi.c)(r)){let e=r-t;(e>i||e<=0)&&(r=void 0)}return r}_checkIfLoadedMetadata(){let e=this.media;if(!e||!e.readyState)return;let t=e.currentTime,i=this.mediaBuffer?this.mediaBuffer:e,s=i.buffered,r=this.loadingItemStartTime;if(!this.loadedmetadata&&e.readyState>=e.HAVE_METADATA&&e.seekable.length&&s.length){this.loadedmetadata=!0,this.bufferResetResumeLoadInfo&&(this.logger.info("[main] issuing seek for bufferResetResumeLoadInfo "+JSON.stringify(this.bufferResetResumeLoadInfo))(),this.seek(this.bufferResetResumeLoadInfo.seekToPos,!1),this.bufferResetResumeLoadInfo=void 0),r=Object(Oi.c)(r)?r:0;const n=Object(Oi.c)(this.seekToPos)?this.seekToPos:r;let a=e.seeking?t:n;const o=Ms.isBuffered(i,a);this.hls.isPreloadingItem||t===a&&o||(o||e.seeking||(a=s.start(0),this.logger.info("target start position not buffered, seek to buffered.start(0) "+a)()),this.logger.info(`adjust currentTime from ${t} to ${a}`)(),this.seek(a))}}onFragLoadEmergencyAborted(){this.state=zs.IDLE,this.resetNextLoadPositionState(),this.tick()}onBufferFlushed(e){const t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(e=>Ms.isBuffered(t,(e.startPTS+e.endPTS)/2)),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state===zs.BUFFER_FLUSHING_WAITING_PLAYLIST?this.state=zs.PLAYLIST_LOADING:this.state=zs.IDLE,this.preserveFragPrevious||(this.fragPrevious=null),this.preserveFragPrevious=void 0,this._flushingBuffer=!1,this._startOffsetOfBufferFlush=void 0;let i=e&&e.seekAfterFlush;this.media&&Object(Oi.c)(this.seekToPos)&&i&&(this.logger.info(`[iframes] buffer flushed, iframeSeekTo: ${this.seekToPos.toFixed(3)}, currentTime: ${this.media.currentTime.toFixed(3)}, seekable: ${JSON.stringify(this.media.seekable)}, readyState ${this.media.readyState}`)(),this.seek(this.seekToPos)),this.bufferMonitor.notifyWaterLevelChanged(),this.tick()}ccForTime(e){var t;const i=null===(t=this.hls.levelWithPersistentId(this.levelLastLoaded).levelInfo)||void 0===t?void 0:t.details;let s;return i&&(s=xs(i.fragments,Hs.fragmentWithinToleranceTest.bind(null,e,0))),null==s?void 0:s.cc}onLevelsChanged(e){if(e.requiresReset){if(this.state!==zs.STOPPED&&this.media){let e=this.realCurrentTime;this.clearPendingData(),this.resetMediaSource({seekToPos:e,cc:this.ccForTime(e)})}}else(this.state===zs.PLAYLIST_LOADING||this.state===zs.KEY_LOADING||this.state===zs.FRAG_LOADING&&!this.hls.levelController.getLevelWithPersistentId(this.fragCurrent.level).levelInfo||this.state!==zs.STOPPED&&!this.hls.levelController.getLevelWithPersistentId(this.levelId).levelInfo)&&(this.cancelCurrentLoad(),this.clearPendingData(),this.hls.levels&&this.hls.levels.length>0?this.state=zs.IDLE:(this.logger.error("Empty level list")(),this.state=zs.ERROR),this.tick())}onBandwidthChanged(){this.tick()}onBufferChanged(){this.tick()}onStalled(e){var t,i;const s=this.hls,r=this.config,o=this.config.maxSeekHole;let l=e.type,h=e.isLowBufferStall,d=e.bufferInfo,c=e.stallDurationMs,u=this.media,f=u.currentTime;const p=d.len;let g=o;if(this.tstalled=e.tstalled,this.logger.warn(`stall state, audio state: ${null!==(i=null===(t=this.audioStreamController)||void 0===t?void 0:t.state)&&void 0!==i?i:"N/A"}, main state: ${this.state}, currentTime: ${f}, buffered: ${this.bufferedRangeString}`)(),this.checkDiscontinuityState(!0))return;if(!this.stallReported&&(this.stallReported=!0,this.logger.warn(`playback stall type:${l} @${f}, state: ${this.state}, buffer length: ${p}, buffered ranges: ${this.bufferedRangeString} stallMs=${Math.round(c)}`)(),!this.iframeMode)){let e=h?a.f.InsufficientDataAvailable:a.f.VideoDecoderBadDataErr,t=new a.c(a.g.MEDIA_ERROR,a.d.BUFFER_STALLED_ERROR,!1,"buffer stalled error",e);t.buffer=p,s.trigger(n.b.INTERNAL_ERROR,t)}let m,y=this.nudgeRetry||0;if(h){if(p>g)return void this.logger.warn("Got low buffer stall but above jump threshold")();let e=this._ensureNudgeStartTimeForIncompatibleCC(d.nextStart,f,r.maxSeekHole,this.state);if(e){this.nudgeRetry=++y;const t=y*r.nudgeOffset;this.logger.info(`adjust currentTime from ${u.currentTime} to next buffered @ ${e} + nudge ${t}`)(),u.currentTime=e+t,(m=new a.c(a.g.MEDIA_ERROR,a.d.BUFFER_SEEK_OVER_HOLE,!1,"got buffer seek over hole error",a.f.InsufficientDataAvailable)).hole=e+t-f,s.trigger(n.b.INTERNAL_ERROR,m)}}else if(this.relaxHighBufferStallRule)this.relaxHighBufferStallRule--,m=new a.c(a.g.MEDIA_ERROR,a.d.BUFFER_STALLED_ERROR,!1,"got buffer stalled error",a.f.VideoDecoderBadDataErr),s.trigger(n.b.INTERNAL_ERROR,m);else if(this.nudgeRetry=++y,y<r.nudgeMaxRetry){const e=u.currentTime,t=e+y*r.nudgeOffset;this.logger.info(`adjust currentTime from ${e} to ${t}`)(),u.currentTime=t,m=new a.c(a.g.MEDIA_ERROR,a.d.BUFFER_NUDGE_ON_STALL,!1,"got buffer nudge error on stall",a.f.InsufficientDataAvailable),s.trigger(n.b.INTERNAL_ERROR,m)}else this.logger.error(`still stuck in high buffer @${f} after ${r.nudgeMaxRetry}, raise fatal error`)(),m=new a.c(a.g.MEDIA_ERROR,a.d.BUFFER_STALLED_ERROR,!0,"got fatal buffer error",a.f.VideoDecoderBadDataErr),s.trigger(n.b.INTERNAL_ERROR,m)}onMediaTimeUpdate(){let e=this.media.currentTime;if(this.stallReported&&(this.logger.info(`playback not stuck anymore @${e}, after ${Math.round(performance.now()-this.tstalled)}ms`)(),this.stallReported=!1),this.tstalled=void 0,this.nudgeRetry=0,this.relaxHighBufferStallRule=0,this.hls.config.gapless){let t=this.loadingItemStartTime,i=this.playingItemStartTime;t&&e>=t&&i!==t&&!this.media.seeking&&this.hls.handleItemTransitioned()}}computeLivePosition(e,t){let i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)}get liveSyncPosition(){return this._liveSyncPosition}set liveSyncPosition(e){this._liveSyncPosition=e}get playbackEverStarted(){return this.firstPlaybackStarted}get bufferedRangeString(){let e="main"+(this.mediaBuffer&&this.mediaBuffer.buffered.length?Xs(this.mediaBuffer.buffered):"[N/A]");if(this.altAudio){const t=this.audioStreamController.mediaBuffer;e+="/audio"+(t&&t.buffered.length?Xs(t.buffered):"[N/A]")}return e}get variantController(){return this.hls.levelController}getLivePlaylistRefreshDelay(e){let t=Ms.bufferInfo(this.media,this.media.currentTime,this.config.maxBufferHole),i=0===t.len||t.len<Math.max(this.config.liveMinPlayingBufferLen,e.targetduration),s=this.fragCurrent&&"number"==typeof this.fragCurrent.sn&&e.endSN>this.fragCurrent.sn;return i&&s?this.config.livePlaylistRefreshDelay:0}},ur=class extends N{constructor(e){super(e,n.b.MEDIA_ATTACHED,n.b.MEDIA_DETACHING,n.b.FRAG_PARSING_METADATA),this.id3Track=void 0,this.media=void 0}destroy(){N.prototype.destroy.call(this)}onMediaAttached(e){this.media=e.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}onMediaDetaching(){this.media=void 0}onFragParsingMetadata(e){const t=e.frag,i=e.samples;if(!this.hls.config.enableID3Cues)return;let s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,r=t.endPTS?t.endPTS:t.duration+t.start;for(let n=0;n<i.length;n++){let e=i[n].pts,t=n<i.length-1?i[n+1].pts:r;e===t&&(t+=1e-4),i[n].frames&&i[n].frames.forEach(i=>{if(i&&!this.shouldIgnore(i)){let r=new s(e,t,"");r.value=i,this.id3Track.addCue(r)}})}}shouldIgnore(e){return"PRIV"===e.key&&("com.apple.streaming.transportStreamTimestamp"===e.info||"com.apple.streaming.audioDescription"===e.info)}};function fr(e){return(t,i)=>{let s=0,r=0;for(const{timestamp:n,value:a,duration:o}of t){const t=Math.pow(Math.max(0,n-i)/1e3,e);s+=t*a,r+=t*o}return s/r}}const pr={"uniform-time-weighted":fr(0),"linear-time-weighted":fr(1),"quadratic-time-weighted":fr(2)};class gr{constructor(e,t=(()=>{})){this.windowSize=e,this.cleanupCallback=t,this.latencyEntries=[],this.bandwidthEntries=[],this.minEntries=1,this.cleanUpExpiredEntries=this.cleanUpExpiredEntries.bind(this)}record(e){const{trequest:t,tfirst:i,tload:s,bitsDownloaded:r}=e;this.recordLatency(t,i),this.recordBandwidth(t,s,r)}getEstimate(e="quadratic-time-weighted"){if(this.latencyEntries.length<this.minEntries)return;const t=performance.now()-this.windowSize,i=pr[e],s=this.latencyEntries.map(({start:e,end:t})=>({timestamp:t,value:t-e,duration:1})),r=function(e,t){const i=[...e].sort((e,t)=>e.start-t.start),s=[];for(const r of i)0===s.length||s[s.length-1].end<=r.start?s.push(r):s[s.length-1]=t(s[s.length-1],r);return s}(this.bandwidthEntries,(e,t)=>({start:e.start,end:Math.max(e.end,t.end),bitsDownloaded:e.bitsDownloaded+t.bitsDownloaded})).map(({start:e,end:t,bitsDownloaded:i})=>({timestamp:t,duration:(t-e)/1e3,value:i}));return{avgLatencyMs:i(s,t),avgBandwidth:i(r,t)}}recordLatency(e,t){this.latencyEntries.push({start:e,end:t}),this.updateCleanupTimeout(t)}recordBandwidth(e,t,i){this.bandwidthEntries.push({start:e,end:t,bitsDownloaded:i}),this.updateCleanupTimeout(t)}setCleanupTimeout(e){this.cleanupTimeout=setTimeout(this.cleanUpExpiredEntries,Math.max(e-performance.now(),0)),this.cleanupTimestamp=e}clearCleanupTimeout(){void 0!==this.cleanupTimeout&&(clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0),this.cleanupTimestamp=void 0}updateCleanupTimeout(e){const t=e+this.windowSize;(!this.cleanupTimestamp||t<this.cleanupTimestamp)&&(this.clearCleanupTimeout(),this.setCleanupTimeout(t))}cleanUpExpiredEntries(){this.clearCleanupTimeout();const e=performance.now()-this.windowSize;if(this.latencyEntries=this.latencyEntries.filter(t=>t.end>=e),this.bandwidthEntries=this.bandwidthEntries.filter(t=>t.end>=e),this.cleanupCallback(),this.latencyEntries.length>0||this.bandwidthEntries.length>0){const e=Math.min(...this.latencyEntries.map(e=>e.end),...this.bandwidthEntries.map(e=>e.end));this.updateCleanupTimeout(e)}}destroy(){this.clearCleanupTimeout()}}class mr extends N{constructor(e){super(e,n.b.MEDIA_DETACHED),this.bwEstimator=new gr(e.config.bandwidthHistoryWindowSize,()=>this.getAndCacheBandwidthEstimate()),this.ttl=e.config.bandwidthHistoryTTL,this.persistBandwidthEstimate=this.persistBandwidthEstimate.bind(this),"undefined"!=typeof window&&"function"==typeof window.addEventListener&&window.addEventListener("beforeunload",this.persistBandwidthEstimate),this.onMediaDetached=this.persistBandwidthEstimate,this.storage=e.config.storage,this.storageKey=e.config.bandwidthHistoryStorageKey}getAndCacheBandwidthEstimate(){const e=this.bwEstimator.getEstimate(this.hls.config.bandwidthHistoryAggregationMethod);return e&&(this.aggregatedAt=performance.now(),this.cachedBandwidthEstimate=e),e}sample({trequest:e,tfirst:t,tload:i,loaded:s}){this.bwEstimator.record({trequest:e,tfirst:t,tload:i,bitsDownloaded:8*s}),this.getAndCacheBandwidthEstimate()}getEstimate(){if(performance.now()-this.aggregatedAt<=this.hls.config.bandwidthHistoryGetEstimateThrottleMs)return this.cachedBandwidthEstimate;const e=this.getAndCacheBandwidthEstimate();if(e)return e;try{const e=JSON.parse(this.storage.get(this.storageKey));if(e.expires&&e.expires>=Date.now())return e}catch(e){this.logger.warn("Unable to get persisted bandwidth history, returning undefined: "+e.message)()}}persistBandwidthEstimate(){if(void 0===this.storage.set)return void this.logger.warn("`storage.set` is not supported! Not persisting bandwidth estimate")();const e=this.getAndCacheBandwidthEstimate();e&&this.storage.set(this.storageKey,JSON.stringify(Object.assign({},e,{expires:Date.now()+this.ttl})))}destroy(){"undefined"!=typeof window&&"function"==typeof window.removeEventListener&&window.removeEventListener("beforeunload",this.persistBandwidthEstimate),this.bwEstimator.destroy(),super.destroy()}}var yr,vr=class{constructor(e,t,i,s={}){this._logger=e.logger,this._intervalTimeout=i.rtcIntervalTimeout,this._interval=setInterval(this._handlePeriodic.bind(this),this._intervalTimeout),this._state=se,this._hls=e,this._sessStartTime=this._stateStartTime=this._intervalStartTime=Date.now(),this._variantStartTime=0,this._minSwitchWindow=1e4,this._sessionData={},this._intervalData={},this._playStalledData={},this._mediaEngineStalledData={},this._keySessionCompleteData={},this._playLikelyToKeepUpData={},this._playRateChangedData={},this._playErrorData={},this._switchCompleteData={},this._variantEndData={},this._nwErrorData={},this._dimensionData={maxVideoQltyIndex:0,maxReWd:0,maxReHt:0},this._miscData={periodicEvtCnt:0,playLikelyToKeepUpEvtCnt:0,keyDataDict:{},fragmentCnt:0,sessVariantList:{},intervalVariantList:{},nonFatalMediaErrList:{},nonFatalNwErrList:{},playlistMimeTypes:new Set,segmentMimeTypes:new Set,decodedFramesForVariant:0,decodedFramesForVariantSampleCount:0,intervalSegmentBytes:0,intervalSegmentAdt:0,intervalSegmentProcessTime:0,sessSegmentBytes:0,sessSegmentAdt:0,sessSegmentProcessTime:0,sessVideoBytes:0,sessVideoDuration:0,sessAudioBytes:0,sessAudioDuration:0,intervalVideoBytes:0,intervalVideoDuration:0,intervalAudioBytes:0,intervalAudioDuration:0},t?s.reportingAgent&&(this.reportingAgent=s.reportingAgent,this._logger.info("[QE Critical] [RTCA] - Reporting session started, base SessionID: "+this.reportingAgent.SessionID)()):this._logger.info("[RTCA] - Reporting is disabled")(),this._eventEmitter=e.media,this._accessLogReporter={SessionID:e.sessionID,ServiceName:s.serviceName,ClientName:s.appName},this._accessLogData=this.createAccessLogEntry(),this._accesslog=[],this._errorlog=[]}destroy(){clearInterval(this._interval),this._accesslog=[],this._errorlog=[],this._accessLogData=void 0,this._accessLogReporter=void 0,this.reportingAgent=null,this._eventEmitter=void 0}get currentItemId(){return this.itemId}set currentItemId(e){this.itemId=e}setMedia(e){!e&&this._interval&&clearInterval(this._interval),this.media=e}getDesiredRate(){return this._desiredRate}getMedia(){return this.media}updateSvrAddrStats(e){let t=u.parseURL(e);if(t&&t.netLoc){let e=t.netLoc.indexOf(":"),i=e>=0?t.netLoc.slice(0,e):t.netLoc;i.startsWith("//")&&(i=i.slice(2)),this._accessLogData.svrAddr?i!==this._accessLogData.svrAddr&&this._accessLogData.svrAddrChanged++:this._accessLogData.svrAddrChanged=0,this._accessLogData.svrAddr=i}}convertStringObjectToPrimitive(e){return e?"object"==typeof e?e.toString():e:""}createAccessLogEntry(){return{fragmentCnt:0,overdue:0,startPTS:0,obrMax:0,obrMin:0,audioBytes:0,audioDuration:0,videoBytes:0,videoDuration:0,svrAddrChanged:0,svrAddr:"",PlayTimeWC:0,ViFrDr:0,StallCount:0,MediaEngineStallCount:0,ADT:0,NetBytes:0,StartupTime:0,OBRMean:0,OBRLast:0}}translateToAccessLogItem(e,t,i){let s,r=this.convertStringObjectToPrimitive(e);this.updateSvrAddrStats(r),(s=this._switchCompleteData.MediaDur?this._switchCompleteData.MediaDur:this._getBufferedDuration())||(s=0);let n={uri:r,"s-ip":this._accessLogData.svrAddr,"s-ip-changes":this._accessLogData.svrAddrChanged,"sc-wwan-count":-1,"c-transfer-duration":this._accessLogData.ADT,bytes:this._accessLogData.NetBytes,"c-total-media-requests":this._accessLogData.fragmentCnt,"cs-guid":this._accessLogReporter.SessionID,"c-start-time":this._accessLogData.startPTS,"c-startup-time":this._accessLogData.StartupTime,"c-duration-watched":this._accessLogData.PlayTimeWC/1e3,"c-frames-dropped":this._accessLogData.ViFrDr,"c-stalls":this._accessLogData.StallCount,"c-duration-downloaded":this._accessLogData.lastMediaDur?s-this._accessLogData.lastMediaDur:s,"c-overdue":this._accessLogData.overdue,"c-avg-video-bitrate":8*this._accessLogData.videoBytes/(this._accessLogData.videoDuration||1),"c-observed-max-bitrate":this._accessLogData.obrMax,"c-observed-min-bitrate":this._accessLogData.obrMin,"sc-indicated-bitrate":t.bandwidth?t.bandwidth:0,"sc-indicated-avg-bitrate":t.avgBandwidth?t.avgBandwidth:0,"c-observed-bitrate":this._accessLogData.OBRMean,"c-switch-bitrate":this._accessLogData.OBRLast,"c-provisional-entry":!1};return i.playlistType&&(n["s-playback-type"]=i.playlistType),this._accessLogData.audioBytes&&(n["c-avg-audio-bitrate"]=8*this._accessLogData.audioBytes/(this._accessLogData.audioDuration||1)),n}translateToErrorLogItem(e,t){let i=this.convertStringObjectToPrimitive(e);return this.updateSvrAddrStats(i),{date:new Date,"cs-guid":this._accessLogReporter.SessionID+"-"+this.currentItemId,uri:i,"s-ip":this._accessLogData.svrAddr,status:t.ErrCode,domain:t.ErrDomain}}addToAccessLog(e,t,i){if(!e||""===e)return;let s=this.translateToAccessLogItem(e,t,i);if(s){let e=this._accesslog.length-20;e>0&&this._accesslog.splice(0,e),this._accesslog.push(s)}this._accessLogData=this.createAccessLogEntry(),this._accessLogData.lastMediaDur=this._switchCompleteData.MediaDur?this._switchCompleteData.MediaDur:this._getBufferedDuration()}addToErrorLog(e,t){let i=this.translateToErrorLogItem(e,t);if(i){let e=this._errorlog.length-20;e>0&&this._errorlog.splice(0,e),this._errorlog.push(i)}}get accessLog(){let e=this._accesslog.slice(0);if(e){let t=this._miscData.curLevelUrl;if(t&&""!==t){let i=this._getVariantInfo(t),s=this.translateToAccessLogItem(t,i,this._miscData);s&&(s["c-provisional-entry"]=!0,e.push(s))}}return e}get errorLog(){return this._errorlog}notify(e,t){if(this._state!==le||"ended"===e)switch(e){case"canplay":this._handleCanPlay();break;case"desiredratechange":this._handleDesiredRateChange(t);break;case"pause":case"playing":this._handleRateChange();break;case"ended":this._handlePlayEnded();break;case"bufferstalled":this._handleBufferStalled();break;case"mediaenginestalled":this._handleMediaEngineStalled();break;case"mediaerror":this._handleMediaError(t);break;case"variantend":this._handleVariantEnd();break;case"levelloaded":this._handleLevelLoaded(t);break;case"levelswitched":case"levelloaderror":this._handleLevelSwitched(t);break;case"nwerror":this._handleNwError(t);break;case"playbackinfo":this._handlePlaybackInfo(t);break;case"manifestparsed":case"manifestloaded":case"fragloading":case"fragloaded":case"fragbuffered":this._aggregateStats(e,t);break;case"segmentkeyloaded":case"spcrequested":case"spcreceived":case"spcsubmitted":case"spccreated":case"ckcrequested":case"ckcreceived":case"ckcsubmitted":case"ckcprocessed":case"keyaborted":case"ckcerror":case"spcerror":this._handleKeySessionEvents(e,t)}}_handleCanPlay(){if(!this._isLikelyToKeepUp){const e=Date.now();this._state===se&&this._setValue([this._intervalData,this._sessionData],"InitTime",e-this._sessStartTime),this._miscData.lastLikelyToKeepUpTime=e,this._setValue([this._playLikelyToKeepUpData,this._playRateChangedData,this._accessLogData],"StartupTime",e-this._stateStartTime),this._sendPlayLikelyToKeepUpEvent(),this._isLikelyToKeepUp=!0}}_handleDesiredRateChange(e){this._desiredRate=e.rate}_handleRateChange(){(this._rate!==this._desiredRate||0!==this._desiredRate&&this._state!==ne)&&(this._rate=this._desiredRate,this._updateStateTimes(G,100*this._rate),this._sendPlayRateChangedEvent())}_handlePlayEnded(){let e=this._sessionData.NetBytes,t=this._intervalData.NetBytes;e=1e3*Math.round(e/1e3),t=1e3*Math.round(t/1e3),this._sessionData.NetBytes=e,this._intervalData.NetBytes=t,this._handlePeriodic(),this._updateStateTimes(U,void 0),this._sendSummaryEvent()}_handlePeriodic(){this._finalizeStatsForPeriodic(),this._sendPeriodicEvent()}_handleBufferStalled(){this._state===ne&&(this._updateStateTimes($,void 0),this._inc([this._sessionData,this._intervalData,this._accessLogData],"StallCount",1),this._sendPlayStalledEvent())}_handleMediaEngineStalled(){this._state===ne&&(this._updateStateTimes(K,void 0),this._inc([this._sessionData,this._intervalData],"MediaEngineStallCount",1),this._sendMediaEngineStalledEvent())}_handleVariantEnd(){if(this._state===ne){const e=Date.now(),t=Math.min(e-this._variantStartTime,e-this._stateStartTime),i=Math.abs(t*(this._miscData.lastPlayRate/100));this._inc([this._variantEndData],"VarPlayTime",i),this._inc([this._variantEndData],"VarPlayTimeWC",t)}this._sendVariantEndEvent()}_handleLevelLoaded(e){if(!this._miscData.playlistType){this._miscData.playlistType=e.playlistType;let t=this._getVariantInfo(e.url);t&&(t.targetduration=e.targetduration)}this._miscData.playlistMimeTypes.has(e.contentType)||this._miscData.playlistMimeTypes.add(e.contentType),this._inc([this._sessionData,this._intervalData],"PlaylistADT",e.adt),this._setValue([this._playLikelyToKeepUpData],"PlaylistADT",e.adt),this._updateMaxValue([this._sessionData,this._intervalData],"MaxPlaylistDT",e.adt)}_handleKeySessionEvents(e,t){const i=t.timestamp;let s=this._miscData.keyDataDict[t.keyuri]||{};switch(e){case"segmentkeyloaded":s.keyFormat="identity",s.keyDeliveryTime=t.adt,this._state===se&&(s.keyInitTime=i-this._sessStartTime),this._miscData.keyData=s,this._sendKeySessionCompleteEvent();break;case"spcrequested":s.keySessionStartTime=s.SPCRequestStartTime=i,this._state===se&&(s.keyInitTime=i-this._sessStartTime),this._miscData.keyDataDict[t.keyuri]=s;break;case"spcreceived":s.SPCRequestTime=i-s.SPCRequestStartTime;break;case"spcsubmitted":s.keyFormat=t.keyFormat,s.SPCSubmitStartTime=i;break;case"spccreated":s.cdmVersion=t.cdmVersion,s.SPCCreationTime=i-s.SPCSubmitStartTime;break;case"ckcrequested":s.CKCRequestStartTime=i;break;case"ckcreceived":s.CKCResponseTime=i-s.CKCRequestStartTime;break;case"ckcsubmitted":s.CKCSubmitStartTime=i;break;case"ckcprocessed":s&&(s.CKCProcessTime=i-s.CKCSubmitStartTime,s.keyDeliveryTime=i-s.keySessionStartTime,this._miscData.keyData=s,this._sendKeySessionCompleteEvent(),delete this._miscData.keyDataDict[t.keyuri]);break;case"keyaborted":case"ckcerror":case"spcerror":s&&(s.isKeyError=!0,s.keyErrorType=e,this._miscData.keyData=s,this._sendKeySessionCompleteEvent(),delete this._miscData.keyDataDict[t.keyuri])}}_handleLevelSwitched(e){const t=Date.now();let i,s=!1;if(this._miscData.curLevelUrl){let t=this._getVariantInfo(this._miscData.curLevelUrl),r=this._getVariantInfo(e.url);i=r.bandwidth<t.bandwidth?"Down":"Up",s=r.iframes}if(this._inc([this._sessionData,this._intervalData],"SwCnt",1),this._miscData.isBadSw=this._isBadSw(i,s,t,this._minSwitchWindow,this._miscData,e.isSeeking),e.failedSwitchUrl)this._miscData.failedSwitchUrl=e.failedSwitchUrl;else{if(this._state===ne){const e=Math.min(t-this._variantStartTime,t-this._stateStartTime),i=Math.abs(e*(this._miscData.lastPlayRate/100));this._inc([this._switchCompleteData],"PlayTimeLastSW",i);const s=Math.min(e,t-this._intervalStartTime);this._updateLevelStats(s,this._miscData.curLevelUrl)}this._miscData.lastSwitchDir=i,this._miscData.lastSwitchTime=t,this._miscData.variantStartTimeMedia=this._getCurrentMediaTimeMilliSec(),this._miscData.lastLevelIsIframe=s,this._miscData.prevLevelUrl=this._miscData.curLevelUrl,this._miscData.curLevelUrl=e.url,this._variantStartTime=t}this._sendSwitchComplete()}_handleMediaError(e){if(this._inc([this._sessionData,this._intervalData],"PlayerErrCount",1),e.fatal)this._inc([this._sessionData,this._intervalData],"FatalPlayerErrCount",1),this._miscData.playErrCode=e.details,this._miscData.playErrIsFatal=e.fatal,this._miscData.playErrCount=1,this._miscData.playErrDomain=e.type,this._updateStateTimes(H,void 0),this._sendPlayError();else{let t=this._miscData.nonFatalMediaErrList[e.details]||0;this._miscData.nonFatalMediaErrList[e.details]=t+1}}_handleNwError(e){if(this._inc([this._sessionData,this._intervalData],"NwErrCount",1),e.fatal)this._miscData.nwErrTime=Date.now(),this._inc([this._sessionData,this._intervalData],"FatalNwErrCount",1),this._miscData.nwErrCode=e.details,this._miscData.nwErrIsFatal=e.fatal,this._miscData.nwErrDomain=e.type,this._miscData.nwErrReason=e.code,this._updateStateTimes(j,void 0),this._sendNwError();else{let t=e.details+"/"+e.code,i=this._miscData.nonFatalNwErrList[t]||0;this._miscData.nonFatalNwErrList[t]=i+1}}_handleBatchMediaError(){let e=this._miscData.nonFatalMediaErrList;Object.keys(e).forEach(t=>{this._miscData.playErrCode=t,this._miscData.playErrIsFatal=!1,this._miscData.playErrCount=e[t],this._sendPlayError()}),this._miscData.nonFatalMediaErrList={}}_handleBatchNwError(){let e=this._miscData.nonFatalNwErrList;Object.keys(e).forEach(t=>{let i=t.split("/");this._miscData.nwErrTime=Date.now(),this._miscData.nwErrCode=i[0],this._miscData.nwErrReason=parseInt(i[1]),this._miscData.nwErrIsFatal=!1,this._miscData.nwErrCount=e[t],this._sendNwError()}),this._miscData.nonFatalNwErrList={}}_handlePlaybackInfo(e){e.droppedVideoFrames<this._miscData.droppedVideoFrames&&(this._miscData.droppedVideoFrames=0),e.decodedFrameCount<this._miscData.decodedFrameCount&&(this._miscData.decodedFrameCount=0);let t=e.droppedVideoFrames-(this._miscData.droppedVideoFrames||0),i=e.decodedFrameCount-(this._miscData.decodedFrameCount||0);this._miscData.droppedVideoFrames=e.droppedVideoFrames,this._miscData.decodedFrameCount=e.decodedFrameCount,this._miscData.decodedFramesForVariant+=i,this._miscData.decodedFramesForVariantSampleCount+=1,t&&(this._inc([this._accessLogData],"ViFrDr",t),t>=3?(this._inc([this._sessionData,this._intervalData],"GroupViFrDr",t),this._inc([this._sessionData,this._intervalData],"GroupViFrDrEvtCount",1)):(this._inc([this._sessionData,this._intervalData],"SparseViFrDr",t),this._inc([this._sessionData,this._intervalData],"SparseViFrDrEvtCount",1)))}_sendSummaryEvent(){clearInterval(this._interval);let e=this._sessionData.NetBytes||0,t=this._sessionData.ADT||0,i=e&&t?8*e/(t/1e3):0,s=this._sessionData.SegmentProcessTime||0,r=e&&t?8*e/((t+s)/1e3):0,n=this._sessionData.SegmentParseTime||0;e=this._miscData.sessSegmentBytes,t=this._miscData.sessSegmentAdt,s=this._miscData.sessSegmentProcessTime;let a=e&&t?8*e/((t+s+n)/1e3):0,o=8*(this._miscData.sessVideoBytes||0)/(this._miscData.sessVideoDuration||1),l=8*(this._miscData.sessAudioBytes||0)/(this._miscData.sessAudioDuration||1),h=this._findTimeWeightedValues(this._miscData.sessVariantList),d=this._getVariantInfo(this._miscData.curLevelUrl),c=this._miscData.manifestData||{},u="";this._miscData.playlistMimeTypes.forEach(e=>{u+=e+","});let f="";this._miscData.segmentMimeTypes.forEach(e=>{f+=e+","}),this._sessionData.PlayType=this._miscData.playlistType,this._sessionData.TWOBR=i,this._sessionData.PerceivedTWOBR=r,this._sessionData.NetTWOBR=a,this._sessionData.AvgVideoBitrate=o,this._sessionData.AvgAudioBitrate=l,this._sessionData.PlayerTWIBR=h.twIBR,this._sessionData.PlayerTWIABR=h.twIABR,this._sessionData.TWBitRk=h.twBRnk,this._sessionData.TargetDur=d.targetduration,this._sessionData.VariantList=c.trimmedVarList,this._sessionData.PlaylistMimeType=u.slice(0,-1),this._sessionData.SegmentMimeType=f.slice(0,-1),this._sessionData.Rate=this._miscData.lastPlayRate,this._sessionData.ReWd=d.width,this._sessionData.ReHt=d.height,this._fillAndFire(U,W,this._sessionData),this._sessionData={},this._miscData.sessVariantList={},this._miscData.sessSegmentBytes=0,this._miscData.sessSegmentAdt=0,this._miscData.sessSegmentProcessTime=0}_sendPeriodicEvent(){let e=this._intervalData.NetBytes,t=this._intervalData.ADT,i=e&&t?8*e/(t/1e3):0,s=this._intervalData.SegmentProcessTime||0,r=e&&t?8*e/((t+s)/1e3):0,n=this._intervalData.SegmentParseTime||0;e=this._miscData.intervalSegmentBytes,t=this._miscData.intervalSegmentAdt,s=this._miscData.intervalSegmentProcessTime;let a=e&&t?8*e/((t+s+n)/1e3):0,o=8*(this._miscData.intervalVideoBytes||0)/(this._miscData.intervalVideoDuration||1),l=8*(this._miscData.intervalAudioBytes||0)/(this._miscData.intervalAudioDuration||1),h=this._findTimeWeightedValues(this._miscData.intervalVariantList),d=this._getVariantInfo(this._miscData.curLevelUrl),c=this._miscData.manifestData||{};this._intervalData.EventCounter=++this._miscData.periodicEvtCnt,this._intervalData.PlayType=this._miscData.playlistType,this._intervalData.TWOBR=i,this._intervalData.PerceivedTWOBR=r,this._intervalData.NetTWOBR=a,this._intervalData.AvgVideoBitrate=o,this._intervalData.AvgAudioBitrate=l,this._intervalData.PlayerTWIBR=h.twIBR,this._intervalData.PlayerTWIABR=h.twIABR,this._intervalData.TWBitRk=h.twBRnk,this._intervalData.TargetDur=d.targetduration,this._intervalData.VariantList=c.trimmedVarList,this._intervalData.Rate=this._miscData.lastPlayRate,this._intervalData.ReWd=d.width,this._intervalData.ReHt=d.height,(this._intervalData.PlayTimeWC>0||this._intervalData.ADT)&&this._fillAndFire(V,q,this._intervalData),this._intervalData={},this._miscData.intervalVariantList={},this._miscData.intervalSegmentBytes=0,this._miscData.intervalSegmentAdt=0,this._miscData.intervalSegmentProcessTime=0,this._miscData.intervalVideoBytes=0,this._miscData.intervalVideoDuration=0,this._miscData.intervalAudioBytes=0,this._miscData.intervalAudioDuration=0}_sendPlayStalledEvent(){const e=Date.now();let t=this._getVariantInfo(this._miscData.curLevelUrl);this._playStalledData.MediaDur=this._getBufferedDuration(),this._playStalledData.BitRnk=t.brRnk,this._playStalledData.Codecs=t.codecs,this._playStalledData.PlayTime=this._sessionData.PlayTime,this._playStalledData.PlayType=this._miscData.playlistType,this._playStalledData.LastLikelyToKeepUp=e-this._miscData.lastLikelyToKeepUpTime,this._playStalledData.LastSwitch=e-this._miscData.lastSwitchTime,this._playStalledData.NwErrTime=this._miscData.nwErrTime,this._playStalledData.NwErrCode=this._miscData.nwErrCode,this._playStalledData.LaSwDir=this._miscData.lastSwitchDir,this._playStalledData.TargetDur=t.targetduration,this._playStalledData.PlayerIABR=t.avgBandwidth,this._playStalledData.PlayerIBR=t.bandwidth,this._playStalledData.Rate=this._miscData.lastPlayRate,this._fillAndFire($,z,this._playStalledData),this._playStalledData={}}_sendMediaEngineStalledEvent(){const e=Date.now();let t=this._getVariantInfo(this._miscData.curLevelUrl);this._mediaEngineStalledData.MediaDur=this._getBufferedDuration(),this._mediaEngineStalledData.BitRnk=t.brRnk,this._mediaEngineStalledData.Codecs=t.codecs,this._mediaEngineStalledData.PlayTime=this._sessionData.PlayTime,this._mediaEngineStalledData.PlayType=this._miscData.playlistType,this._mediaEngineStalledData.LastLikelyToKeepUp=e-this._miscData.lastLikelyToKeepUpTime,this._mediaEngineStalledData.LastSwitch=e-this._miscData.lastSwitchTime,this._mediaEngineStalledData.LaSwDir=this._miscData.lastSwitchDir,this._mediaEngineStalledData.TargetDur=t.targetduration,this._mediaEngineStalledData.PlayerIABR=t.avgBandwidth,this._mediaEngineStalledData.PlayerIBR=t.bandwidth,this._mediaEngineStalledData.Rate=this._miscData.lastPlayRate,this._fillAndFire(K,Z,this._mediaEngineStalledData),this._mediaEngineStalledData={}}_sendKeySessionCompleteEvent(){this._keySessionCompleteData.KeyFormat=this._miscData.keyData.keyFormat,this._keySessionCompleteData.CDMVersion=this._miscData.keyData.cdmVersion,this._keySessionCompleteData.SPCRequestTime=this._miscData.keyData.SPCRequestTime,this._keySessionCompleteData.SPCCreationTime=this._miscData.keyData.SPCCreationTime,this._keySessionCompleteData.CKCResponseTime=this._miscData.keyData.CKCResponseTime,this._keySessionCompleteData.CKCProcessTime=this._miscData.keyData.CKCProcessTime,this._keySessionCompleteData.KeyDeliveryTime=this._miscData.keyData.keyDeliveryTime,this._keySessionCompleteData.CurrentMediaTime=this._getCurrentMediaTimeMilliSec(),this._keySessionCompleteData.KeyInitTime=this._miscData.keyData.keyInitTime,this._miscData.keyData.isKeyError&&(this._keySessionCompleteData.KeyErrorType=this._miscData.keyData.keyErrorType),this._fillAndFire(6104,Y,this._keySessionCompleteData),this._keySessionCompleteData={},delete this._miscData.keyData}_sendPlayLikelyToKeepUpEvent(){let e=this._getVariantInfo(this._miscData.curLevelUrl);this._playLikelyToKeepUpData.EventCounter=++this._miscData.playLikelyToKeepUpEvtCnt,this._playLikelyToKeepUpData.PlayType=this._miscData.playlistType,this._playLikelyToKeepUpData.PlayerIABR=e.avgBandwidth,this._playLikelyToKeepUpData.PlayerIBR=e.bandwidth,this._playLikelyToKeepUpData.MediaDur=this._getBufferedDuration(),this._playLikelyToKeepUpData.BitRnk=e.brRnk,this._playLikelyToKeepUpData.Codecs=e.codecs,this._playLikelyToKeepUpData.TargetDur=e.targetduration,this._fillAndFire(6105,X,this._playLikelyToKeepUpData),this._playLikelyToKeepUpData={}}_sendPlayRateChangedEvent(){let e=this._getVariantInfo(this._miscData.curLevelUrl);this._playRateChangedData.Rate=this._miscData.lastPlayRate,this._playRateChangedData.PlayType=this._miscData.playlistType,this._playRateChangedData.StNPT=this._getCurrentMediaTimeMilliSec(),this._playRateChangedData.PlayerIABR=e.avgBandwidth,this._playRateChangedData.PlayerIBR=e.bandwidth,this._playRateChangedData.BitRnk=e.brRnk,this._playRateChangedData.MediaDur=this._getBufferedDuration(),this._playRateChangedData.Codecs=e.codecs,this._fillAndFire(G,Q,this._playRateChangedData),this._playRateChangedData={}}_sendPlayError(){const e=Date.now();let t=this._getVariantInfo(this._miscData.curLevelUrl);this._playErrorData.ErrCode=this._miscData.playErrCode,this._playErrorData.ErrIsFatal=this._miscData.playErrIsFatal,this._playErrorData.PlayerErrCount=this._miscData.playErrCount,this._playErrorData.ErrDomain=this._miscData.playErrDomain,this._playErrorData.PlayType=this._miscData.playlistType,this._playErrorData.BitRnk=t.brRnk,this._playErrorData.MediaDur=this._getBufferedDuration(),this._playErrorData.PlayTime=this._sessionData.PlayTime,this._playErrorData.PlayTimeWC=this._sessionData.PlayTimeWC,this._playErrorData.PlayerIABR=t.avgBandwidth,this._playErrorData.PlayerIBR=t.bandwidth,this._playErrorData.LastLikelyToKeepUp=e-this._miscData.lastLikelyToKeepUpTime,this._playErrorData.LastSwitch=e-this._miscData.lastSwitchTime,this._playErrorData.VideoQltyIndex=t.qltyIndex,this.addToErrorLog(this._miscData.curLevelUrl,this._playErrorData),this._fillAndFire(H,J,this._playErrorData),this._playErrorData={}}_sendSwitchComplete(){let e=this._miscData.prevLevelUrl,t=this._miscData.failedSwitchUrl||this._miscData.curLevelUrl,i=!!this._miscData.failedSwitchUrl;this._miscData.failedSwitchUrl=void 0;let s=this._getVariantInfo(e),r=this._getVariantInfo(t);this._switchCompleteData.FrBitRnk=s.brRnk,this._switchCompleteData.ToBitRnk=r.brRnk,this._switchCompleteData.TimeToBitrate=Date.now()-this._sessStartTime,this._switchCompleteData.MediaDur=this._getBufferedDuration(),this._switchCompleteData.Rate=this._miscData.lastPlayRate,this._switchCompleteData.PlayType=this._miscData.playlistType,this._switchCompleteData.SwFail=i,this._switchCompleteData.PlayerIBR=r.bandwidth,this._switchCompleteData.PlayerIABR=r.avgBandwidth,this._switchCompleteData.LastPlayerIBR=s.bandwidth,this._switchCompleteData.LastPlayerIABR=s.avgBandwidth,this._switchCompleteData.PlayTime=this._sessionData.PlayTime,this._switchCompleteData.BadSw=this._miscData.isBadSw,this._switchCompleteData.ReWd=r.width,this._switchCompleteData.ReHt=r.height,this.addToAccessLog(e,s,this._miscData),this._fillAndFire(6109,ee,this._switchCompleteData),this._switchCompleteData={}}_sendVariantEndEvent(){let e=this._getVariantInfo(this._miscData.curLevelUrl),t=this._miscData.decodedFramesForVariant/(this._miscData.decodedFramesForVariantSampleCount||1);this._miscData.decodedFramesForVariant=0,this._miscData.decodedFramesForVariantSampleCount=0,this._variantEndData.Rate=this._miscData.lastPlayRate,this._variantEndData.PlayType=this._miscData.playlistType,this._variantEndData.VarAvgBitrate=e.avgBandwidth,this._variantEndData.VarPeakBitrate=e.bandwidth,this._variantEndData.VarBitRk=e.brRnk,this._variantEndData.VarSTTime=this._miscData.variantStartTimeMedia,this._variantEndData.VarEndTime=this._getCurrentMediaTimeMilliSec(),this._variantEndData.IFR=e.framerate,this._variantEndData.ODR=t,this._variantEndData.ReWd=e.width,this._variantEndData.ReHt=e.height,this._fillAndFire(6111,te,this._variantEndData),this._variantEndData={}}_sendNwError(){let e=this._getVariantInfo(this._miscData.curLevelUrl);this._nwErrorData.BitRnk=e.brRnk,this._nwErrorData.PlayTime=this._sessionData.PlayTime,this._nwErrorData.PlayTimeWC=this._sessionData.PlayTimeWC,this._nwErrorData.PlayType=this._miscData.playlistType,this._nwErrorData.ErrCode=this._miscData.nwErrCode,this._nwErrorData.ErrReason=this._miscData.nwErrReason,this._nwErrorData.ErrIsFatal=this._miscData.nwErrIsFatal,this._nwErrorData.NwErrCount=this._miscData.nwErrCount,this._nwErrorData.ErrDomain=this._miscData.nwErrDomain,this.addToErrorLog(this._miscData.curLevelUrl,this._nwErrorData),this._fillAndFire(j,ie,this._nwErrorData),this._nwErrorData={}}_aggregateStats(e,t){switch(e){case"manifestparsed":this._aggregateManifestParsedStats(t);break;case"manifestloaded":this._aggregateManifestLoadedStats(t);break;case"fragloading":this._aggregateFragLoadingStats();break;case"fragloaded":this._aggregateFragLoadedStats(t);break;case"fragbuffered":this._aggregateFragBufferedStats(t)}}_aggregateManifestParsedStats(e){let t=e.levels||[],i={},s={},r=0,n=0,a=this._getMaxNormalizedPeak(t);t.forEach(e=>{if(e.attrs){let t=this._getVideoFourCC(e.attrs.CODECS),s=this._getVideoQualityIndex(t,e.attrs["VIDEO-RANGE"])||0,r={codecs:e.attrs.CODECS,width:e.width,height:e.height,bandwidth:parseInt(e.attrs.BANDWIDTH),avgBandwidth:parseInt(e.attrs["AVERAGE-BANDWIDTH"]),framerate:parseFloat(e.attrs["FRAME-RATE"]),iframes:e.iframes,brRnk:this._getBitrateRank(parseInt(e.attrs.BANDWIDTH),t,a),qltyIndex:s};n=s>n?s:n,i[e.url]=r}let t=e.width*e.height;t>r&&(r=t,s={width:e.width,height:e.height})}),this._miscData.manifestData={},this._miscData.manifestData.variantList=i,this._miscData.manifestData.trimmedVarList=Object.keys(i).length>0?Object.values(i).map(e=>e.bandwidth+":"+e.avgBandwidth).join(","):void 0,this._dimensionData.maxVideoQltyIndex=n,this._dimensionData.maxReWd=s.width,this._dimensionData.maxReHt=s.height}_aggregateManifestLoadedStats(e){this._miscData.playlistMimeTypes.has(e.contentType)||this._miscData.playlistMimeTypes.add(e.contentType),this._inc([this._sessionData,this._intervalData],"MasterPlaylistADT",e.adt)}_aggregateFragLoadingStats(){this._inc([this._sessionData,this._intervalData],"MediaRequestsSent",1)}_aggregateFragObserverdBitrate(e,t,i,s){const r=8*i/(s/1e3);return{obr:r,obrLast:8*e.bytes/(e.adt/1e3),obrMean:r/t}}_aggregateFragMinMaxBitrate(e,t){(!e.obrMax||t>e.obrMax)&&(e.obrMax=t),(!e.obrMin||t<e.obrMin)&&(e.obrMin=t)}_hasGap(e,t,i,s){return void 0!==e&&void 0!==i&&(e-s>1||i-t>1)}_aggregateFragLoadedStats(e){if(this._miscData.segmentMimeTypes.has(e.contentType)||this._miscData.segmentMimeTypes.add(e.contentType),"string"==typeof e.cdnServer&&de.includes(e.cdnServer.toLowerCase())&&(this._miscData.lastMediaCDNServer=e.cdnServer),e.serverInfo&&(this._miscData.serverInfo=e.serverInfo),"main"===e.fragType||"video"===e.fragType){this._inc([this._sessionData,this._intervalData,this._accessLogData],"NetBytes",e.bytes),this._inc([this._sessionData,this._intervalData,this._accessLogData],"ADT",e.adt),this._inc([this._sessionData,this._intervalData,this._accessLogData],"SegmentProcessTime",e.processTime);const t=this._aggregateFragObserverdBitrate(e,++this._miscData.fragmentCnt,this._sessionData.NetBytes,this._sessionData.ADT),i=this._aggregateFragObserverdBitrate(e,++this._accessLogData.fragmentCnt,this._accessLogData.NetBytes,this._accessLogData.ADT);if(this._playStalledData.OBRLast=t.obrLast,this._playStalledData.OBRMean=t.obrMean,this._mediaEngineStalledData.OBRLast=t.obrLast,this._mediaEngineStalledData.OBRMean=t.obrMean,this._accessLogData.OBRLast=i.obrLast,this._accessLogData.OBRMean=i.obrMean,this._aggregateFragMinMaxBitrate(this._accessLogData,i.obr),(this.media?this.media.currentTime:0)>e.startPTS&&this._eventEmitter&&!this._eventEmitter.seeking&&this._accessLogData.overdue++,this._hasGap(e.startPTS,e.endPTS,this._accessLogData.lastStartPTS,this._accessLogData.lastEndPTS)){let e=this._getVariantInfo(this._miscData.curLevelUrl);this.addToAccessLog(this._miscData.curLevelUrl,e,this._miscData)}this._accessLogData.startPTS||(this._accessLogData.startPTS=e.startPTS),this._accessLogData.lastStartPTS=e.startPTS,this._accessLogData.lastEndPTS=e.endPTS,this._miscData.sessVideoBytes+=e.bytes,this._miscData.sessVideoDuration+=e.duration,this._miscData.intervalVideoBytes+=e.bytes,this._miscData.intervalVideoDuration+=e.duration,this._accessLogData.videoBytes+=e.bytes,this._accessLogData.videoDuration+=e.duration}else"audio"===e.fragType&&(this._miscData.sessAudioBytes+=e.bytes,this._miscData.sessAudioDuration+=e.duration,this._miscData.intervalAudioBytes+=e.bytes,this._miscData.intervalAudioDuration+=e.duration,this._accessLogData.audioBytes+=e.bytes,this._accessLogData.audioDuration+=e.duration)}_aggregateFragBufferedStats(e){"main"!==e.fragType&&"video"!==e.fragType||(this._miscData.intervalSegmentBytes+=e.bytes,this._miscData.intervalSegmentAdt+=e.adt,this._miscData.intervalSegmentProcessTime+=e.processTime,this._miscData.sessSegmentBytes+=e.bytes,this._miscData.sessSegmentAdt+=e.adt,this._miscData.sessSegmentProcessTime+=e.processTime,this._inc([this._sessionData,this._intervalData,this._accessLogData],"SegmentParseTime",e.parseTime))}_inc(e,t,i){t&&i&&e&&t&&e.forEach(e=>{e[t]=e[t]?e[t]+i:i})}_updateMaxValue(e,t,i){t&&i&&e&&t&&e.forEach(e=>{(!e[t]||e[t]<i)&&(e[t]=i)})}_setValue(e,t,i){t&&i&&e&&t&&e.forEach(e=>{e[t]=i})}_clearValue(e,t){t&&e&&t&&e.forEach(e=>{delete e[t]})}_updateLevelStats(e,t){if(e&&t){let i=this._getVariantInfo(t),s={bandwidth:i.bandwidth,avgBandwidth:i.avgBandwidth,framerate:i.framerate,brRnk:i.brRnk,playTime:0},r=s,n=Object.assign({},s),a=this._miscData.intervalVariantList,o=this._miscData.sessVariantList,l=a[t]?a[t].playTime:0,h=o[t]?o[t].playTime:0;r.playTime=l+e,n.playTime=h+e,a[t]=r,o[t]=n}}_finalizeStatsForPeriodic(){const e=Date.now();let t=e-this._intervalStartTime,i=e-this._stateStartTime;if(this._intervalStartTime=e,this._miscData.pInterval=t,i=Math.min(t,i),this._setValue([this._intervalData],"PInterval",t),this._state===ne){this._inc([this._intervalData],"PlayTimeWC",i);const t=Math.abs(i*(this._miscData.lastPlayRate/100));this._inc([this._intervalData],"PlayTime",t);const s=Math.min(e-this._variantStartTime,i);this._updateLevelStats(s,this._miscData.curLevelUrl)}else this._state===ae?this._inc([this._intervalData],"StallTime",i):this._state===oe?this._inc([this._intervalData],"MediaEngineStallTime",i):this._state===re&&this._inc([this._intervalData],"PauseTime",i);this._handleBatchMediaError(),this._handleBatchNwError()}_updateStateTimes(e,t){if(-1===he.indexOf(e))return;const i=Date.now(),s=i-this._stateStartTime,r=Math.min(i-this._intervalStartTime,s),n=Math.min(i-this._variantStartTime,s);if(this._state===ne){this._inc([this._sessionData,this._accessLogData],"PlayTimeWC",s);const e=Math.abs(s*(this._miscData.lastPlayRate/100));this._inc([this._sessionData],"PlayTime",e);let t=Math.abs(r*(this._miscData.lastPlayRate/100));this._inc([this._intervalData],"PlayTimeWC",r),this._inc([this._intervalData],"PlayTime",t);let i=Math.abs(n*(this._miscData.lastPlayRate/100));this._inc([this._variantEndData],"VarPlayTime",i),this._inc([this._variantEndData],"VarPlayTimeWC",n),this._inc([this._switchCompleteData],"PlayTimeLastSW",i);let a=Math.min(n,r);this._updateLevelStats(a,this._miscData.curLevelUrl),this._inc([this._playRateChangedData],"RateChangePlayTime",s),this._setValue([this._playStalledData,this._mediaEngineStalledData,this._playErrorData,this._nwErrorData],"LastResume",s)}else this._state===ae?(this._inc([this._sessionData],"StallTime",s),this._inc([this._intervalData],"StallTime",r),this._setValue([this._sessionData,this._playErrorData,this._playRateChangedData],"LastStall",s)):this._state===oe?(this._inc([this._sessionData],"MediaEngineStallTime",s),this._inc([this._intervalData],"MediaEngineStallTime",r),this._setValue([this._sessionData,this._playErrorData,this._playRateChangedData],"LastMediaEngineStall",s)):this._state===re&&(this._inc([this._sessionData],"PauseTime",s),this._inc([this._intervalData],"PauseTime",r),this._setValue([this._sessionData,this._playErrorData,this._playRateChangedData],"LastPause",s));switch(this._stateStartTime=i,e){case $:this._state=ae,this._miscData.lastPlayRate=0,this._isLikelyToKeepUp=!1;break;case K:this._state=oe,this._miscData.lastPlayRate=0,this._isLikelyToKeepUp=!1;break;case G:0===t?this._state=re:(this._state=ne,this._clearValue([this._sessionData],"LastStall"),this._clearValue([this._sessionData],"LastMediaEngineStall"),this._clearValue([this._sessionData],"LastPause")),this._miscData.lastPlayRate=t;break;case j:case H:case U:this._state=le,this._miscData.lastPlayRate=0,this._isLikelyToKeepUp=!1}}_fillAndFire(e,t,i){if(!(e&&t&&i&&this.reportingAgent))return;this._miscData.lastMediaCDNServer&&(i.LastMediaCDNServer=this._miscData.lastMediaCDNServer),this._miscData.serverInfo&&(i.ServerInfo=this._miscData.serverInfo),i.MaxVideoQltyIndex=this._dimensionData.maxVideoQltyIndex,i.MaxReWd=this._dimensionData.maxReWd,i.MaxReHt=this._dimensionData.maxReHt,i.IsGapless=this._hls.inGaplessMode,i.IsAudioOnly=this._hls.streamController.gaplessAllowed,this._hls.config.gapless&&this._hls.eventReporter.getFirstInstance()&&(e===U||6111===e||e===V)?i.IsFirstItem=!0:i.IsFirstItem=this._hls.isFirstItem,i.ItemID=this._hls.sessionID+"-"+this.currentItemId;let s={};t.forEach(e=>{let t=i[e];if(isNaN(t)||(t=Number(Number(t).toFixed(2))),"object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(s[r]=t[r]);else s[e]=t});const r=e===U||e===V?1:0;this.reportingAgent.issueReportingEvent(e,s,r)}_findTimeWeightedValues(e){let t={};if(e){let i=0,s=0,r=0,n=0,a=0;Object.values(e).forEach(e=>{e.playTime&&(s+=e.bandwidth*e.playTime,i+=e.brRnk*e.playTime,r+=e.playTime,e.avgBandwidth&&(n+=e.avgBandwidth*e.playTime,a+=e.playTime))}),r&&(t.twBRnk=i/r,t.twIBR=s/r),n&&a&&(t.twIABR=n/a)}return t}_getBufferedDuration(){let e=0;if(this.media&&this.media.buffered){let t=this.media.buffered;for(let i=0;i<t.length;i++)e+=t.end(i)-t.start(i)}return Math.round(1e3*e)}_getVariantInfo(e){return e&&this._miscData.manifestData&&this._miscData.manifestData.variantList&&this._miscData.manifestData.variantList[e]?this._miscData.manifestData.variantList[e]:{}}_getVideoFourCC(e){return e?e.split(",").map(e=>e.split(".")[0].trim()).find(e=>ce.hasOwnProperty(e)):e}_getVideoQualityIndex(e,t){return"object"==typeof ce[e]?ce[e][t]:ce[e]}_getNormalizedPeak(e,t){return"object"==typeof ce[t]?1.5*e:1*e}_getMaxNormalizedPeak(e){let t=0;return e.forEach(e=>{let i=e.attrs;if(i){let e=i.BANDWIDTH||0,s=this._getNormalizedPeak(e,this._getVideoFourCC(i.CODECS)),r=Math.max(e,s);t=r>t?r:t}}),t}_getBitrateRank(e,t,i){const s=Math.max(1,this._getNormalizedPeak(e,t));return Math.ceil(100*s/i)}_getCurrentMediaTimeMilliSec(){return this.media&&this.media.currentTime?Math.round(1e3*this.media.currentTime):0}_isBadSw(e,t,i,s,r,n){let a=!1,o=r.lastSwitchTime||0,l=r.lastSwitchDir||e;return i-o<s&&l!==e&&r.lastLevelIsIframe===t&&!n&&(a=!0),a}},_r=class extends N{constructor(e){super(e,n.b.MEDIA_ATTACHING,n.b.MEDIA_DETACHING,n.b.MANIFEST_LOADING,n.b.MANIFEST_LOADED,n.b.MANIFEST_PARSED,n.b.LEVEL_LOADED,n.b.FRAG_LOADING,n.b.FRAG_LOADED,n.b.FRAG_BUFFERED,n.b.KEY_LOADED,n.b.LEVEL_SWITCHED,n.b.KEY_REQUEST_STARTED,n.b.ITEM_TRANSITIONED,n.b.ERROR,n.b.INTERNAL_ERROR),this.enablePerformanceLogging=this.hls.config.enablePerformanceLogging,this.enableRtcReporting=this.hls.config.enableRtcReporting,this.firstInstance=!0,this.rtcAggregatorGroup={playingAggregator:void 0,loadingAggregator:void 0},this.media=null}destroy(){this._removeMediaEventListeners(this.media),N.prototype.destroy.call(this)}get accessLog(){let e=this._getAggregator();return e?e.accessLog:[]}get errorLog(){let e=this._getAggregator();return e?e.errorLog:[]}getFirstInstance(){return this.firstInstance}setAppData(e){this.appData=e}setRate(e){this.desiredRate=e,this._getAggregator()&&this._logAndReport("Set desired rate to: "+e,"desiredratechange",{rate:e})}onItemTransitioned(e){this._logAndReport("Variant end for itemId: "+e.prevItemId,"variantend"),this._logAndReport(null,"desiredratechange",{rate:0}),this._logAndReport("[QE Critical] Play ended for itemId "+e.prevItemId,"ended"),this.logger.info("Destroying RTC Aggregator, itemId: "+this.rtcAggregatorGroup.playingAggregator.currentItemId)(),this.rtcAggregatorGroup.playingAggregator.destroy(),this.firstInstance&&(this.firstInstance=!1),this.rtcAggregatorGroup.playingAggregator=this.rtcAggregatorGroup.loadingAggregator,this.rtcAggregatorGroup.loadingAggregator=void 0,this.setRate(this.hls.streamController.desiredRate),this._logAndReport("[QE Critical] [PlayerEvent]CanPlay","canplay"),this._logAndReport("[QE Critical] [PlayerState]Playing/rate="+this.desiredRate,"playing")}onMediaAttaching(e){this.media=e.media,this._addMediaEventListeners(this.media),this._getAggregator()&&this._getAggregator().setMedia(this.media)}onMediaDetaching(){let e=this.frag?this.frag.level:void 0;this._logAndReport("Variant end for level: "+e,"variantend"),this._logAndReport(null,"desiredratechange",{rate:0}),this._logAndReport("[QE Critical] Play ended","ended"),this._removeMediaEventListeners(this.media),clearInterval(this.timer),this._getAggregator()&&this._getAggregator().destroy()}onFragLoading(){this._logAndReport(null,"fragloading")}onFragLoaded(e){if(e&&e.frag){let t={fragType:e.frag.type,adt:e.stats.tload-e.stats.trequest,processTime:e.stats.tdataack-e.stats.tload,bytes:e.stats.total,duration:e.frag.duration||0,startPTS:e.frag.start,endPTS:e.frag.start+e.frag.duration,contentType:e.stats.contentType,cdnServer:e.stats.cdnServer,serverInfo:e.serverInfo};this._logAndReport(null,"fragloaded",t)}}onFragBuffered(e){if(e&&e.frag){let t=e.stats,i={fragType:e.frag.type,adt:t.tload-t.trequest,processTime:t.tdataack-t.tload,parseTime:t.tparsed-t.tdataack,bytes:t.total};this._logAndReport(null,"fragbuffered",i)}}onKeyLoaded(e){"AES-128"===e.decryptdata.method&&this._logAndReport(null,"segmentkeyloaded",{adt:e.stats.tload-e.stats.trequest,timestamp:e.timestamp})}onKeyRequestStarted(e){this._logAndReport(null,"spcrequested",e)}findCurLevelInfo(e){let t=this.hls.levelController.variantManager.getVariantInfo(e);return t||this.logger.warn(`Level ${e} is missing from variantManager`)(),t}onLevelSwitched(e){let t=this.level,i=this.level=e.level;t>=0&&this._logAndReport("Variant end for level: "+t,"variantend");let s=this.findCurLevelInfo(i);if(s){let r=JSON.stringify(s,["bitrate","bandwidth","avgBandwidth","width","height"])+" "+JSON.stringify(s.attrs,["CODECS","FRAME-RATE"]);e.url=s.url,e.isSeeking=this.isSeeking,this._logAndReport(`[QE Critical] Playing level switch from ${t} to ${i}. ${r}`,"levelswitched",e)}}onManifestLoading(){let e=void 0,t=void 0;if(this.hls.userInfo&&(this.enableRtcReporting=this.hls.userInfo.diagnosticsAndUsage||this.hls.userInfo.internalBuild),this.hls.config.enableRtcReporting&&!this.enableRtcReporting&&(this.enableRtcReporting=!0),this.hls.playingItem.itemId===this.hls.loadingItem.itemId){let i=this.hls.playingItem.appData;this.rtcAggregatorGroup.playingAggregator=new vr(this.hls,this.enableRtcReporting,this.hls.config,i),this.rtcAggregatorGroup.playingAggregator.currentItemId=this.hls.playingItem.itemId,e=this.hls.playingItem.itemId,t=i&&i.reportingAgent?i.reportingAgent.SessionID:void 0}else{let i=this.hls.loadingItem.appData;this.rtcAggregatorGroup.loadingAggregator=new vr(this.hls,this.enableRtcReporting,this.hls.config,i),this.rtcAggregatorGroup.loadingAggregator.currentItemId=this.hls.loadingItem.itemId,e=this.hls.loadingItem.itemId,t=i&&i.reportingAgent?i.reportingAgent.SessionID:void 0}let i=this._getAggregator();if(i&&(this.media&&!i.getMedia()&&i.setMedia(this.media),this.desiredRate&&!i.getDesiredRate())){let e=this.desiredRate;this._logAndReport("Set desired rate to: "+e,"desiredratechange",{rate:e})}this.logger.info(`[QE Critical] isGapless: ${this.hls.inGaplessMode}, isAudioOnly: ${this.hls.streamController.gaplessAllowed}, isFirstItem: ${this.hls.isFirstItem}, SessionID: ${t}, sub itemID: ${e}`)()}onManifestLoaded(e){this._logAndReport(null,"manifestloaded",{adt:e.stats.tload-e.stats.trequest,contentType:e.stats.contentType})}onManifestParsed(e){this._logAndReport(null,"manifestparsed",e)}onLevelLoaded(e){let t={url:e.details.url,targetduration:e.details.targetduration,adt:e.stats.tload-e.stats.trequest,contentType:e.stats.contentType,playlistType:e.playlistType};this._logAndReport(null,"levelloaded",t)}onError(e){return this.onInternalError(e)}onInternalError(e){if(e){let t={details:e.details,fatal:e.fatal,type:a.g.MEDIA_ERROR};e.type===a.g.NETWORK_ERROR?(t.type=e.type,t.code=e.response?e.response.code:void 0,e instanceof a.p&&(e.fatal||(t.failedSwitchUrl=e.url,t.isSeeking=this.isSeeking,this._logAndReport(null,"levelloaderror",t))),this._logAndReport("Network Error","nwerror",t)):e.type!==a.g.MEDIA_ERROR&&e.type!==a.g.MUX_ERROR&&e.type!==a.g.KEY_SYSTEM_ERROR&&e.type!==a.g.OTHER_ERROR||(e.details!==a.d.BUFFER_STALLED_ERROR||e.fatal?this._logAndReport("Media Error","mediaerror",t):e.response.code===a.f.InsufficientDataAvailable.code?this._logAndReport("[QE Critical] Buffer stalled due to insufficient data","bufferstalled"):this._logAndReport("Stalled due to high buffer (media engine)","mediaenginestalled"))}}notifyKeySessionEvent(e,t){switch(t.timestamp=Date.now(),e){case"spcreceived":this._logAndReport(null,"spcreceived",t);break;case"spcsubmitted":this._logAndReport(null,"spcsubmitted",t);break;case"spccreated":this._logAndReport(null,"spccreated",t),this._logAndReport(null,"ckcrequested",t);break;case"ckcsubmitted":this._logAndReport(null,"ckcreceived",t),this._logAndReport(null,"ckcsubmitted",t);break;case"ckcprocessed":this._logAndReport(null,"ckcprocessed",t);break;case"keyaborted":this._logAndReport(null,"keyaborted",t);break;case"spcerror":this._logAndReport(null,"spcerror",t);break;case"ckcerror":this._logAndReport(null,"ckcerror",t)}}_getAggregator(){if(void 0!==this.hls.playingItem&&void 0!==this.hls.loadingItem)return this.hls.playingItem.itemId!==this.hls.loadingItem.itemId?this.rtcAggregatorGroup.loadingAggregator:this.rtcAggregatorGroup.playingAggregator}_timeRangeToArray(e){let t=[];for(let i=0;i<e.length;i++)t.push([e.start(i),e.end(i)]);return t}_isWebkitMediaElement(e){return"webkitDroppedFrameCount"in e}_isHtmlVideoElement(e){return"getVideoPlaybackQuality"in e}_videoPlaybackInfo(){let e=this.hls.media;if(!e)return;let t,i,s={readyToPlay:e.readyState>=e.HAVE_FUTURE_DATA,playbackLikelyToKeepUp:this.hls.playbackLikelyToKeepUp,rate:e.playbackRate,paused:e.paused,position:e.currentTime,duration:e.duration,seekableTimeRanges:this._timeRangeToArray(e.seekable),loadedTimeRanges:this._timeRangeToArray(e.buffered)};if(this._isHtmlVideoElement(e)){let r=e.getVideoPlaybackQuality;if(r&&typeof r==typeof Function){let r=e.getVideoPlaybackQuality();t=s.droppedVideoFrames=r.droppedVideoFrames,s.corruptedVideoFrames=r.corruptedVideoFrames,s.totalVideoFrames=r.totalVideoFrames,i=s.totalVideoFrames-t}}else this._isWebkitMediaElement(e)&&(t=s.droppedVideoFrames=e.webkitDroppedFrameCount,i=s.decodedFrameCount=e.webkitDecodedFrameCount);this._logAndReport("[QE Critical] hls player: "+JSON.stringify(s),"playbackinfo",{droppedVideoFrames:t,decodedFrameCount:i})}_addMediaEventListeners(e){e&&(this.onloadstart=this._onloadstart.bind(this),this.onpause=this._onpause.bind(this),this.onplaying=this._onplaying.bind(this),this.onseeking=this._onseeking.bind(this),e.addEventListener("loadstart",this.onloadstart),e.addEventListener("pause",this.onpause),e.addEventListener("playing",this.onplaying),e.addEventListener("seeking",this.onseeking))}_removeMediaEventListeners(e){e&&(e.removeEventListener("loadstart",this.onloadstart),e.removeEventListener("pause",this.onpause),e.removeEventListener("playing",this.onplaying),e.removeEventListener("seeking",this.onseeking))}_onloadstart(){this.timer&&clearInterval(this.timer),this.timer=setInterval(this._videoPlaybackInfo.bind(this),1e3),this._logAndReport("[QE Critical] [PlayerEvent]LoadStart")}_onpause(){this._logAndReport("[QE Critical] [PlayerState]Paused/rate=0","pause"),this._logAndReport("[QE Critical] [PlayerEvent]Paused")}_onplaying(){this.timer||(this.timer=setInterval(this._videoPlaybackInfo.bind(this),1e3)),this._logAndReport("[QE Critical] [PlayerEvent]CanPlay","canplay"),this._logAndReport("[QE Critical] [PlayerState]Playing/rate="+this.desiredRate,"playing"),this.isSeeking=!1,this.logger.info("[QE Critical] [PlayerEvent]Playing, sessionID: "+this.hls.sessionID+"-"+this.hls.playingItem.itemId)()}_onseeking(){this._logAndReport("[QE Critical] [PlayerEvent]Seeking"),this.isSeeking=!0}_logAndReport(e,t,i){this.enablePerformanceLogging&&e&&this.logger.info(e)(),this._getAggregator()&&t&&this._getAggregator().notify(t,i)}},br=class{constructor(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0,this.numSamples_=0}sample(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e,this.numSamples_++}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}};!function(e){e.LowBandwidth="LowBandwidth",e.HighBandwidth="HighBandwidth"}(yr||(yr={}));class Tr extends N{constructor(e){super(e,n.a.MEDIA_ATTACHING,n.a.MEDIA_DETACHING,n.a.LEVEL_PTS_UPDATED,n.a.LEVEL_UPDATED,n.a.AUDIO_TRACK_LOADED),this._needsFlush=!1,this._needsEos=!1,this.bufferCodecEventsExpected=0,this.numAppended=0,this.flushBufferCounter=0,this.postFlushAction=void 0,this.postFlushContext=void 0,this.sbInfoMap=new Map,this.parentToTrackName=new Map,this.flushRange=[],this._msDuration=null,this._levelDuration=null,this.pendingTracks=new Map,this.trackCodecByCC={},this.parentInitInfo={},this.invalidSourceBufferNb=0,this.sourceBufferTimeout=1e4,this.alwaysResetOnNewCC=e.config.alwaysResetOnNewCC}get totalItemDuration(){return this.postFlushContext?this.postFlushContext.duration:this._msDuration}destroy(){this.sbInfoMap.forEach(e=>{this.abortPendingAppendsInternal(e,0,Number.POSITIVE_INFINITY)}),this._clearTimer(),N.prototype.destroy.call(this)}_clearTimer(){this.sbOpenTimer&&(clearTimeout(this.sbOpenTimer),this.sbOpenTimer=null)}onLevelPtsUpdated(e){if("audio"===e.type&&this.updateMp3Timestamps){let t=this.sbInfoMap.get("audio");if(t&&t.sourceBuffer){let i=t.sourceBuffer;if(Math.abs(i.timestampOffset-e.start)>.1){let t=i.updating;try{i.abort()}catch(e){t=!0,this.logger.warn("can not abort audio buffer: "+e)()}t?this.audioTimestampOffset=e.start:(this.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start)(),i.timestampOffset=e.start)}}}this.onLevelUpdated(e)}setExpectedSB(e,t,i){let s=0;i&&(t||e)&&(s=(t?1:0)+(e?1:0)),this.sourceBufferNb=s,this.pendingTracks.clear()}onMediaAttaching(e){this.logger.info("media source attaching")();let t=this.media=e.media;if(t){var i=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(i),this._objectUrl=t.src,this.sbOpenTimer||(this.sbOpenTimer=setTimeout(this._handleMediaSourceTimeout.bind(this),this.sourceBufferTimeout))}}onMediaDetaching(){this.logger.info("media source detaching")();var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){this.logger.error(`onMediaDetaching:${e.message} while calling endOfStream`)()}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):this.logger.warn("media.src was changed by a third party - skip cleanup")()),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks.clear(),this.parentInitInfo={},this.parentToTrackName.clear(),this.sbInfoMap.forEach(e=>{this.abortPendingAppendsInternal(e,0,Number.POSITIVE_INFINITY)}),this.sbInfoMap.clear(),this.flushRange=[],this.numAppended=0,this.currentCC=void 0,this.updateMp3Timestamps=!1,this.postFlushAction=void 0,this.postFlushContext=void 0}this.onmso=this.onmse=this.onmsc=null,this._clearTimer(),this.resettingMediaSource||this.hls.trigger(n.a.MEDIA_DETACHED)}resetLoadSource(){this.parentInitInfo={}}_handleMediaSourceTimeout(){this.logger.warn("Timeout while waiting for sourceopen callback from MediaSource")(),this.sbOpenTimer=null}onMediaSourceOpen(){if(this._clearTimer(),this.resettingMediaSource){this.resettingMediaSource=!1,this.updateMediaElementDuration();const e={media:this.media};this.hls.trigger(n.a.BUFFER_SOURCE_RESET,e)}else this.hls.trigger(n.a.MEDIA_ATTACHED,{media:this.media});let e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}ignoreSourceBuffer(e){let t=this.mediaSource;t&&t.sourceBuffers&&t.sourceBuffers.length>0?this.invalidSourceBufferNbAfterReset=e:(this.invalidSourceBufferNb=e,this.checkPendingTracks())}ensureCompatibleTracksForGaplessPlayback(e){let t=!0;const i=this.sbInfoMap;if(Zs.find(e=>i.get(e)&&i.get(e).sourceBuffer))for(let s=0;s<Zs.length&&t;++s){let r=Zs[s],n=i.get(r)&&i.get(r).sourceBuffer,a=e.get(r);if(n&&a){let e=this.pickCodec(a.codec,a.levelCodec);t=Oi.b.isCompatibleCodecString(e,n.codec)}else(n||a)&&(t=!1)}else this.logger.info("no sourceBuffer")();return t}matchSourceBufferCount(){const e=this.pendingTracks.size;let t=this.sourceBufferNb-this.invalidSourceBufferNb,i=e&&(t<=e||0===t);return i&&this.hls.isPreloadingItem&&((i=this.ensureCompatibleTracksForGaplessPlayback(this.pendingTracks))||this.hls.dequeueSource(a.m.InvalidFormat)),i}checkPendingTracks(){this.matchSourceBufferCount()&&(this.createSourceBuffers(this.pendingTracks),this.pendingTracks.clear(),this.doAppendAll())}onMediaSourceClose(){}onMediaSourceEnded(){}static updateBufferedInfo(e,t){let i=0,s=[];e.buffered.forEach(e=>{if(e.startPTS>=e.endPTS)return;let r=t.find(t=>!(t.start>e.endPTS||t.end<=e.startPTS));if(r){let t=Math.max(r.start,e.startPTS),n=Math.min(r.end,e.endPTS);i+=e.bytes*(n-t)/(e.endPTS-e.startPTS),s.push(e)}}),e.totalBytes=i,e.buffered=s}static mergeToBuffer(e,t){let i=Array.from(e);return i.forEach(e=>{let i=Math.max(t.startPTS,e.startPTS),s=Math.min(t.endPTS,e.endPTS);i>=s||(e.bytes=(1-(s-i)/(e.endPTS-e.startPTS))*e.bytes,e.startPTS<t.startPTS?e.endPTS=i:e.startPTS=s)}),i.push(t),(i=i.filter(e=>e.bytes>0)).sort((e,t)=>e.startPTS-t.startPTS),i}onSBUpdateEnd(e){if(this.audioTimestampOffset){let e=this.sbInfoMap.get("audio");if(e&&e.sourceBuffer){let t=e.sourceBuffer;this.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset)(),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos();let t=this.ensureSBInfo(e),i=t.parent,s=t.inFlight;t.inFlight=void 0,s&&(this.logAppendTiming(i,s,"appended"),Object(Oi.c)(s.startPTS)&&Object(Oi.c)(s.endPTS)&&(t.buffered=Tr.mergeToBuffer(t.buffered,s)));let r=0,a=this.parentToTrackName.get(i);a&&a.forEach(e=>{r+=this.ensureSBInfo(e).appendQueue.length});let o={};this.sbInfoMap.forEach((e,t)=>{e.sourceBuffer&&(o[t]=e.sourceBuffer.buffered,Tr.updateBufferedInfo(e,Fs.buffered(e.sourceBuffer)),e.totalBytes>e.maxTotalBytes&&(e.maxTotalBytes=e.totalBytes))});let l={parent:i,pending:r,timeRanges:o,frag:s?s.frag:void 0};this.hls.trigger(n.a.BUFFER_APPENDED,l),this._needsFlush||this.doAppending(e),this.updateMediaElementDuration()}onSBUpdateError(e,t){this.logger.error("sourceBuffer error:",t)();let i=this.sbInfoMap.get(e).parent,s=new a.b(a.g.MEDIA_ERROR,a.d.BUFFER_APPENDING_ERROR,!1,t.message,a.f.VideoDecoderBadDataErr,i,e);this.hls.trigger(n.a.INTERNAL_ERROR,s)}resetMediaSource(e=!1){if(this.media&&!this.resettingMediaSource){let t=this.media;this.resettingMediaSource=!0,this.resetBuffer(e),this.hls.trigger(n.a.BUFFER_SOURCE_RESETTING),this.onMediaDetaching(),this.onMediaAttaching({media:t})}}resetBuffer(e=!1){this.sbInfoMap.forEach(e=>{this.abortPendingAppendsInternal(e,0,Number.POSITIVE_INFINITY);let t=e.sourceBuffer;if(t)try{this.mediaSource.removeSourceBuffer(t),t.removeEventListener("updateend",e.onupdateend),t.removeEventListener("error",e.onerror)}catch(e){this.logger.error(e)()}}),this._needsFlush=!1,this.parentToTrackName.clear(),this.sbInfoMap.clear(),this.flushRange=[],this.numAppended=0,e?(this.invalidSourceBufferNb=0,this.invalidSourceBufferNbAfterReset=void 0):this.invalidSourceBufferNbAfterReset?(this.invalidSourceBufferNb=this.invalidSourceBufferNbAfterReset,this.invalidSourceBufferNbAfterReset=void 0):this.invalidSourceBufferNb=0}createBuffer(e,t,i,s,r,n){let a=0;for(let o of this.sbInfoMap.values())o.sourceBuffer&&++a;if(0===a||this.hls.isPreloadingItem){this.pendingTracks.set(t,{codec:s,container:r,parent:e,cc:i,levelCodec:n});let a=this.mediaSource;a&&"open"===a.readyState&&this.checkPendingTracks()}}ensureSBInfo(e){let t=this.sbInfoMap.get(e);return t||(t={appendQueue:[],parent:void 0,inFlight:void 0,buffered:[],totalBytes:0,maxTotalBytes:0,gotQuotaExceeded:!1,appendErrors:0},this.sbInfoMap.set(e,t)),t}createSourceBuffers(e){const t=this.mediaSource;let i={};for(let[s,r]of e){let o=this.ensureSBInfo(s);if(!o.sourceBuffer){let l=this.pickHighestCodec(r.codec,r.levelCodec),h=`${r.container};codecs=${l}`;this.logger.info(`creating sourceBuffer(${h}) for codec/levelCodec ${r.codec}/${r.levelCodec}`)();try{let e=t.addSourceBuffer(h);e.codec=l,o.sourceBuffer=e,e.timestampOffset=-1*this.hls.config.audioPrimingDelay,o.onupdateend=e=>{this.onSBUpdateEnd(s)},o.onerror=e=>{this.onSBUpdateError(s,e)},e.addEventListener("updateend",o.onupdateend),e.addEventListener("error",o.onerror),i[s]={id:r.parent,codec:l,container:r.container,buffer:e},void 0!==this.currentCC&&this.currentCC!==r.cc?this.logger.error("createSourceBuffers: track cc mismatch!")():this.currentCC=r.cc,"audio"===s&&"audio/mpeg"===r.container&&(this.updateMp3Timestamps=!0)}catch(e){this.logger.error("error while trying to add sourceBuffer:"+e.message)();let t=new a.r(a.g.MEDIA_ERROR,a.d.BUFFER_ADD_CODEC_ERROR,!1,e.message,a.f.VideoDecoderBadDataErr);t.mimeType=h,this.hls.trigger(n.a.INTERNAL_ERROR,t)}}}this.hls.trigger(n.a.BUFFER_CREATED,{tracks:i})}pickCodec(e,t){return void 0===(e=t&&"vp09"===e?t.substring(0,13):e||t)?"":e}pickHighestCodec(e,t){let i=e||t;return Oi.b.isVideoCodec(i)&&i.split(",").length<2&&(i=this.hls.levelController.variantManager.getHighestCodecByFamily(e)),void 0===i?"":i}updateKnownCodecs(e,t,i,s){let r=!0;if(i=this.pickCodec(i,s),this.trackCodecByCC[e]||(this.trackCodecByCC[e]={}),this.trackCodecByCC[e][t]){let s=this.trackCodecByCC[e][t];r=r&&Oi.b.isCompatibleCodecString(s,i)}return this.trackCodecByCC[e][t]=i,r}isTrackCompatibleTransition(e,t){let i=this.currentCC;if(void 0===i||i===t)return"yes";if(this.alwaysResetOnNewCC)return"no";let s,r=this.trackCodecByCC,n=r[e]&&r[e][i]?r[e][i]:void 0,a=r[e]&&r[e][t]?r[e][t]:void 0;return n&&a?s=Oi.b.isCompatibleCodecString(n,a)?"yes":"no":(r.audiovideo&&r.audiovideo[i]&&(r.video&&r.video[t]||r.audio&&r.audio[t])||(r.audio&&r.audio[i]||r.video&&r.video[i])&&r.audiovideo&&r.audiovideo[t]||a)&&(s="no"),s}isParentCompatibleTransition(e,t){return"main"===e?this.trackCodecByCC.audiovideo?this.isTrackCompatibleTransition("audiovideo",t):this.isTrackCompatibleTransition("video",t):"audio"===e?this.isTrackCompatibleTransition("audio",t):"unknown"}isCompatibleTransitionWithSeparateSourceBuffers(e){let t=this.isTrackCompatibleTransition("video",e),i=2===this.sourceBufferNb?this.isTrackCompatibleTransition("audio",e):"yes",s="unknown";return"no"===t||"no"===i?s="no":"yes"===t&&"yes"===i&&(s="yes"),s}isCompatibleTransitionWithCombinedSourceBuffer(e){return this.isTrackCompatibleTransition("audiovideo",e)}isCompatibleTransition(e){var t;return isNaN(e)?"unknown":null!==(t=this.trackCodecByCC.audiovideo)&&void 0!==t&&t?this.isCompatibleTransitionWithCombinedSourceBuffer(e):this.isCompatibleTransitionWithSeparateSourceBuffers(e)}appendBuffer(e,t,i,s,r,n,a){let{level:o,sn:l,cc:h}=a,d={level:o,sn:l,cc:h};a.decryptdata&&a.decryptdata.keyId&&(d.decryptdata={keyId:a.decryptdata.keyId});let c={type:e,data:t,startPTS:i,endPTS:s,parent:r,content:n,frag:d};this._needsFlush&&this.logger.warn(`Flush is in process and type/content: ${e}/${n} will not be appended, sn/cc/level ${l}/${h}/${o}`)();let u=this.parentToTrackName.get(r);if(u||(u=new Set,this.parentToTrackName.set(r,u)),u.add(e),!this._needsFlush){let t=this.ensureSBInfo(e);t.parent&&t.parent!==r&&this.logger.warn(`Unexpected parent for ${e} ${t.parent} !== ${r}`)(),t.appendQueue.push(c),this.doAppending(e)}}scheduleAppendRetry(e,t){let i=this.sbInfoMap.get(e);i&&(clearTimeout(i.retryTimeout),i.retryTimeout=setTimeout(()=>{this.doAppending(e)},t))}getCurrentInitInfoForParent(e){return this.parentInitInfo[e]}clearTrackNamesForParent(e){this.parentToTrackName.delete(e)}hasPendingAppends(e){let t=!1,i=this.parentToTrackName.get(e);return i&&i.forEach(e=>{let i=this.sbInfoMap.get(e);i&&(t=t||i.appendQueue.length>0||void 0!==i.inFlight)}),t}abortPendingAppendsByParent(e,t,i){let s=this.parentToTrackName.get(e);s&&s.forEach(e=>{this.abortPendingAppendsByType(e,t,i)})}abortPendingAppendsByType(e,t,i){let s=this.sbInfoMap.get(e);s&&this.abortPendingAppendsInternal(s,t,i)}abortPendingAppendsInternal(e,t,i){e.appendQueue=e.appendQueue.filter(e=>e.endPTS<=t||e.startPTS>=i),e.retryTimeout&&(clearTimeout(e.retryTimeout),e.retryTimeout=void 0)}getEstimatedMaxBuffer(e){let t=this.sbInfoMap.get(e);return t&&t.sourceBuffer&&t.gotQuotaExceeded?t.maxTotalBytes:Number.POSITIVE_INFINITY}endBuffer(e){this.sbInfoMap.forEach((t,i)=>{if(!e||i===e){let e=t.sourceBuffer;e&&!e.ended&&(e.ended=!0,this.logger.info(i+" sourceBuffer now EOS")())}}),this.checkEos()}checkEos(){var e=this.sbInfoMap,t=this.mediaSource;if(t&&"open"===t.readyState){for(let t of e.values()){let e=t.sourceBuffer;if(e){if(!e.ended)return;if(e.updating)return void(this._needsEos=!0)}}this.logger.info("all media data available, signal endOfStream() to MediaSource and stop loading fragment")();try{t.endOfStream()}catch(e){this.logger.warn("exception while calling mediaSource.endOfStream()")()}this._needsEos=!1}else this._needsEos=!1}flushBufferRange(e,t,i,s=!1,r,n){i?this.abortPendingAppendsByType(i,e,t):this.sbInfoMap.forEach(i=>{this.abortPendingAppendsInternal(i,e,t)}),this.flushRange.push({start:e,end:t,type:i,forceAll:s}),this.flushBufferCounter=0,n?(r&&this.postFlushContext&&(r.duration===this.postFlushContext.duration?this.logger.warn(`[gapless] duplicated EVICT_ITEMs: flush(${e}, ${t}, ${r.duration}) vs flush(${this.postFlushContext.duration},infinity); media duration ${this.media.duration}`)():this.logger.error(`[gapless] different EVICT_ITEMs overlapped: flush(${e}, ${t}, ${r.duration}) vs flush(${this.postFlushContext.duration},infinity); media duration ${this.media.duration}`)()),this.postFlushAction=n,this.postFlushContext=r):this.postFlushAction&&this.logger.info(`[gapless] flush(${e}, ${t}) overlap EVICT_ITEM flush(${this.postFlushContext?this.postFlushContext:"undefined"},infinity); media duration ${this.media.duration}`)(),this.doFlush()}onLevelUpdated(e){let t=e.details;t&&0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}onAudioTrackLoaded(e){this.onLevelUpdated(e)}updateMediaElementDuration(){let e=this.media,t=this.mediaSource,i=this._levelDuration;if(null===i||!e||!t||"open"!==t.readyState)return;if(Zs.find(e=>this.isSourceBufferUpdating(e)))return;let s=e.duration;if(null===this._msDuration||!isFinite(s)||i>this._msDuration&&i>s)try{t.duration=i,this._msDuration=i}catch(e){this.logger.error("Exception setting mediasource duration "+e.message)()}}isSourceBufferUpdating(e){if(er(e)){let t=this.sbInfoMap.get(e);return void 0!==t&&void 0!==t.sourceBuffer&&t.sourceBuffer.updating}let t=!1;for(let[i,s]of this.sbInfoMap.entries()){let e=s.sourceBuffer;e&&(e.updating&&this.logger.warn(`sourceBuffer '${i}' is busy`)(),t=t||e.updating)}return t}sourceBufferHasProperInitSegment(e,t){const i=this.parentInitInfo[e];return!!i&&Object(Us.c)(t)===Object(Us.c)(i)}updateDurationAfterEvictItem(e){this.logger.info("[gapless] media duration after EVICT_ITEM flush = "+e)(),this._msDuration=this._levelDuration=e,this.mediaSource.duration=e}shouldEvictItem(){return void 0!==this.postFlushAction}ensureItemEvicted(){let e=!1;return this.shouldEvictItem()&&!this.isSourceBufferUpdating()&&(this.postFlushAction(this.postFlushContext),this.postFlushAction=void 0,this.postFlushContext=void 0,e=!0),e}evictItemCompleted(){return this.ensureItemEvicted(),!this.shouldEvictItem()}doFlush(){let e=!this.shouldEvictItem();for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type,t.forceAll))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var i=0;try{this.sbInfoMap.forEach(e=>{i+=e.sourceBuffer.buffered.length})}catch(e){this.logger.error("error while accessing sourceBuffer.buffered")()}this.numAppended=i,this.hls.trigger(n.a.BUFFER_FLUSHED,{seekAfterFlush:e})}}doAppendAll(){for(let e of this.sbInfoMap.keys())this.doAppending(e)}doAppending(e){let t=this.ensureSBInfo(e),i=t.appendQueue;if(clearTimeout(t.retryTimeout),t.retryTimeout=void 0,0===i.length||!this.media)return;if(this.media.error)return this.logger.error("trying to append although a media error occured, flush segment and abort")(),void this.sbInfoMap.forEach(e=>{this.abortPendingAppendsInternal(e,0,Number.POSITIVE_INFINITY)});let s=t.sourceBuffer;if(!s)return void this.logger.warn("Source buffer not yet created for "+e)();if(s.updating)return;let r=i.shift();try{const{type:e,frag:i,content:a,parent:o,startPTS:l,endPTS:h,data:d}=r;s.ended=!1,t.parent=o;let c={type:e,parent:o,content:a,frag:i,startPTS:l,endPTS:h};if(this.hls.trigger(n.a.BUFFER_APPENDING,c),t.inFlight={startPTS:l,endPTS:h,bytes:d.byteLength,tstart:performance.now(),frag:i},this.logAppendTiming(o,t.inFlight,"appending"),"data"===a){let e=this.parentInitInfo[o];const t=Object(Us.c)(i),s=e?Object(Us.c)(e):void 0;s!==t&&this.logger.error(`mismatching initSegment: ${s} to data: ${t}`)()}else if(this.alwaysResetOnNewCC&&"initSegment"===a){const e=this.parentInitInfo[o];if(e&&e.cc!==i.cc)throw{message:"alwaysResetOnNewCC detected cc switch without reset"}}if(s.appendBuffer(d),"initSegment"===a){const{cc:e,level:t,sn:s}=i;this.parentInitInfo[o]={cc:e,level:t,sn:s},i.decryptdata&&i.decryptdata.keyId&&(this.parentInitInfo[o].decryptdata={keyId:i.decryptdata.keyId})}t.appendErrors=0,this.numAppended++}catch(s){if(t.inFlight=void 0,this.logger.error("error while trying to append buffer:"+s.message)(),i.unshift(r),22!==s.code){let i=new a.b(a.g.MEDIA_ERROR,a.d.BUFFER_APPEND_ERROR,!1,s.message,a.f.VideoDecoderBadDataErr,r.parent,r.type);if(++t.appendErrors,t.appendErrors>this.hls.config.appendErrorMaxRetry)return this.logger.error(`fail ${this.hls.config.appendErrorMaxRetry} times to append segment in sourceBuffer`)(),this.abortPendingAppendsByType(e,0,Number.POSITIVE_INFINITY),i.fatal=!0,void this.hls.trigger(n.a.INTERNAL_ERROR,i);i.fatal=!1,this.hls.trigger(n.a.INTERNAL_ERROR,i)}else{t.gotQuotaExceeded=!0,Tr.updateBufferedInfo(t,Fs.buffered(t.sourceBuffer)),++t.appendErrors;let e=new a.b(a.g.MEDIA_ERROR,a.d.BUFFER_FULL_ERROR,!1,s.message,a.f.AllocationFailed,r.parent,r.type,t.maxTotalBytes);this.hls.trigger(n.a.INTERNAL_ERROR,e)}}}abortBuffer(e){let t=this.sbInfoMap.get(e);t&&(this.logger.warn("aborting any appends for "+e)(),t.sourceBuffer.abort(),delete this.parentInitInfo[t.parent])}flushBuffer(e,t,i,s=!1){let r,n,a,o;if(this.sbInfoMap.size>0)if(this.logger.info(`flushBuffer,pos/start/end/forceAll: ${this.media.currentTime.toFixed(3)}/${e}/${t}/${s}/${i}`)(),this.flushBufferCounter<this.numAppended)for(let[l,h]of this.sbInfoMap.entries()){if(i&&l!==i)continue;let d=h.sourceBuffer;if(d){if(d.ended=!1,d.updating)return this.logger.warn("cannot flush, sb updating in progress")(),!1;try{for(let i=0;i<d.buffered.length;i++)if(r=d.buffered.start(i),n=d.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,o=t):(a=Math.max(r,e),o=Math.min(n,t)),s&&Math.min(o,n)>a||Math.min(o,n)-a>.5)return this.flushBufferCounter++,d.remove(a,o),!1}catch(e){this.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")()}}}else this.logger.warn("abort flushing too many retries: "+this.hls.streamController.bufferedRangeString)();return!0}logAppendTiming(e,t,i){this.hls.config.enablePerformanceLogging&&this.logger.info("[timing] "+JSON.stringify({t:performance.now(),name:e,level:t.frag.level,sn:t.frag.sn,cc:t.frag.cc,startPTS:t.startPTS,endPTS:t.endPTS,stage:i}))()}}var Sr=Tr;class Er extends Es{constructor(e){super(e,n.b.AUDIO_TRACK_LOADED,n.b.PREFERRED_HOST_CHANGED)}destroy(){this.stopLoad(),this.levelLoader&&this.levelLoader.destroy(),this.variantManager&&this.variantManager.destroy(),N.prototype.destroy.call(this)}stopLoad(){this.levelLoader&&this.levelLoader.stop()}resetTracks(){this.trackId=void 0,this._selectedMediaOption=void 0}setTracks(e,t){let i=e.validVariantList;this.resetTracks(),this.setVariantManager(e),this._mediaSelectionGroup=t||{MediaSelectionGroupAllowEmptySelection:1,MediaSelectionGroupMediaCharacteristics:["public.audible"],MediaSelectionGroupMediaType:pi.AUDIO,MediaSelectionGroupOptions:[]};let s={audioTracks:i};if(this.hls.trigger(n.b.AUDIO_TRACKS_UPDATED,s),void 0===this.queuedPersistentID||this.selectedMediaOption){if(this.mediaSelectionOptions.length>0){let e=this.mediaSelectionOptions.find((function(e){return e.MediaSelectionOptionsIsDefault}));this.selectedMediaOption=e||this.mediaSelectionOptions[0]}}else{let e=Er.sanitizePersistentID(i,this.queuedPersistentID);e===this.queuedPersistentID||(this.queuedPersistentID=e),this.selectedPersistentID=this.queuedPersistentID,this.queuedPersistentID=void 0}}onPreferredHostChanged(e){if(e.mediaType===pi.AUDIO||isNaN(this.trackId)||this.trackId<0||0===this.variantManager.variantList.length)return;let t,i=this.variantManager&&this.variantManager.getVariantInfoIfValid(this.trackId),s=this.validTracks,r=i.groupCodecList;(t=s.find(e=>{let t=e.groupCodecList,s=!1;if(t.length===r.length&&1===t.length){let n=r[0],a=t[0];s=e.persistentID===i.persistentID&&Oi.b.isCompatibleAudioCodec(n,a)&&e.url&&un.hasAllowedHost(e.url,this.hls.preferredHostName)}return s}))&&(this.logger.warn("preemptively switching audio host to "+this.hls.preferredHostName)(),this.updateTrack(t.id))}onAudioTrackLoaded(e){if(this.variantManager&&this.variantManager.getVariantInfoIfValid(e.id)){let t=e.details,i=this.levelLoader.handleLevelLoad(e.id,t,e.stats);i.success||this.logger.error("Got error "+i.error)(),this.resolveTrackId(e.id).trackInfo.details=t}else this.logger.warn(`invalid audioTrack ${e.id} loaded`)()}getNextBestAutoVariant(e,t){t=t||this.hls.preferredHostName;let i=this.resolveTrackId(e).trackInfo;if(!i)return-1;let s=this.validTracks.find((function(e){return e.groupId&&e.groupId!==i.groupId&&e.persistentID===i.persistentID&&un.hasAllowedHost(e.url,t)}));return s?s.id:-1}resolveTrackId(e){let t,i;return!e&&0!==e||e<0?this.logger.warn("invalid trackID "+e)():this.variantManager&&(t=this.variantManager.getVariantInfoIfValid(e),i=this.variantManager.getVariantListPosition(e)),{trackInfo:t,trackListPosition:i}}containsFallbackVariant(e){let t=this.audioTrack;return-1!==this.getNextBestAutoVariant(t,e)}setNextAutoVariant(e){this.audioTrack=e}get validTracks(){return this.variantManager&&this.variantManager.validVariantList||[]}get currentVariantId(){return this.audioTrack}setVariantManager(e){this.levelLoader&&this.levelLoader.destroy(),this.variantManagerInternal=e,this.levelLoader=new Ss(e,e=>{this._loadTrackInternal(e)},()=>{this.hls.playlistLoader.abort("audioTrack")})}get variantManager(){return this.variantManagerInternal}get audioTrack(){return this.trackId}set audioTrack(e){if(!this.validTracks)return;let t=this.resolveTrackId(e).trackInfo;t?this.trackId===e&&void 0!==t.details||this.setAudioTrackInternal(e):this.logger.error(`[audio] Invalid track set ${e} ${(new Error).stack}`)()}get mediaSelectionGroup(){return this._mediaSelectionGroup}get mediaSelectionOptions(){return this.mediaSelectionGroup?this.mediaSelectionGroup.MediaSelectionGroupOptions:[]}get selectedPersistentID(){return this.selectedMediaOption?this.selectedMediaOption.MediaSelectionOptionsPersistentID:-1}set selectedPersistentID(e){if(e>=0&&!this._mediaSelectionGroup)return void(this.queuedPersistentID=e);let t=this.mediaSelectionOptions.find((function(t){return t.MediaSelectionOptionsPersistentID===e}));this.selectedMediaOption=t}get selectedMediaOption(){return this._selectedMediaOption}set selectedMediaOption(e){this._selectedMediaOption=e,this.updateTrackSelection()}updateTrackSelection(){if(!this._selectedMediaOption)return;let e=this._selectedMediaOption.MediaSelectionOptionsPersistentID,t=this.validTracks.find(t=>e===t.persistentID&&t.url&&un.hasAllowedHost(t.url,this.hls.preferredHostName));t?this.audioTrack=t.id:this.logger.warn("could not find audio track for selected media group: "+this._selectedMediaOption.MediaSelectionOptionsName+" with ID: ("+e+")")()}setAudioTrackInternal(e){if(this.trackId!==e){this.trackId=e;let t=this.resolveTrackId(e).trackInfo,i=this.hls,s={id:e,type:t.type,url:t.url};this.logger.info(`[QE Critical] switching to audioTrack ${e} - ${t.name}`)(),i.trigger(n.b.AUDIO_TRACK_SWITCH,s),i.trigger(n.b.AUDIO_TRACK_SWITCHING,s)}this.levelLoader.loadLevel(e)}updateTrack(e){this.setAudioTrackInternal(e)}_loadTrackInternal(e){let t=e.url,i=e.id;t&&(this.logger.info("[QE Critical] (re)loading playlist for audioTrack "+i)(),this.hls.playlistLoader.loadAudioTrack(t,i).then(function(e){this.hls.trigger(n.b.AUDIO_TRACK_LOADED,e)}.bind(this)).catch(e=>{this._handleMediaPlaylistNetworkError(e,!1)}))}_attemptRetry(e,t){let i=this.hls.playlistLoader.retryPlaylistRequest(e);return i?i.then(()=>{this.hls.trigger(n.b.AUDIO_TRACK_LOADED,e)}).catch(e=>{this._handleMediaPlaylistNetworkError(e,t)}):void 0}static sanitizePersistentID(e,t){if(!e||!e.length)return t;let i;for(let s=0;s<e.length;s++){let r=e[s];if(r.persistentID===t){i=t;break}r.default&&(i=r.persistentID),i||"en-US"!==r.lang||(i=r.persistentID)}return i>=0?i:e[0].persistentID}}var wr=Er,Ir=i(13),Dr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Lr=function(e){var t=e;return Dr.hasOwnProperty(e)&&(t=Dr[e]),String.fromCharCode(t)},kr=100,Rr={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Cr={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ar={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Pr={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xr=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Mr={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var i=this.verboseFilter[e];this.verboseLevel>=i&&console.log(this.time+" ["+e+"] "+t)}},Or=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Nr{constructor(e,t,i,s,r){this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=s||"black",this.flash=r||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){var t;t=e,Object.assign(this,t)}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Fr{constructor(e,t,i,s,r,n){this.uchar=e||" ",this.penState=new Nr(t,i,s,r,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Br{constructor(){this.chars=[];for(var e=0;e<kr;e++)this.chars.push(new Fr);this.pos=0,this.currPenState=new Nr}equals(e){for(var t=!0,i=0;i<kr;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}copy(e){for(var t=0;t<kr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){for(var e=!0,t=0;t<kr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(Mr.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>kr&&(Mr.log("ERROR","Too large cursor position "+this.pos),this.pos=kr)}moveCursor(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();var t=Lr(e);this.pos>=kr?Mr.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){var t;for(t=e;t<kr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){for(var e=[],t=!0,i=0;i<kr;i++){var s=this.chars[i].uchar;" "!==s&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ur{constructor(){this.rows=[];for(var e=0;e<15;e++)this.rows.push(new Br);this.currRow=14,this.nrRollUpRows=null,this.reset()}reset(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){for(var t=!0,i=0;i<15;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){Mr.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){Mr.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<15;t++)this.rows[t].clear();var i=this.currRow+1-this.nrRollUpRows;const e=this.lastOutputScreen;if(e){var s=e.rows[i].cueStartTime;if(s&&s<Mr.time)for(let s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(e.rows[i+s])}}this.currRow=t;var r=this.rows[this.currRow];if(null!==e.indent){var n=e.indent,a=Math.max(n-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}var o={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(o)}setBkgData(e){Mr.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null!==this.nrRollUpRows){Mr.log("INFO","TEXT "+this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),Mr.log("INFO","Rolling up")}else Mr.log("DEBUG","roll_up but nrRollUpRows not set yet")}getDisplayText(e){e=e||!1;for(var t=[],i="",s=-1,r=0;r<15;r++){var n=this.rows[r].getTextString();n&&(s=r+1,e?t.push("Row "+s+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}}class Vr{constructor(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ur,this.nonDisplayedMemory=new Ur,this.lastOutputScreen=new Ur,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,Mr.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";Mr.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(Mr.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){Mr.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){Mr.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){Mr.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){Mr.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){Mr.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){Mr.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){Mr.log("INFO","TR"),this.setMode("MODE_TEXT")}ccRTD(){Mr.log("INFO","RTD"),this.setMode("MODE_TEXT")}ccEDM(){Mr.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){Mr.log("INFO","CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){Mr.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(Mr.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,Mr.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){Mr.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){var t={flash:!1,underline:!1,italics:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}Mr.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){var t=Mr.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class $r{constructor(e,t){this.handler=e,this.track=t,this.startTime=null,this.endTime=null,this.screen=null}dispatchCue(){null!==this.startTime&&(this.handler.addCues("cc"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.handler.createCaptionsTrack(this.track)}}function Gr(e,t,i){return e.substr(i||0,t.length)===t}function Hr(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()}function Kr(e){let t=Math.floor(e),i=t+.5,s=t+1;return e>=i?e-i>=s-e?s:i:e-t>=i-e?i:t}function jr(e,t=0,i=8589934592){if(!Number.isFinite(t))return e;const s=i/2,r=Math.abs(e-t)%i;return t+(e>t?-1:1)*(r>s?i-r:-r)}const Wr=e=>"cc1"===e||"cc2"===e;function qr(e){let t=[];for(let i=0;i<e.length;i++){let s=e[i];("captions"===s.kind||"subtitles"===s.kind||"metadata"===s.kind&&s.customTextTrackCueRenderer)&&t.push(s)}return t}function zr(e,t){return(e?e.id:void 0)===(t?t.id:void 0)}function Yr(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}class Xr extends N{constructor(e){super(e,n.b.MEDIA_ATTACHING,n.b.MEDIA_DETACHING,n.b.FRAG_PARSING_USERDATA,n.b.FRAG_PARSING_CAPTIONDATA,n.b.SUBTITLE_TRACKS_UPDATED,n.b.FRAG_LOADED,n.b.LEVEL_SWITCHING,n.b.INIT_PTS_FOUND,n.b.INLINE_STYLES_PARSED),this.hls=e,this.hls=e,this.config=e.config,this.enabled=!0,this.Cues=e.config.cueHandler,this.textTracks=[],this.tracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cueRanges=[],this.channelToTrackMap={},this.mediaAttached=!1,this.gotTracks=!1}addCues(e,t,i,s){const r=this.cueRanges;let n=!1;for(let d=r.length;d--;){let e=r[d],s=(a=e[0],o=e[1],l=t,h=i,Math.min(o,h)-Math.max(a,l));if(s>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],i),n=!0,s/(i-t)>.5))return}var a,o,l,h;n||r.push([t,i]),this.Cues.newCue(this.channelToTrackMap[e],t,i,s,this.media)}removeParsedFrag(e){let t=this.unparsedVttFrags.indexOf(e);t>-1&&this.unparsedVttFrags.splice(t,1)}onInitPtsFound(e){"main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS90k),this.unparsedVttFrags.length&&this.unparsedVttFrags.forEach(t=>{t.frag&&t.frag.cc===e.frag.cc?(this._processUnparsedVttFrags(t),this.removeParsedFrag(t)):this.logger.info(`[subtitle] ignore PTS ${e.initPTS90k} for cc ${e.frag.cc}; not for frag ${t.frag.sn} ${t.frag.cc}`)()})}forgetFragsWaitingForInitPTS(){let e=this.unparsedVttFrags;return e.length&&this.logger.info(`[subtitle] don't forget ${e.length} frags waiting for initPTS`)(),e}getExistingTrack(e){const t=this.media;if(t)for(let i=0;i<t.textTracks.length;i++){let s=t.textTracks[i],r="cc"+e;if(Wr(r)&&!0===s[r])return s}return null}sendAddTrackEvent(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}createCaptionsTrackGuts(e,t,i){let s="cc"+e;if(!this.channelToTrackMap[s]){let r=this.getExistingTrack(e);if(r)this.channelToTrackMap[s]=r,Yr(this.channelToTrackMap[s]),this.sendAddTrackEvent(this.channelToTrackMap[s],this.media);else{const e=this.createTextTrack("captions",t,i);e&&Wr(s)&&(e[s]=!0,this.channelToTrackMap[s]=e)}}return this.channelToTrackMap[s]}createCaptionsTrack(e){return this.createCaptionsTrackGuts(e,this.config["captionsTextTrack"+e+"Label"],this.config.captionsTextTrack1LanguageCode)}createTextTrack(e,t,i){const s=this.media;if(s){let r=!1;"metadata"!==e&&this.config.customTextTrackCueRenderer&&(r=!0,e="metadata");let n=s.addTextTrack(e,t,i);return r&&(n.customTextTrackCueRenderer=!0),n}}destroy(){N.prototype.destroy.call(this)}onMediaAttaching(e){this.media=e.media,this.mediaAttached=!0,this.attachSubtitleTracks()}onMediaDetaching(){Yr(this.textTrack1),Yr(this.textTrack2)}resetCCs(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0}}resetTracks(){this._cleanTracks(),this.cueRanges=[]}_cleanTracks(){const e=this.media;if(e){const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)Yr(t[e])}}getCuesOfEnabledTrack(e,t=!1){let i=[];if(t){let t=this._getCuesOfEnabledTrack(e);for(let e=0;e<t.length;e++){let s=t[e];Boolean(s.webVTTCue)&&i.push(s)}}else i=this._getCuesOfEnabledTrack(e);return i}_getCuesOfEnabledTrack(e){let t=this.textTracks[e];return t&&t.cues?Array.from(t.cues):null}attachSubtitleTracks(){this.mediaAttached&&this.gotTracks&&(this.tracks.forEach(e=>{let t;if("sbtl"===e.mediaType)t=this.createTextTrack("subtitles",e.name,e.lang);else{let i=1;e.inStreamID&&(i=Number(e.inStreamID.substring(2))),t=this.createCaptionsTrackGuts(i,e.name,e.lang)}this.textTracks.push(t)}),this.hls.trigger(n.b.SUBTITLE_TRACKS_CREATED))}onSubtitleTracksUpdated(e){this.resetCCs(),this._cleanTracks(),this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=e.subtitleTracks||[]),this.gotTracks=!0,this.attachSubtitleTracks()}onLevelSwitching(){this.enabled="NONE"!==this.hls.levelWithPersistentId(this.hls.levelController.level).levelInfo.closedcaption}onInlineStylesParsed(e){}hasDiscontinuityOffset(e){return this.vttCCs[e]}_processUnparsedVttFrags(e){let t=e.frag,i=e.payload;i.byteLength?this._parseVTTs(t,i):this.hls.trigger(n.b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})}processSubtitleFrag(e){let t=e.frag,i=e.payload;i.byteLength?"initSegment"===t.sn?this.hls.trigger(n.b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t}):isNaN(this.initPTS[t.cc])?(this.unparsedVttFrags.push(e),this.initPTS.length&&this.hls.trigger(n.b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})):this._parseVTTs(t,i):this.hls.trigger(n.b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})}onFragLoaded(e){let t=e.frag;if("main"===t.type&&"initSegment"!==t.sn){var i=t.sn;if(i!==this.lastSn+1){const e=this.cea608Parser;e&&e.reset()}this.lastSn=i}}_parseVTTs(e,t){let i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);let s=this.textTracks,r=this.hls;!function(e,t,i,s,r,n,a){let o=m.b.utf8arrayToStr(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",h=0,d=0,c=0,u=[],f=null,p=!0,g=!1;const y=new Ir.WebVTTParser(window,Ir.WebVTTParser.StringDecoder(),a);y.oncue=function(e){let t=i[s],r=i.ccOffset;t&&t.new&&(void 0!==d?r=i.ccOffset=t.start:function(e,t,i){let s=e[t],r=e[s.prevCC];if(!r||!r.new&&s.new)return e.ccOffset=e.presentationOffset=s.start,void(s.new=!1);for(;r&&r.new;)e.ccOffset+=s.start-r.start,s.new=!1,r=e[(s=r).prevCC];e.presentationOffset=i}(i,s,c)),c&&(r=c-i.presentationOffset),g&&(e.startTime=jr(e.startTime+r-d,0,95443.7176888889),e.endTime=jr(e.endTime+r-d,0,95443.7176888889)),e.id=Hr(Kr(e.startTime).toString())+Hr(Kr(e.endTime-e.startTime).toString())+Hr(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&u.push(e)},y.onparsingerror=function(e){f=e},y.onflush=function(){f&&n?n(f):r(u)},o.forEach(e=>{if(p){if(Gr(e,"X-TIMESTAMP-MAP=")){p=!1,g=!0,e.substr(16).split(",").forEach(e=>{Gr(e,"LOCAL:")?l=e.substr(6):Gr(e,"MPEGTS:")&&(h=parseInt(e.substr(7)))});try{h=jr(jr(h)-t,9e4*i.ccOffset),d=function(e){let t=parseInt(e.substr(-3)),i=parseInt(e.substr(-6,2)),s=parseInt(e.substr(-9,2)),r=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;return isNaN(t)||isNaN(i)||isNaN(s)||isNaN(r)?-1:(t+=1e3*i,t+=6e4*s,t+=36e5*r)}(l)/1e3,c=h/9e4,-1===d&&(f=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){g=!1,f=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(p=!1)}y.parse(e+"\n")}),y.flush()}(t,this.initPTS[e.cc],i,e.cc,t=>{const i=s[e.trackId];(t=t.filter(e=>!i.cues.getCueById(e.id))).map(t=>{try{i.addCue(t)}catch(e){this.logger.warn("retry addCue. Previous addCue failed: "+e.message)();const r=new VTTCue(t.startTime,t.endTime,t.text);r.id=t.id,i.addCue(r),t=r}return t.fragSN=e.sn,t.webVTTCue=!0,t}),r.trigger(n.b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e,cues:t})},t=>{r.trigger(n.b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},e=>{r.trigger(n.b.INLINE_STYLES_PARSED,{styles:e})})}_ensureParser(){if(!this.cea608Parser){var e=new $r(this,1),t=new $r(this,2);this.cea608Parser=new class{constructor(e=1,t,i){this.field=e,this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.channels=[new Vr(1,t),new Vr(2,i)],this.dataCounters={padding:0,char:0,cmd:0,other:0}}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,s,r,n=null;Mr.setTime(e);for(var a=0;a<t.length;a+=2)s=127&t[a],r=127&t[a+1],s>=16&&s<=31&&s===this.lastCmdA&&r===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,Mr.log("DEBUG","Repeated command ("+Or([s,r])+") is dropped")):0!==s||0!==r?(Mr.log("DATA","["+Or([t[a],t[a+1]])+"] -> ("+Or([s,r])+")"),(i=this.parseCmd(s,r))||(i=this.parseMidrow(s,r)),i||(i=this.parsePAC(s,r)),i||(i=this.parseBackgroundAttributes(s,r)),i||(n=this.parseChars(s,r))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(n):Mr.log("WARNING","No channel found yet. TEXT-MODE?")),i?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,Mr.log("WARNING","Couldn't parse cleaned data "+Or([s,r])+" orig: "+Or([t[a],t[a+1]])))):this.dataCounters.padding+=2}parseCmd(e,t){var i;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;i=20===e||23===e?1:2;var s=this.channels[i-1];return 20===e||21===e||28===e||29===e?32===t?s.ccRCL():33===t?s.ccBS():34===t?s.ccAOF():35===t?s.ccAON():36===t?s.ccDER():37===t?s.ccRU(2):38===t?s.ccRU(3):39===t?s.ccRU(4):40===t?s.ccFON():41===t?s.ccRDC():42===t?s.ccTR():43===t?s.ccRTD():44===t?s.ccEDM():45===t?s.ccCR():46===t?s.ccENM():47===t&&s.ccEOC():s.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0}parseMidrow(e,t){var i=null;if((17===e||25===e)&&32<=t&&t<=47){if((i=17===e?1:2)!==this.currChNr)return Mr.log("ERROR","Mismatch channel in midrow parsing"),!1;var s=this.channels[i-1];return s.insertChars([32]),s.ccMIDROW(t),Mr.log("DEBUG","MIDROW ("+Or([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1}parsePAC(e,t){var i,s;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;i=e<=23?1:2,s=64<=t&&t<=95?1===i?Rr[e]:Ar[e]:1===i?Cr[e]:Pr[e];var r=this.interpretPAC(s,t);return this.channels[i-1].setPAC(r),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0}interpretPAC(e,t){var i,s={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,s.underline=1==(1&i),i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((i-16)/2),s}parseChars(e,t){var i,s=null,r=null,n=null;if(e>=25?(s=2,n=e-8):(s=1,n=e),17<=n&&n<=19?(i=17===n?t+80:18===n?t+112:t+144,Mr.log("INFO","Special char '"+Lr(i)+"' in channel "+s),r=[i],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(r=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null),r){var a=Or(r);Mr.log("DEBUG","Char codes =  "+a.join(","))}return r}parseBackgroundAttributes(e,t){var i,s,r;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(i={underline:!1},16===e||24===e?(s=Math.floor((t-32)/2),i.background=xr[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),r=e<24?1:2,this.channels[r-1].setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,!0)}reset(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}cueSplitAtTime(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}(0,e,t)}}onFragParsingCaptiondata(e){if(this.enabled&&this.config.enableCEA708Captions){this._ensureParser();for(let t=0;t<e.samples.length;t++){let i=e.samples[t].pts,s=e.samples[t].bytes;for(let e=0;e<s.length;e+=2){let r=[];r.push(s[e]),e+1<s.length?r.push(s[e+1]):(this.logger.warn(`CEA608 sample ${t} not even length (index ${e+1} >= length ${s.length})`)(),r.push(80)),this.cea608Parser.addData(i,r),i+=1001/3e4}}}}onFragParsingUserdata(e){if(this.enabled&&this.config.enableCEA708Captions){this._ensureParser();for(let t=0;t<e.samples.length;t++){let i=Xr.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}}}static extractCea608Data(e){for(var t,i,s,r=31&e[0],n=2,a=[],o=0;o<r;o++)t=e[n++],i=127&e[n++],s=127&e[n++],0===i&&0===s||0!=(4&t)&&0==(3&t)&&(a.push(i),a.push(s));return a}}let Qr={maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},Jr={maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3};const Zr={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,defaultVideoCodec:void 0,debug:!1,debugLevel:void 0,buildType:void 0,minFramesBeforeSwitchingLevel:11,minTargetDurations:3,initialLiveManifestSize:1,maxBufferLength:30,maxBufferHole:.5,maxSeekHole:2,discontinuitySeekTolerance:2,almostDryBufferSec:.5,maxTotalDurationTolerance:.1,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,seekWatchdogPeriod:5,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveFlushExpiredFrags:!0,allowFastSwitchUp:!1,desiredIframeFPS:8,initialIframeFPS:6,minRemainingTimeInMediaPipeline:3,leftMediaTimeToAutoPause:10,startTargetDurationFactor:.9,enableWorker:!0,enableSoftwareAES:!0,keySystemPreference:void 0,clearMediaKeysOnPromise:!0,useMultipleKeySessions:!1,enablePlayReadyKeySystem:!1,useMediaKeySystemAccessFilter:!1,playReadyMessageFormat:"utf16",startLevel:void 0,livePlaylistRefreshDelay:2500,liveMinPlayingBufferLen:5,enableIFramePreloading:!0,useMediaCapabilities:!1,enableID3Cues:!0,manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,autoRetry:!1,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}},customURL:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:1e4,autoRetry:!1,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,autoRetry:!1,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}},customURL:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:1e4,autoRetry:!1,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:5e3,maxLoadTimeMs:2e4,autoRetry:!1,timeoutRetry:Qr,errorRetry:Jr,forceContentLenCheckIfNoHeader:!1,reportCDNServer:!0},customURL:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,autoRetry:!1,timeoutRetry:Qr,errorRetry:Jr,reportCDNServer:!0}},maxNumAddLevelToPenaltyBox:4,fragLoadingLoopThreshold:3,firstAudioMustOverlapVideoStart:!1,keyLoadingDefaultTimeout:2e4,keyLoadingMinTimeout:3e3,keyLoadingRetryDelay:1e3,keyRetryCountOnError:3,keyHoldTimeAfterExpiry:15e3,startFragPrefetch:!1,appendErrorMaxRetry:3,alwaysResetOnNewCC:!1,loader:g,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,abrController:class extends N{constructor(e){super(e,n.b.LEVELS_CHANGED,n.b.LEVEL_SWITCHING,n.b.FRAG_LOADING,n.b.FRAG_LOAD_PROGRESS,n.b.FRAG_LOADED,n.b.FRAG_BUFFERED,n.b.BUFFER_CHANGED,n.b.DESIRED_RATE_CHANGED,n.b.INTERNAL_ERROR),this._fragDownloadSlow=!1,this._fragDownloadTooSlow=!1,this._levelDownloadSlow=!1,this._highBWTrigger=Number.POSITIVE_INFINITY,this._shouldSwitchLevel=!1,this.maxBufferSize=Number.POSITIVE_INFINITY,this._nextAutoLevel=-1,this.shortTermBandwidthFactor=1.8,this.hls=e,this.onCheck=this._abandonRulesCheck.bind(this),this.flowMeasurementPeriodMS=2e3,this.underflowAllowanceMS=1e3,this.numBandwidthSamples=0,this.minItemsInBandwidthAverage=4,this.minTargetDurations=e.config&&e.config.minTargetDurations||1,"bandwidth-history-controller"===e.config.abrBandwidthEstimator&&this._ensureBwEstimator()}destroy(){this.clearTimer(),N.prototype.destroy.call(this)}_ensureBwEstimator(e=!1){if(!this._bwEstimator)if("bandwidth-history-controller"===this.hls.config.abrBandwidthEstimator)this._bwEstimator=this.hls.bandwidthHistoryController;else if("ewma"===this.hls.config.abrBandwidthEstimator){const{config:t}=this.hls;let i,s;e?(i=t.abrEwmaFastLive,s=t.abrEwmaSlowLive):(i=t.abrEwmaFastVoD,s=t.abrEwmaSlowVoD),this._bwEstimator=new class{constructor(e,t,i){this.hls=e,this.logger=e.logger,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new br(t),this.fast_=new br(i)}sample({tparsed:e,tload:t,trequest:i,loaded:s}){this.getEstimate();const r=Math.max((e||t)-i,this.minDelayMs_);var n=8e3*s/r,a=r/1e3;this.fast_.sample(a,n),this.slow_.sample(a,n)}canEstimate(){let e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}getEstimate(){if(this.canEstimate())return{avgLatencyMs:0,avgBandwidth:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}}destroy(){}}(this.hls,s,i);const r=this.hls.bandwidthHistoryController.getEstimate();r&&r.avgBandwidth&&(this.minItemsInBandwidthAverage=1,this._bwEstimator.sample({trequest:0,tparsed:0,tfirst:0,tload:1e3*this.hls.config.defaultTargetDuration,loaded:r.avgBandwidth*this.hls.config.defaultTargetDuration/8}),++this.numBandwidthSamples)}}onFragLoading(e){let t=e.frag;"main"===t.type&&(this.timer||(this.timer=setInterval(this.onCheck,100)),t&&!isNaN(t.level)&&this.hls.levelWithPersistentId(t.level).levelInfo?this._ensureBwEstimator(this.hls.levelWithPersistentId(t.level).levelInfo.details.live):this.logger.warn(`Invalid level id ${t.level} or level info, unable to process ensure bw estimator`)(),this.fragCurrent=t)}_abandonRulesCheck(){var e;let t=this.hls,i=t.media,s=this.fragCurrent,r=s.loader,a=t.minAutoLevel,o=t.iframeMode,l=t.levelWithPersistentId(s.level),h=null==l?void 0:l.levelInfo;if(!r||r.stats&&r.stats.aborted||o||!h)return!0!==s.loadSuccess&&this.logger.warn(`[${s.type}] loader of frag ${s.sn} level ${s.level} destroy or aborted, disarm abandonRules`)(),h||this.logger.warn(`[${s.type}] while loading frag ${s.sn}, level ${s.level} is moved to penalty box, disarm abandonRules`)(),void this.clearTimer();let d=r.stats,c=l.levelListPosition;if(!i||(i.paused||0===i.playbackRate)&&i.readyState||!s.autoLevel||0===c)return;const u=performance.now();let f=u-d.trequest,p=Math.abs(i.playbackRate);if(f<500*s.duration/p)return;let g=t.levels,m=Math.max(1,d.bw?d.bw/8:1e3*d.loaded/f),y=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,v=d.total?d.total:Math.max(d.loaded,Math.round(s.duration*y/8)),_=i.currentTime,b=(v-d.loaded)/m,T=(Fs.bufferInfo(i,_,t.config.maxBufferHole).end-_)/p,S=2*((null===(e=h.details)||void 0===e?void 0:e.targetduration)||s.duration);if(!(T>0&&T<=S&&(b>=T||this.fragDownloadSlow)))return;this.fragDownloadSlow=!0;let E=!1,w=NaN;for(let n=c-1;n>=a&&!E;n--){let e=g[n];if(e.iframes!==o)continue;if(e.url&&!un.hasAllowedHost(e.url,this.hls.preferredHostName))continue;let i=e.realBitrate?Math.max(e.realBitrate,e.bitrate):e.bitrate;t.iframeMode&&(i*=t.config.desiredIframeFPS);let r=s.duration*i/(8*m);(r<T||isNaN(w))&&(w=e.persistentId),E=r<T}Object(Oi.c)(w)&&(this.logger.info(`[abr] capping level to ${w} because likelyToStall`)(),t.nextAutoLevel=w),E&&(this.logger.warn("[abr] loading too slow, abort fragment loading and switch to level "+w)(),this._sampleBandwidth(Object.assign({},d,{tfirst:d.tfirst||u,tload:d.tload||u})),r.abort(),this.clearTimer(),this.fragDownloadTooSlow=!0,t.trigger(n.b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,stats:d}))}_fragResponseIsValid(e){let t=this.hls,i=!0;if(!t.levelWithPersistentId(e).levelInfo){let s=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!1,"empty level info for level "+e);s.response=a.f.InternalError,s.url=t.url,t.trigger(n.b.INTERNAL_ERROR,s),i=!1}return i}onFragLoadProgress(e){let t=e.frag,i=e.stats;if("main"===t.type&&"initSegment"!==t.sn&&0!==i.loaded){if(!this._fragResponseIsValid(t.level))return void this.clearTimer();let e=this.hls.levelWithPersistentId(t.level).levelInfo,s=e.realBitrate?Math.max(e.realBitrate,e.bitrate):e.bitrate,r=i.total?i.total:Math.max(i.loaded,Math.round(t.duration*s/8)),n=performance.now()-i.tfirst,a=i.loaded*t.duration*1e3/r;n>=this.flowMeasurementPeriodMS&&n-a>=this.underflowAllowanceMS&&(this.fragDownloadSlow=!0),n>=1e3*t.duration&&(this.logger.warn(`[abr][${t.type}] too much time spent downloading fragment, likely to switch down ${n} > ${1e3*t.duration}`)(),this.fragDownloadTooSlow=!0)}}onFragLoaded(e){let t=e.frag;if("main"===t.type&&"initSegment"!==t.sn){if(this.clearTimer(),!this._fragResponseIsValid(t.level))return;if(this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const i=this.hls.levelWithPersistentId(t.level).levelInfo;let s=(i.loaded?i.loaded.bytes:0)+e.stats.loaded,r=(i.loaded?i.loaded.duration:0)+e.frag.duration;i.loaded={bytes:s,duration:r},i.realBitrate=Math.round(8*s/r)}if(e.frag.bitrateTest){let t=e.stats;t.tparsed=t.tbuffered=t.tload,this.onFragBuffered(e)}}}onFragBuffered(e){var t=e.stats,i=e.frag;if(!0!==t.aborted&&1===i.loadCounter&&"initSegment"!==i.sn&&(!i.bitrateTest||t.tload===t.tbuffered)){let e=t.tparsed-t.trequest,s=t.tload-t.tfirst,r=t.tdataack-t.tload;if(this.logger.info(`[QE Critical] [${i.type}]latency/loading/dataack/parsing/append:${Math.round(t.tfirst-t.trequest)}/${Math.round(t.tload-t.tfirst)}/${Math.round(r)}/${Math.round(t.tparsed-t.tdataack)}/${Math.round(t.tbuffered-t.tparsed)}`)(),this.logger.info(`[QE Critical] [${i.type}]fragLoadingProcessingMs/stats.loaded/viddur/fragLoadMs: ${e}/${t.loaded}/${i.duration}/${s}`)(),"main"===i.type&&(this.fragDownloadSlow=!1),!("main"!==i.type&&"audio"!==i.type||i.iframe||isNaN(e))){this._sampleBandwidth(t),t.bwEstimate=this.getBandwidthEstimate(),this.logger.info(`[abr][${i.type}]fragNetworkDownloadKbps/fragDownloadKbps/bwEstimateKbps: ${Math.round(8*t.loaded/s)}/${Math.round(8*t.loaded/e)}/${Math.round(t.bwEstimate/1e3)}`)(),i.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0;let r=this.hls.config.abrBandWidthUpFactor,n=this.getAdjustedBW(this.getBandwidthEstimate(),r,this.hls.config.abrBandWidthFactor);"main"===i.type&&n.bwUp>this.highBWTrigger&&this.onBandwidthChanged(yr.HighBandwidth)}}}set fragDownloadSlow(e){this._fragDownloadSlow!==e&&(this._fragDownloadSlow=e,e&&this.onBandwidthChanged(yr.LowBandwidth))}get fragDownloadSlow(){return this._fragDownloadSlow}set fragDownloadTooSlow(e){this._fragDownloadTooSlow!==e&&(this._fragDownloadTooSlow=e,e&&this.onBandwidthChanged(yr.LowBandwidth))}get fragDownloadTooSlow(){return this._fragDownloadTooSlow}set levelDownloadSlow(e){this._levelDownloadSlow!==e&&(this._levelDownloadSlow=e,e&&this.onBandwidthChanged(yr.LowBandwidth))}get levelDownloadSlow(){return this._levelDownloadSlow}get _gotSlowMedia(){return this.levelDownloadSlow||this.fragDownloadTooSlow}onBandwidthChanged(e){this.logger.info(`bandwidth note ${e} ${Math.round(this.getBandwidthEstimate())/1e3}kbps`)(),this._gotSlowMedia||!this.hls.seeking&&!this.hls.waitingForIncompatibleCCFragLoad?this.setShouldSwitchLevel(!0,e):this.logger.warn(`[abr] Could be ignoring bandwidth change seeking=${this.hls.seeking} incompatibleCC ${this.hls.waitingForIncompatibleCCFragLoad}`)(),this.hls.trigger(n.b.BANDWIDTH_CHANGED,{reason:e})}onLevelsChanged(){this.hls.streamController&&(this.hls.levelWithPersistentId(this.hls.streamController.levelId).levelInfo||this.setShouldSwitchLevel(!0,"Current level in penalty box"),this.highBWTrigger=this._getLowestSuperiorBW(this.hls.streamController.levelId))}onLevelSwitching(e){this.setShouldSwitchLevel(!1,"Level switching"),this.fragDownloadTooSlow=!1,this.fragDownloadSlow=!1,this.levelDownloadSlow=!1,this.highBWTrigger=this._getLowestSuperiorBW(e.persistentId)}onInternalError(e){switch(e.details){case a.d.FRAG_LOAD_TIMEOUT:this.fragDownloadTooSlow=!0,this.clearTimer();break;case a.d.FRAG_LOAD_ERROR:this.clearTimer();break;case a.d.LEVEL_LOAD_TIMEOUT:this.levelDownloadSlow=!0;break;case a.d.BUFFER_FULL_ERROR:if(e instanceof a.b){let{parent:t,maxTotalBytes:i}=e;"main"===t&&(this.logger.info(`QuotaExceeded buffer ${this.maxBufferSize} -> ${i}`)(),this.maxBufferSize=i)}}}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}isSafeToFlushExcessBuffer(){if(-1!==this._nextAutoLevel&&!this.getBandwidthEstimate(0))return!1;let e=this._bufferedDuration;return this._holdOffDuration&&e>this._holdOffDuration}getSafeBufferFlushPosition(){return this._holdOffDuration}get nextAutoLevel(){const e=this._nextAutoLevel;if(-1!==e&&!this.getBandwidthEstimate(0))return e;let t=this._nextABRAutoLevel;return-1!==e&&(t=Math.min(e,t)),t}get _bufferedDuration(){var e=this.hls;const t=e.media,i=t?t.currentTime:0,s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1;return(Fs.bufferInfo(t,i,e.config.maxBufferHole).end-i)/s}findNextABRAutoLevelInMode(e){var t=this.hls,i=t.maxAutoLevel,s=t.levels,r=t.config,n=t.minAutoLevel;const a=this.hls.streamController.levelId,o=this.hls.levelController.variantManager.getVariantInfo(a),l=o?o.details:void 0,h=this.getBandwidthEstimate(),d=this._bufferedDuration;let c,u,f;if(e){const s=this.hls.config.desiredIframeFPS;f=this.fragCurrent&&void 0!==this.fragCurrent.iframeMediaDuration?this.fragCurrent.iframeMediaDuration:l?l.targetduration/s:0,f=Math.max(1/s,f),t.iframeMode!==e&&(i=t.maxLevelIframeMode,n=t.minLevelIframeMode)}else f=this.fragCurrent&&void 0!==this.fragCurrent.duration?this.fragCurrent.duration:l?l.targetduration:0;if((u=(c=this._findBestLevel(o,f,h,n,i,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor,s,e)).levelId)<0){let t=f?Math.min(f,r.maxStarvationDelay):r.maxStarvationDelay,a=r.abrBandWidthFactor,l=r.abrBandWidthUpFactor;if(0===d){let e=this.bitrateTestDelay;e&&(t=(f?Math.min(f,r.maxLoadingDelay):r.maxLoadingDelay)-e,a=l=1)}u=-1===(c=this._findBestLevel(o,f,h,n,i,d+t,a,l,s,e)).levelId&&n>=0?s[n].persistentId:c.levelId}return this._holdOffDuration=c.holdOffDuration,u}_getLowestSuperiorBW(e){let t=1/0,i=this.hls.levelWithPersistentId(e),s=i.levelInfo;if(!s)return;let r=i.levelListPosition,n=s.frameRate,a=s.realBitrate?Math.max(s.realBitrate,s.bitrate):s.bitrate,o=this.hls.levels,l=Math.min(this.hls.maxAutoLevel,o.length-1);for(let h=this.hls.config.abrMaxWithRealBitrate?this.hls.minAutoLevel:Math.max(this.hls.minAutoLevel,r+1);h<=l;++h){let e=o[h];if(e.iframes!==s.iframes||void 0!==n&&e.frameRate<n)continue;let i=e.realBitrate?Math.max(e.realBitrate,e.bitrate):e.bitrate;if(i>a&&(t=Math.min(i,t),!this.hls.config.abrMaxWithRealBitrate))break}return t}set highBWTrigger(e){this._highBWTrigger!==e&&(this._highBWTrigger=e)}get highBWTrigger(){return this._highBWTrigger}get avgBW(){return this.logger.warn("abrController.getBandwidthEstimate() is deprecated and will be removed in a future release.")(),this.getBandwidthEstimate()}getBandwidthEstimate(e=this.hls.config.abrEwmaDefaultEstimate){const t=this._bwEstimator?this._bwEstimator.getEstimate():void 0;return t?t.avgBandwidth:e}_sampleBandwidth(e){++this.numBandwidthSamples,this._bwEstimator.sample(e),this._bwEstimator!==this.hls.bandwidthHistoryController&&this.hls.bandwidthHistoryController.sample(e)}getAdjustedBW(e,t,i){let s,r;return this.numBandwidthSamples>=this.minItemsInBandwidthAverage?(s=e*t,r=e*i):s=r=e/this.shortTermBandwidthFactor,{bwUp:s,bwDown:r}}onDesiredRateChanged(e){let{oldRate:t,newRate:i}=e;(0!==t&&1!==t)!=(0!==i&&1!==i)&&this.setShouldSwitchLevel(!0,"mode change")}onBufferChanged(e){this.hls.waitingForIncompatibleCCFragLoad||e.reason!==Os.LowWaterLevel||this.setShouldSwitchLevel(!0,e.reason)}setShouldSwitchLevel(e,t){e!==this._shouldSwitchLevel&&(this.logger.info(`[abr] shouldSwitchLevel: ${this._shouldSwitchLevel}->${e} reason:${t}`)(),this._shouldSwitchLevel=e)}get shouldSwitchLevel(){return this.hls.levelWithPersistentId(this.hls.streamController.levelId).levelInfo||this.setShouldSwitchLevel(!0,"Current level not in variant list"),this._shouldSwitchLevel}get _nextABRAutoLevel(){let e,t=this.hls,i=t.iframeMode,s=t.config.minFramesBeforeSwitchingLevel;if(i){let r=t.countIframesInCurrentLevel();e=!t.levelWithPersistentId(r.level).levelInfo||r.loading+r.buffered===0||r.buffered>=s?this.findNextABRAutoLevelInMode(i):r.level}else e=this.shouldSwitchLevel?this.findNextABRAutoLevelInMode(i):this.hls.streamController.levelId;return e}_findBestLevel(e,t,i,s,r,n,a,o,l,h){const d=e&&e.persistentId,c=this.hls.preferredHostName,u=this.getAdjustedBW(i,o,a),f=this.maxBufferSize,p=e?e.frameRate:void 0;r=Math.max(0,Math.min(l.length-1,r)),s=Math.max(0,Math.min(l.length-1,s));for(let g=r;g>=s;g--){let i=l[g],s=i.persistentId,r=i.details,a=r?r.totalduration/r.fragments.length:t,o=null!=r&&r.live,m=null!=e&&i.bitrate>e.bitrate,y=null!=e&&i.bitrate<e.bitrate,v=i.url,_=!v||un.hasAllowedHost(v,c);if(isNaN(a)||i.iframes!==h||!_)continue;if(void 0!==p&&(m&&i.frameRate<p||y&&i.frameRate>p))continue;if(m&&e&&e.height>i.height)continue;let b=m?u.bwUp:u.bwDown,T=Math.max(i.realBitrate||0,i.bitrate),S=i.bandwidth,E=T*a/b;!o||i.details&&i.details.PTSKnown&&!this.hls.levelController.levelIsExpired(i.details)||(E*=2);let w=b>T&&b<S&&this._bufferedDuration<=2*a,I=(S||T||0)*(r&&r.targetduration||a),D=this.minTargetDurations*I/8<=f;if(b>T&&D&&!w&&(h||!E||E<n))return(this.fragDownloadSlow||this.fragDownloadTooSlow)&&this._bufferedDuration<=2*a&&m&&(this.logger.info("[abr] Last fragment too slow, not switching up")(),s=d),(!this.gotFirst||s!==d&&h===this.hls.iframeMode)&&(this.gotFirst=!0,this.logger.info(`[abr] level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: ${s}/${Math.round(b)}/${T}/${a}/${n}/${E}`)()),{levelId:s,holdOffDuration:E}}return{levelId:-1,holdOffDuration:-1}}set nextAutoLevel(e){if(isNaN(e))try{throw Error("nextAutoLevel set with NaN")}catch(e){this.logger.warn(`${e.message} ${e.stack}`)()}this._nextAutoLevel=e}},bufferController:Sr,audioStreamController:class extends dr{constructor(e,t){super(e,"audio",n.b.MEDIA_ATTACHING,n.b.MEDIA_DETACHING,n.b.AUDIO_TRACK_SWITCHING,n.b.AUDIO_TRACK_LOADED,n.b.FRAG_PARSING_INIT_SEGMENT,n.b.INTERNAL_ERROR,n.b.BUFFER_CREATED,n.b.BUFFER_APPENDED,n.b.BUFFER_FLUSHED,n.b.BUFFER_SOURCE_RESET,n.b.INIT_PTS_FOUND),this.initPTSs=new Map,this.tickFn=t,this.state=zs.STOPPED}get hasInitialSeekToPos(){return this._hasInitialSeekToPos}hasInitPTS(e){return this.initPTSs.has(e)}tick(){this.tickFn()}destroy(){this.stopLoad(),this.state=zs.STOPPED,super.destroy()}resetLoadSource(){this.initPTSs=new Map,this.stopLoad()}stopLoad(){this.state!==zs.STOPPED&&(this.cancelCurrentLoad(),this.startFragRequested=!1,this.fragPrevious=null,this.pendingSeekToPosInfo=null,this._hasInitialSeekToPos=!1,this._destroyDemuxer(),this.state=zs.STOPPED)}get waitingToStart(){return this.haveAltAudio&&!this.hasInitialSeekToPos}get pendingDataInfo(){const e=this.pendingParsedData;return e?{startPTS:e.startPTS,cc:e.frag.cc,level:e.frag.level}:void 0}startLoadAtTargetTime(e){var t,i;this.haveAltAudio?(null===(t=this.pendingSeekToPosInfo)||void 0===t?void 0:t.cc)===e.cc&&(null===(i=this.pendingSeekToPosInfo)||void 0===i?void 0:i.seekToPos)===e.seekToPos||(this.logger.info(`[audio] startLoadAtTargetTime setting pending seek, cc: ${e.cc} offset: ${e.seekToPos}`)(),this.pendingSeekToPosInfo=Object.assign({},e),this._hasInitialSeekToPos=!0,this.fragLoadError=0,this.checkPendingSeek()):this.logger.warn("[audio] startLoadAtTargetTime ignoring call, no alternate audio")()}checkPendingSeek(){var e;if(!this.pendingSeekToPosInfo)return;if(!this.haveAltAudio)return void this.logger.warn("[audio] checkPendingSeek ignoring call, no alternate audio")();if(!this.tracks||!this.tracks.length)return;const t=this.trackId>=0?null===(e=this.hls.audioTrackController.resolveTrackId(this.trackId).trackInfo)||void 0===e?void 0:e.details:void 0;if(!t)return void this.logger.info("[audio] waiting for track details")();const i=this.pendingSeekToPosInfo.cc,s=this.pendingSeekToPosInfo.seekToPos,r=Hs.snapToCCTimeRange(s,t.fragments,i),n=!!this.mediaBuffer&&Ms.isBuffered(this.mediaBuffer,r);switch(this.logger.info(`[audio] have pending seek origSeekToPos: ${s}, cc: ${i}, actual start position snapSeekToPos: ${r}, isBuffered: ${n}`)(),this.pendingSeekToPosInfo=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state){case zs.FRAG_LOADING:{const e=this.fragCurrent;e&&e.loader&&(e.cc!==i||!n&&(e.start>=r||e.start+e.duration<=r)?(this.logger.info(`[audio] currently loading ${e.fragTag}, audio range: ${e.rangeString}, outside of snapSeekToPos: ${r}, cancel it`)(),e.loader.abort(),this.fragCurrent=null,this.fragPrevious=null,this.state=zs.IDLE):this.logger.info(`[audio] currently loading ${e.fragTag}, audio range: ${e.rangeString}, within of snapSeekToPos: ${r}, continue loading`)());break}case zs.WAITING_DISCONTINUITY:this.ensurePendingDataForSeek(r,i);break;case zs.WAITING_INIT_PTS:this.waitingForCC=null,this.state=zs.IDLE;break;case zs.ENDED:case zs.STOPPED:this.state=zs.IDLE}this.nextLoadPosition=r}get targetDuration(){return this.hls.streamController.targetDuration}get highWaterLevel(){return this.hls.streamController.highWaterLevel}flushAudioBuffer(e,t){this.state=zs.BUFFER_FLUSHING,this.hls.bufferController.flushBufferRange(e,t,"audio")}resetNextLoadPositionState(){this.loadedmetadata||(this.stopLoad(),this.state=zs.IDLE)}getAudioTimeRangeForCC(e){if(!this.tracks||isNaN(this.trackId))return[];let t=this.hls.audioTrackController.resolveTrackId(this.trackId).trackInfo;return t&&t.details?Hs.getTimeRangeForCC(t.details.fragments,e):[]}doTickIdle(){var e;const t=this.hls,i=t.config,s=this.tracks;let r;if(!s||0===s.length||!this.hasInitialSeekToPos)return;if(this.pushPendingData())return;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))return;if(this.hls.isLive&&0===this.hls.desiredRate)return;r=this.media&&this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;let o=this.getSourceBufferInfo(r),l=o.len,h=o.end,d=this.fragPrevious,c=this.maxBufferAheadSec,u=this.audioSwitch,f=this.trackId;if(l<c||u){let s=this.hls.audioTrackController.resolveTrackId(f).trackInfo;if(!s)return;if(this.hls.audioTrackController.updateTrack(f),this.hls.playlistLoader.isLoadingAudioTrack(f))return void(this.state=zs.PLAYLIST_LOADING);const l=s.details;if(!l)return void this.logger.error("[audio] no track details")();if(!u&&!l.live&&d&&d.sn===l.endSN&&!this.hls.iframeMode&&(!this.media.seeking||this.media.duration-h<d.duration/2))return this.hls.bufferController.endBuffer("audio"),void(this.state=zs.ENDED);let c=l.fragments,p=c.length,g=c[0].start,m=c[p-1].start+c[p-1].duration,y=null;if(u)if(this.startFragRequested&&l.live&&!l.PTSKnown)h=0;else if(h=r,l.PTSKnown&&r<g){if(!(o.end>g||o.nextStart))return;this.logger.info("[audio] adjust currentTime to alt audio track start")(),this.media.currentTime=g+.05}if(h<=g){if(y=c[0],l.live&&y.loadIdx&&y.loadIdx===this.fragLoadIdx){const e=o.nextStart?o.nextStart:g;return this.logger.info(`[audio] no alt audio available @currentTime:${this.media.currentTime}, seeking @${e+.05}`)(),void(this.media.currentTime=e+.05)}}else{let e=null,t=this.hls.config.firstAudioMustOverlapVideoStart?0:this.hls.config.maxFragLookUpTolerance;if(e=Hs.findFragmentBySNAndBuffer(d,c,h,m,t),this.hls.isLive&&null===d&&e&&"number"==typeof e.sn&&(h>=m||m-h<=t)&&c.length>0&&e.sn===c[c.length-1].sn&&e.level===c[c.length-1].level&&(this.logger.info(`Dropping ${e.sn} as a repeat download`)(),e=null),e){if(y=e,g=e.start,this.hls.streamController&&!this.loadedmetadata){let e=this.hls.streamController.fragCurrent;"initSegment"!==y.sn&&e&&e.cc!==y.cc&&y.sn<l.endSN&&(this.logger.warn(`mismatching cc @pos:${r.toFixed(3)} main:${e.cc} audio:${y.cc} bumping one ahead`)(),y=c[y.sn+1-l.startSN],e.cc!==y.cc&&(this.logger.error(`still mismatching cc main:${e.cc} audio:${y.cc}`)(),y=null))}d&&y&&y.level===d.level&&y.sn===d.sn&&(y="initSegment"!==y.sn&&y.sn<l.endSN?c[y.sn+1-l.startSN]:null)}}if(y){y.decryptdata&&y.decryptdata.isEncrypted&&this.fetchKey(y).subscribe(),l.initSegments[y.cc]&&!l.initSegments[y.cc].data&&(y=l.initSegments[y.cc]);const s=this.hls.bufferController.isCompatibleTransition(y.cc),o=this.initPTSs.has(y.cc),c=o&&"no"!==s,u=o&&!c&&!this.pendingParsedData;let p="initSegment"===y.sn||c||u;if(d&&d.cc!==y.cc&&("no"===s&&this.pendingParsedData?this.logger.error(`[${this.sbid}} why are we back in idle you crazy controller? not compatible, already have cached frag ${y.fragTag}`)():p&&this.logger.info(`[${this.sbid}] loading into discontuity, frag ${y.fragTag}, isCompatible: ${s}, need to cache: ${u}, loadedmetadata: ${this.loadedmetadata}`)()),p||o||(p=!1,this.state=zs.WAITING_INIT_PTS,this.waitingForCC=y.cc,this.logger.info(`[${this.sbid}] waiting to load frag ${y.fragTag}, state: ${this.state} range: ${y.rangeString}, currentTime: ${null===(e=this.media)||void 0===e?void 0:e.currentTime}, pos: ${r?r.toFixed(3):"undefined"}, bufferEnd: ${h?h.toFixed(3):"undefined"} URL ${this.hls.redactUrl(y.relurl)}`)()),p){if(void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,y.loadCounter){y.loadCounter++;let e=i.fragLoadingLoopThreshold;if(y.loadCounter>e&&Math.abs(this.fragLoadIdx-y.loadIdx)<e){let e=new a.j(a.g.MEDIA_ERROR,a.d.FRAG_LOOP_LOADING_ERROR,!1,"Frag has already been loaded more than 3 times",a.f.CorruptStream,y);return t.trigger(n.b.ERROR,e),void(e.iframe=y.iframe)}}else y.loadCounter=1;y.loadIdx=this.fragLoadIdx,this.fragCurrent=y,this.startFragRequested=!0,"initSegment"!==y.sn&&(this.nextLoadPosition=y.start+y.duration),this.logFragmentTiming(y,"loading"),this.logger.info(`${y.type} loading ${y.sn} of [${l.startSN},${l.endSN}], trackId: ${f}, cc: ${y.cc}, range: ${y.rangeString}, currentTime: ${this.media.currentTime}, pos:${r?r.toFixed(3):"undefined"}, bufferEnd:${h?h.toFixed(3):"undefined"} URL ${this.hls.redactUrl(y.relurl)} `)(),t.fragmentLoader.loadFragment(y).then(e=>{this.logFragmentTiming(y,"loaded"),this._processLoadedFrag(e)}).catch(e=>{this._handleFragmentError(e)}),this.demuxImmediate=Object(Qs.setImmediate)(this._ensureDemuxer.bind(this)),this.state=zs.FRAG_LOADING}}}}doTick(){switch(this.state){case zs.ERROR:case zs.BUFFER_FLUSHING:break;case zs.IDLE:this.doTickIdle();break;case zs.PLAYLIST_LOADING:if(!this.hls.playlistLoader.isLoadingAudioTrack(this.trackId)){let e=this.hls.audioTrackController.resolveTrackId(this.trackId).trackInfo;e&&e.details&&(this.state=zs.IDLE)}break;case zs.FRAG_LOADING_WAITING_RETRY:{let e=performance.now(),t=this.retryDate,i=this.media,s=i&&i.seeking;(!t||e>=t||s)&&(this.state=zs.IDLE);break}case zs.WAITING_INIT_PTS:case zs.STOPPED:break;case zs.FRAG_LOADING:case zs.KEY_LOADING:case zs.PARSING:case zs.PARSED:case zs.ENDED:}}get loadedmetadata(){return this.hls.streamController.loadedmetadata}get tracks(){return this.hls.audioTracks}getSourceBufferInfo(e,t=this.config.maxBufferHole){return Ms.bufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,e,t)}onMediaAttaching(e){this._attachMedia(e.media)}_attachMedia(e){this.media=this.mediaBuffer=e,this.onvended=this.onMediaEnded.bind(this),e.addEventListener("ended",this.onvended)}onMediaDetaching(){this.onMediaDetachingInternal(!0)}onMediaDetachingInternal(e){var t=this.media;t&&t.ended&&(this.pendingSeekToPosInfo=null);var i=this.tracks;i&&i.length>0&&i.forEach(e=>{e.details&&e.details.fragments.forEach(e=>{e.loadCounter=void 0})}),t&&t.removeEventListener("ended",this.onvended),this.media=this.mediaBuffer=null,this.stopLoad(),this.hls.config.firstAudioMustOverlapVideoStart&&(this.initPTSs=new Map)}onMediaEnded(){this.pendingSeekToPosInfo=null}onAudioTrackSwitching(e){this.haveAltAudio=!!e.url,this.trackId=e.id,this.fragCurrent=null,this.haveAltAudio||this._destroyDemuxer(),this.haveAltAudio?(this.audioSwitch=!0,this.state=zs.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()):this.stopLoad()}onAudioTrackLoaded(e){var t=e.details,i=e.id,s=this.hls.audioTrackController.resolveTrackId(i).trackInfo;if(t.totalduration,t.live){var r=s.details;r&&t.endSN===r.endSN&&(t.unchangedLivePlaylist=!0),r&&t.fragments.length>0?(Ys.mergeDetails(r,t),t.fragments[0].start,t.PTSKnown):t.PTSKnown=!1}else t.PTSKnown=!1;s.details=t,this.state===zs.PLAYLIST_LOADING&&(this.checkPendingSeek(),this.state=zs.IDLE)}_ensureDemuxer(){this.demuxer||(this.demuxer=new Ws(this.hls,"audio"))}_destroyDemuxer(){Object(Qs.clearImmediate)(this.demuxImmediate),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null)}_processLoadedFrag(e){var t=this.fragCurrent,i=e.frag;if(this.state===zs.FRAG_LOADING&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){const i=t.level,s=this.hls.audioTrackController.resolveTrackId(i).trackInfo.details;if(!s)return this.logger.error("[audio] no track details")(),t=null,void(this.state=zs.IDLE);const r=s.totalduration,{sn:a,cc:o}=t;let l=this.stats=e.stats;if("initSegment"===a)this.state=zs.IDLE,l.tparsed=l.tbuffered=performance.now(),s.initSegments[o].data=e.payload,this.hls.trigger(n.b.FRAG_BUFFERED,{stats:l,frag:t,id:"audio"}),this.tick();else{this.state=zs.PARSING,this.appended=!1,this._ensureDemuxer();let i=this.initPTSs.get(o),n=s.initSegments[o]?s.initSegments[o].data:void 0;if(void 0===i)this.state=zs.WAITING_INIT_PTS;else{this.pendingBuffering=!0;let s=!1;this.logFragmentTiming({level:t.level,sn:"initSegment",cc:o},"parsing"),this.logFragmentTiming(t,"parsing"),this.demuxer.push(e.payload,n,t,r,s,i)}}}this.fragLoadError=0,this.hls.trigger(n.b.FRAG_LOADED,e)}onInitPtsFound(e){let t=e.id,i=e.frag.cc,s=e.initPTS90k;"main"===t&&(this.initPTSs.set(i,s),this.state===zs.WAITING_INIT_PTS&&(this.state=zs.IDLE,i===this.waitingForCC&&(this.waitingForCC=null)))}onFragParsingInitSegment(e){const t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===zs.PARSING){const t=e.track;if("audio"===t.type){const{codec:s,type:r}=t,n=this.bufferController.updateKnownCodecs(r,i.cc,s,void 0),a=this.bufferController.getCurrentInitInfoForParent(this.sbid);this.logger.info(`[${i.type}] onFragParsingInitSegment, trackType: ${e.track.type}, frag: ${i.fragTag}, currentSbInitInfo: ${a?JSON.stringify(a):"N/A"}`)(),n||i.cc!==(null==a?void 0:a.cc)?this.doCreateSbAndAppendInitSegment(i,t,void 0):(this.logger.warn(`[${this.sbid}] incompatible codecs[parsed]=[${t.codec}] on track switch, will wait for a source buffer reset`)(),this.hls.streamController.setNeedsResetForCC(i.cc)),this.tick()}else this.logger.warn(`${e.id}: missing audio track @ level ${i.level} cc ${i.cc}`)(),this.hls.bufferController.ignoreSourceBuffer(1),this.stopLoad()}}handleFragParsingData(e,t){var i;const s=e.frag;t&&this.logger.info(`[${this.sbid}] handleFragParsingData parsing cached data for frag ${s.fragTag}`)();let r=this.hls.bufferController.isCompatibleTransition(s.cc);if("yes"!==r)this.logger.info(`[${this.sbid}] caching frag ${s.fragTag}, compatible: ${r}, seeking: ${null===(i=this.media)||void 0===i?void 0:i.seeking}`)(),this.setWaitingDiscontinuity(e);else if(this.audioSwitch&&this.mediaBuffer.buffered.length)this.pendingParsedData=e,this.flushAudioBuffer(0,Number.POSITIVE_INFINITY);else if(this.state===zs.PARSING)if(null!=this.waitingForKey.value)this.pendingParsedData=e,this.state=zs.KEY_LOADING;else{let t=this.trackId,i=this.hls.audioTrackController.resolveTrackId(t).trackInfo,r=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),this.ensureInitSegmentForFragInfo(s,e.track,void 0),this.logger.info(`parsed ${e.type},PTS:[${e.startPTS.toFixed(3)},${e.endPTS.toFixed(3)}],DTS:[${e.startDTS.toFixed(3)}/${e.endDTS.toFixed(3)}]`)(),Ys.updateFragPTSDTS(i.details,s,e.startPTS,e.endPTS);let a=this.audioSwitch,o=this.media;a&&o&&(this.audioSwitch=!1,r.trigger(n.b.AUDIO_TRACK_SWITCHED,{id:t})),[e.data1,e.data2].forEach(t=>{t&&t.length&&this.state===zs.PARSING&&(this.appended=!0,this.pendingBuffering=!0,this.logFragmentTiming(s,"appending"),this.hls.bufferController.appendBuffer("audio",t,e.startPTS,e.endPTS,"audio","data",s))})}}onBufferCreated(e){let t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer)}onBufferAppended(e){if("audio"===e.parent){this.logFragmentTiming(e.frag,"appended");const t=this.state;t!==zs.PARSING&&t!==zs.PARSED||(this.pendingBuffering=e.pending>0,this.checkAppendedParsed())}}checkAppendedParsed(){if(!(this.state!==zs.PARSED||this.appended&&this.pendingBuffering)){let e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now();let s=this.mediaBuffer?this.mediaBuffer:this.media;i.trigger(n.b.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"}),this.logger.info("audio buffered: "+Xs(s.buffered))(),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(n.b.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=zs.IDLE}this.tick()}}onBufferFlushed(){this.state!==zs.FRAG_LOADING&&(this.state=zs.IDLE,this.fragPrevious=null)}onBufferSourceReset(e){this._attachMedia(e.media)}_handleFragmentError(e){e instanceof a.l&&(this._handleFragmentNetworkError(e,!1),this.resetNextLoadPositionState(),e.fatal&&this.escalateInternalError(e))}onInternalError(e){if(super.handleInternalError(e))return;let t;if(!(e instanceof a.l||e instanceof a.k||e instanceof a.j||e instanceof a.o)||!(t=e.frag)||"audio"===t.type)if(e instanceof a.k)this.resetNextLoadPositionState(),this.state=e.fatal?zs.ERROR:zs.IDLE,this.logger.warn(`audioStreamController: ${e.details} while parsing frag,switch to ${this.state} state`)();else if(e instanceof a.j)e.fatal||e.retrying||this.state!==zs.PLAYLIST_LOADING||(this.state=zs.IDLE);else if(e instanceof a.b){let t=this.media.currentTime,i=Ms.bufferInfo(this.media,t,this.config.maxBufferHole),s=Ms.isBuffered(this.mediaBuffer,t)&&Ms.isBuffered(this.mediaBuffer,t+.5);this.handleBufferFullError(e,"audio",this.trackId,i,s,()=>{this.fragCurrent=null,this.flushAudioBuffer(0,Number.POSITIVE_INFINITY)})}}get canContinuePlaybackWithoutGap(){let e=this.trackId,t=this.hls.audioTrackController.resolveTrackId(e).trackInfo,i=t?t.details:void 0;return Ms.canContinuePlaybackWithoutGap(this.mediaBuffer||this.media,this.media.currentTime,this.config.maxBufferHole,this.hls.playlistType,i)}get variantController(){return this.hls.audioTrackController}},audioTrackController:wr,iframeMaxExitSeekDuration:2e3,iframeStallMaxRetry:5,audioPrimingDelay:0,subtitleStreamController:class extends Js{constructor(e,t){super(e,"subtitle",n.b.MEDIA_ATTACHING,n.b.MEDIA_DETACHING,n.b.INTERNAL_ERROR,n.b.SUBTITLE_TRACKS_UPDATED,n.b.SUBTITLE_TRACK_SWITCH,n.b.SUBTITLE_TRACK_LOADED,n.b.SUBTITLE_FRAG_PROCESSED),this.media=null,this.fragCurrent=null,this.fragPrevious=null,this.fragQueue=[],this.fragNumCues={},this.latestCueStart=0,this.tracks=null,this.enabledTrack=null,this.onMediaSeeking=()=>{this.state===zs.ENDED&&(this.state=zs.IDLE),this.tick()},this.onMediaSeeked=()=>{this.logger.info("[subtitle] seeked. state "+this.state)();let e=this.hls.timelineController.forgetFragsWaitingForInitPTS();this.state===zs.FRAG_LOADING&&e.length&&(this.state=zs.IDLE)},this.fragLoadError=0,this.tickFn=t}destroy(){this.stopLoad(),this.bufferMonitor&&(this.bufferMonitor.destroy(),this.bufferMonitor=null),this.state=zs.STOPPED,this._pendingDiscontinuityOffsets=void 0,super.destroy()}tick(){this.tickFn()}startLoad(){this.tracks?(this.stopLoad(),this.fragLoadError=0,this.state=zs.IDLE,this.tick()):this.state=zs.STOPPED}stopLoad(){if(this.state!==zs.STOPPED){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.state=zs.STOPPED}}isSubtitleTrackEnabled(){return this.findEnabledTrack()&&(this.findEnabledTrack().mediaType===pi.SUBTITLE||this.enabledTrack.sideTrackId)}estimateCurrentWaterLevel(){if(!this.hls.media)return 0;const e=this.hls.media.currentTime;if(this.hls.isLive)return this.latestCueStart-e;{const{bufferedFrags:t}=this._checkFragBufferedState();return Fs.fragmentsBufferedInfo(t,e,this.hls.config.maxBufferHole).end-e}}processSubtitleFrag(e){let t=e.frag,i=this.enabledTrack.details;this.logger.info(`${t.type} Loaded  ${t.sn} of [${i.startSN},${i.endSN}], level: ${t.level}, cc: ${t.cc}, start: ${t.start} URL ${this.hls.redactUrl(t.relurl)}`)(),this.hls.timelineController.processSubtitleFrag(e)}doTick(){if(this.state===zs.FRAG_LOADING_WAITING_RETRY){let e=performance.now(),t=this.retryDate;t&&e>=t&&(this.state=zs.IDLE)}if(this.state!==zs.IDLE||!this.enabledTrack||this.enabledTrack.mediaType!==pi.SUBTITLE&&void 0===this.enabledTrack.sideTrackId||!this.media)return;let e=!1;this.enabledTrack.details?this.enabledTrack.details.live&&Date.now()-this.enabledTrack.details.lastLoadTimeMillis>=1e3*this.enabledTrack.details.targetduration&&this.hls.isLive&&0!==this.hls.desiredRate&&(e=!0):e=!0,this.enabledTrack.details&&0===this.fragQueue.length&&this._addAllFragmentsToQueue(),e&&(this.state=zs.PLAYLIST_LOADING,this.hls.subtitleTrackController.loadTrackInternal(this.enabledTrack)),this.enabledTrack.details&&this.bufferMonitor&&(this.bufferMonitor.targetDuration=this.enabledTrack.details.targetduration);let t=this.enabledTrack.details;const{fragQueue:i}=this;let s=this._findFragment();if(null==s)return;this.fragLoadError>0&&this.fragPrevious&&s.sn!==this.fragPrevious.sn+1&&(s=i[this.fragPrevious.sn-i[0].sn+1]),this._pendingDiscontinuityOffsets||(this._pendingDiscontinuityOffsets=this._findAllDiscontinuityFragmentsBefore(s));let r=this.enabledTrack.details.initSegments[s.cc];r&&!r.data?(r.trackId=this.enabledTrack.id,s=r):this._pendingDiscontinuityOffsets&&this._pendingDiscontinuityOffsets.length>0&&(s=this._pendingDiscontinuityOffsets.shift()),this.fragPrevious&&s.sn===this.fragPrevious.sn&&s.level===this.fragPrevious.level||(this.logger.info(`${s.type} loading ${s.sn} of level ${s.level} trackId ${s.trackId} [${t.startSN},${t.endSN}], cc: ${s.cc}, range: ${s.rangeString}, currentTime: ${this.media.currentTime} URL ${this.hls.redactUrl(s.relurl)} `)(),this.state=zs.FRAG_LOADING,this.fragCurrent=s,this.hls.fragmentLoader.loadFragment(s).then(e=>{this.processSubtitleFrag(e),this.fragLoadError=0}).catch(e=>{this._handleFragmentError(e)}))}_findFragment(){const{hls:e}=this,t=this.media.currentTime,i=t+e.config.maxBufferLength;return e.isLive&&"EVENT"!==e.playlistType?this._findFragmentLive(i):this._findFragmentVod(t,i)}_findFragmentLive(e){return e>this.latestCueStart?this.fragQueue.shift():null}_findFragmentVod(e,t){const{loadableFrags:i}=this._checkFragBufferedState();for(const s of i){const i=s.start,r=i+s.duration;if(i<=e&&r>e||i<=t&&r>t||i>=e&&r<=t)return s}return null}_checkFragBufferedState(){if(!this.enabledTrack)return{bufferedFrags:[],loadableFrags:[]};let e=[],t=[];const{fragQueue:i,fragNumCues:s}=this,r=this.hls.timelineController.getCuesOfEnabledTrack(this.enabledTrack.id,void 0!==this.enabledTrack.sideTrackId);if(null!=r&&r.length>0&&i.length>0){const n={};for(let e=0;e<r.length;e++){const t=r[e];null==n[t.fragSN]?n[t.fragSN]=1:n[t.fragSN]++}for(const r of i){const i=r.sn,a=s[i],o=n[i];null==o||null==a||a>o?t.push(r):e.push(r)}}else t=[...i];return{bufferedFrags:e,loadableFrags:t}}_addAllFragmentsToQueue(){const{fragQueue:e,enabledTrack:t}=this,{details:i,id:s}=t;let r=e.length;i.fragments.forEach(t=>{t.trackId=s,"number"==typeof t.sn&&(null==this.fragPrevious||t.sn>this.fragPrevious.sn)&&(0===e.length||t.sn>e[e.length-1].sn)&&e.push(t)}),i.live&&(r<e.length||"number"!=typeof i.lastLoadTimeMillis)&&(i.lastLoadTimeMillis=Date.now())}_findAllDiscontinuityFragmentsBefore(e){let t,i=[];return this.enabledTrack.details.fragments.forEach(s=>{if(e.sn>s.sn){let e=this.hls.timelineController.hasDiscontinuityOffset(s.cc);void 0!==t&&s.cc===t||e||(i.push(s),t=s.cc)}}),i}onMediaAttaching(e){this.media=e.media;let t=this.tracks&&this.hls.config.autoStartLoad?this.hls.config.startPosition:-1;this._attachMedia(e.media,t)}_attachMedia(e,t){this.media=e,e.addEventListener("seeking",this.onMediaSeeking),e.addEventListener("seeked",this.onMediaSeeked),t>=0&&this.startLoad()}onMediaDetaching(){var e=this.media;e&&(e.removeEventListener("seeking",this.onMediaSeeking),e.removeEventListener("seeked",this.onMediaSeeked)),this.media=null,this.stopLoad(),this.bufferMonitor&&(this.bufferMonitor.destroy(),this.bufferMonitor=null)}onSubtitleTracksUpdated(e){this.tracks=e.subtitleTracks,this.fragQueue=[],this.fragNumCues=[],this.latestCueStart=0,this.state=zs.IDLE}onSubtitleTrackSwitch(e){if(e.hidden&&e.track){let t=this.hls.subtitleTrackController.redirectTextTrack(e.track.id);this.enabledTrack=this.hls.subtitleTrackController.resolveTrackId(t).trackInfo,this.enabledTrack.sideTrackId=e.track.id,this.enabledTrack.url=this.hls.subtitleTrackController.resolveTrackId(e.track.id).trackInfo.url}else this.enabledTrack=e.track;if(this.fragPrevious&&this.enabledTrack&&this.fragPrevious.trackId!==this.enabledTrack.id&&(this.logger.info("[subtitle] clear fragPrevious from trackId "+this.fragPrevious.trackId)(),this.fragPrevious=null),this.logger.info(`[subtitle] enable track id: ${this.enabledTrack?this.enabledTrack.id:"undefined"} side track id `+(this.enabledTrack?this.enabledTrack.sideTrackId:"undefined"))(),this.enabledTrack){this.bufferMonitor&&this.bufferMonitor.destroy();let e=()=>this.estimateCurrentWaterLevel();this.bufferMonitor=new Bs(this.hls,this.hls.media,e,Ns.Subtitle,this.config.maxBufferHole,this.config.maxBufferLength,this.config.defaultTargetDuration,this.config.almostDryBufferSec)}else this.bufferMonitor&&(this.bufferMonitor.destroy(),this.bufferMonitor=null);this.fragQueue=[],this.fragNumCues=[],this.latestCueStart=0,this.fragCurrent&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragCurrent=null),this.state=zs.IDLE,this.tick()}onSubtitleTrackLoaded(e){this.enabledTrack.details=e.details,this.enabledTrack&&this.enabledTrack.id===e.id&&this._addAllFragmentsToQueue(),this.state=zs.IDLE,this.tick()}onSubtitleFragProcessed({frag:e,cues:t}){this.fragPrevious=e,this.fragCurrent=null,this.state=zs.IDLE,"number"==typeof e.sn&&(t=t||[],this.updateLatestCueStart(t),this.fragNumCues[e.sn]=t.length,this.bufferMonitor.notifyWaterLevelChanged()),this.tick()}updateLatestCueStart(e){this.latestCueStart=Math.max(this.latestCueStart,...e.map(e=>e.startTime))}findEnabledTrack(){return this.enabledTrack}_handleFragmentError(e){e instanceof a.l&&(super._handleFragmentNetworkError(e,!1),e.fatal&&this.escalateInternalError(e))}onInternalError(e){if(this.state!==zs.ERROR)return e.fatal?(this.state=zs.ERROR,void this.escalateInternalError(e)):void 0}get variantController(){return this.hls.subtitleTrackController}},subtitleTrackController:class extends Es{constructor(e){super(e,n.a.MEDIA_ATTACHED,n.a.MEDIA_DETACHING,n.a.SUBTITLE_TRACKS_CREATED,n.a.PREFERRED_HOST_CHANGED),this.media=void 0,this.subtitleDisplay=!1,this.allTracksCreated=!1,this.trackRetryCount=0,this.variantManager=new bs(e,pi.SUBTITLE)}destroy(){this.variantManager&&this.variantManager.destroy(),super.destroy()}get validTracks(){return this.variantManager&&this.variantManager.validVariantList||[]}get mediaSelectionGroup(){return this._mediaSelectionGroup}get mediaSelectionOptions(){return this.mediaSelectionGroup?this.mediaSelectionGroup.MediaSelectionGroupOptions:[]}get selectedPersistentID(){return this.selectedMediaOption?this.selectedMediaOption.MediaSelectionOptionsPersistentID:-1}set selectedPersistentID(e){if(e>=0&&!this.allTracksCreated)return void(this.queuedPersistentID=e);let t=this.mediaSelectionOptions.find((function(t){return t.MediaSelectionOptionsPersistentID===e}));this.selectedMediaOption=t}get selectedMediaOption(){return this._selectedMediaOption}set selectedMediaOption(e){if(e&&!this.allTracksCreated)return void(this.queuedPersistentID=e.MediaSelectionOptionsPersistentID);let t;if(this._selectedMediaOption=e,e){let i=e.MediaSelectionOptionsPersistentID;(t=this.validTracks.find((function(e){return e.persistentID===i})))||this.logger.warn("could not find subtitle track for selected media group: "+e.MediaSelectionOptionsName+" with ID: ("+i+")")()}this.selectedTrack=t;let i=this.selectedTrack?this.selectSideTrack(this._selectedMediaOption):void 0;i&&(this.selectedSideTrack=i)}get selectedTrack(){return this._selectedTrack}set selectedTrack(e){zr(this._selectedTrack,e)||(this.selectedSideTrack&&(this._selectedSideTrack=void 0),this.logger.info("[QE Critical] switching to subtitle/caption track "+(e?e.id+" - "+e.name:"(NONE)"))(),this._selectedTrack=e,this.hls.trigger(n.a.SUBTITLE_TRACK_SWITCH,{track:e}),this.updateTextTrackState())}get currentVariantId(){return this._selectedTrack.id}selectSideTrack(e){let t;if(this.hls.config.enableDualTrackSelection&&e&&e.MediaSelectionOptionsMediaType===pi.CLOSEDCAPTION){e.MediaSelectionOptionsPersistentID;let i=this.selectedTrack,s=this.logger;t=this.validTracks.find((function(t){let r=t.mediaType===pi.SUBTITLE&&t.lang===e.MediaSelectionOptionsExtendedLanguageTag&&t.forced&&t.autoselect&&t.groupId!==i.groupId;return r&&s.info(`[subtitle] pick side track persistent id ${t.persistentID} track id ${t.id} group id ${t.groupId}`)(),r}))}return t}get selectedSideTrack(){return this._selectedSideTrack}set selectedSideTrack(e){zr(this._selectedSideTrack,e)||(this.logger.info("[QE Critical] switching to side subtitle/caption track "+(e?e.id+" - "+e.name:"(NONE)"))(),this._selectedSideTrack=e,this.hls.trigger(n.a.SUBTITLE_TRACK_SWITCH,{track:e,hidden:!0}),this.updateTextTrackState())}redirectTextTrack(e){let t=e;return this.selectedSideTrack&&e===this.selectedSideTrack.id&&(t=this.selectedTrack.id,this.logger.info(`[subtitle] promote side track id from ${e} to ${t}`)()),t}updateTextTrackState(){if(!this.media||!this.media.textTracks)return;let e=this.selectedTrack?this.selectedTrack.id:void 0,t=qr(this.media.textTracks);for(let i=0;i<t.length;i++)i===e&&"showing"!==t[i].mode?t[i].mode="showing":i!==e&&"hidden"!==t[i].mode&&(t[i].mode="hidden")}onMediaAttached(e){this.media=e.media,this.media&&(this.updateTextTrackState(),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(()=>{this.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))}onMediaDetaching(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)}resetTracks(){this.selectedTrack=void 0,this._selectedMediaOption=void 0,this.trackRetryCount=0}setVariantManager(e){this.logger.info(`${this.constructor.name} setVariantManager ${e&&e.validVariantList.length}`)(),this.variantManager=e}setTracks(e,t){this.resetTracks(),this.setVariantManager(e),this._mediaSelectionGroup=t||{MediaSelectionGroupAllowEmptySelection:1,MediaSelectionGroupMediaCharacteristics:["public.legible"],MediaSelectionGroupMediaType:pi.SUBTITLE,MediaSelectionGroupOptions:[]};let i={subtitleTracks:this.validTracks};this.hls.trigger(n.a.SUBTITLE_TRACKS_UPDATED,i)}onSubtitleTracksCreated(){this.allTracksCreated=!0,void 0===this.queuedPersistentID||this.selectedMediaOption||(this.selectedPersistentID=this.queuedPersistentID,this.queuedPersistentID=void 0)}onPreferredHostChanged(e){if(e.mediaType===pi.SUBTITLE||!this.selectedTrack||0===this.variantManager.variantList.length)return;let t,i=this.selectedTrack;i.url,(t=this.validTracks.find(e=>e.persistentID===i.persistentID&&e.forced===i.forced&&un.hasAllowedHost(e.url,this.hls.preferredHostName)))&&(this.selectedSideTrack?(this.logger.warn(`preemptively switching subtitle host for side track id ${this.selectedSideTrack.id} to id ${t.id}, host=${this.hls.preferredHostName}`)(),this.selectedSideTrack=t):(this.logger.warn("preemptively switching subtitle host to "+this.hls.preferredHostName)(),this.selectedTrack=t))}_onTextTracksChanged(){if(!this.media)return;let e,t=!1,i=qr(this.media.textTracks);for(let s=0;s<i.length;s++)i[s].seen?"showing"===i[s].mode&&this.resolveTrackId(s).trackInfo&&(e=this.resolveTrackId(s).trackInfo):(i[s].seen=!0,t=!0);if(!t){let t=e?e.persistentID:void 0,i=this._selectedMediaOption;if(!i||i.MediaSelectionOptionsPersistentID!==t){let e=this.mediaSelectionOptions.find((function(e){return e.MediaSelectionOptionsPersistentID===t}));this.selectedMediaOption=e}}}loadTrackInternal(e){let t=e.url;e.id,t&&this.hls.playlistLoader.loadSubtitleTrack(e.url,e.id).then(function(e){this.hls.trigger(n.a.SUBTITLE_TRACK_LOADED,e)}.bind(this)).catch(function(e){this._handleMediaPlaylistNetworkError(e,!1)}.bind(this))}_attemptRetry(e,t){let i=this.hls.playlistLoader.retryPlaylistRequest(e);return i?i.then(()=>{this.hls.trigger(n.a.SUBTITLE_TRACK_LOADED,e)}).catch(e=>{this._handleMediaPlaylistNetworkError(e,t)}):void 0}containsFallbackVariant(e){return-1!==this.getNextBestAutoVariant(this.selectedTrack.id,e)}_findValidGroupId(e){let t=this.validTracks.find((function(t){return t.groupId&&t.groupId!==e.groupId}));return t?t.groupId:void 0}resolveTrackId(e){let t,i;return!e&&0!==e||e<0?this.logger.warn("invalid trackID "+e)():this.variantManager&&(t=this.variantManager.getVariantInfoIfValid(e),i=this.variantManager.getVariantListPosition(e)),{trackInfo:t,trackListPosition:i}}getNextBestAutoVariant(e,t){t=t||this.hls.preferredHostName;let i,s=this.resolveTrackId(e).trackInfo,r=s?this._findValidGroupId(s):void 0;return s&&r?i=this.validTracks.find((function(e){return e.groupId===r&&e.persistentID===s.persistentID&&un.hasAllowedHost(e.url,t)})):this.logger.warn("can't find substitute track in a different group id")(),i?i.id:-1}setNextAutoVariant(e){let t=this.resolveTrackId(e).trackInfo;if(t){let e=this.mediaSelectionOptions.find((function(e){return e.MediaSelectionOptionsPersistentID===t.persistentID}));this.selectedSideTrack?(this.logger.info("[subtitle] use next side track "+t.id)(),this.selectedSideTrack=t):(this.logger.info("[subtitle] use next track "+t.id)(),this._selectedMediaOption=e,this.selectedTrack=t)}}},timelineController:Xr,cueHandler:{newCue:function(e,t,i,s,r){let n,a,o,l,h;const d={foreground:!1,background:!1,italics:!1,underline:!1,flash:!1,styleStack:[]};for(const[c,u]of s.rows.entries())if(a=!0,o=0,l="",!u.isEmpty()){for(let e=0;e<u.chars.length;e++)u.chars[e].uchar.match(/\s/)&&a?o++:(l+=this.getFormattedChar(u.chars[e],d),a=!1);u.cueStartTime=t,t===i&&(i+=1e-4),l=l.trim().replace(/<br(?: \/)?>/gi,"\n"),l+=this.closeStyles(d),n=new Ir.VTTCue(t,i,l),o>=16?o--:o++,h=navigator.userAgent.match(/Firefox\//)?c+1:c>7?c:c+1,n.snapToLines=!1,n.line=10+5.33*h,n.align="left",n.position=this.getPosition(o,r),e.addCue(n)}},getPosition:function(e,t){let i=4/3;t&&t.offsetWidth&&t.offsetHeight&&t.offsetWidth/t.offsetHeight>=1.6&&(i=16/9);let s=10+e/32*80,r=10,n=90;return i===16/9&&(s=12.5+.75*s,r=20,n=80),Math.max(r,Math.min(n,s+(navigator.userAgent.match(/Firefox\//)?50:0)))},getRootStyleTag:function(e){let t=e[0];return"c"===t?t:e},closeStyles:function(e){let t="";for(let i=e.styleStack.length-1;i>=0;--i)t+="</"+this.getRootStyleTag(e.styleStack[i])+">",e.styleStack.pop();return t},beginStyleAndBalance:function(e,t){let i="";return"c"===t[0]&&(i+=this.closeStyleAndBalance(e,"c")),i+="<"+t+">",e.styleStack.push(t),i},closeStyleAndBalance:function(e,t){let i=e.styleStack.length,s=0,r="",n=!1;for(let a=i-1;a>=0;--a){let o=e.styleStack[a],l=this.getRootStyleTag(o);if(t[0]===o[0]){r+="</"+l+">",e.styleStack.splice(i-1-s);break}n=!0,"c"===l[0]?(e.background="",e.foreground="",e.flash=!1,r+="</c>"):"u"===l[0]?(e.underline=!1,r+="</u>"):"i"===l[0]&&(e.italics=!1,r+="</i>"),s++}return r},getFormattedChar:function(e,t){let i="",s=e.uchar,r="",n=e.penState.foreground!==t.foreground,a=e.penState.background!==t.background,o=e.penState.flash!==t.flash;return(n||a||o)&&(r="."+e.penState.foreground,r+=".bg_"+e.penState.background,e.penState.flash&&o&&(r+=".blink"),e.penState.foreground||e.penState.background||e.penState.blink?i+=this.beginStyleAndBalance(t,"c"+r):i+=this.closeStyleAndBalance(t,"c"),n&&(t.foreground=e.penState.foreground),a&&(t.background=e.penState.background),o&&(t.flash=e.penState.flash)),e.penState.underline!==t.underline&&(i+=e.penState.underline?this.beginStyleAndBalance(t,"u"):this.closeStyleAndBalance(t,"u"),t.underline=e.penState.underline),e.penState.italics!==t.italics&&(i+=e.penState.italics?this.beginStyleAndBalance(t,"i"):this.closeStyleAndBalance(t,"i"),t.italics=e.penState.italics),i+s}},enableCEA708Captions:!0,customTextTrackCueRenderer:!1,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",enableDualTrackSelection:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,useFirstLevelAtIncompatDiscontinuity:!0,abrBandwidthEstimator:"bandwidth-history-controller",abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.9,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,enableRtcReporting:!1,rtcIntervalTimeout:3e5,rtcSender:"HLSJS",rtcSessionTag:"none",useHTTPPlaybackSessionId:!1,warmupCdms:!1,enablePerformanceLogging:!1,overridePlaybackRate:!1,enableAdaptiveStartup:!0,bandwidthHistoryWindowSize:12e4,bandwidthHistoryTTL:6e5,bandwidthHistoryAggregationMethod:"quadratic-time-weighted",bandwidthHistoryGetEstimateThrottleMs:1e3,defaultTargetDuration:10,targetStartupMs:3e3,adaptiveStartupMetricsOverride:{maxValidHeight:1080,maxValidBitrate:1/0,maxPreferredBitrate:1/0},bandwidthHistoryStorageKey:"AppleHLS-bandwidth-estimation",storage:{get:"undefined"==typeof localStorage?void 0:localStorage.getItem.bind(localStorage),set:"undefined"==typeof localStorage?void 0:localStorage.setItem.bind(localStorage)},enableCDNFallback:!0,enableQueryParamsForITunes:!1,gapless:!1};var en=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new tn(e,this.predicate,this.thisArg))},e}(),tn=function(e){function t(t,i,s){var r=e.call(this,t)||this;return r.predicate=i,r.thisArg=s,r.count=0,r}return pe(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(ke),sn=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),rn=(new Ke((function(e){return e.complete()})),function(){function e(e){if(this.total=e,this.total<0)throw new sn}return e.prototype.call=function(e,t){return t.subscribe(new nn(e,this.total))},e}()),nn=function(e){function t(t,i){var s=e.call(this,t)||this;return s.total=i,s.count=0,s}return pe(t,e),t.prototype._next=function(e){var t=this.total,i=++this.count;i<=t&&(this.destination.next(e),i===t&&(this.destination.complete(),this.unsubscribe()))},t}(ke),an=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new on(e,this.value))},e}(),on=function(e){function t(t,i){var s=e.call(this,t)||this;return s.value=i,s}return pe(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(ke);class ln extends Ke{constructor(){var e;super(t=>this._count$.pipe((e=e=>0===e,function(t){return t.lift(new en(e,void 0))}),(function(e){return e.lift(new rn(1))}),(function(e){return e.lift(new an(void 0))})).subscribe(t)),this._count$=new tr(0)}do(e){this.add(),vt(e).pipe(Ae({complete:()=>this.done()})).subscribe()}add(e=1){this._count$.next(this._count$.value+e)}done(e=1){this._count$.next(this._count$.value-e)}}const hn=[".*.itunes.apple.com"],dn={deviceName:"&xapdn=",deviceModel:"&xapdm=",language:"&xapdl=",dsid:"&xapdsid=",subs:"&xapsub="};class cn extends Ks{constructor(e={}){super(),this.firstItem=!0,this.media=null,this.destroyWG=new ln,this.destroy$=new it;let t=cn.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");this.config=Object.assign(Object.assign({},t),e);const{config:i}=this;if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');this.logger=new f.a,this.logger.enable(i.debug,i.debugLevel),this.config=i,this._autoLevelCapping=-1,this.trigger=function(e,...t){if(t&&t.length&&"object"!=typeof t[0])return void this.logger.warn(`[QE Critical] [EventTrigger] ${e.toString()} data[0]: ${t[0]} is not an object`)();let i={loadItemId:this.loadingItem?this.loadingItem.options.itemId:void 0,playItemId:this.playingItem?this.playingItem.options.itemId:void 0};if(t.length?t[0].itemData=i:t[0]={itemData:i},"hlsFragLoadProgress"!==e.toString()){let i="";"hlsInternalError"!==e&&"hlsError"!==e||!t.length||(i=JSON.stringify(t[0],["fatal","details","reason"])),this.logger.info(`[QE Critical] [EventTrigger] ${e.toString()} ${i}`)()}this.emit(e,e,...t)}.bind(this),void 0===this.off&&(this.off=function(e,...t){this.removeListener(e,...t)}),this.bufferChangedFn=this.onBufferChanged.bind(this),this.on(n.a.BUFFER_CHANGED,this.bufferChangedFn);const s=this.bandwidthHistoryController=new mr(this),r=this.abrController=new i.abrController(this),a=this.bufferController=new i.bufferController(this),o=this.playlistLoader=new fs(this),l=this.fragmentLoader=new ms(this),h=this.keyLoader=new Vt(this),d=this.networkErrorHandler=new Ps(this),c=new B(this),u=new ur(this);let p=[this.levelController=new As(this,o),this.streamController=new cr(this)];this.networkControllers=p;const g=[o,l,h,c,r,a,u,d,s];if(i.audioTrackController){let e=new i.audioTrackController(this);this.audioTrackController=e,g.push(e)}if(i.subtitleTrackController){let e=new i.subtitleTrackController(this);this.subtitleTrackController=e,g.push(e)}if(i.timelineController){let e=new i.timelineController(this);this.timelineController=e,g.push(e)}const m=this.eventReporter=new _r(this);g.push(m),this.coreComponents=g,this.isValid=!0,this.cdnReferenceBaseURL=void 0,this.cdnWhiteList=new Set}get audioStreamController(){return this.streamController.audioStreamController}get subtitleStreamController(){return this.streamController.subtitleStreamController}static initialize(e){let t=cn.DefaultConfig,i=Object.assign(Object.assign({},t),e);cn.DefaultConfig=i,f.b.enable(i.debug,i.debugLevel),!0===i.warmupCdms&&ht.warmupCDM()}static get version(){return"1.530.12"}static isSupported(){return function(){try{const e=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!s}catch(e){return!1}}()}static get Events(){return n.a}static get ErrorTypes(){return a.g}static get ErrorDetails(){return a.d}static get ErrorResponses(){return a.f}static get GaplessEvictReason(){return a.m}static get DefaultConfig(){return cn.defaultConfig?cn.defaultConfig:Zr}static set DefaultConfig(e){cn.defaultConfig=e}destroy(){if(this._isObjectValid())return this.logger.info("destroy")(),this.destroy$.next(),this.clearFatalError(),this.trigger(n.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(e=>{e.destroy()}),this.setPlayingItem(null),this.setLoadingItem(null),this.removeAllListeners(),this._autoLevelCapping=-1,this.cdnReferenceBaseURL=void 0,this.cdnWhiteList.clear(),this.isValid=!1,this.bufferEndPromiseWrapper=void 0,this.destroyWG.toPromise()}scheduleFatalError(e){this.fatalImmediate||(this.fatalImmediate=s(this.triggerFatalError.bind(this,e)))}clearFatalError(){r(this.fatalImmediate),this.fatalImmediate=null}triggerFatalError(e){this.clearFatalError(),this.trigger(n.a.ERROR,e)}get isFirstItem(){return this.firstItem}evictItemOnFatalError(e){let t=this.isPreloadingItem&&this.playingItem.itemId!==this.loadingItem.itemId;return t&&(e.escalated=a.e.Downgraded,this.streamController.evictLoadingItem(this.loadingItem.startTime,cn.GaplessEvictReason.FatalErrorWhileLoading)),t}fatalErrorRequiresAction(e){return!e.escalated&&!this.evictItemOnFatalError(e)}upgradeInternalErrorIfNecessary(e){return e.escalated||this.evictItemOnFatalError(e)||(e.escalated=a.e.Upgraded,this.scheduleFatalError(e)),e.escalated===a.e.Upgraded}attachMedia(e){this._isObjectValid()&&(this.logger.info("attachMedia")(),this.media=e,this.streamController.installMediaFunctions(e),this.trigger(n.a.MEDIA_ATTACHING,{media:e}))}detachMedia(){this._isObjectValid()&&this.media&&(this.logger.info("detachMedia")(),this.streamController.uninstallMediaFunctions(),this.trigger(n.a.MEDIA_DETACHING),this.media=null)}get isPreloadingItem(){return this.config.gapless&&this.loadingItem&&!isNaN(this.loadingItem.startTime)&&this.media&&this.media.buffered&&this.media.buffered.length>0}get inGaplessMode(){return this.config.gapless&&this.streamController.gaplessAllowed}cleanupItem(e){if(e&&e.cachedManifestCtx){let t=e.cachedManifestCtx;[t.levels,t.audioTracks,t.subtitleTracks].forEach(e=>{e&&e.destroy()}),e.cachedManifestCtx=void 0}}setLoadingItem(e){if(this.loadingItemInternal!==e)if(this.loadingItemInternal&&this.loadingItemInternal===this.playingItem){let e=this.loadingItemInternal.cachedManifestCtx;e&&[e.levels,e.audioTracks,e.subtitleTracks].forEach(e=>e.stopTimers())}else this.cleanupItem(this.loadingItemInternal);let t=e&&e.cachedManifestCtx;t&&[t.levels,t.audioTracks,t.subtitleTracks].forEach(e=>e.startTimers()),this.loadingItemInternal=e}get loadingItem(){return this.loadingItemInternal}setPlayingItem(e){this.playingItemInternal!==e&&this.cleanupItem(this.playingItemInternal),this.playingItemInternal=e}get playingItem(){return this.playingItemInternal}get playingItemDuration(){return this.media.duration-(isNaN(this.playingItem.startTime)?0:this.playingItem.startTime)}queueSource(e,t={}){if(!this._isObjectValid()||!this.media||!this.config.gapless)return;if(t===this.playingItem.options)return void this.logger.error("[gapless] queueSource must not reuse the options object from loadSource")();if(this.loadingItem.itemId!==this.playingItem.itemId)return void f.b.error(`[gapless] already enqueued. loading item ${this.loadingItem.itemId}, playing item ${this.playingItem.itemId}`)();let i=this.bufferController.totalItemDuration;this.resetLoadSource(),this.firstItem=!1,this.logger.info("[gapless] start loading next item @ "+i)(),this.loadSource(e,t,i)}dequeueSource(e=a.m.ApplicationInitiated){this._isObjectValid()&&this.media&&this.config.gapless&&(this.loadingItem.itemId!==this.playingItem.itemId?this.streamController.dequeueSource(e):f.b.error(`[gapless] nothing to dequeue. loading item ${this.loadingItem.itemId}, playing item ${this.playingItem.itemId}`)())}endSource(){this._isObjectValid()&&this.media&&this.config.gapless&&this.streamController.endSource()}get accessLog(){if(!this._isObjectValid())return;let e=this.eventReporter;return e?e.accessLog:[]}get errorLog(){if(!this._isObjectValid())return;let e=this.eventReporter;return e?e.errorLog:[]}get url(){if(this._isObjectValid())return this.playingItem?this.playingItem.url:this.loadingItem?this.loadingItem.url:void 0}_isObjectValid(){return this.isValid||this.logger.error("Hls object already destroyed")(),this.isValid}_getHostName(e){return c.getHostName(e)}_urlNeedsUpdate(e){if(!0===this.config.enableQueryParamsForITunes)return!0;let t=this._getHostName(e);return void 0!==hn.find(e=>new RegExp(e).exec(t))}_shouldUpdateUrlWithDeviceNameAndModel(e){let t=e.model,i=e.manufacturer;return t&&i||this.logger.warn(`Missing model/manufacturer in platformInfo model ${t} manufacturer ${i}`)(),!!t&&!!i}_updateUrlWithDeviceNameAndModel(e,t){let i,s,r=t.model,n=t.manufacturer,a=-1!==e.indexOf("?");return i=encodeURIComponent(r),s=encodeURIComponent(n),(e=a?e:e+"?")+dn.deviceName+s+dn.deviceModel+i}_updateUrlWithOptionsQuery(e,t){let i,s=-1!==e.indexOf("?");for(i in e=s?e:e+"?",t)t[i]?e+=dn[i]+("subs"===i?encodeURIComponent(t[i]):t[i]):this.logger.warn(`Missing ${i} info`)();return e}_updateUrlWithQueryStrings(e,t,i){return this._shouldUpdateUrlWithDeviceNameAndModel(t)&&(e=this._updateUrlWithDeviceNameAndModel(e,t)),this._updateUrlWithOptionsQuery(e,i)}_createSessionID(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=[];for(let n=0;n<256;++n)r[n]=(n<16?"0":"")+n.toString(16);return r[255&e]+r[e>>8&255]+r[e>>16&255]+r[e>>24&255]+"-"+r[255&t]+r[t>>8&255]+"-"+r[t>>8&15|64]+r[t>>16&255]+"-"+r[63&i|128]+r[i>>8&255]+"-"+r[i>>8&255]+r[i>>16&255]+r[255&s]+r[s>>8&255]+r[s>>16&255]+r[s>>24&255]}resetLoadSource(){var e;this.logger.info("[gapless] clean up current source")(),this.streamController.resetLoadSource(),null===(e=this.streamController.audioStreamController)||void 0===e||e.resetLoadSource(),this.levelController.resetLoadSource(),this.bufferController.resetLoadSource()}loadSource(e,t={},i){if(!this._isObjectValid())return;let s;if(t.appData&&(s=t.appData.reportingAgent),this.sessionID=s?s.SessionID:this._createSessionID(),this.streamID=t.streamID,this.logger.setStreamAndSessionIDs(this.sessionID,this.streamID),this.logger.info("[QE Critical] hls player version "+cn.version)(),"playready"===this.config.keySystemPreference&&!this.config.enablePlayReadyKeySystem){let t=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,"Playready key system is not supported now");return t.url=e,void this.trigger(n.a.ERROR,t)}if(!e||!e.trim().length){let t=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,"Empty loadSource url");return t.url=e,void this.trigger(n.a.ERROR,t)}if(this.config.gapless&&void 0===t.itemId){let e=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,!0,"Undefined itemId");this.trigger(n.a.ERROR,e)}else{if(e=c.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),this.platformInfo=t.platformInfo,this._userInfo=t.userInfo,this._urlNeedsUpdate(e)){let i={language:t.language,dsid:t.dsid,subs:t.subs};e=this._updateUrlWithQueryStrings(e,this.platformInfo,i),t.inheritQuery=!1}this.loadSourceInternal(e,t,i)}}reloadSource(e){this.resetLoadSource(),this.logger.info(`[gapless] reload item ${this.playingItem.itemId} @ ${this.playingItem.startTime}, seek to ${e}; stale loading item ${this.loadingItem.itemId}`)(),this.loadSourceInternal(this.playingItem.url,this.playingItem.options,isNaN(this.playingItem.startTime)?0:this.playingItem.startTime,e)}loadSourceInternal(e,t={},i,s){let r=t&&t.itemId;this.playingItem&&r===this.playingItem.itemId?this.setLoadingItem(this.playingItem):(this.setLoadingItem({url:e,itemId:t.itemId,inheritQuery:Boolean(t.inheritQuery),secureStop:Boolean(t.generateSecureStop),appData:t.appData,startTime:i,options:t}),(isNaN(i)||i<0)&&(this.logger.info("[gapless] loadSource: setting playingItem as current loadingItem")(),this.setPlayingItem(this.loadingItem),void 0===this.playingItem.startTime&&(this.playingItem.startTime=0))),this.logger.info(`[QE Critical] loadSource:${this.redactUrl(e)}, itemId:${t.itemId}`)(),this.tloadsource=performance.now(),this.loadingItem.cachedManifestCtx?this.handleParsedManifestData(this.loadingItem.cachedManifestCtx,s):this.playlistLoader.loadManifest(e,t).then(e=>{this.handleManifestLoadedData(e,r)}).catch(e=>{e instanceof a.p?this._handleManifestNetworkError(e):e instanceof a.q&&this.logger.warn(`encountered playlist parsing error because ${e.reason} and may expect to hanle manifest parsing error here`)()})}handleManifestLoadedData(e,t){return this.trigger(n.a.MANIFEST_LOADED,e),this.levelController.parseManifestLoadedData(e).then(i=>{if(this.loadingItem.itemId!==t)return void this.logger.warn("[gapless] item switched before manifest parsed for "+t)();let s=e.stats;s.tparsed=performance.now(),this.loadingItem.cachedManifestCtx=i,this.handleParsedManifestData(i);let r={levels:this.levels,firstLevel:this.firstLevel,audio:i.audioCodecFound,video:i.videoCodecFound,altAudio:i.altAudio,audioTracks:this.audioTracks,audioMediaSelectionGroup:i.audioMediaSelectionGroup,subtitleMediaSelectionGroup:i.subtitleMediaSelectionGroup,stats:s};if(this.trigger(n.a.MANIFEST_PARSED,r),e.isMediaPlaylist){let e=this.levels[0].details,t=this.playlistType,i={level:this.levels[0].persistentId,details:e,playlistType:t,id:this.levels[0].persistentId,stats:{trequest:s.trequest,tload:s.tload,contentType:s.contentType},livePlaylistUpdateError:!1};this.trigger(n.a.LEVEL_LOADED,i)}}).catch(e=>{let t;this.logger.error("manifest parse error:"+e.message)(),e instanceof a.q?t=Object.assign(Object.assign({},e),{url:this.url}):((t=new a.h(a.g.OTHER_ERROR,a.d.INTERNAL_EXCEPTION,void 0,e.message)).response=a.f.InternalError,t.url=this.url),t.fatal=!0,this.trigger(n.a.ERROR,t)})}handleParsedManifestData(e,t){let{levels:i,audioTracks:s,subtitleTracks:r,isMediaPlaylist:n,audioCodecFound:a,videoCodecFound:o,altAudio:l,audioMediaSelectionGroup:h,subtitleMediaSelectionGroup:d}=e;this.logger.info(`handleParsedManifestData ${i.validVariantList.length}/${s.validVariantList.length}/${r.validVariantList.length}`)();let u=i.variantList;this.cdnWhiteList=new Set,u.forEach(e=>{y.isCustomUrl(e.url)||this.addCDNToWhiteList(c.getHostName(e.url))}),this.levelController.setVariantManager(i),this.audioTrackController&&this.audioTrackController.setTracks(s,h),this.subtitleTrackController&&this.subtitleTrackController.setTracks(r,d);let f=o||i.variantList.length&&l;this.bufferController.setExpectedSB(f,a,l),this.streamController.startItemLoad(u,n,l,t)}_handleManifestNetworkError(e){let t,i,s,r=e.response,n=r?r.code:r;i=this.networkErrorHandler.getActionForManifestError(e),this.logger.warn(`manifest encountered error ${n} errorAction ${i.errorAction}`)(),s=()=>this.playlistLoader.retryPlaylistRequest(e),(t=this.networkErrorHandler.handleNetworkError(i.errorAction,i.errorActionFlags,e,void 0,s)).retryPromise instanceof Promise?t.retryPromise.then(e=>{this.handleManifestLoadedData(e,this.loadingItem.itemId)}).catch(e=>{e instanceof a.p&&this._handleManifestNetworkError(e)}):i.errorAction===Rs.RetryRequest&&(e.fatal=!0),e.fatal&&this.upgradeInternalErrorIfNecessary(e)}handleItemTransitioned(){let e=this.playingItem?this.playingItem.itemId:void 0,t=this.loadingItem;this.logger.info(`[QE Critical] [gapless] transitioning from ${e} to ${t.itemId}`)(),this.setPlayingItem(t),this.trigger(n.a.ITEM_TRANSITIONED,{prevItemId:e,nextItemId:t.itemId,nextStartTime:this.playingItem.startTime,nextDuration:this.playingItem.totalduration})}get bufferDryPromise(){if(this.streamController.combinedBufferEmpty())return Promise.resolve();if(!this.bufferEndPromiseWrapper){this.bufferEndPromiseWrapper={};let e=new Promise((e,t)=>{this.bufferEndPromiseWrapper.resolve=e,this.bufferEndPromiseWrapper.reject=t});this.bufferEndPromiseWrapper.promise=e.then(()=>{this.bufferEndPromiseWrapper=void 0}).catch(e=>{throw this.bufferEndPromiseWrapper=void 0,e})}return this.bufferEndPromiseWrapper.promise}onBufferChanged(e,t){switch(t.reason){case Os.AlmostDryWaterLevel:this.bufferEndPromiseWrapper&&this.bufferEndPromiseWrapper.resolve()}}get realCurrentTime(){if(this._isObjectValid())return this.streamController.realCurrentTime}set realCurrentTime(e){this._isObjectValid()&&(this.streamController.realCurrentTime=e)}get iframeMode(){if(this._isObjectValid())return this.streamController.iframeMode}get effectiveRate(){return this.streamController.effectiveRate}set desiredRate(e){this.setRate(e)}get desiredRate(){return this._isObjectValid()?this.streamController.desiredRate:0}addCDNToWhiteList(e){this.cdnWhiteList.add(e)}removeCDNFromWhiteList(e){this.cdnWhiteList.delete(e)}isValidCDN(e){return this.cdnWhiteList.has(e)}hasFallBack(){return this.cdnWhiteList.size>1&&this.config.enableCDNFallback}static hasAllowedHost(e,t){return y.isCustomUrl(e)||c.getHostName(e)===t}get preferredHostName(){return this.cdnReferenceBaseURL}set preferredHostName(e){this.cdnReferenceBaseURL=e}setRate(e){if(!this._isObjectValid()||!this.media)return;this.logger.info("setRate "+e)();const t=Math.abs(e);if(![0,1,8,24,48,96].some(e=>e===t))return this.logger.warn(`unsupported rate(${e})`)(),-3;const i=0!==e&&1!==e;if(i&&!this.levelController.hasIframeLevels)return this.logger.warn("can't switch to iframe mode")(),-1;if(this.config.overridePlaybackRate){let e=i?2:1;this.media.playbackRate=e,this.logger.info("[iframes] setting playbackRate to "+e)()}return this.streamController.desiredRate=e,this.eventReporter.setRate(e),0}startLoad(e=-1){this._isObjectValid()&&this.media&&(this.logger.info(`Hls startLoad(${e})`)(),this.networkControllers.forEach(t=>{t.startLoad(e)}))}stopLoad(){this._isObjectValid()&&(this.logger.info("stopLoad")(),this.networkControllers.forEach(e=>{e.stopLoad()}))}setAppData(e){this._isObjectValid()&&e&&this.eventReporter&&this.eventReporter.setAppData(e)}set userInfo(e){this._isObjectValid()&&e&&(this._userInfo=e)}get userInfo(){if(this._isObjectValid())return this._userInfo}get keysystems(){if(this._isObjectValid())return this.keyLoader.keySystemController.availableKeySystems}setProtectionData(e){this._isObjectValid()&&this.keyLoader.keySystemController.initialize(e)}generateKeyRequest(e,t){this._isObjectValid()&&(this.keyLoader.keySystemController.generateRequest(e,t),this.eventReporter.notifyKeySessionEvent("spcreceived",{keyuri:e}))}setLicenseResponse(e,t){this._isObjectValid()&&this.keyLoader.keySystemController.setLicenseResponse(e,t)}registerProgramDateTime(e,t){if(!this._isObjectValid())return;this.availableProgramDateTime||(this.availableProgramDateTime=new Map);let i=new Date(e);this.availableProgramDateTime.set(i.getTime(),t)}resolvePendingSeekToDate(){if(!this._isObjectValid())return;let e=-1;return this.availableProgramDateTime&&this.availableProgramDateTime.size>0&&this.pendingSeekToDate&&(e=this.resolveProgramDateTimeToPTS(this.pendingSeekToDate)),e}resolveProgramDateTimeToPTS(e){if(!this._isObjectValid())return;let t=Array.from(this.availableProgramDateTime.keys());t.sort((function(e,t){return e-t}));let i,s=new Date("1970-01-01 00:00:00").getTime(),r=0,n=0,a=0;if(t.length){for(i=0;i<t.length;++i){let r=t[i];if(e.getTime()<r)break;s=r}if(0===i){let i=t[0],s=this.availableProgramDateTime.get(i);s>0&&(a=s-(n=(i-e.getTime())/1e3))}else a=(r=this.availableProgramDateTime.get(s))+(n=(e.getTime()-s)/1e3)}return a}seekToDate(e){if(this._isObjectValid()&&e instanceof Date&&!isNaN(e.getTime()))if(this.availableProgramDateTime&&0!==this.availableProgramDateTime.size){let t=this.resolveProgramDateTimeToPTS(e);null!=t&&isFinite(t)&&(this.logger.info("adjust currentTime to date "+t)(),this.media.currentTime=t)}else this.pendingSeekToDate=e}handleResolvedUri(e,t){this._isObjectValid()&&this.trigger(n.a.UNRESOLVED_URI_LOADED,{uri:e,response:t})}redactUrl(e){return"production"===this.config.buildType?"<redacted>":e}recoverMediaError(){if(this._isObjectValid()){var e=this.media;this.detachMedia(),this.attachMedia(e)}}get levels(){if(this._isObjectValid())return this.levelController.validLevels}get currentLevel(){if(this._isObjectValid())return this.streamController.currentLevel}levelWithPersistentId(e){if(this._isObjectValid())return this.levelController.getLevelWithPersistentId(e)}set currentLevel(e){this._isObjectValid()&&(this.loadLevel=e,this.streamController.immediateLevelSwitch())}get nextLevel(){if(this._isObjectValid())return this.streamController.nextLevel}set nextLevel(e){this._isObjectValid()&&(this.levelController.manualLevel=e,this.streamController.nextLevelSwitch())}get loadLevel(){if(this._isObjectValid())return this.levelController.level}set loadLevel(e){this._isObjectValid()&&(this.levelController.manualLevel=e)}get nextLoadLevel(){if(this._isObjectValid())return this.levelController.nextLoadLevel}set nextLoadLevel(e){this._isObjectValid()&&(this.levelController.nextLoadLevel=e)}get firstLevel(){if(this._isObjectValid())return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this._isObjectValid()&&(this.levelController.firstLevel=e)}get startLevel(){if(this._isObjectValid())return this.levelController.startLevel}set startLevel(e){this._isObjectValid()&&(-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e)}get autoLevelCapping(){if(this._isObjectValid())return this._autoLevelCapping}set autoLevelCapping(e){this._isObjectValid()&&(this._autoLevelCapping=e)}get autoLevelEnabled(){if(this._isObjectValid())return-1===this.levelController.manualLevel}get manualLevel(){if(this._isObjectValid())return this.levelController.manualLevel}get seeking(){return!!this._isObjectValid()&&this.streamController.seeking}get playbackLikelyToKeepUp(){return!!this._isObjectValid()&&this.streamController.playbackLikelyToKeepUp}get waitingForIncompatibleCCFragLoad(){return!!this._isObjectValid()&&!!this.streamController.waitingForIncompatibleCC}get minAutoLevel(){if(!this._isObjectValid())return;let e=this,t=e.levels,i=e.config.minAutoBitrate,s=t?t.length:0;for(let r=0;r<s;r++)if((t[r].realBitrate?Math.max(t[r].realBitrate,t[r].bitrate):t[r].bitrate)>i&&t[r].iframes===e.iframeMode)return r;return 0}get minLevelIframeMode(){if(!this._isObjectValid())return;let e=this.levels,t=this.config.minAutoBitrate,i=e?e.length:0;for(let s=0;s<i;s++)if((e[s].realBitrate?Math.max(e[s].realBitrate,e[s].bitrate):e[s].bitrate)>t&&!0===e[s].iframes)return s;return-1}get maxAutoLevel(){if(!this._isObjectValid())return;const e=this.levels,t=this.iframeMode?-1:this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}get maxLevelIframeMode(){if(!this._isObjectValid())return;const e=this.levels;return e&&e.length?e.length-1:-1}getLowestBitrateLevel(e){if(this._isObjectValid())return this.levelController.lowestBitrateLevel(e)}countIframesInCurrentLevel(){return this.streamController.countIframesInCurrentLevel(this.levelController.level)}get nextAutoLevel(){if(this._isObjectValid())return 0!==this.levels.length?Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.levels[this.maxAutoLevel].persistentId):void 0}set nextAutoLevel(e){this._isObjectValid()&&(this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e))}get sessionData(){if(this._isObjectValid())return this.playlistLoader.parsedSessionData}get liveSyncPosition(){if(this._isObjectValid())return this.streamController.liveSyncPosition}get audioTracks(){if(!this._isObjectValid())return;const e=this.audioTrackController;return e?e.validTracks:[]}get audioTrack(){if(!this._isObjectValid())return;const e=this.audioTrackController;return e?e.audioTrack:-1}get audioMediaOptions(){if(!this._isObjectValid())return;const e=this.audioTrackController;return e&&e.mediaSelectionGroup?e.mediaSelectionGroup.MediaSelectionGroupOptions:void 0}get audioSelectedPersistentID(){if(!this._isObjectValid())return;const e=this.audioTrackController;return e&&e.selectedMediaOption?e.selectedPersistentID:void 0}set audioSelectedPersistentID(e){if(!this._isObjectValid())return;const t=this.audioTrackController;t&&(t.selectedPersistentID=e)}get subtitleTracks(){if(!this._isObjectValid())return;const e=this.subtitleTrackController;return e?e.validTracks:[]}get subtitleMediaOptions(){if(!this._isObjectValid())return;const e=this.subtitleTrackController;return e&&e.mediaSelectionGroup?e.mediaSelectionGroup.MediaSelectionGroupOptions:void 0}get subtitleSelectedPersistentID(){if(!this._isObjectValid())return;const e=this.subtitleTrackController;return e&&e.selectedMediaOption?e.selectedPersistentID:void 0}set subtitleSelectedPersistentID(e){if(!this._isObjectValid())return;const t=this.subtitleTrackController;t&&(t.selectedPersistentID=e)}get selectedMediaArray(){if(!this._isObjectValid())return;let e=[],t=this.audioTrackController?this.audioTrackController.selectedMediaOption:void 0,i=this.subtitleTrackController?this.subtitleTrackController.selectedMediaOption:void 0;if(t){let i={MediaSelectionGroupMediaType:pi.AUDIO,MediaSelectionOptionsPersistentID:t.MediaSelectionOptionsPersistentID};e.push(i)}if(i){let t=i.MediaSelectionOptionsDisplaysNonForcedSubtitles?i.MediaSelectionOptionsDisplaysNonForcedSubtitles:gi.NO,s={MediaSelectionGroupMediaType:pi.SUBTITLE,MediaSelectionOptionsDisplaysNonForcedSubtitles:t,MediaSelectionOptionsPersistentID:i.MediaSelectionOptionsPersistentID};e.push(s)}return e}set selectedMediaArray(e){this._isObjectValid()&&e.forEach(e=>{e.MediaSelectionGroupMediaType===pi.AUDIO||e.MediaSelectionOptionsMediaType===pi.AUDIO?this.audioSelectedPersistentID=e.MediaSelectionOptionsPersistentID:e.MediaSelectionGroupMediaType!==pi.SUBTITLE&&e.MediaSelectionOptionsMediaType!==pi.SUBTITLE&&e.MediaSelectionOptionsMediaType!==pi.CLOSEDCAPTION||(this.subtitleSelectedPersistentID=e.MediaSelectionOptionsPersistentID)})}get mediaSelectionArray(){if(!this._isObjectValid())return;let e=new Array;const t=this.subtitleTrackController,i=this.audioTrackController;return i&&i.mediaSelectionGroup&&e.push(i.mediaSelectionGroup),t&&t.mediaSelectionGroup&&e.push(t.mediaSelectionGroup),e}get subtitleDisplay(){if(!this._isObjectValid())return;const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){if(!this._isObjectValid())return;const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get hasPlaybackEverStarted(){if(this._isObjectValid())return this.streamController.playbackEverStarted}updatePlaylistAttributes(e){let t=e.type,i="VOD",s=e.live;return"EVENT"===t&&s?i="EVENT":t&&"LIVE"!==t||!s||(i="LIVE"),this.isLive=s,this.playlistType=i,{playlistType:i,isLive:s}}}var un=t.default=cn},function(e,t,i){"use strict";i.r(t),i.d(t,"createDemuxerWorker",(function(){return a})),i.d(t,"createDecryptorWorker",(function(){return o}));var s=i(14);i.d(t,"DemuxerInline",(function(){return s.a}));var r=i(15);i.d(t,"SegmentDecryptorInline",(function(){return r.a}));const n=(e,t)=>i(24)(e,t),a=()=>n(25),o=()=>n(26)}]).default}).call(this,i(720),i(1859),i(2355).setImmediate,i(2355).clearImmediate)},2355:function(e,t,i){(function(e){var s="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,r=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(r.call(setTimeout,s,arguments),clearTimeout)},t.setInterval=function(){return new n(r.call(setInterval,s,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(s,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},i(2356),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(720))},2356:function(e,t,i){(function(e,t){!function(e,i){"use strict";if(!e.setImmediate){var s,r=1,n={},a=!1,o=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?s=function(e){t.nextTick((function(){d(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?function(){var t="setImmediate$"+Math.random()+"$",i=function(i){i.source===e&&"string"===typeof i.data&&0===i.data.indexOf(t)&&d(+i.data.slice(t.length))};e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),s=function(i){e.postMessage(t+i,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){d(e.data)},s=function(t){e.port2.postMessage(t)}}():o&&"onreadystatechange"in o.createElement("script")?function(){var e=o.documentElement;s=function(t){var i=o.createElement("script");i.onreadystatechange=function(){d(t),i.onreadystatechange=null,e.removeChild(i),i=null},e.appendChild(i)}}():s=function(e){setTimeout(d,0,e)},l.setImmediate=function(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var a={callback:e,args:t};return n[r]=a,s(r),r++},l.clearImmediate=h}function h(e){delete n[e]}function d(e){if(a)setTimeout(d,0,e);else{var t=n[e];if(t){a=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(void 0,i)}}(t)}finally{h(e),a=!1}}}}}("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,i(720),i(1859))},2357:function(e,t,i){"use strict";var s=i(2358);s.create=i(2463),e.exports={Player:s,VERSION:i(2461)}},2358:function(e,t,i){"use strict";function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var n=i(2359),a=i(2362),o=i(2363),l=i(2364).create,h=i(2365),d=i(2398),c=i(2413),u=i(2415),f=i(2418),p=i(2419),g=i(2431),m=i(2432)(),y=i(2434)()&&!i(2435)(),v=i(2437)(),_=h.browser.safari&&h.os.ios,b=h.browser.safari&&h.os.osx,T=h.browser.chrome,S=h.browser.edge,E=i(2439),w=i(2370),I=i(2440),D=i(2441),L=i(2442),k=i(2443),R=i(2451),C=i(2455),A=i(2459),P=i(2461);w("@marcom/ac-video version: "+P.toString());var x=function(e){var t,i;function x(t){var i;i=e.call(this,t)||this,t=t||{},i.el=t.el||document.createElement("div"),i._elementEmitter=new a(i.el),i.VERSION=P,i.options=t,i._controlsFactory=t.controlsFactory,i._urlOptimizer=t.urlOptimizer,b&&i.el.classList.add("safari-fix-zindex");try{var r=window.top;i._maxWidth=t.maxWidth||Math.min(window.innerWidth,1280)||Math.min(r.innerWidth,1280)}catch(n){i._maxWidth=t.maxWidth||Math.min(window.innerWidth,1280)}return i._lastResize=0,i._lastMouseCoords={},i.el.classList.add("ac-video-player"),i.el.classList.add("idle-state"),i._isLive=t.live,i._isDvr=t.dvr,i._isLive&&i._useLiveMode(t.dvr),i._videoImpl=l(t,i.el),i._isResponsive=t.responsive,i._isResponsive&&(i._breakpointDetect=new L({el:i.el,player:s(i),breakpoints:E,addClass:!0})),i._supportsInlineVideo=y||!(v&&_),i._cachedPiPMode=i.isPictureInPicture(),i._cachedReadyState=i.getReadyState(),i._cachedVisibleTracksLength=0,i.el.appendChild(i._videoImpl.getRenderElement()),(t.poster||"undefined"===typeof t.poster)&&(i._initPoster(t.poster),t.autoplay||"undefined"===typeof t.preload||"none"!==t.preload&&"metadata"!==t.preload&&!1!==t.preload||i._poster.show()),i._bindMethods(),i._addEventListeners(),y&&(i._keyboardControl=k({player:s(i),threesixty:t.threesixty,keyboardTarget:t.keyboardTarget})),t.controls&&i._initUIComponents(),i._initErrorView(),t.parentElement&&t.parentElement.appendChild(i.el),i._chapterEmitter=new o(t),i.refreshSize=i.refreshSize.bind(s(i)),i._refreshSizeTimeout=setTimeout(i.refreshSize,0),window.addEventListener("DOMContentLoaded",i.refreshSize),i}i=e,(t=x).prototype=Object.create(i.prototype),t.prototype.constructor=t,r(t,i);var M=x.prototype;return M._bindMethods=function(){this._onStart=this._onStart.bind(this),this._onEnded=this._onEnded.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onCaptionsChanged=this._onCaptionsChanged.bind(this),this._onPlay=this._onPlay.bind(this),this._onFullscreenChange=this._onFullscreenChange.bind(this),this._onError=this._onError.bind(this),this._forwardEvent=this._forwardEvent.bind(this),this._onPresentationModeChanged=this._onPresentationModeChanged.bind(this),this._forwardFullScreenChangeEvent=this._forwardNamedEvent.bind(this,"fullscreen:change"),this._forwardEnterFullScreenEvent=this._forwardNamedEvent.bind(this,"enterfullscreen"),this._forwardExitFullScreenEvent=this._forwardNamedEvent.bind(this,"exitfullscreen"),this._onDurationChange=this._onDurationChange.bind(this),this._forwardReadyStateChange=this._forwardReadyStateChange.bind(this),this._showControls=this._showControls.bind(this),this._hideControls=this._hideControls.bind(this),this._raiseControls=this._raiseControls.bind(this),this._lowerControls=this._lowerControls.bind(this),this._onPlayPromiseError=this._onPlayPromiseError.bind(this),this._onPlayPromiseResolved=this._onPlayPromiseResolved.bind(this),this._onChapterChange=this._onChapterChange.bind(this),this.refreshSize=this.refreshSize.bind(this)},M._addEventListeners=function(){for(var e=0,t=I.length;e<t;e++)this._videoImpl.on(I[e],this._forwardEvent);for(e=0,t=D.length;e<t;e++)this._videoImpl.on(D[e],this._forwardReadyStateChange);this._videoImpl.on("timeupdate",this._onTimeUpdate),this._videoImpl.on("webkitpresentationmodechanged",this._onPresentationModeChanged),this._videoImpl.on("durationchange",this._onDurationChange),this._videoImpl.on("addtrack",this._forwardEvent),this._videoImpl.on("change",this._forwardEvent),this._videoImpl.on("change",this._onCaptionsChanged),this._videoImpl.on("removetrack",this._forwardEvent),this._videoImpl.on("loadedmetadata",this.refreshSize),this._videoImpl.on("loadeddata",this.refreshSize),this._videoImpl.on("play",this._onPlay),y?(d.on("enterfullscreen",this._forwardEnterFullScreenEvent),d.on("exitfullscreen",this._forwardExitFullScreenEvent),d.on("enterfullscreen",this._forwardFullScreenChangeEvent),d.on("exitfullscreen",this._forwardFullScreenChangeEvent),this.on("fullscreen:change",this._onFullscreenChange)):_&&(this._videoImpl.on("webkitbeginfullscreen",this._forwardEnterFullScreenEvent),this._videoImpl.on("webkitendfullscreen",this._forwardExitFullScreenEvent),this._videoImpl.on("webkitbeginfullscreen",this._forwardFullScreenChangeEvent),this._videoImpl.on("webkitendfullscreen",this._forwardFullScreenChangeEvent),v&&this.on("fullscreen:change",this._onFullscreenChange)),this._chapterEmitter&&this._chapterEmitter.on("change",this._onChapterChange),this._videoImpl.on("PlayPromiseError",this._onPlayPromiseError),this._videoImpl.on("PlayPromiseResolved",this._onPlayPromiseResolved),this._videoImpl.on("error",this._onError)},M._onPlayPromiseResolved=function(){this.trigger("PlayPromiseResolved")},M._removeEventListeners=function(){for(var e=0,t=I.length;e<t;e++)this._videoImpl.off(I[e],this._forwardEvent);for(e=0,t=D.length;e<t;e++)this._videoImpl.off(D[e],this._forwardReadyStateChange);this._videoImpl.off("timeupdate",this._onTimeUpdate),this._videoImpl.off("webkitpresentationmodechanged",this._onPresentationModeChanged),this._videoImpl.off("durationchange",this._onDurationChange),y?(d.off("enterfullscreen",this._forwardEnterFullScreenEvent),d.off("exitfullscreen",this._forwardExitFullScreenEvent),d.off("enterfullscreen",this._forwardFullScreenChangeEvent),d.off("exitfullscreen",this._forwardFullScreenChangeEvent)):h.os.ios&&(this._videoImpl.off("webkitbeginfullscreen",this._forwardEnterFullScreenEvent),this._videoImpl.off("webkitendfullscreen",this._forwardExitFullScreenEvent),this._videoImpl.off("webkitbeginfullscreen",this._forwardFullScreenChangeEvent),this._videoImpl.off("webkitendfullscreen",this._forwardFullScreenChangeEvent)),this._chapterEmitter&&this._chapterEmitter.off("change",this._onChapterChange),this._videoImpl.off("PlayPromiseError",this._onPlayPromiseError),this._videoImpl.off("loadedmetadata",this.refreshSize),this._videoImpl.off("loadeddata",this.refreshSize),window.removeEventListener("DOMContentLoaded",this.refreshSize)},M._forwardReadyStateChange=function(){var e=this.getReadyState();(e>this._cachedReadyState||0===e)&&(this._cachedReadyState=e,this.trigger("readystatechange",{readyState:e}))},M._forwardEvent=function(e){w(e.type+" time:"+this.getCurrentTime()),this.trigger(e.type)},M._forwardNamedEvent=function(e){w(e+" time:"+this.getCurrentTime()),this.trigger(e)},M._onPlayPromiseError=function(){w("play() Promise rejected, probably because the browser is blocking autoplay"),this.el.classList.add("initial-play"),this._showStartState(),this._poster.show(),this.once("play",this._onPlay)},M._onCaptionsChanged=function(e){var t=this.getVisibleTextTracks().length;t>0&&0===this._cachedVisibleTracksLength?this.trigger("texttrackshow"):0===t&&this._cachedVisibleTracksLength>0&&this.trigger("texttrackhide"),this._cachedVisibleTracksLength=t},M._onTimeUpdate=function(){this.trigger("timeupdate",{currentTime:this.getCurrentTime()})},M.load=function(e,t,i,s){if(this._setError(!1),this.refreshSize(),this._started=!1,Array.isArray(e)||(e=[e]),t&&!Array.isArray(t)&&(t=[{src:t}]),this._cachedReadyState=0,s||(s=this.options),this._urlOptimizer){t||(t=e.map(this._urlOptimizer.getCaptionsSource).filter((function(e){return!!e})));var r=this.getVisibleTextTracks();r&&r.length&&t&&t.length&&(t[0].mode="showing");var n=s.maxWidth||this._calcMaxWidth();e=e.map(function(e){return this._urlOptimizer.getVideoSource(e,n,null,{urlOptimizeHls:this.options.urlOptimizeHls})}.bind(this))}var a=s&&s.thumbnails||this._urlOptimizer&&this._urlOptimizer.getThumbnailImageSource(e[0]);this.once("play",this._onPlay),(this.options.autoplay&&y||this.getEnded())&&this.once("loadstart",function(){this.play()}.bind(this)),s||(s=this.options),s&&this._poster&&this.setPoster(s.poster),this._poster&&this._poster.show(),this.controls&&this.controls.sharingModule&&(s.sharing?this.controls.sharingModule.setData(s.sharing):this.controls.sharingModule.setData(null)),void 0!==s.live&&(this._isLive=s.live,this._useLiveMode(s.dvr)),this._hideEndState(),this._videoImpl.load(e,t,i),this.controls&&this.controls.overlays?this.controls.overlays.setData(a):this.controls&&this.once("controlsready",function(){this.controls.overlays&&this.controls.overlays.setData(a)}.bind(this)),this.controls&&this.controls.endState?this.controls.endState.setData(s.endState):this.controls&&this.once("controlsready",function(){this.controls.endState&&this.controls.endState.setData(s.endState)}.bind(this))},M._calcMaxWidth=function(){return this.el.parentElement?this.el.parentElement.clientWidth:this._maxWidth},M._isActiveArea=function(e){for(;e!==this.el;){if(e.hasAttribute("data-acv-active-area"))return!0;e=e.parentNode}return!1},M._onPresentationModeChanged=function(e){this._forwardEvent(e);var t=this.isPictureInPicture();this._cachedPiPMode!==t&&(this._cachedPiPMode=t,w("pictureinpicture:change to "+t),this.trigger("pictureinpicture:change"))},M._onDurationChange=function(e){(this._isDvr||this.getDuration()>3600)&&this.el.classList.add("longform"),this.refreshSize()},M.appendTo=function(e){e.appendChild(this.el),this.refreshSize()},M.getTextTracks=function(){return Array.prototype.slice.call(this._videoImpl.getTextTracks())},M.getVisibleTextTracks=function(){var e=Array.prototype.slice.call(this._videoImpl.getTextTracks());return e&&e.length&&(e=e.filter((function(e){return"showing"===e.mode}))),e},M.getFullScreenElement=function(){return y?this.el:this.getMediaElement()},M.getFullScreenEnabled=function(){return d.fullscreenEnabled(this.getFullScreenElement())},M.isFullscreen=function(){return y?d.fullscreenElement()===this.getFullScreenElement():this._videoImpl.isFullscreen()},M.requestFullscreen=function(){if(!this.isFullscreen()){this.controls&&(this.controls.el.display="none",this._hideControls()),this.trigger("fullscreen:willenter",{type:"enter"}),this._lastResize=Date.now(),g(this._updateFullscreenId);var e=this;this._updateFullscreenId=p((function t(){e.refreshSize(),e._updateFullscreenId=p(t)})),T?setTimeout(function(){this._lastResize=Date.now(),d.requestFullscreen(this.getFullScreenElement())}.bind(this),300):d.requestFullscreen(this.getFullScreenElement())}},M.exitFullscreen=function(){this.isFullscreen()&&(this.controls&&(this.controls.el.display="none",this._hideControls()),this.trigger("fullscreen:willexit",{type:"exit"}),T?setTimeout(function(){d.exitFullscreen(this.getFullScreenElement())}.bind(this),300):d.exitFullscreen(this.getFullScreenElement()))},M._onFullscreenChange=function(){this._lastResize=Date.now(),this.controls&&(this.controls.el.display="",this._hideControls()),this._preventUserInteraction=!0,setTimeout(function(){g(this._updateFullscreenId),this._preventUserInteraction=!1,this.refreshSize()}.bind(this),750),this.refreshSize()},M.toggleFullscreen=function(){this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()},M._initUIComponents=function(){this._controlsFactory?(this._instantiateDefaultCustomUIControls(),y?this.el.appendChild(this._blockade.el):(this.controls.el.classList.add("mobile"),this.setControls(!0))):this.setControls(!0)},M._showControls=function(){this._controlsVisible=!0,this.el.classList.remove("initial-play"),this.el.classList.add("user-hover")},M._hideControls=function(){this._controlsVisible=!1,this.el.classList.remove("user-hover"),this.hideCaptionsSelector()},M._raiseControls=function(){this._controlsVisible=!0,this.el.classList.remove("mouse-leave")},M._lowerControls=function(){this._controlsVisible=!1,this.el.classList.add("mouse-leave"),this.hideCaptionsSelector()},M._onControlsReady=function(){this.options.autoplay&&y||this._showStartState()},M._showStartState=function(){this.controls&&this.controls.el.classList.add("start-state"),this._poster&&this._poster.show(),y||C(this.getMediaElement())},M._hideStartState=function(){this.controls&&this.controls.el.classList.remove("start-state"),this._poster&&this._poster.hide(),y||A(this.getMediaElement())},M._showEndState=function(){this.controls&&(this.controls.mainControlsElement?this.controls.mainControlsElement.contains(document.activeElement)&&setTimeout(function(){this.controls.playButtonElement.focus()}.bind(this)):this.el.contains(document.activeElement)&&!this.controls.sharingModule.el.contains(document.activeElement)&&setTimeout(function(){this.controls.playButtonElement.focus()}.bind(this)),this.controls.el.classList.add("end-state")),this._poster&&this._poster.show(),C(this.getMediaElement())},M._hideEndState=function(){this.controls&&this.controls.el.classList.remove("end-state"),y||A(this.getMediaElement())},M._createBlockade=function(){this._blockade=new a(document.createElement("div")),this._blockade.el.classList.add("ac-video-blockade")},M._instantiateDefaultCustomUIControls=function(){return this.controls=this._controlsFactory.create({player:this,endState:this.options.endState,enableMainControls:y,basePath:this.options.localizationBasePath,forceEnglishLabels:this.options.forceEnglishLabels,template:this.options.template,readyCallback:function(){this._onControlsReady(),this.trigger("controlsready")}.bind(this)}),this.controls.el.parentNode!==this.el&&this.el.appendChild(this.controls.el),this._videoImpl.setControls(!1),this._createBlockade(),this._controlsInteraction=R({player:this,keyboardControl:this._keyboardControl,controlsTimeoutDuration:this.options.controlsTimeoutDuration,showControls:this._showControls,hideControls:this._hideControls,raiseControls:this._raiseControls,lowerControls:this._lowerControls,controlsVisible:function(){return this._controlsVisible}.bind(this),sendMouseDown:this._videoImpl.sendMouseDown,elementEmitter:this._elementEmitter}),this.controls},M._onPlay=function(){this._started||(this.el.classList.remove("idle-state"),this.once("timeupdate",this._onStart,function(){return this.getCurrentTime()>0&&!this.getPaused()}.bind(this)))},M.isCaptionsSelectorShowing=function(){return this.controls.el.classList.contains("captions-selector-showing")},M.showCaptionsSelector=function(){this.controls.el.classList.add("captions-selector-showing")},M.hideCaptionsSelector=function(){this.controls.el.classList.remove("captions-selector-showing")},M._onStart=function(){this._started=!0,this.el.classList.add("initial-play"),this._poster&&this._poster.hide(),this.controls&&(this._hideStartState(),this._hideEndState()),this.once("ended",this._onEnded)},M._onEnded=function(){this.isFullscreen()&&this.exitFullscreen(),this.controls&&(this._hideStartState(),this._showEndState()),setTimeout(function(){this.once("timeupdate",function(){this.getEnded()?this._onEnded():this._onStart()}.bind(this))}.bind(this),300),this._poster&&this._poster.show(),this._started=!1},M._initPoster=function(e){this._poster=c({player:this,video:this._videoImpl,useNativePoster:!1===this.options.controls,is2x:m,src:e}),this._poster.el&&this.el.appendChild(this._poster.el),this.options.autoplay||this._poster.show()},M._initErrorView=function(){this._errorView=new f,this.el.appendChild(this._errorView.el)},M._useLiveMode=function(e){this._isLive?(this.el.classList.add("ac-video-live"),e&&!S&&this.el.classList.add("ac-video-live-dvr")):(this.el.classList.remove("ac-video-live"),this.el.classList.remove("ac-video-live-dvr"))},M.once=function(t,i,s){if(arguments.length<3||"object"===typeof s)e.prototype.once.apply(this,arguments);else{var r=arguments,n=Array.prototype.slice.call(arguments,2),a=function(){n.every((function(e){return!!e()}))&&(r[1].apply(this,r),this.off(r[0],a))}.bind(this);this.on(r[0],a)}},M.getMediaElement=function(){return this._videoImpl.getMediaElement()},M.play=function(){var e=this;this.el.classList.remove("idle-state");var t=this._videoImpl.getCurrentTime();w("play called"),!this._videoImpl.getError()||0!==t&&!isNaN(t)?this._videoImpl.play():setTimeout((function(){e._errorView.focus()}),1e3)},M.pause=function(){this._videoImpl.pause()},M.seek=function(e){this.setCurrentTime.apply(this,arguments)},M.addTextTrack=function(e){this._videoImpl.addTextTrack(e)},M.getReadyState=function(){return this._videoImpl.getMediaElement().readyState},M.getPreload=function(){return this._videoImpl.getPreload()},M.setPoster=function(e){this._poster.setSrc(e)},M.getPoster=function(){this._poster.getSrc()},M.getVolume=function(){return this._videoImpl.getVolume()},M.getMuted=function(){return this._videoImpl.getMuted()},M.getCurrentTime=function(){return this._videoImpl.getCurrentTime()},M.getDuration=function(){return this._videoImpl.getDuration()},M.getPaused=function(){return this._videoImpl.getPaused()},M.getEnded=function(){return this._videoImpl.getEnded()},M.getBufferedPercentage=function(){var e=this.getCurrentTime(),t=this.getDuration();if(isNaN(t)||t===1/0)return 0;var i=this._videoImpl.getBuffered();if(i.length)for(var s=0;s<i.length;s++)if(i.start(s)<=e&&i.end(s)>e)return i.end(s)/t*100;return e/t*100},M.setCurrentTime=function(e){return this._videoImpl.setCurrentTime(e)},M.goToLive=function(){this._videoImpl.goToLive&&this._videoImpl.goToLive()},M.isDvr=function(){return this._isDvr&&!S},M.setVolume=function(e){return this.trigger("uservolumechange"),this._videoImpl.setVolume(e)},M.setMuted=function(e){this.trigger("uservolumechange"),this._videoImpl.setMuted(e)},M.setSrc=function(e){this._videoImpl.setSrc(e)},M.getCurrentSrc=function(){return this._videoImpl.getCurrentSrc()},M.setControls=function(e){return this._videoImpl.setControls(e)},M.getMediaHeight=function(){return this._videoImpl.getMediaElement().videoHeight},M.getMediaWidth=function(){return this._videoImpl.getMediaElement().videoWidth},M.supportsPictureInPicture=function(){return this._videoImpl.supportsPictureInPicture()},M.isPictureInPicture=function(){return this._videoImpl.isPictureInPicture()},M.setPictureInPicture=function(e){return this._videoImpl.setPictureInPicture(e)},M.supportsAirPlay=function(){return this._videoImpl.supportsAirPlay()},M.isLive=function(){return this._isLive},M.refreshSize=function(){this._breakpointDetect?this._breakpointDetect.refresh():(this._currentBreakpoint&&this.el.classList.remove(this._currentBreakpoint.name),this._currentBreakpoint=L.getBreakpointFromElement(this.el,E),this.el.classList.add(this._currentBreakpoint.name)),this._videoImpl&&this._videoImpl.refreshSize()},M._setError=function(e){e?this.el.classList.add("media-error"):this.el.classList.remove("media-error")},M._onError=function(e){var t=this._videoImpl.getError();if(this._started)w("ERROR: an error occured during playback, but we'll try to recover. Error code "+(t?t.message:"unknown"));else if(this._setError(!0),this.controls){var i;if(e.message)i=e.message;else{if(!u.translationReady())return void u.getTranslation({callback:this._onError.bind(this,e),forceEnglishLabels:this.options.forceEnglishLabels});i=u.getTranslation().error}this._poster.show(),this._errorView.setText(i)}},M._onChapterChange=function(e){this.trigger("chapter:change")},M.getChapters=function(){return this._chapterEmitter.chapters},M.setChapters=function(e){this._chapterEmitter.chapters=e},M.getChapterForTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._chapterEmitter.getChapterForTime(e,t)},M.isStalled=function(){return this._videoImpl.isStalled()},M.destroy=function(){this._removeEventListeners(),this.controls&&(this.controls.destroy(),this.controls=null),this._poster&&(this._poster.destroy(),this._poster=null),this._controlsInteraction&&(this._controlsInteraction.destroy(),this._controlsInteraction=null),this._keyboardControl&&this._keyboardControl.destroy(),this.el.innerHTML="",this._breakpointDetect&&this._breakpointDetect.destroy(),this._chapterEmitter&&this._chapterEmitter.destroy(),this._blockade&&(this._blockade=null),this._videoImpl.destroy(),this._videoImpl=null,clearTimeout(this._refreshSizeTimeout),n.prototype.destroy.call(this)},x}(n);x.LOADEDMETADATA=1,x.LOADEDDATA=2,x.CANPLAY=3,x.CANPLAYTHROUGH=4,e.exports=x},2359:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(){return e.call(this)||this}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n.once=function(t,i,s){if(s){var r=function(){i.apply(s,arguments)};e.prototype.once.apply(this,[t,r])}else e.prototype.once.apply(this,arguments)},n.on=function(t,i,s){if(arguments.length>2){this._boundListeners||(this._boundListeners={}),this._boundListeners[t]||(this._boundListeners[t]=[]);var r=i.bind(s);return this._boundListeners[t].push([i,s,r]),e.prototype.on.call(this,t,r)}return e.prototype.on.apply(this,arguments)},n.off=function(t,i,s){if(arguments.length>2)try{for(var r=this._boundListeners[t],n=r.length,a=0;a<n;a++)if(r[a][0]===i&&r[a][1]===s){var o=r.splice(a,1)[0];return e.prototype.off.call(this,t,o[2])}}catch(l){}return e.prototype.off.apply(this,arguments)},n.destroy=function(){this._boundListeners=void 0,e.prototype.destroy.call(this)},r}(i(2360).EventEmitterMicro);e.exports=r},2360:function(e,t,i){"use strict";e.exports={EventEmitterMicro:i(2361)}},2361:function(e,t,i){"use strict";function s(){this._events={}}var r=s.prototype;r.on=function(e,t){this._events[e]=this._events[e]||[],this._events[e].unshift(t)},r.once=function(e,t){var i=this;this.on(e,(function s(r){i.off(e,s),void 0!==r?t(r):t()}))},r.off=function(e,t){if(this.has(e)){if(1===arguments.length)return this._events[e]=null,void delete this._events[e];var i=this._events[e].indexOf(t);-1!==i&&this._events[e].splice(i,1)}},r.trigger=function(e,t){if(this.has(e))for(var i=this._events[e].length-1;i>=0;i--)void 0!==t?this._events[e][i](t):this._events[e][i]()},r.has=function(e){return e in this._events!==!1&&0!==this._events[e].length},r.destroy=function(){for(var e in this._events)this._events[e]=null;this._events=null},e.exports=s},2362:function(e,t){var i=function(){function e(e){this._listeners={},this.el=e}var t=e.prototype;return t.on=function(e,t){this._listeners[e]||(this._listeners[e]=[]);var i={originalCb:t,args:[e,function(e){t(e)}].concat(Array.from(arguments).slice(2))};this._listeners[e].push(i),this.el.addEventListener.apply(this.el,i.args)},t.off=function(e,t){var i=this._listeners[e],s=-1;if(i.find((function(e){return s++,e.originalCb===t}))){var r=i[s];this.el.removeEventListener.apply(this.el,r.args),i.splice(s,1)}},t.replaceElement=function(e){var t=this;Object.keys(this._listeners).forEach((function(i){t._listeners[i].forEach((function(i){t.el.removeEventListener.apply(t.el,i.args),e.addEventListener.apply(e,i.args)}))})),this.el=e},t.once=function(e,t){var i=this;this.on(e,(function s(){t(),i.off(e,s)}))},t.trigger=function(e,t){var i=new CustomEvent(e,{detail:t});this.el.dispatchEvent(i)},e}();e.exports=i},2363:function(e,t,i){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var n=function(e){var t,i;function n(t){var i;return(i=e.call(this)||this)._chapters=Array.from(t.chapters||[]),i}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,r(t,i);var a,o,l=n.prototype;return l.addChapter=function(e){this._chapters.push(e),this._onChange()},l.removeChapter=function(e){for(var t=-1,i=0;i<this._chapters.length;i++)if(this._chapters[i].chapter===e){t=i;break}t>=0&&this._chapters.splice(t,1),this._onChange()},l._onChange=function(){this.trigger("change")},l.getChapterForTime=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;i<this._chapters.length;i++){var s=this._chapters[i],r=s["start-time"];if(!s.duration||isNaN(s.duration)){if(this._chapters.length>i+1){var n=this._chapters[i+1];if(e>=r-t&&e<n["start-time"]-t)return s}else if(e>=r)return s}else if(r-t<=e&&e<r+s.duration-t)return s}return null},l.clearChapters=function(){this._chapters=[],this._onChange()},a=n,(o=[{key:"chapters",get:function(){return this._chapters},set:function(e){this._chapters=e,this._onChange()}}])&&s(a.prototype,o),Object.defineProperty(a,"prototype",{writable:!1}),n}(i(2360).EventEmitterMicro);e.exports=n},2364:function(e,t,i){"use strict";var s=i(2365),r=s.browser.safari||s.browser.edge,n="MediaSource"in window&&!s.browser.edge&&!s.os.ios,a=function(){function e(){}return e.prototype.create=function(e,t){return!e.hls&&!function(e){return e.src&&-1!==e.src.indexOf(".m3u8")||e.sources&&e.sources[0]&&-1!==e.sources[0].indexOf(".m3u8")}(e)||r&&!1!==e.useNativeHls&&!e.dvr||!n?e.threesixty?new(i(2396))(Object.assign({},e,{parentElement:t})):new(i(2375))(Object.assign({},e,{parentElement:t})):new(i(2369))(Object.assign({},e,{parentElement:t}))},e}();e.exports=new a},2365:function(e,t,i){"use strict";var s={ua:window.navigator.userAgent,platform:window.navigator.platform,vendor:window.navigator.vendor};e.exports=i(2366)(s)},2366:function(e,t,i){"use strict";var s=i(2367),r=i(2368);function n(e,t){if("function"===typeof e.parseVersion)return e.parseVersion(t);var i,s=e.version||e.userAgent;"string"===typeof s&&(s=[s]);for(var r,n=s.length,a=0;a<n;a++)if((r=t.match((i=s[a],new RegExp(i+"[a-zA-Z\\s/:]+([0-9_.]+)","i"))))&&r.length>1)return r[1].replace(/_/g,".");return!1}function a(e,t,i){for(var s,r,a=e.length,o=0;o<a;o++)if("function"===typeof e[o].test?!0===e[o].test(i)&&(s=e[o].name):i.ua.indexOf(e[o].userAgent)>-1&&(s=e[o].name),s){if(t[s]=!0,"string"===typeof(r=n(e[o],i.ua))){var l=r.split(".");t.version.string=r,l&&l.length>0&&(t.version.major=parseInt(l[0]||0),t.version.minor=parseInt(l[1]||0),t.version.patch=parseInt(l[2]||0))}else"edge"===s&&(t.version.string="12.0.0",t.version.major="12",t.version.minor="0",t.version.patch="0");return"function"===typeof e[o].parseDocumentMode&&(t.version.documentMode=e[o].parseDocumentMode()),t}return t}e.exports=function(e){var t={};return t.browser=a(r.browser,s.browser,e),t.os=a(r.os,s.os,e),t}},2367:function(e,t,i){"use strict";e.exports={browser:{safari:!1,chrome:!1,firefox:!1,ie:!1,opera:!1,android:!1,edge:!1,edgeChromium:!1,samsung:!1,version:{string:"",major:0,minor:0,patch:0,documentMode:!1}},os:{osx:!1,ios:!1,android:!1,windows:!1,linux:!1,fireos:!1,chromeos:!1,version:{string:"",major:0,minor:0,patch:0}}}},2368:function(e,t,i){"use strict";e.exports={browser:[{name:"edge",userAgent:"Edge",version:["rv","Edge"],test:function(e){return e.ua.indexOf("Edge")>-1||"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"===e.ua}},{name:"edgeChromium",userAgent:"Edge",version:["rv","Edg"],test:function(e){return e.ua.indexOf("Edg")>-1&&-1===e.ua.indexOf("Edge")}},{name:"chrome",userAgent:"Chrome"},{name:"firefox",test:function(e){return e.ua.indexOf("Firefox")>-1&&-1===e.ua.indexOf("Opera")},version:"Firefox"},{name:"android",userAgent:"Android"},{name:"safari",test:function(e){return e.ua.indexOf("Safari")>-1&&e.vendor.indexOf("Apple")>-1},version:"Version"},{name:"ie",test:function(e){return e.ua.indexOf("IE")>-1||e.ua.indexOf("Trident")>-1},version:["MSIE","rv"],parseDocumentMode:function(){var e=!1;return document.documentMode&&(e=parseInt(document.documentMode,10)),e}},{name:"opera",userAgent:"Opera",version:["Version","Opera"]},{name:"samsung",userAgent:"SamsungBrowser"}],os:[{name:"windows",test:function(e){return e.ua.indexOf("Windows")>-1},version:"Windows NT"},{name:"osx",userAgent:"Mac",test:function(e){return e.ua.indexOf("Macintosh")>-1}},{name:"ios",test:function(e){return e.ua.indexOf("iPhone")>-1||e.ua.indexOf("iPad")>-1},version:["iPhone OS","CPU OS"]},{name:"linux",userAgent:"Linux",test:function(e){return(e.ua.indexOf("Linux")>-1||e.platform.indexOf("Linux")>-1)&&-1===e.ua.indexOf("Android")}},{name:"fireos",test:function(e){return e.ua.indexOf("Firefox")>-1&&e.ua.indexOf("Mobile")>-1},version:"rv"},{name:"android",userAgent:"Android",test:function(e){return e.ua.indexOf("Android")>-1}},{name:"chromeos",userAgent:"CrOS"}]}},2369:function(e,t,i){"use strict";function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=window.Hls,n=i(2370),a=i(2373),o=i(2374),l=function(e){var t,i;function l(t){var i;return(i=e.call(this,t)||this)._src=null,i._hlsUrl=t.hlsUrl||"/ac/libs/hls.js/1.530.2/hls.js",i._hlsConfig=t.hlsConfig||{},i._initialize(t),i}i=e,(t=l).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var h=l.prototype;return h._initialize=function(e){var t=this;"undefined"===typeof r&&(this._deferredQueue=[],o(this._hlsUrl).then((function(){r=window.Hls,t._initialize(e),t._deferredQueue.forEach((function(e){e()})),t._deferredQueue=null}))),this._debugHls=e.debugHls,this._enablePerformanceLogging=e.enablePerformanceLogging,this._onHlsError=this._onHlsError.bind(this),this._onDesiredRateChanged=this._onDesiredRateChanged.bind(this),this._onPlay=this._onPlay.bind(this),this.on("play",this._onPlay)},h._initHls=function(){if(this._hls){this._cachedVisibleTracks=Array.from(this.el.textTracks).filter((function(e){return"showing"===e.mode})),this._hls.off(r.Events.ERROR,this._onHlsError),this._hls.off(r.Events.DESIRED_RATE_CHANGED,this._onDesiredRateChanged),this._hls.destroy();var e=this.el.cloneNode(!1),t=this.el.muted;this.el.parentElement.replaceChild(e,this.el),this.replaceElement(e),this.el.muted=t,this.getTextTracksEventEmitter().replaceElement(this.el.textTracks)}this._hls=new r(Object.assign({debug:this._debugHls,enableWorker:!0,enableStreaming:!0,autoRecoverError:!0,enablePerformanceLogging:this._enablePerformanceLogging||!1,startPosition:-1},this._hlsConfig))},h.load=function(e,t){if(r){this._initHls(),this._hls.on(r.Events.ERROR,this._onHlsError),this._hls.on(r.Events.DESIRED_RATE_CHANGED,this._onDesiredRateChanged),this._src=e[0];var i=function(){this._mediaAttached=!0,this._hls.off(r.Events.MEDIA_ATTACHED,i),this.setSrc(e[0]),this._createTextTrackTags(t)}.bind(this);this._hls.on(r.Events.MEDIA_ATTACHED,i),this._hls.attachMedia(this.el)}else this._deferredQueue.push(this.load.bind(this,e,t))},h.setSrc=function(e){r?(this._hls||this._initHls(),this._src=e,this._manifestParsed=!1,this._hls.loadSource(e,{appData:{}}),this._hls.on(r.Events.MANIFEST_PARSED,this._boundManifestParsed=function(){this._manifestParsed=!0,this._hls.off(r.Events.MANIFEST_PARSED,this._boundManifestParsed),this._shouldPlay&&this.play()}.bind(this))):this._deferredQueue.push(this.setSrc.bind(this,e))},h.getCurrentSrc=function(){return this._src},h.canPlayType=function(t){return"vnd.apple.mpegURL"===t?e.prototype.canPlayType.call(this,"video/mp4"):e.prototype.canPlayType.call(this,t)},h._playPromiseRejected=function(){this._hls&&"undefined"!==typeof this._hls.desiredRate&&(this._hls.desiredRate=0),e.prototype._playPromiseRejected.call(this)},h._onPlay=function(){this._hls&&0===this._hls.desiredRate&&(this._hls.desiredRate=1)},h.getError=function(){return this.el.error||this._error},h.destroy=function(){this.off("play",this._onPlay),e.prototype.destroy.call(this),this._hls&&(this._hls.destroy(),this._hls=null)},h._onHlsError=function(e,t){!0===t.fatal&&("fragLoadError"===t.details?n("HLS JS threw a fatal fragLoadError error, but we'll try to let it recover because it probably can if the network/stream recovers"):(this._error=t.type,this.trigger("error",t)))},h._onDesiredRateChanged=function(e){0===this._hls.desiredRate?this.trigger("pause"):this.trigger("play")},h.play=function(){this._shouldPlay=!0,this._manifestParsed&&(this._mediaAttached||this.load([this._src]),e.prototype.play.call(this))},h.pause=function(){this._shouldPlay=!1,e.prototype.pause.call(this)},h.getPaused=function(){return this._hls&&"undefined"!==typeof this._hls.desiredRate?0===this._hls.desiredRate:e.prototype.getPaused.call(this)},h.isStalled=function(){return void 0!==this._hls.desiredRate&&1===this._hls.desiredRate&&this._hls.desiredRate!==this._hls.effectiveRate||e.prototype.isStalled.call(this)},h.goToLive=function(){this.setCurrentTime(Math.max(this._hls.liveSyncPosition,this.getDuration()-a/2))},l}(i(2375));e.exports=l},2370:function(e,t,i){"use strict";e.exports=i(2371)("log")},2371:function(e,t,i){"use strict";var s=i(2372);e.exports=function(e){return function(){if(s&&"object"===typeof window.console&&"function"===typeof console[e])return console[e].apply(console,Array.prototype.slice.call(arguments,0))}}},2372:function(e,t,i){"use strict";var s=!1,r={};"undefined"!==typeof window&&(r=window||self);try{s=!!r.localStorage.getItem("f7c9180f-5c45-47b4-8de4-428015f096c0")}catch(n){}e.exports=s},2373:function(e,t){e.exports=90},2374:function(e,t,i){"use strict";var s={};e.exports=function(e){return s[e]||(s[e]=new Promise((function(t,i){var s=document.createElement("script");s.type="text/javascript",s.src=e,s.onload=t,s.onerror=i;try{document.body.appendChild(s)}catch(r){i(r)}}))),s[e]}},2375:function(e,t,i){"use strict";function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var n=i(2362),a=i(2376),o=i(2370),l=window.document,h=i(2365).browser.safari?4:3,d=function(e){var t,i;function n(t){var i,r=t&&t.mediaElement?t.mediaElement:l.createElement("video");return(i=e.call(this,r)||this).el=r,i.options=t||{},i._textTracks=a(t),i._initElement(),i._forwardCaptionEvent=i._forwardCaptionEvent.bind(s(i)),i._onTextTrackChangeAfterLoad=i._onTextTrackChangeAfterLoad.bind(s(i)),i._textTracksEmitter=i.getTextTracksEventEmitter(),i._textTracksEmitter.on("addtrack",i._onTextTrackChangeAfterLoad),i._textTracksEmitter.on("addtrack",i._forwardCaptionEvent),i._textTracksEmitter.on("change",i._forwardCaptionEvent),i._textTracksEmitter.on("removetrack",i._forwardCaptionEvent),i}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,r(t,i);var d=n.prototype;return d._initElement=function(){this.el.classList.add("ac-video-media-controller"),null!==this.options.crossorigin&&this.el.setAttribute("crossorigin",this.options.crossorigin?this.options.crossorigin:"anonymous"),this.el.setAttribute("preload",this.options.preload||"auto"),this.el.setAttribute("x-webkit-airplay","")},d._forwardCaptionEvent=function(e){this.trigger(e.type)},d.load=function(e,t,i){i&&(e=e.map((function(e){return e+"#t="+i}))),this.el.textTracks.length&&(this._cachedVisibleTracks=Array.from(this.el.textTracks).filter((function(e){return"showing"===e.mode}))),this._createSourceTags(e),this._createTextTrackTags(t),this.el.load()},d._createSourceTags=function(e){this.el.removeAttribute("src"),this.el.innerHTML="";var t=0,i=e.length;for(i&&this.el.setAttribute("src",e[0]);t<i;t++){var s=l.createElement("source");s.src=e[t],this.el.appendChild(s)}},d._playPromiseRejected=function(){this.trigger("PlayPromiseError")},d.play=function(){try{var e=this.el.play();e&&"function"===typeof e.catch&&(e.catch(function(t){this._playPromise===e&&this._playPromiseRejected()}.bind(this)),e.then(function(){this.trigger("PlayPromiseResolved")}.bind(this),(function(e){o(e)}))),this._playPromise=e}catch(t){o(t)}},d.refreshSize=function(){},d.pause=function(){this._playPromise=null,this.el.pause()},d.addTextTrack=function(e){this._addTextTrackTag(e)},d.removeTextTrack=function(e){this._removeTextTrackTag(e)},d.getRenderElement=function(){return this.getMediaElement()},d.getMediaElement=function(){return this.el},d._createTextTrackTags=function(){return this._textTracks.create.apply(this,arguments)},d._addTextTrackTag=function(){return this._textTracks.add.apply(this,arguments)},d._removeTextTrackTag=function(){return this._textTracks.remove.apply(this,arguments)},d.getTextTracks=function(){return this._textTracks.get.apply(this,arguments)},d.getTextTracksEventEmitter=function(){return this._textTracks.getEmitter.apply(this,arguments)},d.getReadyState=function(){return this.el.readyState},d.getPreload=function(){return this.el.preload},d.setPreload=function(e){return this.el.preload=e},d.setPoster=function(e){e?this.el.poster=e:this.el.removeAttribute("poster")},d.getVolume=function(){return this.el.volume},d.getMuted=function(){return this.el.muted},d.getPaused=function(){return this.el.paused},d.getCurrentTime=function(){return this.el.currentTime},d.getDuration=function(){return this.el.duration},d.setCurrentTime=function(e){return this.el.currentTime=e},d.setVolume=function(e){return this.el.volume=e},d.setMuted=function(e){this.el.muted=e,e?this.el.setAttribute("muted",""):this.el.removeAttribute("muted")},d.getEnded=function(){return this.el.ended},d.getError=function(){return this.el.error},d.setSrc=function(e){this.el.childNodes.length&&e===this._getSrcNode().url||this._createSourceTags([e])},d.advanceLiveStream=function(){},d.getCurrentSrc=function(){return this.el.src},d._getSrcNode=function(){return this.el.childNodes[0]},d._onTextTrackChangeAfterLoad=function(){var e=this;if(this._cachedVisibleTracks){if(!this._cachedVisibleTracks.length)for(var t=0,i=Array.from(this.el.textTracks);t<i.length;t++)i[t].mode="hidden";this._cachedVisibleTracks.forEach((function(t){var i=Array.from(e.el.textTracks).find((function(e){return t.language===e.language}));i&&(i.mode="showing")}))}},d.setControls=function(e){e?(this.el.setAttribute("controls",""),this.el.removeAttribute("aria-hidden")):(this.el.removeAttribute("controls"),this.el.setAttribute("aria-hidden","true"))},d.isFullscreen=function(){return this.el.webkitDisplayingFullscreen},d.supportsPictureInPicture=function(){return"function"===typeof this.el.webkitSetPresentationMode},d.isPictureInPicture=function(){return"picture-in-picture"===this.el.webkitPresentationMode},d.setPictureInPicture=function(e){this.supportsPictureInPicture()&&this.el.webkitSetPresentationMode(e?"picture-in-picture":"inline")},d.supportsAirPlay=function(){return!!window.WebKitPlaybackTargetAvailabilityEvent},d.canPlayType=function(e){return this.el.canPlayType(e)},d.getBuffered=function(){return this.el.buffered},d.isStalled=function(){return this.getReadyState()<h},d.destroy=function(){this._playPromise=null,this._textTracksEmitter&&(this._textTracksEmitter.off("addtrack",this._forwardCaptionEvent),this._textTracksEmitter.off("addtrack",this._onTextTrackChangeAfterLoad),this._textTracksEmitter.off("change",this._forwardCaptionEvent),this._textTracksEmitter.off("removetrack",this._forwardCaptionEvent)),this._textTracks&&this._textTracks.destroy.call(this),this._textTracks=null,this._textTracksEmitter=null,this.el=null},n}(n);e.exports=d},2376:function(e,t,i){"use strict";var s=i(2365),r=!s.browser.ie&&!s.browser.edge;e.exports=function(e){var t;return t=!!(e=e||{}).hls||!e.threesixty&&("undefined"===typeof e.useNativeCaptions?r:e.useNativeCaptions),i(t?2377:2378)}},2377:function(e,t,i){"use strict";var s,r=i(2365);s=r.browser.safari?function(e,t){e.track.mode=t}:function(e,t){e.mode=t};var n=function(e){var t;if(e instanceof HTMLElement)this.el.appendChild(e);else{var i=document.createElement("track");i.src=e.src,i.kind="captions",i.srclang=e.srclang,"en"===i.srclang?i.label=e.label||"English":i.label=e.label||e.srclang&&e.srclang.toUpperCase()||"Unknown CC",r.browser.firefox?(t=this.el.textTracks.length,setTimeout(function(){this.el.appendChild(i),s(this.el.textTracks[t],e.mode||"hidden")}.bind(this),0)):r.os.android?(t=this.el.textTracks.length,this.el.appendChild(i),s(this.el.textTracks[t],e.mode||"hidden")):(this.el.appendChild(i),s(i,e.mode||"hidden"))}};e.exports={create:function(e){for(var t=0,i=e?e.length:0;t<i;t++){var s=e[t];n.call(this,s)}},add:n,get:function(){return this.el.textTracks},getEmitter:function(){if(!this._textTracksEmitter){var e=i(2362);this._textTracksEmitter=new e(this.getTextTracks())}return this._textTracksEmitter},destroy:function(){}}},2378:function(e,t,i){"use strict";var s=i(2379);e.exports={create:function(e){if(e)if(this._textTracksPolyfill){this._textTracksPolyfill.clearTracks();for(var t=0,i=e.length;t<i;t++)this._textTracksPolyfill.addTrack(e[t])}else this._textTracksPolyfill=new s({video:this,tracks:e,container:this._parentElement})},add:function(e){return this._textTracksPolyfill.addTrack(e)},get:function(){return this._textTracksPolyfill||this._createTextTrackTags([]),this._textTracksPolyfill.getTextTracks()},getEmitter:function(){return this._textTracksPolyfill||this._createTextTrackTags([]),this._textTracksPolyfill},destroy:function(){this._textTracksPolyfill.destroy(),this._textTracksPolyfill=null}}},2379:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2380),n=i(2383),a=i(2395),o=i(2360).EventEmitterMicro,l={textTracksPolyfill:{className:"ac-video-player-text-track",view:{classDef:a,options:{}},behavior:{classDef:n}}},h=function(e){var t,i;function n(t){var i;return(i=e.call(this,t)||this).container=t.container,i._video=t.video,i._initialize(t),i}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var a=n.prototype;return a._initialize=function(e){this._onTrackChange=this._onTrackChange.bind(this),this.el=document.createElement("div"),this.el.innerHTML=e.template||'<div class="ac-video-player-text-track"></div>',this.el.classList.add("ac-video-player-text-track-container"),this._tracks=e.tracks||[],this._textTrackComponent=r(this.el,l,{video:this._video})},a._onTrackChange=function(){this.trigger("change"),this.el.parentElement||(this._video.getRenderElement().parentElement.appendChild(this.el),this.el.firstElementChild.classList.add("is-visible"))},a.addTrack=function(e){this._tracks||(this._tracks=[]);var t=e.mode||"hidden",i=this._onTrackChange;Object.defineProperty(e,"mode",{get:function(){return t},set:function(e){t=e,i()},enumerable:!0,configurable:!0}),this._tracks.push(e),this.trigger("addtrack")},a.clearTracks=function(){this._tracks=[],this.trigger("removetrack"),this.trigger("change")},a.getTextTracks=function(){return this._tracks},a.trigger=function(t,i){return e.prototype.trigger.call(this,t,Object.assign({type:t},i||{}))},a.destroy=function(){this._textTrackComponent.destroy(),e.prototype.destroy.call(this)},n}(o);e.exports=h},2380:function(e,t,i){"use strict";var s=i(2381),r=i(2382),n=function(e,t){"function"===typeof t.destroy&&t.destroy(),"function"===typeof e.destroy&&e.destroy()},a=function(e){for(;e.length;)e.shift().destroy()},o=function(e){for(var t in e)e.hasOwnProperty(t)&&(a(e[t]),delete e[t])},l=function(e,t,i){var a=s(e,t.view),o=r(a,t.behavior,i);return{view:a,behavior:o,destroy:n.bind(null,a,o)}};e.exports=function(e,t,i){var s={};for(var r in t)if(t.hasOwnProperty(r)&&"object"===typeof t[r]){var n=t[r],a=t.elementClassPrefix?"."+t.elementClassPrefix+"-"+n.className:"."+n.className,h=e.querySelectorAll(a);s[r]=[];for(var d=0,c=h.length;d<c;d++)s[r].push(l(h[d],n,i))}return{components:s,destroy:o.bind(null,s)}}},2381:function(e,t,i){"use strict";e.exports=function(e,t){return new t.classDef(e,t.options)}},2382:function(e,t,i){"use strict";var s=function(e,t,i){return function(s){e[t](s,i)}};e.exports=function(e,t,i){return t.classDef?function(e,t,i){return new t.classDef(e,Object.assign(t.options||{},i||{}))}(e,t,i):function(e,t){var i=t.handlers||{},r={};for(var n in i)i.hasOwnProperty(n)&&e.on(n,r[n]=s(i,n,e));var a,o=t.observe;if(o){for(var l=o.update,h=o.source,d=h.on.bind(h)||h.addEventListener,c=h.off.bind(h)||h.removeEventListener,u=o.events,f=0,p=u.length,g=function(){l.call(o,e)};f<p;f++)d(n=u[f],g);a=function(){for(f=0;f<p;f++)n=u[f],c(n,g)}}return{destroy:function(){for(var t in r)r.hasOwnProperty(t)&&e.off(t,r[t]);a&&a()}}}(e,t)}},2383:function(e,t,i){var s=i(2384),r=i(2391),n=i(2392),a=function(){function e(e,t){this._view=e,this._video=t.video,this._refreshTracks=this._refreshTracks.bind(this),this._throttledRefreshCurrentCaption=r(this._refreshCurrentCaption.bind(this,300)),this._addTrackListeners()}var t=e.prototype;return t._addTrackListeners=function(){this._video.on("addtrack",this._refreshTracks),this._video.on("removetrack",this._refreshTracks),this._video.on("change",this._refreshTracks)},t._addVideoListeners=function(e){if(!e.cues){this._view.setText("");try{s.get(e.src,{complete:function(t){e.cues=n(t.responseText),this._addVideoListeners(e),this._refreshCurrentCaption()}.bind(this),error:function(e){}.bind(this)})}catch(t){}}this._video.on("loadstart",this._refreshTracks),this._video.on("timeupdate",this._throttledRefreshCurrentCaption)},t._removeVideoListeners=function(){this._video.off("loadstart",this._refreshTracks),this._video.off("timeupdate",this._throttledRefreshCurrentCaption)},t._refreshTracks=function(){var e=this._video.getTextTracks();e&&e.length&&(e=e.filter((function(e){return"showing"===e.mode}))),e.length?(this._activeTrack=e[0],this._addVideoListeners(this._activeTrack)):(this._activeTrack=null,this._removeVideoListeners()),this._refreshCurrentCaption()},t._getCurrentCaptionText=function(e){var t=this._activeTrack?this._activeTrack.cues:null;if(!t)return"";if(this._currentCaption&&this._currentCaption.startTime>=e&&this._currentCaption<=e)return this._currentCaption.text;for(var i,s=0,r=t.length;s<r;){if(t[s].startTime<=e&&t[s].endTime>=e)i=t[s];else if(t[s].startTime>=e)break;s++}return this._currentCaption=i,i?i.text:""},t._refreshCurrentCaption=function(){this._view.setText(this._getCurrentCaptionText(this._video.getCurrentTime()))},t.destroy=function(){this._removeVideoListeners()},e}();e.exports=a},2384:function(e,t,i){"use strict";var s=i(2385),r={complete:function(e,t){},error:function(e,t){},method:"GET",headers:{},success:function(e,t,i){},timeout:5e3},n={ajax:function(e,t){t=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},r,t),"//"===e.substr(0,2)&&(e=window.location.protocol+e);var i=s(e);return i.open(t.method,e),i.setTransportHeaders(t.headers),i.setReadyStateChangeHandlers(t.complete,t.error,t.success),i.setTimeout(t.timeout,t.error,t.complete),i.send(t.data),i},get:function(e,t){return t.method="GET",n.ajax(e,t)},head:function(e,t){return t.method="HEAD",n.ajax(e,t)},post:function(e,t){return t.method="POST",n.ajax(e,t)}};e.exports=n},2385:function(e,t,i){"use strict";var s=i(2386),r=i(2388),n=/.*(?=:\/\/)/,a=/^.*:\/\/|\/.+$/g,o=window.XDomainRequest&&document.documentMode<10;e.exports=function(e,t){return new(o&&function(e){return!!e.match(n)&&e.replace(a,"")!==window.location.hostname}(e)?r:s)}},2386:function(e,t,i){"use strict";var s=i(2387),r=function(){this.xhr=new XMLHttpRequest};(r.prototype=s.create()).setReadyStateChangeHandlers=function(e,t,i){this.xhr.onreadystatechange=function(s){4===this.xhr.readyState&&(clearTimeout(this.timeout),this.xhr.status>=200&&this.xhr.status<300?(i(this.xhr.responseText,this.xhr.status,this.xhr),e(this.xhr,this.status)):(t(this.xhr,this.status),e(this.xhr,this.status)))}.bind(this)},e.exports=r},2387:function(e,t,i){"use strict";var s=function(){};s.create=function(){var e=function(){};return e.prototype=s.prototype,new e},s.prototype.open=function(e,t){e=e.toUpperCase(),this.xhr.open(e,t)},s.prototype.send=function(e){this.xhr.send(e)},s.prototype.setTimeout=function(e,t,i){this.xhr.ontimeout=function(){t(this.xhr,this.status),i(this.xhr,this.status)}.bind(this)},s.prototype.setTransportHeaders=function(e){for(var t in e)this.xhr.setRequestHeader(t,e[t])},e.exports=s},2388:function(e,t,i){"use strict";var s=i(2387),r=i(2389),n=function(){this.xhr=new XDomainRequest};(n.prototype=s.create()).setReadyStateChangeHandlers=function(e,t,i){this.xhr.onerror=function(){t(this.xhr,this.status),e(this.xhr,this.status)}.bind(this),this.xhr.onload=function(){i(this.xhr.responseText,this.xhr.status,this.xhr),e(this.xhr,this.status)}.bind(this)},n.prototype.send=function(e){e&&"object"===typeof e&&(e=r(e)),this.xhr.send(e)},n.prototype.setTransportHeaders=function(e){},e.exports=n},2389:function(e,t,i){"use strict";var s=i(2390);e.exports=function(e){if("object"!==typeof e)throw new TypeError("toQueryParameters error: argument is not an object");return s(e,!1)}},2390:function(e,t,i){"use strict";e.exports=function(e,t){var i="";if(e){var s=Object.keys(e),r=s.length-1;s.forEach((function(t,s){var n=e[t],a=(t=t.trim())+(n=null===(n=n&&"string"===typeof n?n.trim():n)?"":"="+n)+(s===r?"":"&");i=i?i.concat(a):a}))}return i&&!1!==t?"?"+i:i}},2391:function(e,t,i){"use strict";e.exports=function(e,t){var i=null;return function(){null===i&&(e.apply(this,arguments),i=setTimeout((function(){i=null}),t))}}},2392:function(e,t,i){"use strict";var s=i(2393);e.exports=function(e){for(var t,i,r=e.split(/\n/),n=/([\d]{2}:)?[\d]{2}:[\d]{2}.[\d]{3}( --> ){1}([\d]{2}:)?[\d]{2}:[\d]{2}.[\d]{3}/,a=[],o=0,l=r.length;o<l;o++)if(i="",n.test(r[o])){for((t=r[o].split(" --\x3e "))[0]=t[0].split(":").length<3?"00:"+t[0]:t[0],t[1]=t[1].split(":").length<3?"00:"+t[1]:t[1];++o&&o<l&&!n.test(r[o]);)""!==r[o]&&(i+=r[o]+"<br />");i=i.substr(0,i.length-6),o<l&&o--,a.push({startTime:s.stringToNumber(t[0].split(" ")[0]),endTime:s.stringToNumber(t[1].split(" ")[0]),text:i})}return a}},2393:function(e,t,i){"use strict";var s=i(2394),r={addLeadingZero:function(e,t){if(t=t||2,e<10||t>2)for(e=String(e);e.length<t;)e="0"+e;return e},formatTime:function(e,t,i){return isNaN(e)?"00:00":(e=this.splitTime(Math.floor(e),t,function(e){return this.addLeadingZero(e,i)}.bind(this)),s(t>=3600?"{PN}{hours}:{minutes}:{seconds}":"{PN}{minutes}:{seconds}",{PN:e.negativeModifier,hours:e.hours,minutes:e.minutes,seconds:e.seconds}))},splitTime:function(e,t,i){i=i||function(e){return e};var s={negativeModifier:"",hours:0,minutes:0,seconds:0};if(isNaN(e))return s;for(var r in s.negativeModifier=e<0?"-":"",e=Math.abs(e),s.hours=t>=3600?Math.floor(e/3600):0,s.minutes=s.hours?Math.floor(e/60%60):Math.floor(e/60),s.seconds=e%60,s)"number"===typeof s[r]&&"hours"!==r&&(s[r]=i(s[r]));return s},stringToNumber:function(e){for(var t=0,i=e.split(":");i.length;)3===i.length?t+=3600*parseFloat(i.shift()):2===i.length?t+=60*parseFloat(i.shift()):t+=parseFloat(i.shift());return t}};e.exports=r},2394:function(e,t,i){"use strict";e.exports=function(e,t,i){return t?(i=i||/{([^{}]*)}/g,e.replace(i,(function(e,i){var s=t[i];return"string"===typeof s||"number"===typeof s||"boolean"===typeof s?s:e}))):e}},2395:function(e,t){var i=function(){function e(e){this.el=e}return e.prototype.setText=function(e){this.el.innerHTML=e},e}();e.exports=i},2396:function(e,t,i){"use strict";function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var n=i(2375),a=i(2397),o=function(e){var t,i;function n(t){var i;return(i=e.call(this,t)||this)._renderElement=document.createElement("div"),i._renderElement.classList.add("threesixty-video-container"),i.el.style.visibility="hidden",i.el.style.opacity=0,i._renderElement.appendChild(i.el),i._ac360=new a({el:i._renderElement,src:i.getMediaElement()}),i._ac360.on("error",function(){this._error="360_ERROR",this.trigger("error")}.bind(s(i))),i.sendMouseDown=i.sendMouseDown.bind(s(i)),i}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,r(t,i);var o=n.prototype;return o.load=function(){this._ac360.setPos(0,0),e.prototype.load.apply(this,arguments)},o.play=function(){this.getEnded()&&this._ac360.setPos(0,0),e.prototype.play.call(this)},o.sendMouseDown=function(e){this._ac360.sendMouseDown(e)},o.getRenderElement=function(){return this._renderElement},o.get360=function(){return this._ac360},o.setControls=function(t){e.prototype.setControls.call(this,!1)},o.supportsPictureInPicture=function(){return!1},o.supportsAirPlay=function(){return!1},o.refreshSize=function(){this._ac360.refreshSize()},o.getError=function(){return this._error||e.prototype.getError.call(this)},n}(n);e.exports=o},2397:function(e,t){},2398:function(e,t,i){"use strict";e.exports=i(2399)},2399:function(e,t,i){"use strict";i(2360).EventEmitterMicro;var s=i(2400).create();function r(){throw new Error("Error: Element missing. ac-fullscreen requires an element to be specified")}var n={requestFullscreen:function(e){return e||r(),s.requestFullscreen(e)},fullscreenEnabled:function(e){return e||r(),s.fullscreenEnabled(e)},fullscreenElement:function(){return s.fullscreenElement()},exitFullscreen:function(e){return e||r(),s.exitFullscreen(e)},getMode:function(){return s.mode},on:function(){return s.on.apply(s,arguments)},off:function(){return s.off.apply(s,arguments)},once:function(){return s.once.apply(s,arguments)}};e.exports=n},2400:function(e,t,i){"use strict";var s=i(2401),r=i(2412);e.exports={create:function(){var e=r;return"webkitEnterFullscreen"in document.createElement("video")&&!("webkitRequestFullScreen"in document.createElement("div"))&&(e=s),e}}},2401:function(e,t,i){"use strict";var s,r=i(2402),n=i(2360).EventEmitterMicro,a=i(2410),o=i(2411);r(document,"webkitbeginfullscreen",(function(e){l.trigger(a.ENTERFULLSCREEN,e)}),!0),r(document,"webkitendfullscreen",(function(e){s=void 0,l.trigger(a.EXITFULLSCREEN,e)}),!0);var l=new n;l.fullscreenEnabled=function(e){return!!e.webkitSupportsFullscreen},l.fullscreenElement=function(){return s},l.exitFullscreen=function(e){e&&"function"===typeof e.webkitExitFullscreen&&e.webkitExitFullscreen()},l.requestFullscreen=function(e){"function"===typeof e.webkitEnterFullscreen&&e.webkitEnterFullscreen()},l.mode=o.IOS,e.exports=l},2402:function(e,t,i){"use strict";var s=i(2403),r=i(2404);e.exports=function(e,t,i,n){return t=r(e,t),s(e,t,i,n)}},2403:function(e,t,i){"use strict";e.exports=function(e,t,i,s){return e.addEventListener?e.addEventListener(t,i,!!s):e.attachEvent("on"+t,i),e}},2404:function(e,t,i){"use strict";var s=i(2405);e.exports=function(e,t){var i;return i="tagName"in e?e.tagName:e===window?"window":"document",s(t,i)||t}},2405:function(e,t,i){"use strict";var s=i(2406),r=i(2407),n=i(2408),a=i(2409),o={};e.exports=function e(t,i){var l,h,d;if(i=i||"div",t=t.toLowerCase(),i in o||(o[i]={}),t in(h=o[i]))return h[t];if(s(t,i))return h[t]=t;if(t in r)for(d=0;d<r[t].length;d++)if(l=r[t][d],s(l.toLowerCase(),i))return h[t]=l;for(d=0;d<a.evt.length;d++)if(l=a.evt[d]+t,s(l,i))return a.reduce(d),h[t]=l;return"window"!==i&&n.indexOf(t)?h[t]=e(t,"window"):h[t]=!1}},2406:function(e,t,i){"use strict";var s={window:window,document:document};e.exports=function(e,t){var i;return e="on"+e,t in s||(s[t]=document.createElement(t)),e in(i=s[t])||"setAttribute"in i&&(i.setAttribute(e,"return;"),"function"===typeof i[e])}},2407:function(e,t,i){"use strict";e.exports={transitionend:["webkitTransitionEnd","MSTransitionEnd"],animationstart:["webkitAnimationStart","MSAnimationStart"],animationend:["webkitAnimationEnd","MSAnimationEnd"],animationiteration:["webkitAnimationIteration","MSAnimationIteration"],fullscreenchange:["MSFullscreenChange"],fullscreenerror:["MSFullscreenError"]}},2408:function(e,t,i){"use strict";e.exports=["transitionend","animationstart","animationend","animationiteration"]},2409:function(e,t,i){"use strict";var s=["-webkit-","-moz-","-ms-"],r=["Webkit","Moz","ms"],n=["webkit","moz","ms"],a=function(){this.initialize()},o=a.prototype;o.initialize=function(){this.reduced=!1,this.css=s,this.dom=r,this.evt=n},o.reduce=function(e){this.reduced||(this.reduced=!0,this.css=[this.css[e]],this.dom=[this.dom[e]],this.evt=[this.evt[e]])},e.exports=new a},2410:function(e,t){e.exports={ENTERFULLSCREEN:"enterfullscreen",EXITFULLSCREEN:"exitfullscreen"}},2411:function(e,t){e.exports={STANDARD:"standard",IOS:"ios"}},2412:function(e,t,i){"use strict";var s=i(2402),r=i(2360).EventEmitterMicro,n=i(2410),a=i(2411),o=new r;s(document,"fullscreenchange",(function(e){o.fullscreenElement()?function(e){o.trigger(n.ENTERFULLSCREEN,e)}(e):function(e){o.trigger(n.EXITFULLSCREEN,e)}(e)})),o.fullscreenEnabled=function(e){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)},o.fullscreenElement=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement},o.exitFullscreen=function(e){var t;e&&"function"===typeof e.webkitExitFullscreen?e.webkitExitFullscreen():"function"===typeof document.exitFullscreen?t="exitFullscreen":"function"===typeof document.webkitExitFullscreen?t="webkitExitFullscreen":"function"===typeof document.webkitCancelFullScreen?t="webkitCancelFullScreen":"function"===typeof document.mozCancelFullScreen?t="mozCancelFullScreen":"function"===typeof document.msExitFullscreen&&(t="msExitFullscreen"),"function"===typeof document[t]&&document[t].call(document)},o.requestFullscreen=function(e){var t;"function"===typeof e.requestFullscreen?t="requestFullscreen":"function"===typeof e.webkitRequestFullscreen?t="webkitRequestFullscreen":"function"===typeof e.webkitRequestFullScreen?t="webkitRequestFullScreen":"function"===typeof e.mozRequestFullScreen?t="mozRequestFullScreen":"function"===typeof e.msRequestFullscreen&&(t="msRequestFullscreen"),"function"===typeof e[t]&&e[t].call(e)},o.mode=a.STANDARD,e.exports=o},2413:function(e,t,i){var s=i(2414);e.exports=function(e){if(e.src=e.src||(e.is2x?"/ac/ac-video-posterframe/4.0/images/ac_video_poster_960x540_2x.jpg":"/ac/ac-video-posterframe/4.0/images/ac_video_poster_960x540.jpg"),e.useNativePoster){e.video.setPoster(e.src);var t,i=!1;return{show:function(){i=!0,t&&(e.video.setPoster(t),t=null)},hide:function(){i=!1},setSrc:function(s){i?s?e.video.setPoster(s):e.video.setPoster(e.src):t=s}}}return new s(e)}},2414:function(e,t){var i=function(){function e(e){this.options=e,this._defaultSrc=e.src,this._initialize()}var t=e.prototype;return t._initialize=function(){var e=this.options.src;this.el=this.options.el||document.createElement("div"),this._imgElement=document.createElement("img"),this._imgElement.src=e,this._currentSrc=e,this._imgElement.alt="",this._onLoad=this._onLoad.bind(this),this._imgElement.addEventListener("load",this._onLoad),this.el.appendChild(this._imgElement),this.hide(),this.el.classList.add("ac-video-poster")},t.hide=function(){this.el.classList.add("ac-video-poster-hide")},t.show=function(){this.el.classList.remove("ac-video-poster-hide")},t.setSrc=function(e){var t=e||this._defaultSrc;t!==this._currentSrc&&(this._imgElement.style.display="none",this._imgElement.src=t,this._currentSrc=t)},t._onLoad=function(){this._imgElement.style.display=""},t.getSrc=function(){return this._imgElement.src},t.destroy=function(){this._imgElement.removeEventListener("load",this._onLoad),this._el=null},e}();e.exports=i},2415:function(e,t,i){"use strict";var s,r=i(2416),n=i(2417),a=window.document.documentElement;try{s=window.top.document.documentElement}catch(c){s=a}var o=i(2384),l={},h=function(e){var t,i;try{t=e||s.getAttribute("lang")}catch(r){t=a.getAttribute("lang")}if(t)switch(t.toLowerCase()){case"es-418":i="es-LA";break;case"pt":i="pt-BR";break;default:i=t}else i="en-US";return i},d=function(e){return e=h(e),void 0!==l[e]};e.exports={getLanguage:h,getTranslation:function(e){var t=h((e=e||{}).lang);if(d(t))return e.callback?(e.callback(l[t]),null):l[t];if(!e.callback)throw new Error("To use Localization.getTranslation you must either pass a callback or ensure the translation is ready via Localization.translationReady");var i=e.basePath||"/global/ac_media_player/scripts/ac_media_languages/",s=r[t]?i+r[t]:i+r["en-US"],a=n,c=function(){l[t]=a,e.callback(a)};return e.forceEnglishLabels?(c(),l[t]):(o.get(s,{success:function(i){try{a=Object.assign(a,JSON.parse(i)),l[t]=a,e.callback(a)}catch(s){c()}},error:c}),null)},translationReady:d}},2416:function(e,t,i){"use strict";e.exports={"bg-BG":"bg-BG.json","cs-CZ":"cs-CZ.json","el-GR":"el-GR.json","de-AT":"de-AT.json","de-CH":"de-CH.json","de-DE":"de-DE.json","de-LI":"de-LI.json","da-DK":"da-DK.json",en:"en.json","en-US":"en-US.json","en-AP":"en-AP.json","en-CA":"en-CA.json","en-GB":"en-GB.json","en-HK":"en-HK.json","en-IE":"en-IE.json","en-IN":"en-IN.json","en-KR":"en-KR.json","en-AU":"en-AU.json","en-NZ":"en-NZ.json","en-SG":"en-SG.json","en-ZA":"en-ZA.json",es:"es.json","es-LA":"es-LA.json","es-MX":"es-MX.json","es-ES":"es-ES.json","et-EE":"et-EE.json","fi-FI":"fi-FI.json",fr:"fr.json","fr-BE":"fr-BE.json","fr-CA":"fr-CA.json","fr-CH":"fr-CH.json","fr-FR":"fr-FR.json","hr-HR":"hr-HR.json","hu-HU":"hu-HU.json","it-IT":"it-IT.json",ja:"ja.json","ja-JP":"ja-JP.json","ko-KR":"ko-KR.json","lt-LT":"lt-LT.json","lv-LV":"lv-LV.json","nl-BE":"nl-BE.json","nl-NL":"nl-NL.json","no-NO":"no-NO.json","pl-PL":"pl-PL.json",pt:"pt.json","pt-BR":"pt-BR.json","pt-PT":"pt-PT.json","ro-RO":"ro-RO.json","ru-RU":"ru-RU.json","sk-SK":"sk-SK.json","sv-SE":"sv-SE.json","tr-TR":"tr-TR.json",zh:"zh.json","zh-CN":"zh-CN.json","zh-HK":"zh-HK.json","zh-TW":"zh-TW.json"}},2417:function(e,t,i){"use strict";e.exports={backthirtyseconds:"Back 30 Seconds",playpause:"Play/Pause",play:"Play",pause:"Pause",togglemutevolume:"Toggle Mute Volume",mutevolume:"Mute Volume",minvolume:"Minimum Volume",adjustvolume:"Adjust Volume",fastreverse:"Fast Reverse",fastforward:"Fast Forward",fullvolume:"Full Volume",fullscreen:"Full Screen",exitfullscreen:"Exit Full Screen",airplay:"AirPlay",captionscontrol:"Closed Captions",captionsturnedon:"Closed Captions On",captionsturnedoff:"Closed Captions Off",subtitlescontrol:"Subtitles",subtitlesturnedon:"Subtitles On",subtitlesturnedoff:"Subtitles Off",sizescontrol:"Video Size",downloadcontrol:"Download Video",share:"Share",small:"Small",medium:"Medium",large:"Large",hd:"HD",ipod:"iPod/iPhone",mb:"MB",gb:"GB",tb:"TB",downloadquicktimetitle:"Get QuickTime.",downloadquicktimetext:"Download QuickTime to view this video. QuickTime is free for Mac + PC.",downloadquicktimebutton:"Download",downloadquicktimeurl:"http://www.apple.com/quicktime/download/",elapsed:"elapsed",remaining:"remaining",currenttimetext:"{minutes} minutes and {seconds} seconds",pictureinpicture:"Picture-in-Picture",exitpictureinpicture:"Exit Picture-in-Picture",closesharing:"Close Sharing",facebookshare:"Share to Facebook",twittershare:"Share to Twitter",copylink:"Copy Link",copyembed:"Copy Embed Code",copyarea:"Copy Link Text Area",selectlink:"Select Link Text",selectembed:"Select Embed Code",close:"Close",dismisscopy:"Dismiss Copy",replay:"Replay",live:"Live",livestream:"Live Streaming",newwindow:"Opens in New Window",threesixtyicon:"Return 360 Point of View to Origin",threesixtyleft:"Move 360 Point of View Left",threesixtyright:"Move 360 Point of View Right",threesixtyup:"Move 360 Point of View Up",threesixtydown:"Move 360 Point of View Down",error:"The video could not be played.",jumptochapter:"Jump to chapter",chapter:"{chaptertitle} Chapter {chaptertime}",minutesandseconds:"{minutes} minutes and {seconds} seconds",loading:"The video is loading",captionsoff:"Off"}},2418:function(e,t){var i=function(){function e(e){this.el=document.createElement("div"),this.el.classList.add("error-state-wrapper")}var t=e.prototype;return t.setText=function(e){this._errorStr=e,this.render(),this._container=this.el.firstElementChild},t.focus=function(){this._container&&this._container.firstElementChild.focus()},t.render=function(){this.el.innerHTML='<div class="error-state-container" >\n\t\t\t<div tabindex="-1" role="text" class="error-state-message">'+this._errorStr+"</div>\n\t\t</div>\n\t\t"},e}();e.exports=i},2419:function(e,t,i){"use strict";var s=i(2420);e.exports=s.requestAnimationFrame("update")},2420:function(e,t,i){"use strict";var s=i(2421),r=function(){this.events={}},n=r.prototype;n.requestAnimationFrame=function(e){return this.events[e]||(this.events[e]=new s(e)),this.events[e].requestAnimationFrame},n.cancelAnimationFrame=function(e){return this.events[e]||(this.events[e]=new s(e)),this.events[e].cancelAnimationFrame},e.exports=new r},2421:function(e,t,i){"use strict";var s=i(2422),r=function(e){this.rafEmitter=new s,this.rafEmitter.on(e,this._onRAFExecuted.bind(this)),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.cancelAnimationFrame=this.cancelAnimationFrame.bind(this),this._frameCallbacks=[],this._nextFrameCallbacks=[],this._currentFrameID=-1,this._cancelFrameIdx=-1,this._frameCallbackLength=0,this._nextFrameCallbacksLength=0,this._frameCallbackIteration=0},n=r.prototype;n.requestAnimationFrame=function(e){return this._currentFrameID=this.rafEmitter.run(),this._nextFrameCallbacks.push(this._currentFrameID,e),this._nextFrameCallbacksLength+=2,this._currentFrameID},n.cancelAnimationFrame=function(e){this._cancelFrameIdx=this._nextFrameCallbacks.indexOf(e),-1!==this._cancelFrameIdx&&(this._nextFrameCallbacks.splice(this._cancelFrameIdx,2),this._nextFrameCallbacksLength-=2,0===this._nextFrameCallbacksLength&&this.rafEmitter.cancel())},n._onRAFExecuted=function(e){for(this._frameCallbacks=this._nextFrameCallbacks,this._frameCallbackLength=this._nextFrameCallbacksLength,this._nextFrameCallbacks=[],this._nextFrameCallbacksLength=0,this._frameCallbackIteration=0;this._frameCallbackIteration<this._frameCallbackLength;this._frameCallbackIteration+=2)this._frameCallbacks[this._frameCallbackIteration+1](e.time,e)},e.exports=r},2422:function(e,t,i){"use strict";var s=i(2423),r=function(e){s.call(this,e)};(r.prototype=Object.create(s.prototype))._subscribe=function(){return this.executor.subscribe(this,!0)},e.exports=r},2423:function(e,t,i){"use strict";var s,r=i(2360).EventEmitterMicro,n=i(2424),a=i(2430);function o(e){e=e||{},r.call(this),this.id=a.getNewID(),this.executor=e.executor||n,this._reset(),this._willRun=!1,this._didDestroy=!1}(s=o.prototype=Object.create(r.prototype)).run=function(){return this._willRun||(this._willRun=!0),this._subscribe()},s.cancel=function(){this._unsubscribe(),this._willRun&&(this._willRun=!1),this._reset()},s.destroy=function(){var e=this.willRun();return this.cancel(),this.executor=null,r.prototype.destroy.call(this),this._didDestroy=!0,e},s.willRun=function(){return this._willRun},s.isRunning=function(){return this._isRunning},s._subscribe=function(){return this.executor.subscribe(this)},s._unsubscribe=function(){return this.executor.unsubscribe(this)},s._onAnimationFrameStart=function(e){this._isRunning=!0,this._willRun=!1,this._didEmitFrameData||(this._didEmitFrameData=!0,this.trigger("start",e))},s._onAnimationFrameEnd=function(e){this._willRun||(this.trigger("stop",e),this._reset())},s._reset=function(){this._didEmitFrameData=!1,this._isRunning=!1},e.exports=o},2424:function(e,t,i){"use strict";var s=i(2425).SharedInstance,r=i(2427);e.exports=s.share("ac-raf-executor:sharedRAFExecutorInstance","2.0.1",r)},2425:function(e,t,i){"use strict";e.exports={SharedInstance:i(2426)}},2426:function(e,t,i){"use strict";var s="undefined"!==typeof window?window:{},r=s.AC,n=function(){var e={};return{get:function(t,i){var s=null;return e[t]&&e[t][i]&&(s=e[t][i]),s},set:function(t,i,s){return e[t]||(e[t]={}),e[t][i]="function"===typeof s?new s:s,e[t][i]},share:function(e,t,i){var s=this.get(e,t);return s||(s=this.set(e,t,i)),s},remove:function(t,i){var s=typeof i;if("string"!==s&&"number"!==s)e[t]&&(e[t]=null);else{if(!e[t]||!e[t][i])return;e[t][i]=null}}}}();r||(r=s.AC={}),r.SharedInstance||(r.SharedInstance=n),e.exports=r.SharedInstance},2427:function(e,t,i){"use strict";var s;function r(e){e=e||{},this._reset(),this._willRun=!1,this._totalSubscribeCount=-1,this._requestAnimationFrame=window.requestAnimationFrame,this._cancelAnimationFrame=window.cancelAnimationFrame,this._boundOnAnimationFrame=this._onAnimationFrame.bind(this),this._boundOnExternalAnimationFrame=this._onExternalAnimationFrame.bind(this)}i(2428),(s=r.prototype).subscribe=function(e,t){return this._totalSubscribeCount++,this._nextFrameSubscribers[e.id]||(t?this._nextFrameSubscribersOrder.unshift(e.id):this._nextFrameSubscribersOrder.push(e.id),this._nextFrameSubscribers[e.id]=e,this._nextFrameSubscriberArrayLength++,this._nextFrameSubscriberCount++,this._run()),this._totalSubscribeCount},s.unsubscribe=function(e){return!!this._nextFrameSubscribers[e.id]&&(this._nextFrameSubscribers[e.id]=null,this._nextFrameSubscriberCount--,0===this._nextFrameSubscriberCount&&this._cancel(),!0)},s.trigger=function(e,t){var i;for(i=0;i<this._subscriberArrayLength;i++)null!==this._subscribers[this._subscribersOrder[i]]&&!1===this._subscribers[this._subscribersOrder[i]]._didDestroy&&this._subscribers[this._subscribersOrder[i]].trigger(e,t)},s.destroy=function(){var e=this._cancel();return this._subscribers=null,this._subscribersOrder=null,this._nextFrameSubscribers=null,this._nextFrameSubscribersOrder=null,this._rafData=null,this._boundOnAnimationFrame=null,this._onExternalAnimationFrame=null,e},s.useExternalAnimationFrame=function(e){if("boolean"===typeof e){var t=this._isUsingExternalAnimationFrame;return e&&this._animationFrame&&(this._cancelAnimationFrame.call(window,this._animationFrame),this._animationFrame=null),!this._willRun||e||this._animationFrame||(this._animationFrame=this._requestAnimationFrame.call(window,this._boundOnAnimationFrame)),this._isUsingExternalAnimationFrame=e,e?this._boundOnExternalAnimationFrame:t||!1}},s._run=function(){if(!this._willRun)return this._willRun=!0,0===this.lastFrameTime&&(this.lastFrameTime=performance.now()),this._animationFrameActive=!0,this._isUsingExternalAnimationFrame||(this._animationFrame=this._requestAnimationFrame.call(window,this._boundOnAnimationFrame)),!0},s._cancel=function(){var e=!1;return this._animationFrameActive&&(this._animationFrame&&(this._cancelAnimationFrame.call(window,this._animationFrame),this._animationFrame=null),this._animationFrameActive=!1,this._willRun=!1,e=!0),this._isRunning||this._reset(),e},s._onSubscribersAnimationFrameStart=function(e){var t;for(t=0;t<this._subscriberArrayLength;t++)null!==this._subscribers[this._subscribersOrder[t]]&&!1===this._subscribers[this._subscribersOrder[t]]._didDestroy&&this._subscribers[this._subscribersOrder[t]]._onAnimationFrameStart(e)},s._onSubscribersAnimationFrameEnd=function(e){var t;for(t=0;t<this._subscriberArrayLength;t++)null!==this._subscribers[this._subscribersOrder[t]]&&!1===this._subscribers[this._subscribersOrder[t]]._didDestroy&&this._subscribers[this._subscribersOrder[t]]._onAnimationFrameEnd(e)},s._onAnimationFrame=function(e){this._subscribers=this._nextFrameSubscribers,this._subscribersOrder=this._nextFrameSubscribersOrder,this._subscriberArrayLength=this._nextFrameSubscriberArrayLength,this._subscriberCount=this._nextFrameSubscriberCount,this._nextFrameSubscribers={},this._nextFrameSubscribersOrder=[],this._nextFrameSubscriberArrayLength=0,this._nextFrameSubscriberCount=0,this._isRunning=!0,this._willRun=!1,this._didRequestNextRAF=!1,this._rafData.delta=e-this.lastFrameTime,this.lastFrameTime=e,this._rafData.fps=0,this._rafData.delta>=1e3&&(this._rafData.delta=0),0!==this._rafData.delta&&(this._rafData.fps=1e3/this._rafData.delta),this._rafData.time=e,this._rafData.naturalFps=this._rafData.fps,this._rafData.timeNow=Date.now(),this._onSubscribersAnimationFrameStart(this._rafData),this.trigger("update",this._rafData),this.trigger("external",this._rafData),this.trigger("draw",this._rafData),this._onSubscribersAnimationFrameEnd(this._rafData),this._willRun||this._reset()},s._onExternalAnimationFrame=function(e){this._isUsingExternalAnimationFrame&&this._onAnimationFrame(e)},s._reset=function(){this._rafData={time:0,delta:0,fps:0,naturalFps:0,timeNow:0},this._subscribers={},this._subscribersOrder=[],this._subscriberArrayLength=0,this._subscriberCount=0,this._nextFrameSubscribers={},this._nextFrameSubscribersOrder=[],this._nextFrameSubscriberArrayLength=0,this._nextFrameSubscriberCount=0,this._didEmitFrameData=!1,this._animationFrame=null,this._animationFrameActive=!1,this._isRunning=!1,this._shouldReset=!1,this.lastFrameTime=0},e.exports=r},2428:function(e,t,i){i(2429),function(){if("performance"in window==0&&(window.performance={}),"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}}()},2429:function(e,t){Date.now||(Date.now=function(){return(new Date).getTime()})},2430:function(e,t,i){"use strict";var s=i(2425).SharedInstance,r=function(){this._currentID=0};r.prototype.getNewID=function(){return this._currentID++,"raf:"+this._currentID},e.exports=s.share("ac-raf-emitter-id-generator:sharedRAFEmitterIDGeneratorInstance","1.0.3",r)},2431:function(e,t,i){"use strict";var s=i(2420);e.exports=s.cancelAnimationFrame("update")},2432:function(e,t,i){"use strict";var s=i(2433);e.exports=function(){var e=s.getWindow();return"devicePixelRatio"in e&&e.devicePixelRatio>=1.5}},2433:function(e,t,i){"use strict";e.exports={getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator}}},2434:function(e,t,i){"use strict";var s=i(2365).os,r=i(2435).original,n=i(2433),a=i(2436);function o(){var e=n.getWindow();return!r()&&!e.orientation||s.windows}e.exports=a(o),e.exports.original=o},2435:function(e,t,i){"use strict";var s=i(2433),r=i(2436);function n(){var e=s.getWindow(),t=s.getDocument(),i=s.getNavigator();return!!("ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch||i.maxTouchPoints>0||i.msMaxTouchPoints>0)}e.exports=r(n),e.exports.original=n},2436:function(e,t,i){"use strict";e.exports=function(e){var t;return function(){return"undefined"===typeof t&&(t=e.apply(this,arguments)),t}}},2437:function(e,t,i){"use strict";var s=i(2434).original,r=i(2438).original,n=i(2436);function a(){return!s()&&!r()}e.exports=n(a),e.exports.original=a},2438:function(e,t,i){"use strict";var s=i(2434).original,r=i(2433),n=i(2436);function a(){var e=r.getWindow(),t=e.screen.width;return e.orientation&&e.screen.height<t&&(t=e.screen.height),!s()&&t>=600}e.exports=n(a),e.exports.original=a},2439:function(e,t,i){"use strict";e.exports=[{name:"small",minWidth:0,maxWidth:569},{name:"medium",minWidth:570,maxWidth:779},{name:"large",minWidth:780,maxWidth:1/0}]},2440:function(e,t,i){"use strict";e.exports=["loadstart","progress","suspend","abort","error","emptied","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","ended","ratechange","durationchange","volumechange","addtrack","change","removetrack"]},2441:function(e,t,i){"use strict";e.exports=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","waiting","canplay","canplaythrough"]},2442:function(e,t,i){"use strict";var s=i(2360).EventEmitterMicro,r=function(e){s.call(this),this.el=e.el||document.body,this.breakpoints=e.breakpoints.sort((function(e,t){return e.minWidth-t.minWidth})),this._player=e.player,this._breakPointsLength=this.breakpoints.length,this._addClasses=e.addClass,this._addEventListeners(),this._onResize()},n=s.prototype,a=r.prototype=Object.create(n);a.constructor=r,a._addEventListeners=function(){var e=this;this._boundOnResize=function(){e._onResize.apply(e,arguments)},window.addEventListener("resize",this._boundOnResize),window.addEventListener("orientationchange",this._boundOnResize),window.addEventListener("DOMContentLoaded",this._boundOnResize)},a._removeEventListeners=function(){window.removeEventListener("resize",this._boundOnResize),window.removeEventListener("orientationchange",this._boundOnResize),window.addEventListener("DOMContentLoaded",this._boundOnResize)},a._onResize=function(e){var t=this.el.clientWidth,i=this._currentBreakpoint;if(!1!==e&&this._player.refreshSize(),!i||!r.widthInBreakpoint(t,i)){var s=r.getBreakpointFromWidth(t,this.breakpoints,i,this._breakPointsLength);this._addClasses&&(this._currentBreakpoint&&this.el.classList.remove(i.name),this.el.classList.add(s.name)),this._currentBreakpoint=s,this.trigger("breakpointchange",s)}},a.getCurrentBreakpoint=function(){return this._currentBreakpoint},a.refresh=function(){this._onResize(!1)},a.destroy=function(){this._removeEventListeners(),n.destroy.call(this)},r.getBreakpointFromElement=function(e,t){return r.getBreakpointFromWidth(e.clientWidth,t)},r.getBreakpointFromWidth=function(e,t,i,s){for(var r=0,n=s||t.length;r<n;r++){var a=t[r];if(a!==i&&e>=a.minWidth&&e<=a.maxWidth)return a}return null},r.widthInBreakpoint=function(e,t){return e>=t.minWidth&&e<=t.maxWidth},e.exports=r},2443:function(e,t,i){"use strict";var s,r;e.exports=function(e){return e.threesixty?(s||(s=i(2444)),new s(e)):(r||(r=i(2445)),new r(e))}},2444:function(e,t,i){"use strict";function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2445),n=["controls-toggle-mute-volume-button","controls-volume-level-indicator"],a=function(e){var t,i;function r(t){var i,s=(i=e.call(this,t)||this)._player.get360();return i._arrowControls=!s||s.arrowControls,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var a=r.prototype;return a._bindMethods=function(){e.prototype._bindMethods.call(this),this._onLeftArrowUp=this._onLeftArrowUp.bind(this),this._onRightArrowUp=this._onRightArrowUp.bind(this),this._onDownArrowUp=this._onDownArrowUp.bind(this),this._onUpArrowUp=this._onUpArrowUp.bind(this)},a._addEventListeners=function(){e.prototype._addEventListeners.call(this),this._keyboard.onUp(37,this._onLeftArrowUp),this._keyboard.onUp(39,this._onRightArrowUp),this._keyboard.onUp(38,this._onUpArrowUp),this._keyboard.onUp(40,this._onDownArrowUp)},a._removeEventListeners=function(){e.prototype._removeEventListeners.call(this),this._keyboard.offUp(37,this._onLeftArrowUp),this._keyboard.offUp(39,this._onRightArrowUp),this._keyboard.offUp(38,this._onUpArrowUp),this._keyboard.offUp(40,this._onDownArrowUp)},a._onLeftArrowDown=function(t){if(t.target.classList.contains("controls-progress-indicator"))return this._triggerKeyboardInteraction(),void e.prototype._onLeftArrowDown.call(this,t);this._arrowControls.leftArrowDown(t)},a._onRightArrowDown=function(t){if(t.target.classList.contains("controls-progress-indicator"))return this._triggerKeyboardInteraction(),void e.prototype._onRightArrowDown.call(this,t);this._arrowControls.rightArrowDown(t)},a._onUpArrowDown=function(t){if(t.target.classList.contains(n[0])||t.target.classList.contains(n[1]))return this._triggerKeyboardInteraction(),void e.prototype._onUpArrowDown.call(this,t);t.originalEvent.preventDefault(),this._arrowControls.upArrowDown(t)},a._onDownArrowDown=function(t){if(t.target.classList.contains(n[0])||t.target.classList.contains(n[1]))return this._triggerKeyboardInteraction(),void e.prototype._onDownArrowDown.call(this,t);t.originalEvent.preventDefault(),this._arrowControls.downArrowDown(t)},a._onLeftArrowUp=function(e){e.target.classList.contains("controls-progress-indicator")?this._triggerKeyboardInteraction():(e.originalEvent.preventDefault(),this._arrowControls.leftArrowUp(e))},a._onRightArrowUp=function(e){e.target.classList.contains("controls-progress-indicator")?this._triggerKeyboardInteraction():(e.originalEvent.preventDefault(),this._arrowControls.rightArrowUp(e))},a._onUpArrowUp=function(e){e.target.classList.contains("controls-progress-indicator")?this._triggerKeyboardInteraction():this._arrowControls.upArrowUp(e)},a._onDownArrowUp=function(e){e.target.classList.contains("controls-progress-indicator")?this._triggerKeyboardInteraction():this._arrowControls.downArrowUp(e)},a._onKeyboardInteraction=function(e){},a.destroy=function(){e.prototype.destroy.call(this)},r}(r);e.exports=a},2445:function(e,t,i){"use strict";var s=i(2446),r=i(2360).EventEmitterMicro,n=32,a=37,o=38,l=39,h=40,d=function(e){r.call(this),this._player=e.player,this._target=e.keyboardTarget||this._player.el,this._keyboard=new s(this._target),this._bindMethods(),this._addEventListeners()},c=r.prototype,u=d.prototype=Object.create(c);u._bindMethods=function(){this._onLeftArrowDown=this._onLeftArrowDown.bind(this),this._onRightArrowDown=this._onRightArrowDown.bind(this),this._onUpArrowDown=this._onUpArrowDown.bind(this),this._onDownArrowDown=this._onDownArrowDown.bind(this),this._onSpaceBarUp=this._onSpaceBarUp.bind(this),this._onSpaceBarDown=this._onSpaceBarDown.bind(this),this._onKeyboardInteraction=this._onKeyboardInteraction.bind(this),this._onDurationChange=this._onDurationChange.bind(this),this._boundKeyboardInteraction={},[n,a,l,o,h].forEach(function(e){this._boundKeyboardInteraction[e]=this._onKeyboardInteraction.bind(this,e)}.bind(this))},u._addEventListeners=function(){[n,a,l,o,h].forEach(function(e){this._keyboard.onDown(e,this._boundKeyboardInteraction[e])}.bind(this)),this._keyboard.onDown(n,this._onSpaceBarDown),this._keyboard.onDown(a,this._onLeftArrowDown),this._keyboard.onDown(l,this._onRightArrowDown),this._keyboard.onDown(o,this._onUpArrowDown),this._keyboard.onDown(h,this._onDownArrowDown),this._player.on("durationchange",this._onDurationChange)},u._removeEventListeners=function(){[n,a,l,o,h].forEach(function(e){this._keyboard.offDown(e,this._boundKeyboardInteraction[e])}.bind(this)),this._boundKeyboardInteraction=null,this._keyboard.offDown(n,this._onSpaceBarDown),this._keyboard.offUp(n,this._onSpaceBarUp),this._keyboard.offDown(a,this._onLeftArrowDown),this._keyboard.offDown(l,this._onRightArrowDown),this._keyboard.offDown(o,this._onUpArrowDownDown),this._keyboard.offDown(h,this._onDownArrowDown),this._player.off("durationchange",this._onDurationChange)},u._onKeyboardInteraction=function(){this._triggerKeyboardInteraction()},u._triggerKeyboardInteraction=function(){this.trigger("keyboardinteraction")},u._onDurationChange=function(){var e=this._player.getDuration();this._interval=e>=60?10:e>=20?5:1},u._onLeftArrowDown=function(e){if(!this._player.isLive()){e.originalEvent.preventDefault(),e.originalEvent.stopPropagation();var t=this._player.getCurrentTime();isNaN(t)||this._player.seek(Math.max(t-this._interval,0))}},u._onRightArrowDown=function(e){if(!this._player.isLive()){e.originalEvent.preventDefault(),e.originalEvent.stopPropagation();var t=this._player.getCurrentTime();isNaN(t)||this._player.seek(Math.min(t+this._interval,this._player.getDuration()))}},u._onUpArrowDown=function(e){if(!e.target.hasAttribute("aria-checked")){e.originalEvent.preventDefault(),e.originalEvent.stopPropagation();var t=this._player.getMuted()?0:this._player.getVolume(),i=Math.min(1,t+.1);this._player.setVolume(i),this._player.setMuted(!1)}},u._onDownArrowDown=function(e){if(!e.target.hasAttribute("aria-checked")){e.originalEvent.preventDefault(),e.originalEvent.stopPropagation();var t=this._player.getMuted()?0:this._player.getVolume(),i=Math.max(0,t-.1);this._player.setVolume(i),this._player.setMuted(0===Math.round(10*i))}},u._onSpaceBarDown=function(e){"BUTTON"!==e.target.tagName&&"button"!==e.target.getAttribute("role")&&(this._keyboard.offDown(n,this._onSpaceBarDown),this._keyboard.onUp(n,this._onSpaceBarUp))},u._onSpaceBarUp=function(){this._keyboard.offUp(n,this._onSpaceBarUp),this._player.getPaused()?this._player.play():this._player.pause(),this._keyboard.onDown(n,this._onSpaceBarDown)},u.destroy=function(){this._removeEventListeners(),this._keyboard.destroy(),c.destroy.call(this)},e.exports=d},2446:function(e,t,i){"use strict";var s=i(2360).EventEmitterMicro,r=i(2403),n=i(2447),a=i(2448),o=i(2449);function l(e){this._keysDown={},this._DOMKeyDown=this._DOMKeyDown.bind(this),this._DOMKeyUp=this._DOMKeyUp.bind(this),this._context=e||document,r(this._context,"keydown",this._DOMKeyDown,!0),r(this._context,"keyup",this._DOMKeyUp,!0),s.call(this)}var h=l.prototype=a(s.prototype);h.onDown=function(e,t){return this.on("keydown:"+e,t)},h.onceDown=function(e,t){return this.once("keydown:"+e,t)},h.offDown=function(e,t){return this.off("keydown:"+e,t)},h.onUp=function(e,t){return this.on("keyup:"+e,t)},h.onceUp=function(e,t){return this.once("keyup:"+e,t)},h.offUp=function(e,t){return this.off("keyup:"+e,t)},h.isDown=function(e){return e+="",this._keysDown[e]||!1},h.isUp=function(e){return!this.isDown(e)},h.destroy=function(){return n(this._context,"keydown",this._DOMKeyDown,!0),n(this._context,"keyup",this._DOMKeyUp,!0),this._keysDown=null,this._context=null,s.prototype.destroy.call(this),this},h._DOMKeyDown=function(e){var t=this._normalizeKeyboardEvent(e),i=t.keyCode+="";this._trackKeyDown(i),this.trigger("keydown:"+i,t)},h._DOMKeyUp=function(e){var t=this._normalizeKeyboardEvent(e),i=t.keyCode+="";this._trackKeyUp(i),this.trigger("keyup:"+i,t)},h._normalizeKeyboardEvent=function(e){return new o(e)},h._trackKeyUp=function(e){this._keysDown[e]&&(this._keysDown[e]=!1)},h._trackKeyDown=function(e){this._keysDown[e]||(this._keysDown[e]=!0)},e.exports=l},2447:function(e,t,i){"use strict";e.exports=function(e,t,i,s){return e.removeEventListener?e.removeEventListener(t,i,!!s):e.detachEvent("on"+t,i),e}},2448:function(e,t,i){"use strict";var s=function(){};e.exports=function(e){if(arguments.length>1)throw new Error("Second argument not supported");if(null===e||"object"!==typeof e)throw new TypeError("Object prototype may only be an Object.");return"function"===typeof Object.create?Object.create(e):(s.prototype=e,new s)}},2449:function(e,t,i){"use strict";var s=i(2450),r=["keyLocation","keyIdentifier"];function n(e){var t;for(t in this.originalEvent=e,e)-1===r.indexOf(t)&&"function"!==typeof e[t]&&(this[t]=e[t]);this.keyCode||(this.keyCode=this._getKeyCode()),this.location=void 0!==this.originalEvent.location?this.originalEvent.location:this.originalEvent.keyLocation}n.prototype={preventDefault:function(){if("function"===typeof this.originalEvent.preventDefault)return this.originalEvent.preventDefault();this.originalEvent.returnValue=!1},stopPropagation:function(){return this.originalEvent.stopPropagation()},_getKeyCode:function(){return s[this.code]||-1}},e.exports=n},2450:function(e,t,i){"use strict";e.exports={Backspace:8,Tab:9,Enter:13,NumpadEnter:13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:18,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Delete:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,NumpadEqual:187,Backquote:192,BracketLeft:219,BracketRight:221,Backslash:220,Semicolon:186,Quote:222,Space:32,Equal:187,Comma:188,Minus:189,Period:190,Slash:191}},2451:function(e,t,i){var s=i(2365),r=s.os.ios||s.os.android,n=i(2452),a=i(2453),o=i(2454);e.exports=function(e){return e.threesixty?r?new o(e):new a(e):new n(e)}},2452:function(e,t){var i=function(){function e(e){this._player=e.player,this.el=this._player.el,this._showControls=e.showControls,this._hideControls=e.hideControls,this._raiseControls=e.raiseControls,this._lowerControls=e.lowerControls,this._sendMouseDown=e.sendMouseDown,this._controls=this._player.controls,this._controlsVisible=e.controlsVisible,this._controlsTimeoutDuration=e.controlsTimeoutDuration,this._keyboardControl=e.keyboardControl,this._lastMouseCoords={},this._elementEmitter=e.elementEmitter,this._bindMethods(),this._addEventListeners()}var t=e.prototype;return t._bindMethods=function(){this._onUserInteraction=this._onUserInteraction.bind(this),this._onFullscreenChange=this._onFullscreenChange.bind(this),this._onFullscreenWillExit=this._onFullscreenWillExit.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onClick=this._onClick.bind(this),this._onFocusIn=this._onFocusIn.bind(this),this._onFocusOut=this._onFocusOut.bind(this),this._onUserInteractionTimeout=this._onUserInteractionTimeout.bind(this)},t._addEventListeners=function(){this._controls.el.addEventListener("mousemove",this._onUserInteraction,!0),this._controls.el.addEventListener("click",this._onClick,!0),this._player.on("fullscreen:change",this._onFullscreenChange),this._player.on("fullscreen:willexit",this._onFullscreenWillExit),"onmouseleave"in this.el?this._controls.el.addEventListener("mouseleave",this._onMouseLeave):this._controls.el.addEventListener("mouseout",this._onMouseOut,!0),this._keyboardControl&&this._keyboardControl.on("keyboardinteraction",this._onUserInteraction),this._elementEmitter.on("focusin",this._onFocusIn),this._elementEmitter.on("focusout",this._onFocusOut)},t._removeEventListeners=function(){this._controls.el.removeEventListener("mousemove",this._onUserInteraction,!0),this._controls.el.removeEventListener("click",this._onClick,!0),this._player.off("fullscreen:change",this._onFullscreenChange),this._player.off("fullscreen:willexit",this._onFullscreenWillExit),"onmouseleave"in this.el?this._controls.el.removeEventListener("mouseleave",this._onMouseLeave):this._controls.el.removeEventListener("mouseout",this._onMouseOut,!0),this._keyboardControl&&this._keyboardControl.off("keyboardinteraction",this._onUserInteraction),this._elementEmitter.off("focusin",this._onFocusIn),this._elementEmitter.off("focusout",this._onFocusOut)},t._shouldIgnoreUserInteraction=function(e){return!!(e&&"focusin"!==e.type&&e.target&&this._isActiveArea(e.target))},t._onUserInteraction=function(e,t){!e||"click"!==e.type&&"focusin"!==e.type||this._player.isCaptionsSelectorShowing()&&!e.target.classList.contains("controls-text-tracks-toggle-button")&&"radio"!==e.target.getAttribute("role")&&"radiogroup"!==e.target.getAttribute("role")&&this._player.hideCaptionsSelector(),!this._player.getCurrentSrc()||this._preventUserInteraction||!t&&e&&"mousemove"===e.type&&this._lastMouseCoords.x===e.screenX&&this._lastMouseCoords.y===e.screenY||(e&&e.pageX&&(this._lastMouseCoords={x:e.screenX,y:e.screenY}),this._showControls(),this._raiseControls(),clearTimeout(this._userInteractionTimeout),this._shouldIgnoreUserInteraction(e)||(this._userInteractionTimeout=window.setTimeout(this._onUserInteractionTimeout,this._controlsTimeoutDuration)))},t._onUserInteractionTimeout=function(){this._hideControls()},t._onMouseLeave=function(e){window.clearTimeout(this._userInteractionTimeout),this._hideControls(),this._lowerControls(),this._lastMouseCoords={}},t._onMouseOut=function(e){this._controls.el.contains(e.target)||e.target===this._controls.el||this._onMouseLeave()},t._isActiveArea=function(e){for(;e!==this.el;){if(e.hasAttribute("data-acv-active-area"))return!0;e=e.parentNode}return!1},t._onClick=function(e){this._hasFocus=!1,this._onUserInteraction(e)},t._onFullscreenWillExit=function(){this.controls&&(this.controls.el.display="none")},t._onFullscreenChange=function(){var e=this;this.controls&&(this.controls.el.display=""),this._hideControls(),this._lowerControls(),this._preventUserInteraction=!0,this._fullscreenChangeTimeout=setTimeout((function(){e._preventUserInteraction=!1,e._player.refreshSize()}),750),this._player.refreshSize()},t._onFocusIn=function(e){clearTimeout(this._focusOutTimer),this._focusOutTimer=null,this._hasFocus=!0,this._onUserInteraction(e)},t._onFocusOut=function(e){var t=this;this._focusOutTimer=setTimeout((function(){t._hasFocus&&!t.el.contains(document.activeElement)&&(t._hasFocus=!1,t._hideControls(),t._lowerControls())}),100)},t.destroy=function(){clearTimeout(this._focusOutTimer),clearTimeout(this._fullscreenChangeTimeout),clearTimeout(this._userInteractionTimeout),this._removeEventListeners()},e}();e.exports=i},2453:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this)._showCompass=t.showCompass,i._hideCompass=t.hideCompass,i._threesixtyElementsTimeoutDuration=t.threesixtyElementsTimeoutDuration||3e3,i._dragEndThreshold=500,i._mouseDownPosition=null,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._bindMethods=function(){e.prototype._bindMethods.call(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onDragging=this._onDragging.bind(this),this._onClick=this._onClick.bind(this)},n._addEventListeners=function(){e.prototype._addEventListeners.call(this),this._controls.el.addEventListener("mousedown",this._onMouseDown),this._controls.el.addEventListener("click",this._onClick)},n._removeEventListeners=function(){e.prototype._removeEventListeners.call(this),this._controls.el.removeEventListener("mousedown",this._onMouseDown)},n._onUserInteraction=function(t){this._userWasRecentlyDragging||t&&"mousemove"===t.type&&this._lastMouseCoords.x===t.screenX&&this._lastMouseCoords.y===t.screenY||this._dragging||(this._showCompass(),clearTimeout(this._userHideMouse),e.prototype._onUserInteraction.call(this))},n._onUserInteractionTimeout=function(){var t=this;e.prototype._onUserInteractionTimeout.call(this),clearTimeout(this._userHideMouse),this._userHideMouse=setTimeout((function(){t._hideCompass()}),this._threesixtyElementsTimeoutDuration)},n._onDragging=function(e){var t=this;!this._dragging&&this._isActiveArea(e.target)||(this._dragging=!0,this._player.el.classList.add("dragging"),this._player.el.classList.add("recently-dragging"),this._recentDragTimeout=setTimeout((function(){t._dragging&&(t._hideControls(),t._userWasRecentlyDragging=!0,clearTimeout(t._dragTimer),t._dragTimer=setTimeout((function(){t._userWasRecentlyDragging=!1,t._player.el.classList.remove("recently-dragging")}),t._dragEndThreshold))}),30),clearTimeout(this._userInteractionTimeout),clearTimeout(this._userHideMouse))},n._isDraggable=function(e){return-1!==[this._player.controls.compass.el,this._player.controls.playButtonElement].indexOf(e)||this._player.controls.compass.el.contains(e)},n._onMouseDown=function(e){this._isActiveArea(e.target)&&this._controlsVisible()&&!this._isDraggable(e.target)||!this._isPlayingState()||(this._showControls(),clearTimeout(this._userHideMouse),clearTimeout(this._recentDragTimeout),this._player.el.classList.remove("dragging"),this._player.el.classList.remove("recently-dragging"),this._mouseDownPosition={x:e.x,y:e.y},window.addEventListener("mouseup",this._onMouseUp),window.addEventListener("mousemove",this._onDragging),this._sendMouseDown(e))},n._onMouseUp=function(e){window.removeEventListener("mousemove",this._onDragging),window.removeEventListener("mouseup",this._onMouseUp),this._dragging&&this._onUserInteractionTimeout(),this._player.el.contains(e.target)||this._hideCompass(),this._player.el.classList.remove("dragging"),this._dragging=!1},n._onMouseLeave=function(t){e.prototype._onMouseLeave.call(this),this._userWasRecentlyDragging=!1,this._dragging||(clearTimeout(this._userHideMouse),this._hideCompass())},n._onClick=function(e){this._player.controls.compass.el.contains(e.target)&&this._userWasRecentlyDragging&&e.stopPropagation(),e.target!==this._player.controls.playButtonElement.parentElement&&e.target!==this._controls.el.firstElementChild||null===this._mouseDownPosition||this._mouseDownPosition.x!==e.x||this._mouseDownPosition.y!==e.y||(this._mouseDownPosition=null,this._mouseDownTime=1/0,this._dragging=!1,this._userWasRecentlyDragging=!1,clearTimeout(this._dragTimer),clearTimeout(this._recentDragTimeout))},n._isPlayingState=function(){return!this._player.controls.el.classList.contains("start-state")&&!this._player.controls.el.classList.contains("end-state")},r}(i(2452));e.exports=r},2454:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this)._controlsVisible=t.controlsVisible,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._bindMethods=function(){e.prototype._bindMethods.call(this),this._onTouchStart=this._onTouchStart.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onClick=this._onClick.bind(this)},n._addEventListeners=function(){this._controls.el.addEventListener("touchstart",this._onTouchStart,{passive:!1}),this._controls.el.addEventListener("click",this._onClick),this._controls.el.addEventListener("focusin",this._onFocusIn),this._controls.el.addEventListener("focusout",this._onFocusOut)},n._removeEventListeners=function(){this._controls.el.removeEventListener("touchstart",this._onTouchStart),this._controls.el.removeEventListener("touchend",this._onTouchEnd),this._controls.el.removeEventListener("click",this._onClick),this._controls.el.removeEventListener("focusin",this._onFocusIn),this._controls.el.removeEventListener("focusout",this._onFocusOut)},n._onDragging=function(t){e.prototype._onDragging.call(this)},n._shouldIgnoreUserInteraction=function(e){return!1},n._onClick=function(e){e.target!==this._player.controls.compass.compassView&&(this._controlsVisible()?this._isActiveArea(e.target)||(this._hideControls(),this._hideCompass()):this._onUserInteraction(e))},n._onTouchStart=function(e){e.target!==this._player.controls.playButtonElement&&e.target!==this._controls.el.firstElementChild&&e.target!==this._player.controls.compass.compassView&&e.target!==this._player.controls.playButtonElement||(document.addEventListener("touchend",this._onTouchEnd),window.addEventListener("touchmove",this._onDragging),this._showCompass(),this._touchDownTime=Date.now(),this._sendMouseDown(e))},n._onTouchEnd=function(e){document.removeEventListener("touchend",this._onTouchEnd),window.removeEventListener("touchmove",this._onDragging),this._onMouseUp(e)},r}(i(2453));e.exports=r},2455:function(e,t,i){"use strict";var s=i(2456),r=i(2457),n=function(e,t){var i=e.getAttribute("data-original-"+t);i||(i=e.getAttribute(t)||"",e.setAttribute("data-original-"+t,i))};e.exports=function(e,t){if(r.isFocusableElement(e,t))n(e,"tabindex"),e.setAttribute("tabindex","-1");else for(var i=r.getTabbableElements(e,t),a=i.length;a--;)n(i[a],"tabindex"),i[a].setAttribute("tabindex","-1");n(e,s.HIDDEN),e.setAttribute(s.HIDDEN,"true")}},2456:function(e,t,i){"use strict";e.exports={AUTOCOMPLETE:"aria-autocomplete",CHECKED:"aria-checked",DISABLED:"aria-disabled",EXPANDED:"aria-expanded",HASPOPUP:"aria-haspopup",HIDDEN:"aria-hidden",INVALID:"aria-invalid",LABEL:"aria-label",LEVEL:"aria-level",MULTILINE:"aria-multiline",MULTISELECTABLE:"aria-multiselectable",ORIENTATION:"aria-orientation",PRESSED:"aria-pressed",READONLY:"aria-readonly",REQUIRED:"aria-required",SELECTED:"aria-selected",SORT:"aria-sort",VALUEMAX:"aria-valuemax",VALUEMIN:"aria-valuemin",VALUENOW:"aria-valuenow",VALUETEXT:"aria-valuetext",ATOMIC:"aria-atomic",BUSY:"aria-busy",LIVE:"aria-live",RELEVANT:"aria-relevant",DROPEFFECT:"aria-dropeffect",GRABBED:"aria-grabbed",ACTIVEDESCENDANT:"aria-activedescendant",CONTROLS:"aria-controls",DESCRIBEDBY:"aria-describedby",FLOWTO:"aria-flowto",LABELLEDBY:"aria-labelledby",OWNS:"aria-owns",POSINSET:"aria-posinset",SETSIZE:"aria-setsize"}},2457:function(e,t,i){"use strict";var s=i(2458),r=function(){this.focusableSelectors=s.selectors},n=r.prototype;n.isFocusableElement=function(e,t,i){return!(t&&!this._isDisplayed(e))&&(s.nodeName[e.nodeName]?!e.disabled:!e.contentEditable||(i=i||parseFloat(e.getAttribute("tabindex")),!isNaN(i)))},n.isTabbableElement=function(e,t){if(t&&!this._isDisplayed(e))return!1;var i=e.getAttribute("tabindex");return i=parseFloat(i),isNaN(i)?this.isFocusableElement(e,t,i):i>=0},n._isDisplayed=function(e){var t=e.getBoundingClientRect();return(0!==t.top||0!==t.left||0!==t.width||0!==t.height)&&"hidden"!==window.getComputedStyle(e).visibility},n.getTabbableElements=function(e,t){for(var i=e.querySelectorAll(this.focusableSelectors),s=i.length,r=[],n=0;n<s;n++)this.isTabbableElement(i[n],t)&&r.push(i[n]);return r},n.getFocusableElements=function(e,t){for(var i=e.querySelectorAll(this.focusableSelectors),s=i.length,r=[],n=0;n<s;n++)this.isFocusableElement(i[n],t)&&r.push(i[n]);return r},e.exports=new r},2458:function(e,t,i){"use strict";e.exports={selectors:["input","select","textarea","button","optgroup","option","menuitem","fieldset","object","a[href]","[tabindex]","[contenteditable]"].join(","),nodeName:{INPUT:"input",SELECT:"select",TEXTAREA:"textarea",BUTTON:"button",OPTGROUP:"optgroup",OPTION:"option",MENUITEM:"menuitem",FIELDSET:"fieldset",OBJECT:"object",A:"a"}}},2459:function(e,t,i){"use strict";var s=i(2460),r=i(2456),n="data-original-",a=function(e,t){var i=e.getAttribute(n+t);null!==i&&(""===i?s(e,t):e.setAttribute(t,i),s(e,n+t))};e.exports=function(e){a(e,"tabindex"),a(e,r.HIDDEN);for(var t=e.querySelectorAll("["+n+"tabindex]"),i=t.length;i--;)a(t[i],"tabindex")}},2460:function(e,t,i){"use strict";e.exports=function(e,t){var i;i=e instanceof NodeList?e:[].concat(e),t=Array.isArray(t)?t:[].concat(t),i.forEach((function(e){t.forEach((function(t){e.removeAttribute(t)}))}))}},2461:function(e,t,i){"use strict";e.exports=i(2462)},2462:function(e,t){e.exports={major:4,minor:4,patch:3,prerelease:2,toString:function(){return"4.4.3-2 (75c3017)"},toArray:function(){return[4,4,3]}}},2463:function(e,t,i){"use strict";var s=i(2434)();e.exports=function(e){var t;if(e?arguments.length>1&&(e=Object.assign.apply(null,Array.prototype.slice.apply(arguments))):e={},e.components||(e.components=i(2464)),"undefined"===typeof e.controls&&(e.controls=!0),e.controlsImplementation||(e.controlsImplementation=i(2559)),e.controlsFactory||(e.controlsFactory=i(2574)({controlsImplementation:e.controlsImplementation,components:e.components,template:e.controlsTemplate})),("undefined"!==typeof e.urlOptimizer&&!0===e.urlOptimizer||"true"===e.urlOptimizer)&&(e.urlOptimizer=i(2575)),e.sources||e.src?e.sources||(e.sources=e.src?[e.src]:[]):e.sources=[],e.autoplay=void 0!==e.autoplay?e.autoplay:s,e.controlsTimeoutDuration||(e.controlsTimeoutDuration=3e3),e.threesixty){e.threesixtyElementsTimeoutDuration||(e.threesixtyElementsTimeoutDuration=3e3);var r=i(2581);t=new r(e)}else{var n=i(2358);t=new n(e)}var a={};return e.sharing&&(a.sharing=Object.assign({},e.sharing)),e.thumbnails&&(a.thumbnails=Object.assign({},e.thumbnails)),e.endState&&(a.endState=Object.assign({},e.endState)),e.sources&&e.sources.length&&(e.autoplay||!e.preload||"auto"===e.preload||!0===e.preload?t.load(e.sources,e.textTracks,e.startTime,a):t.setSrc(e.sources[0])),t}},2464:function(e,t,i){"use strict";var s=i(2465),r=i(2466),n=i(2467),a=i(2395),o=i(2468),l=i(2470),h=i(2486),d=i(2487),c=i(2490),u=i(2491),f=i(2492),p=i(2494),g=i(2495),m=i(2496),y=i(2499),v=i(2500),_=i(2501),b=i(2554),T=i(2555),S=i(2556),E=i(2557),w=i(2558);e.exports={back30Seconds:{className:"back-30-seconds-button",view:{classDef:s}},gotoLive:{className:"progress-dvr-label-container",view:{classDef:n,options:{states:{initial:"not-live",on:"live",off:"not-live"},labels:{initial:"livestream",on:"livestream",off:"livestream"}}},behavior:{classDef:T}},fullScreen:{className:"full-screen-button",view:{classDef:n,options:{states:{initial:"fullscreen-unsupported",on:"is-fullscreen",off:""},labels:{initial:"fullscreen",on:"exitfullscreen",off:"fullscreen"}}},behavior:{classDef:g}},toggleMuteVolume:{className:"toggle-mute-volume-button",view:{classDef:n,options:{states:{initial:[],on:["is-muted"],off:[]}}},behavior:{classDef:d}},playPauseContainer:{className:"play-pause-button-container",view:{classDef:r,options:{states:{playing:["is-playing"],paused:[],ended:["is-ended"]}}},behavior:{classDef:c}},pictureInPictureToggle:{className:"picture-in-picture-button",view:{classDef:n,options:{states:{initial:["picture-in-picture-unsupported"],on:["is-picture-in-picture"],off:[]},labels:{initial:"pictureinpicture",on:"exitpictureinpicture",off:"pictureinpicture"}}},behavior:{classDef:u}},captionsToggle:{className:"text-tracks-toggle-button",view:{classDef:n,options:{states:{initial:["no-text-tracks"],on:["text-tracks-visible"],off:[]}}},behavior:{classDef:f}},captionsSelector:{className:"captions-selector",view:{classDef:o},behavior:{classDef:p}},airplayToggle:{className:"airplay-button",view:{classDef:n,options:{states:{initial:["airplay-unsupported"],on:["airplay-active"],off:[]}}},behavior:{classDef:b}},elapsedTimeIndicator:{className:"elapsed-time",view:{classDef:a}},remainingTimeIndicator:{className:"remaining-time",view:{classDef:a}},progressBar:{className:"progress-indicator",view:{classDef:l,options:{template:E,min:0,max:1,mixins:[S],orientation:"horizontal"}},behavior:{classDef:m}},volumeLevel:{className:"volume-level-indicator",view:{classDef:l,options:{template:w,min:0,max:100,mixins:[S],orientation:"vertical"}},behavior:{classDef:y}},sharing:{className:"sharing-button",view:{classDef:r,options:{states:{initial:["sharing-unsupported"],on:["is-sharing"],off:[]}}},behavior:{classDef:v}},socialShare:{className:"social-tray",view:{classDef:h,options:{}},behavior:{classDef:_}}}},2465:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t){return e.call(this,t)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i),r}(i(2362));e.exports=r},2466:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._states=i.states||{},s._labels=i.labels,s._focusTarget=s.el.querySelector("button")||s.el,s._states&&s._states.initial&&s.setState("initial"),s}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i),r.prototype.setState=function(e){this._currentState&&this._currentState!==e&&this._states[this._currentState].length&&this.el.classList.remove(this._states[this._currentState]),this._currentState=e,this._labels&&this._labels[this._currentState]&&(this._focusTarget.value=this._labels[this._currentState],this._focusTarget.setAttribute("aria-label",this._labels[this._currentState])),this._states[e].length&&this.el.classList.add(this._states[e])},r}(i(2465));e.exports=r},2467:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){return e.call(this,t,i)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i),r.prototype.setState=function(t){e.prototype.setState.call(this,t),"on"===this._currentState?this._focusTarget.setAttribute("aria-pressed",!0):this._focusTarget.setAttribute("aria-pressed",!1)},r}(i(2466));e.exports=r},2468:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2362),n=i(2446),a=i(2469),o=function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this).el=t,i._keyboard=new n(i.el),i._addEventListeners(),i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var o=r.prototype;return o._addEventListeners=function(){this._onClick=this._onClick.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this.el.addEventListener("click",this._onClick),this._keyboard.onDown(a.ARROW_UP,this._onKeyDown),this._keyboard.onDown(a.ARROW_DOWN,this._onKeyDown)},o._removeEventListeners=function(){this.el.removeEventListener("click",this._onClick),this._keyboard.onDown(a.ARROW_UP,this._onKeyDown),this._keyboard.onDown(a.ARROW_DOWN,this._onKeyDown)},o.setItems=function(e){var t,i=this;this.el.innerHTML="",e.forEach((function(e){var s=document.createElement("li");s.setAttribute("role","radio"),"showing"===e.mode?(s.classList.add(e.mode),s.setAttribute("aria-checked","true"),s.setAttribute("tabIndex",0),t=s):(s.setAttribute("aria-checked","false"),s.setAttribute("tabIndex",-1)),s.innerText=e.label,s.acvMetadata=e,i.el.appendChild(s)})),t&&t.focus()},o._onKeyDown=function(e){var t=e.target,i=!1;parseInt(e.keyCode)===a.ARROW_DOWN?i=t.nextSibling:parseInt(e.keyCode)===a.ARROW_UP&&(i=t.previousSibling),i&&(this.trigger("ItemSelected",i.acvMetadata),e.preventDefault(),e.stopPropagation())},o._onClick=function(e){this.el!==e.target&&this.el.contains(e.target)&&this.trigger("ItemSelected",e.target.acvMetadata)},o.destroy=function(){this._removeEventListeners()},r}(r);e.exports=o},2469:function(e,t,i){"use strict";e.exports={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,COMMAND:91,CAPSLOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_ZERO:96,NUMPAD_ONE:97,NUMPAD_TWO:98,NUMPAD_THREE:99,NUMPAD_FOUR:100,NUMPAD_FIVE:101,NUMPAD_SIX:102,NUMPAD_SEVEN:103,NUMPAD_EIGHT:104,NUMPAD_NINE:105,NUMPAD_ASTERISK:106,NUMPAD_PLUS:107,NUMPAD_DASH:109,NUMPAD_DOT:110,NUMPAD_SLASH:111,NUMPAD_EQUALS:187,TICK:192,LEFT_BRACKET:219,RIGHT_BRACKET:221,BACKSLASH:220,SEMICOLON:186,APOSTRAPHE:222,APOSTROPHE:222,SPACEBAR:32,CLEAR:12,COMMA:188,DOT:190,SLASH:191}},2470:function(e,t,i){"use strict";var s=i(2471).Slider,r=i(2485),n=function(e,t){if(this.el=e,this._min=t.min||0,this._max=t.max||1,t.mixins)for(var i=t.mixins.slice(0);i.length;)Object.assign(this,i.pop());this._slider=new s(this.el,{template:t.template,min:this._min,max:this._max,step:isNaN(+this.el.getAttribute("step"))?this.el.getAttribute("step"):+this.el.getAttribute("step"),value:void 0!==t.value?t.value:+this.el.getAttribute("value"),orientation:t.orientation,renderedPosition:!0,keyboardContext:this.el}),this._onFocusChange=this._onFocusChange.bind(this),this._setHoveringValue=this._setHoveringValue.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onChapterClicked=this._onChapterClicked.bind(this),this._onChapterFocusIn=this._onChapterFocusIn.bind(this),this._onChapterFocusOut=this._onChapterFocusOut.bind(this),this._slider.el.addEventListener("blur",this._onFocusChange),this._slider.el.addEventListener("focus",this._onFocusChange),this._slider.el.addEventListener("mouseout",this._onFocusChange),this._onGrab=this._onGrab.bind(this),this._onRelease=this._onRelease.bind(this),this._slider.on("grab",this._onGrab),this._slider.on("release",this._onRelease),this._scrubbedEl=this.el.querySelector(".ac-slider-scrubbed"),this._notchEl=this.el.querySelector(".ac-slider-hover-notch"),this._chapterContainer=this.el.querySelector(".ac-slider-chapters-track"),this._axTrack=this.el.querySelector(".ac-slider-ax-track"),this._bufferedTrack=this.el.querySelector(".ac-slider-buffered"),this._notchEl&&(this._slider.el.addEventListener("mouseover",this._onMouseOver),this._slider.el.addEventListener("mouseleave",this._onMouseLeave),this._slider.el.addEventListener("mousemove",this._setHoveringValue)),this._axTrack&&(this._axTrack.tabIndex=0,this._slider.el.tabIndex=-1,this._slider.el.setAttribute("aria-hidden",""),this._slider.el.removeAttribute("aria-label"),this._slider.el.removeAttribute("role")),t.value&&requestAnimationFrame(function(){this._slider&&this.setValue(t.value)}.bind(this))},a=n.prototype;a.on=function(){return this._slider.on.apply(this._slider,arguments)},a.off=function(){return this._slider.off.apply(this._slider,arguments)},a.trigger=function(){return this._slider.trigger.apply(this._slider,arguments)},a.setValue=function(e){return this._axTrack&&this._axTrack.setAttribute("aria-valuenow",e),this._slider.setValue.call(this._slider,e)},a.setAriaValueText=function(e){this._axTrack?this._axTrack.setAttribute("aria-valuetext",e):this._slider.el.setAttribute("aria-valuetext",e)},a.setMin=function(e){this._min=e,this._slider.setMin(e)},a.setMax=function(e){this._max=e,this._slider.setMax(e)},a._onMouseOver=function(){this._slider.el.classList.add("hover")},a._onMouseLeave=function(){this._slider.el.classList.remove("hover")},a._onFocusChange=function(){setTimeout(function(){this.trigger("focuschange")}.bind(this),0)},a.isFocused=function(){return this._slider.el===document.activeElement&&this._hasFocusOutline()},a._hasFocusOutline=function(){return"none"!==getComputedStyle(this._slider.el).getPropertyValue("outline-style")},a.getValue=function(){return this._slider.getValue.apply(this._slider,arguments)},a.getMax=function(){return this._max},a.setScrubbedValue=function(){this._chapters&&this._checkCollisionsSetValue(),"horizontal"===this._slider.getOrientation()?this._scrubbedEl.style.left=this._slider.thumbElement.style.left:this._scrubbedEl.style.bottom=this._slider.thumbElement.style.bottom},a.setBufferedValue=function(e){this._bufferedTrack.style.left=e+"%"},a._checkCollisionsSetValue=function(){for(var e=0;e<this._chapters.length;e++){var t=this._chapters[e].el.children[0],i=parseInt(this._chapters[e].el.style.left)<this.getValue()/this.getMax()*100;this._setInlineBackgroundColor(!i,t)}},a._setHoveringValue=function(e){var t=this.getClientXValue(e,this._notchEl),i=t>this.getValue();this._notchEl.style.left=t/this.getMax()*100+"%",this._setInlineBackgroundColor(i,this._notchEl)},a._setInlineBackgroundColor=function(e,t){e?t.classList.remove("invert-element"):t.classList.add("invert-element")},a._onChapterClicked=function(e){this.trigger("chapter:click",e),this._slider.thumbElement.style.pointerEvents=""},a._onChapterFocusIn=function(e){this._notchEl.classList.add("hidden"),this._slider.thumbElement.style.pointerEvents="none",this.trigger("chapter:focusin",e)},a._onChapterFocusOut=function(e){this._notchEl.classList.remove("hidden"),this._slider.thumbElement.style.pointerEvents="",this.trigger("chapter:focusout",e)},a._onGrab=function(){this.forceCursorPointer(),this.setScrubbedValue()},a._onRelease=function(){this.disableForcedCursorPointer(),this.setScrubbedValue()},a.setChapters=function(e){var t=this;this._chapters&&this._chapters.forEach((function(e){e.off("click",t._onChapterClicked),e.off("focusin",t._onChapterFocusIn),e.off("focusout",t._onChapterFocusOut),e.off("mouseover",t._onChapterFocusIn),e.off("mouseout",t._onChapterFocusOut),e.destroy()})),this._chapterContainer.innerHTML="",this._chapters=[];for(var i=0;i<e.length;i++)if(e[i].startTime<100){var s=new r(e[i]);s.on("click",this._onChapterClicked),s.on("focusin",this._onChapterFocusIn),s.on("focusout",this._onChapterFocusOut),s.on("mouseover",this._onChapterFocusIn),s.on("mouseout",this._onChapterFocusOut),this._chapters.push(s),this._chapterContainer.appendChild(s.el)}},a.show=function(){this.el.classList.remove("ac-slider-inactive")},a.hide=function(){this.el.classList.add("ac-slider-inactive")},a.setState=function(e){this.el.classList.add(e)},a.clearState=function(e){this.el.classList.remove(e)},a.getClientXValue=function(e,t){return this._slider.getClientXValue(e,t)},a.destroy=function(){var e=this;this._chapters&&this._chapters.forEach((function(t){t.off("click",e._onChapterClicked),t.off("focusin",e._onChapterFocusIn),t.off("focusout",e._onChapterFocusOut),t.off("mouseover",e._onChapterFocusIn),t.off("mouseout",e._onChapterFocusOut),t.destroy()})),this._slider.el.removeEventListener("mousemove",this._setHoveringValue),this._slider.el.removeEventListener("mouseleave",this._onMouseOver),this._slider.el.removeEventListener("mouseout",this._onMouseLeave),this._slider.el.removeEventListener("blur",this._onFocusChange),this._slider.el.removeEventListener("focus",this._onFocusChange),this._slider.el.removeEventListener("mouseout",this._onFocusChange),this._slider.off("grab",this._onGrab),this._slider.off("release",this._onRelease),this._slider.destroy(),this._slider=null},e.exports=n},2471:function(e,t,i){"use strict";e.exports.Slider=i(2472)},2472:function(e,t,i){"use strict";var s=i(2360).EventEmitterMicro,r=i(2473),n=i(2446),a=i(2484),o={num:37,string:"ArrowLeft"},l={num:39,string:"ArrowRight"},h={num:40,string:"ArrowDown"},d=[o,l,h,l],c=function(e){if(e.which)return e.which;for(var t=e.key?e.key:e.code,i=0,s=d.length;i<s;i++)if(d[i].string===t)return d[i].num;return-1},u={min:0,max:1,step:1,value:0,orientation:"horizontal",renderedPosition:!1,template:a,keyboardMaxStepPercentage:.05,keyboardStepMultiplier:1.25,containerClass:"ac-slider-container",grabbedClass:"ac-slider-grabbed"},f=Object.keys(u),p=function(e,t){this.options=Object.assign({},u,t),this.model=Object.create(this.options),this.el=e;var i=void 0!==this.options.keyboardContext?this.options.keyboardContext:this.el;null!==i&&(this._keyboard=new n(i),this._keyDown={}),e.classList.add(this.model.containerClass),e.innerHTML=this.model.template,s.call(this),this._initialize()},g=p.prototype=Object.create(s.prototype);g._addGrabClass=function(){this.el.classList.add(this.model.grabbedClass)},g._removeGrabClass=function(){this.el.classList.remove(this.model.grabbedClass)},g._addEventListeners=function(){this._addEventListener(this.el,"mousedown",this._onMouseDown),this._addEventListener(this.el,"touchstart",this._onTouchStart),this._addEventListener(this.el,"mouseover",this._onMouseOver),this._addEventListener(this.el,"mouseleave",this._onMouseLeave),this._keyboard&&("horizontal"===this.model.orientation?(this._keyboard.onDown(l.num,this.stepUp),this._keyboard.onDown(o.num,this.stepDown)):(this._keyboard.onDown(h.num,this.stepDown),this._keyboard.onDown(38,this.stepUp)))},g._addEventListener=function(e,t,i,s){e.addEventListener(t,i,s)},g._bindMethods=function(){this._addGrabClass=this._addGrabClass.bind(this),this._removeGrabClass=this._removeGrabClass.bind(this),this.stepDown=this.stepDown.bind(this),this.stepUp=this.stepUp.bind(this),this._triggerRelease=this._triggerRelease.bind(this),this._preventDefault=this._preventDefault.bind(this),this._onMouseDown=this._bindMethod(this._onMouseDown,this),this._onTouchStart=this._bindMethod(this._onTouchStart,this),this._onMouseOver=this._bindMethod(this._onMouseOver,this),this._onMouseLeave=this._bindMethod(this._onMouseLeave,this),this._onTouchEnd=this._bindMethod(this._onTouchEnd,this),this._onMouseUp=this._bindMethod(this._onMouseUp,this),this._onMouseMove=this._bindMethod(this._onMouseMove,this),this._onTouchMove=this._bindMethod(this._onTouchMove,this)},g._bindMethod=function(e,t){return e.bind(t)},g._correctValueMinMax=function(e,t,i){return e>i&&(e=i),e<t&&(e=t),e},g._calculateStepsToValue=function(e,t){return Math.abs(e-t)},g._calculateMaxSteps=function(e,t){return Math.abs(t-e)},g._calculateStepsEqualToPercentage=function(e,t){return e/100*t},g._calculateNextStepInRange=function(e,t,i,s){var r=this._calculateMaxSteps(t,i),n=this._calculateStepsToValue(e,t),a=t+Math.floor(r/s)*s;return Math.min(a,t+Math.round(n/s)*s)},g._dispatchEvent=function(e,t){e.dispatchEvent(new CustomEvent(t))},g.disableUserControls=function(){this._removeEventListeners()},g.enableUserControls=function(){this._addEventListeners()},g._getNextValue=function(e,t,i,s){return e=this._correctValueMinMax(e,t,i),"auto"!==s&&(e=this._calculateNextStepInRange(e,t,i,s)),e},g.getOrientation=function(){return this.model.orientation},g.getValue=function(){return this.model.value},g.getMin=function(){return this.model.min},g.getMax=function(){return this.model.max},g.getStep=function(){return this.model.step},g.getClientXValue=function(e,t){var i=this._getClientXFromEvent(e),s=null!==t?r.getDimensions(t||this.thumbElement):{width:0,height:0},n=r.getDimensions(this.runnableTrackElement),a=(i-this.runnableTrackElement.getBoundingClientRect().left-Math.round(s.width/2))/(n.width-s.width)*100,o=this._calculateMaxSteps(this.getMin(),this.getMax()),l=this._calculateStepsEqualToPercentage(a,o);return this.getMin()+l},g.getClientYValue=function(e){var t=this._getClientYFromEvent(e),i=r.getDimensions(this.thumbElement),s=r.getDimensions(this.runnableTrackElement),n=r.getViewportPosition(this.runnableTrackElement,this.model.renderedPosition),a=(s.height-i.height-(t-n.top-i.height/2))/(s.height-i.height)*100,o=this._calculateMaxSteps(this.model.min,this.model.max),l=this._calculateStepsEqualToPercentage(a,o);return this.model.min+l},g.getClientValue=function(e){return e=e.originalEvent||e,"horizontal"===this.model.orientation?this.getClientXValue(e):this.getClientYValue(e)},g._getClientXFromEvent=function(e){return e.touches?e.touches[0].clientX:e.clientX},g._getClientYFromEvent=function(e){return e.touches?e.touches[0].clientY:e.clientY},g._initialize=function(){this._setNodeReferences(),this.setValue(this.model.value),this._bindMethods(),this._addEventListeners()},g._onMouseLeave=function(){this._preventDocumentMouseUpDispatch=!1},g._onMouseDown=function(e){this._addGrabClass(),this._addEventListener(document,"mouseup",this._onMouseUp),this._addEventListener(document,"mousemove",this._onMouseMove);var t=this.getClientValue(e);this.trigger("grab",this.getValue()),this.setValue(t)},g._onMouseUp=function(){this._removeGrabClass(),this._removeEventListener(document,"mouseup",this._onMouseUp),this._removeEventListener(document,"mousemove",this._onMouseMove),this.trigger("release",this.getValue()),this._preventDocumentMouseUpDispatch||this._dispatchEvent(this.el,"mouseup")},g._onMouseOver=function(){this._preventDocumentMouseUpDispatch=!0},g._onTouchEnd=function(){this._removeGrabClass(),this._removeEventListener(document,"touchend",this._onTouchEnd),this._removeEventListener(document,"touchmove",this._onTouchMove),this.trigger("release",this.getValue()),this._preventDocumentMouseUpDispatch||this._dispatchEvent(this.el,"touchend")},g._onTouchStart=function(e){this._addGrabClass();var t=this.getClientValue(e);this._addEventListener(document,"touchend",this._onTouchEnd),this._addEventListener(document,"touchmove",this._onTouchMove,{passive:!1}),this.trigger("grab",this.getValue()),this.setValue(t)},g._onMouseMove=function(e){var t=this.getClientValue(e);this.setValue(t)},g._onTouchMove=function(e){e.preventDefault&&e.preventDefault();var t=this.getClientValue(e);this.setValue(t)},g._getElementOrientationOffsetValue=function(e,t){return"horizontal"===t?r.getDimensions(e).width:r.getDimensions(e).height},g._getAvailableRunnableTrack=function(e,t){return e-this._getElementOrientationOffsetValue(this.thumbElement,t)},g._getPercentageByValue=function(e,t){return(e=this._calculateStepsToValue(e,this.getMin()))/this._calculateMaxSteps(this.getMin(),this.getMax())*100},g._getPercentageOfRunnableTrack=function(e){var t=this.getOrientation(),i=this._getElementOrientationOffsetValue(this.runnableTrackElement,t),s=this._getAvailableRunnableTrack(i,t);return this._getPercentageByValue(e,this.getMax())/100*s/i*100},g._onChange=function(e){var t=this._getPercentageOfRunnableTrack(e);isNaN(t)||("horizontal"===this.getOrientation()?this.thumbElement.style.left=t+"%":this.thumbElement.style.bottom=t+"%",this.trigger("change",this.getValue()))},g._removeEventListeners=function(){this._removeEventListener(this.el,"mousedown",this._onMouseDown),this._removeEventListener(this.el,"touchstart",this._onTouchStart),this._removeEventListener(this.el,"mouseover",this._onMouseOver),this._removeEventListener(this.el,"mouseleave",this._onMouseLeave),this._removeEventListener(document,"touchend",this._onMouseUp)},g._removeEventListener=function(e,t,i){e.removeEventListener(t,i)},g._setNodeReferences=function(){this.runnableTrackElement=this.el.querySelector(".ac-slider-runnable-track"),this.thumbElement=this.el.querySelector(".ac-slider-thumb")},g.setOrientation=function(e){this._set("orientation",e)},g._triggerRelease=function(e){this._preventDefault(e),this.trigger("release",this.getValue()),this._keyDown[c(e)]=0},g._preventDefault=function(e){e.preventDefault(),e.stopPropagation()},g._step=function(e,t){this._preventDefault(e),this.el.focus();var i=this._keyDown[c(e)]||0;i?Math.abs(this._keyDown[c(e)])<Math.abs(this.model.max*this.model.keyboardMaxStepPercentage)&&(i*=this.model.keyboardStepMultiplier):(this.trigger("grab",this.getValue()),i="auto"!==(i=this.getStep())?i:this._cachedMaxStep,t||(i*=-1),this._keyboard.onceUp(c(e),this._triggerRelease)),this._keyDown[c(e)]=i,this.setValue(this.getValue()+i)},g.stepUp=function(e){this._step(e,!0)},g.stepDown=function(e){this._step(e,!1)},g.setValue=function(e){e=this._getNextValue(e,this.getMin(),this.getMax(),this.getStep()),this._set("value",e),this.el.setAttribute("aria-valuenow",e),this._onChange(e)},g.setMin=function(e){this._set("min",e),this.el.setAttribute("aria-valuemin",e)},g.setMax=function(e){this._set("max",e),this.el.setAttribute("aria-valuemax",e),this._cachedMaxStep=e/100},g.setStep=function(e){this._set("step",e)},g._set=function(e,t){if(f.indexOf(e)>-1&&this.model[e]!==t){var i=this.model[e];this.model[e]=t,this.trigger("change:model:"+e,{previous:i,current:t})}},g._removeEventListeners=function(){this._removeEventListener(this.el,"mousedown",this._onMouseDown),this._removeEventListener(this.el,"touchstart",this._onTouchStart),this._removeEventListener(this.el,"mouseover",this._onMouseOver),this._removeEventListener(this.el,"mouseleave",this._onMouseLeave),this._removeEventListener(this.el,"touchend",this._onTouchEnd),this._removeEventListener(document,"touchend",this._onMouseUp),"horizontal"===this.model.orientation?(this._keyboard.offDown(l.num,this.stepUp),this._keyboard.offDown(o.num,this.stepDown),this._keyboard.offUp(o.num,this._triggerRelease),this._keyboard.offUp(l.num,this._triggerRelease)):(this._keyboard.offDown(h.num,this.stepDown),this._keyboard.offDown(38,this.stepUp),this._keyboard.offUp(h.num,this._triggerRelease),this._keyboard.offUp(38,this._triggerRelease))},g.destroy=function(){this._removeEventListeners(),this._keyboard&&this._keyboard.destroy(),s.prototype.destroy.call(this)},e.exports=p},2473:function(e,t,i){"use strict";e.exports={getContentDimensions:i(2474),getDimensions:i(2475),getMaxScrollPosition:i(2476),getPagePosition:i(2477),getPercentInViewport:i(2479),getPixelsInViewport:i(2480),getPosition:i(2482),getScrollPosition:i(2478),getViewportPosition:i(2481),isInViewport:i(2483)}},2474:function(e,t,i){"use strict";e.exports=function(e,t){var i=1;return t&&(i=e.getBoundingClientRect().width/e.offsetWidth),{width:e.scrollWidth*i,height:e.scrollHeight*i}}},2475:function(e,t,i){"use strict";e.exports=function(e,t){var i;return t?{width:(i=e.getBoundingClientRect()).width,height:i.height}:{width:e.offsetWidth,height:e.offsetHeight}}},2476:function(e,t,i){"use strict";function s(e,t){return"x"===t?e.scrollWidth-e.clientWidth:e.scrollHeight-e.clientHeight}e.exports=function(e,t){var i=typeof e;return t="string"===i?e:t,e=e&&"string"!==i&&e!==window?e:document.documentElement,t&&/^[xy]$/i.test(t)?s(e,t):{x:s(e,"x"),y:s(e,"y")}}},2477:function(e,t,i){"use strict";var s=i(2475),r=i(2478);e.exports=function(e,t){var i;if(t){var n=r(),a=e.getBoundingClientRect();i={top:a.top+n.y,right:a.right+n.x,bottom:a.bottom+n.y,left:a.left+n.x}}else{var o=s(e);for(i={top:e.offsetTop,right:o.width,bottom:o.height,left:e.offsetLeft};e=e.offsetParent;)i.top+=e.offsetTop,i.left+=e.offsetLeft;i.right+=i.left,i.bottom+=i.top}var l=document.documentElement.offsetTop,h=document.documentElement.offsetLeft;return{top:i.top+l,right:i.right+h,bottom:i.bottom+l,left:i.left+h}}},2478:function(e,t,i){"use strict";function s(e){return"x"===e?window.scrollX||window.pageXOffset:window.scrollY||window.pageYOffset}function r(e,t,i){return"x"===t?i?s("x"):e.scrollLeft:i?s("y"):e.scrollTop}e.exports=function(e,t){var i=typeof e;t="string"===i?e:t;var s=(e=e&&"string"!==i?e:window)===window;return t&&/^[xy]$/i.test(t)?r(e,t,s):{x:r(e,"x",s),y:r(e,"y",s)}}},2479:function(e,t,i){"use strict";var s=i(2475),r=i(2480);e.exports=function(e,t){var i=r(e,t),n=s(e,t);return{x:i.x/n.width,y:i.y/n.height}}},2480:function(e,t,i){"use strict";var s=i(2481);e.exports=function(e,t){var i=window.innerWidth,r=window.innerHeight,n=s(e,t),a={x:n.right-n.left,y:n.bottom-n.top};return n.top<0&&(a.y+=n.top),n.bottom>r&&(a.y-=n.bottom-r),n.left<0&&(a.x+=n.left),n.right>i&&(a.x-=n.right-i),a.x=a.x<0?0:a.x,a.y=a.y<0?0:a.y,a}},2481:function(e,t,i){"use strict";var s=i(2477),r=i(2478);e.exports=function(e,t){var i;if(t)return{top:(i=e.getBoundingClientRect()).top,right:i.right,bottom:i.bottom,left:i.left};i=s(e);var n=r();return{top:i.top-n.y,right:i.right-n.x,bottom:i.bottom-n.y,left:i.left-n.x}}},2482:function(e,t,i){"use strict";var s=i(2475);e.exports=function(e,t){var i,r,n,a,o,l,h;return t?(r=(i=e.getBoundingClientRect()).top,n=i.left,a=i.width,o=i.height,e.offsetParent&&(r-=(l=e.offsetParent.getBoundingClientRect()).top,n-=l.left)):(h=s(e,t),r=e.offsetTop,n=e.offsetLeft,a=h.width,o=h.height),{top:r,right:n+a,bottom:r+o,left:n}}},2483:function(e,t,i){"use strict";var s=i(2479),r=i(2475);e.exports=function(e,t,i){var n=s(e,t);return i=function(e,t,i){var s={x:0,y:0};if(!t)return s;var n,a=typeof t;return t="number"===a||"string"===a?{x:t,y:t}:Object.assign(s,t),Object.keys(s).forEach((function(s){var a=t[s];("string"===typeof a||a>1)&&(n=n||r(e,i),a=(parseInt(a,10)||0)/("x"===s?n.width:n.height)),t[s]=a})),t}(e,i,t),n.y>0&&n.y>=i.y&&n.x>0&&n.x>=i.x}},2484:function(e,t){e.exports='<div class="ac-slider-runnable-track">\n\t<div class="ac-slider-thumb"></div>\n</div>'},2485:function(e,t,i){function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var n=i(2360).EventEmitterMicro,a=i(2394),o=i(2415),l=function(e){var t,i;function n(t){var i;(i=e.call(this)||this).el=document.createElement("button"),i.el.className="ac-slider-chapter-container";var r=t.titles.find((function(e){return"en"===e.language}))||t.titles[0],n=o.getTranslation().chapter;i._chapterMarker=document.createElement("div"),i._chapterMarker.classList.add("ac-slider-chapter-marker"),"0%"===t.startTimeInPercentage&&i.el.classList.add("hidden-chapter"),i.el.style.left=t.startTimeInPercentage,i.el.setAttribute("data-acv-chapter-time",t["start-time"]),i.el.tabIndex=0,i._chapterData=t,i.el.appendChild(i._chapterMarker);var l=t["start-time"],h=Math.floor(l/60),d=Math.ceil(l%60);return i._span=document.createElement("span"),i._span.innerText=a(n,{chaptertitle:r.title,chaptertime:a(o.getTranslation().currenttimetext,{minutes:h,seconds:d})}),i.el.firstElementChild.appendChild(i._span),i._onClick=i._onClick.bind(s(i)),i._onMouseOver=i._onMouseOver.bind(s(i)),i._onMouseOut=i._onMouseOut.bind(s(i)),i._onFocusIn=i._onFocusIn.bind(s(i)),i._onFocusOut=i._onFocusOut.bind(s(i)),i._onMouseDown=i._onMouseDown.bind(s(i)),i.el.addEventListener("click",i._onClick),i.el.addEventListener("focusin",i._onFocusIn),i.el.addEventListener("focusout",i._onFocusOut),i.el.addEventListener("mouseover",i._onMouseOver),i.el.addEventListener("mouseout",i._onMouseOut),i.el.addEventListener("mousemove",i._onMouseMove),i.el.addEventListener("mousedown",i._onMouseDown),i}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,r(t,i);var l=n.prototype;return l._onClick=function(e){e.preventDefault(),e.stopPropagation(),this.trigger("click",this._chapterData)},l._onMouseOver=function(e){e.stopPropagation(),this.trigger("mouseover",this._chapterData)},l._onMouseOut=function(e){this.trigger("mouseout",this._chapterData)},l._onMouseMove=function(e){e.stopPropagation()},l._onMouseDown=function(e){e.stopPropagation()},l._onFocusIn=function(e){this.trigger("focusin",this._chapterData)},l._onFocusOut=function(e){this.trigger("focusout",this._chapterData)},l.destroy=function(){this.el.removeEventListener("click",this._onClick),this.el.removeEventListener("focusin",this._onFocusIn),this.el.removeEventListener("focusout",this._onFocusOut),this.el.removeEventListener("mouseover",this._onMouseOver),this.el.removeEventListener("mouseout",this._onMouseOut),this.el.removeEventListener("mousemove",this._onMouseMove)},n}(n);e.exports=l},2486:function(e,t){var i=function(){function e(e){this.el=e}var t=e.prototype;return t.show=function(){this.el.classList.remove("hidden")},t.hide=function(){this.el.classList.add("hidden")},t.destroy=function(e){},e}();e.exports=i},2487:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._updateState(),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._updateState=function(){this._view.setState(this._player.getMuted()?"on":"off")},n._addPlayerListeners=function(){this._updateState=this._updateState.bind(this),this._player.on("volumechange",this._updateState)},n._onClick=function(){this._player.getMuted()?(this._player.setMuted(!1),0===this._player.getVolume()&&this._player.setVolume(.1)):this._player.setMuted(!0)},n.destroy=function(){this._player.off("volumechange",this._updateState),e.prototype.destroy.call(this)},r}(i(2488));e.exports=r},2488:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){return e.call(this,t,i)||this}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._initialize=function(){this._onClick=this._onClick.bind(this)},n._addViewListeners=function(){this._initialize(),this._view.on("click",this._onClick)},n._onClick=function(e){},n.destroy=function(){this._view.off("click",this._onClick)},r}(i(2489));e.exports=r},2489:function(e,t){e.exports=function(e,t){this._player=t.player,this._view=e,this._addViewListeners&&this._addViewListeners(),this._addPlayerListeners&&this._addPlayerListeners()}},2490:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._setPlayingState(),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._addPlayerListeners=function(){this._setPlayingState=this._setPlayingState.bind(this),this._player.on("play",this._setPlayingState),this._player.on("playing",this._setPlayingState),this._player.on("pause",this._setPlayingState),this._player.on("ended",this._setPlayingState)},n._onClick=function(){this._togglePlay()},n._setPlayingState=function(){this._player.getEnded()?this._view.setState("ended"):this._view.setState(this._player.getPaused()?"paused":"playing")},n._togglePlay=function(){this._player.getPaused()||this._player.getEnded()?this._player.play():this._player.pause()},n.destroy=function(){this._player.off("play",this._setPlayingState),this._player.off("pause",this._setPlayingState),this._player.off("playing",this._setPlayingState),this._player.off("ended",this._setPlayingState),e.prototype.destroy.call(this)},r}(i(2488));e.exports=r},2491:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){return e.call(this,t,i)||this}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._initialize=function(){this._updateButtonState=this._updateButtonState.bind(this),this._player.supportsPictureInPicture()&&(this._updateButtonState(),this._player.on("webkitpresentationmodechanged",this._updateButtonState)),e.prototype._initialize.call(this)},n._onClick=function(){this._player.setPictureInPicture(!this._player.isPictureInPicture())},n._updateButtonState=function(){this._view.setState(this._player.isPictureInPicture()?"on":"off")},n.destroy=function(){this._player.off("webkitpresentationmodechanged",this._updateButtonState),e.prototype.destroy.call(this)},r}(i(2488));e.exports=r},2492:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2488),n=i(2493),a=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._updateState(),s._allowMultiLanguageCaptions=!s._player.options.disableMultiLanguageCaptions,s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var a=r.prototype;return a._updateState=function(){var e=this._player.getVisibleTextTracks(),t=n(this._player.getTextTracks());e.length?this._view.setState("on"):t.length?this._view.setState("off"):this._view.setState("initial")},a._addPlayerListeners=function(){this._updateState=this._updateState.bind(this),this._player.on("addtrack",this._updateState),this._player.on("change",this._updateState),this._player.on("removetrack",this._updateState)},a._onClick=function(){var e=this._player.getVisibleTextTracks(),t=n(this._player.getTextTracks());t.length>1&&this._allowMultiLanguageCaptions?this._player.isCaptionsSelectorShowing()?this._player.hideCaptionsSelector():this._player.showCaptionsSelector():1===e.length?t[0].mode="hidden":t[0].mode="showing",setTimeout(this._updateState)},a.destroy=function(){this._player.off("addtrack",this._updateState),this._player.off("change",this._updateState),this._player.off("removetrack",this._updateState),e.prototype.destroy.call(this)},r}(r);e.exports=a},2493:function(e,t){e.exports=function(e){var t=new Set;return e.filter((function(e){return!(t.has(e.label)||"subtitles"!==e.kind&&"captions"!==e.kind&&e.kind)&&(t.add(e.label),!0)}))}},2494:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r="__CC_DISABLE",n=i(2489),a=i(2365).browser,o=a.edge||a.ie||a.firefox,l=i(2415),h=i(2493),d=function(e){var t,i;function n(t,i){var s;return(s=e.call(this,t,i)||this)._updateState(),s}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var a=n.prototype;return a._addViewListeners=function(){this._onSelected=this._onSelected.bind(this),this._view.on("ItemSelected",this._onSelected)},a._updateState=function(){var e="showing",t=h(this._player.getTextTracks()).map((function(t){"showing"===t.mode&&(e="hidden");var i={label:t.label||t.language||t.srclang&&("en"===t.srclang.toLowerCase()?"English":t.srclang)||"Unknown CC",language:t.language};return Object.defineProperty(i,"mode",{get:function(){return t.mode},set:function(e){t.mode=e}}),i}));this._view.setItems([{label:l.getTranslation().captionsoff,language:r,mode:e}].concat(t))},a._addPlayerListeners=function(){this._updateState=this._updateState.bind(this),this._player.on("addtrack",this._updateState),this._player.on("change",this._updateState),this._player.on("removetrack",this._updateState)},a._onSelected=function(e){var t=e.detail;this._player.getVisibleTextTracks().forEach((function(e){e.mode="hidden"})),t.language!==r&&(t.mode="showing"),o&&this._player.getMediaElement().textTracks.dispatchEvent(new CustomEvent("change")),setTimeout(this._updateState)},a.destroy=function(){this._player.off("addtrack",this._updateState),this._player.off("change",this._updateState),this._player.off("removetrack",this._updateState),this._view.off("ItemSelected",this._onSelected)},n}(n);e.exports=d},2495:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._player.getFullScreenEnabled()&&s._updateState(),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._addPlayerListeners=function(){this._updateState=this._updateState.bind(this),this._player.on("fullscreen:change",this._updateState)},n._updateState=function(){this._view.setState(this._player.isFullscreen()?"on":"off")},n._onClick=function(){this._player.toggleFullscreen(!this._player.isFullscreen())},n.destroy=function(){this._player.off("fullscreen:change",this._updateState),e.prototype.destroy.call(this)},r}(i(2488));e.exports=r},2496:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2489),n=i(2394),a=i(2497),o=i(2498),l=i(2373),h=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._player.isDvr()?s._liveStreamLookback=l:s._liveStreamLookback=0,s._visible=!1,s._ariaTextTemplate=i.localization.currenttimetext,s._onDurationChange(),s._refreshChapters(),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var h=r.prototype;return h._addViewListeners=function(){this._onSliderGrab=this._onSliderGrab.bind(this),this._onSliderChange=this._onSliderChange.bind(this),this._onSliderRelease=this._onSliderRelease.bind(this),this._onChapterClicked=this._onChapterClicked.bind(this),this._onChapterFocusIn=this._onChapterFocusIn.bind(this),this._onChapterFocusOut=this._onChapterFocusOut.bind(this),this._view.on("grab",this._onSliderGrab),this._view.on("chapter:click",this._onChapterClicked),this._view.on("chapter:focusin",this._onChapterFocusIn),this._view.on("chapter:focusout",this._onChapterFocusOut)},h._addPlayerListeners=function(){this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onPlay=this._onPlay.bind(this),this._onPause=this._onPause.bind(this),this._onEnded=this._onEnded.bind(this),this._onDurationChange=this._onDurationChange.bind(this),this._onProgress=this._onProgress.bind(this),this._refreshChapters=this._refreshChapters.bind(this),this._onRAF=this._onRAF.bind(this),this._player.on("durationchange",this._onDurationChange),this._player.on("loadstart",this._onEnded),this._player.on("ended",this._onEnded),this._player.on("timeupdate",this._onTimeUpdate),this._player.on("progress",this._onProgress),this._player.on("play",this._onPlay),this._player.on("pause",this._onPause),this._player.on("ended",this._onEnded),this._player.on("chapters:change",this._refreshChapters)},h._onProgress=function(){this._view.setBufferedValue(this._player.getBufferedPercentage())},h._setIsPlaying=function(e){e?this._view.setState("is-playing"):this._view.clearState("is-playing")},h._onPlay=function(){this._setIsPlaying(!0),this._player.isLive()||(o(this._timeUpdateInterval),this._raf=a(this._onRAF))},h._onRAF=function(){this._onTimeUpdate(),this._timeUpdateInterval=a(this._onRAF)},h._onPause=function(){this._setIsPlaying(!1),o(this._raf),o(this._timeUpdateInterval),this._onTimeUpdate()},h._onEnded=function(){this._onPause(),this._updateSliderPosition(0)},h._onChapterClicked=function(e){this._player.setCurrentTime(e["start-time"])},h._onChapterFocusIn=function(e){this._chapterFocused=!0,this._player.controls.overlays.setPopUpPosition(e["start-time"])},h._onChapterFocusOut=function(e){this._chapterFocused=!1},h._refreshChapters=function(){var e=this._cachedDuration=Math.max(0,this._player.getDuration()-this._liveStreamLookback);e&&!isNaN(e)&&e!==Math.Infinity?this._view.setChapters(this._player.getChapters().map((function(t){var i=t["start-time"]/e*100;return Object.assign({},t,{startTimeInPercentage:i+"%",startTime:i})}))):this._view.setChapters([])},h._onSliderGrab=function(){this._chapterFocused||(this._player.off("timeupdate",this._onTimeUpdate),o(this._timeUpdateInterval),this._view.off("grab",this._onSliderGrab),this._view.on("change",this._onSliderChange),this._view.on("release",this._onSliderRelease),this._onPause())},h._onSliderRelease=function(){this._chapterFocused||(this._view.off("change",this._onSliderChange),this._view.off("release",this._onSliderRelease),this._view.on("grab",this._onSliderGrab),this._player.on("timeupdate",this._onTimeUpdate),this._player.getPaused()||this._onPlay())},h._getDuration=function(){return this._cachedDuration&&isNaN(this._cachedDuration)||(this._cachedDuration=Math.max(0,this._player.getDuration()-this._liveStreamLookback)),this._cachedDuration},h._getTimeAsPercent=function(){return this._player.getCurrentTime()/this._getDuration()},h._onDurationChange=function(){this._cachedDuration=Math.max(0,this._player.getDuration()-this._liveStreamLookback),this._updateSliderPosition(this._getTimeAsPercent()),this._player.getPaused()||this._onPlay(),this._refreshChapters(),0===this._cachedDuration||isNaN(this._cachedDuration)?this._view.hide():this._view.show()},h._onSliderChange=function(){if(!this._player.getEnded()&&!isNaN(this._getDuration())&&0!==this._getDuration()){var e=this._view.getValue();this._setPlayerCurrentTime(e*this._getDuration()),this._setAriaValueText(e*this._getDuration()),this._updateScrubbedValue()}},h._onTimeUpdate=function(){this._updateSliderPosition(this._getTimeAsPercent())},h._updateSliderPosition=function(e){this._view.setValue(e),this._setAriaValueText(e*this._getDuration()),this._updateScrubbedValue(),this._visible||isNaN(this._getDuration())||(this._view.show(),this._visible=!0)},h._setAriaValueText=function(e){var t=Math.floor(e/60),i=Math.ceil(e%60);this._view.setAriaValueText(n(this._ariaTextTemplate,{minutes:t,seconds:i}))},h._updateScrubbedValue=function(){this._view.setScrubbedValue()},h._setPlayerCurrentTime=function(e){this._player.setCurrentTime(e)},h._removeEventListeners=function(){this._player.chapters&&this._player.chapters.off("change",this._refreshChapters),this._player.off("durationchange",this._onDurationChange),this._player.off("loadstart",this._onEnded),this._player.off("ended",this._onEnded),this._player.off("timeupdate",this._onTimeUpdate),this._player.off("progress",this._onTimeUpdate),this._view.off("change",this._onSliderChange),this._view.off("release",this._onSliderRelease),this._view.off("grab",this._onSliderGrab),this._view.off("chapter:click",this._onChapterClicked),this._view.off("chapter:focusin",this._onChapterFocusIn),this._view.off("chapter:focusout",this._onChapterFocusOut),this._player.off("play",this._onPlay),this._player.off("pause",this._onPause),this._player.off("ended",this._onPause),this._player.off("chapters:change",this._refreshChapters)},h.destroy=function(){this._removeEventListeners(),o(this._raf),o(this._timeUpdateInterval),this._view=null},r}(r);e.exports=h},2497:function(e,t,i){"use strict";var s=i(2420);e.exports=s.requestAnimationFrame("draw")},2498:function(e,t,i){"use strict";var s=i(2420);e.exports=s.cancelAnimationFrame("draw")},2499:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._hideVolume(),s._updateSliderVolumeValue(),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._addViewListeners=function(){this._showVolume=this._showVolume.bind(this),this._hideVolume=this._hideVolume.bind(this),this._onSliderGrab=this._onSliderGrab.bind(this),this._onSliderChange=this._onSliderChange.bind(this),this._onSliderRelease=this._onSliderRelease.bind(this),this._onFocusChange=this._onFocusChange.bind(this),this._view.on("grab",this._onSliderGrab),this._view.on("focuschange",this._onFocusChange)},n._addPlayerListeners=function(){this._updateSliderVolumeValue=this._updateSliderVolumeValue.bind(this),this._onUserVolumeChange=this._onUserVolumeChange.bind(this),this._player.once("durationchange",this._updateSliderVolumeValue),this._player.on("volumechange",this._updateSliderVolumeValue),this._player.on("uservolumechange",this._onUserVolumeChange)},n._onSliderGrab=function(){this._cachedVolume=this._player.getVolume(),this._player.off("volumechange",this._updateSliderVolumeValue),this._view.off("grab",this._onSliderGrab),this._view.on("change",this._onSliderChange),this._view.on("release",this._onSliderRelease)},n._onSliderRelease=function(){this._setPlayerVolume(this._view.getValue()),this._view.off("change",this._onSliderChange),this._view.off("release",this._onSliderRelease),this._view.on("grab",this._onSliderGrab),this._player.on("volumechange",this._updateSliderVolumeValue)},n._onSliderChange=function(){var e=this._view.getValue();this._setPlayerVolume(e),this._view.setScrubbedValue()},n._setPlayerVolume=function(e){e?(this._player.setMuted(!1),this._player.setVolume(e/100)):(this._player.setMuted(!0),this._player.setVolume(this._cachedVolume))},n._showVolume=function(){this._view.show()},n._hideVolume=function(){this._view.hide()},n._onUserVolumeChange=function(){this._showVolume(),clearTimeout(this._hideVolumeTimer),this._view.isFocused()||(this._hideVolumeTimer=setTimeout(this._hideVolume,1e3))},n._onFocusChange=function(){this._view.isFocused()?this._showVolume():this._hideVolume()},n._updateSliderVolumeValue=function(){if(this._player.getMuted())this._view.setValue(0),this._view.setScrubbedValue();else{var e=this._player.getVolume();this._view.setValue(100*e),this._view.setScrubbedValue()}},n._removeEventListeners=function(){this._player.off("durationchange",this._updateSliderVolumeValue),this._player.off("volumechange",this._updateSliderVolumeValue),this._player.off("uservolumechange",this._onUserVolumeChange),this._view.off("change",this._onSliderChange),this._view.off("release",this._onSliderRelease),this._view.off("grab",this._onSliderGrab)},n.destroy=function(){this._removeEventListeners()},r}(i(2489));e.exports=r},2500:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._player.states&&s._updateState(),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var n=r.prototype;return n._addPlayerListeners=function(){this._updateState=this._updateState.bind(this),this._player.states&&this._player.states.on("statechange",this._updateState)},n._updateState=function(){this._stateChanging=!1,this._view.setState("sharing"===this._player.states.getCurrentState()?"on":"off")},n._onClick=function(){this._stateChanging||("sharing"===this._player.states.getCurrentState()?(this._view.setState("off"),this._player.states.setState("none")):(this._view.setState("on"),this._player.states.setState("sharing")),this._stateChanging=!0)},n.destroy=function(){this._player.states&&this._player.states.off("statechange",this._updateState),e.prototype.destroy.call(this)},r}(i(2488));e.exports=r},2501:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2489),n=i(2502),a=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._updateState(),s}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i),r.prototype._updateState=function(){this.sharingModule=new n(Object.assign({},{player:this._player,parentView:this._view})),this.sharingModule.setData(this._player.options.sharing),this._view.el.innerHTML="",this._view.el.appendChild(this.sharingModule.el)},r}(r);e.exports=a},2502:function(e,t,i){"use strict";var s,r=i(2503),n=i(2504),a=i(2370),o=i(2505),l=i(2506).Dialog,h=i(2394),d=i(2415),c=i(2457);try{s=i(2531)}catch(m){a("ac-analytics-share failed to load, are you sure you've included it?")}var u=i(2365).os,f=u.ios||u.android,p=function(e){this.el||this._initializeElement(e.el,e.template),this._player=e.player,this._parentView=e.parentView,this._clickedShareButton=null,this._container=this.el.querySelector(".container"),this._sharingButtonContainer=this.el.querySelector(".social-sharing-container"),this._facebookButton=this.el.querySelector(".acv-fb-share"),this._twitterButton=this.el.querySelector(".acv-tw-share"),this._copyLinkButton=this.el.querySelector(".copy-link"),this._copyEmbedCodeButton=this.el.querySelector(".copy-embed-code"),this._copyTextArea=this.el.querySelector(".copy-area"),this._copyCloseButton=this.el.querySelector(".textinput-close-button"),this._closeButton=this.el.querySelector(".close-button"),!1===e.analytics&&(s=null),f&&(this.el.firstChild.classList.add("mobile"),this._player.on("loadstart",function(){this._getClientWidth()>735&&this.el.firstChild.classList.add("mobile-large")}.bind(this))),this._bindMethods(),this._addEventListeners(),this._syncSocialShareHidden()},g=p.prototype;g._initializeElement=function(e,t){e?this.el=e:(this.el=document.createElement("div"),this._templateData=d.getTranslation(),this.el.innerHTML=h((t||r).toString(),this._templateData))},g.setData=function(e){if(e){if(this._parentView.show(),e.allowEmbed&&this.el.firstChild.classList.add("embed-enabled"),this._sharingUrl=e.originatorUrl||window.location.href,this._videoid=e.videoid,this._hideExtension=e.hideExtension,this._embedPath=e.embedpath||"https://www.apple.com/embed/",this._hideFacebook=e.hideFacebookShare||!1,this._hideTwitter=e.hideTwitterShare||!1,this._title=e.title||"Video Player",this._syncSocialShareHidden(),this._container.classList.remove("textarea-active"),s&&!1!==e.analytics&&e.videoid)try{this._initAnalyticsAttributes(e),this._analyticsObserver||(this._analyticsObserver=s({context:this.el}))}catch(t){a("ac-analytics-share failed to load, are you sure you've included it?")}}else this._parentView.hide()},g._bindMethods=function(){this._doFacebookShare=this._doSocialShare.bind(this,l.FACEBOOK_SHARE),this._doTwitterShare=this._doSocialShare.bind(this,l.TWITTER_TWEET),this._copyUrl=this._copyUrl.bind(this),this._copyEmbedCode=this._copyEmbedCode.bind(this),this._closeCopyArea=this._showTextArea.bind(this,!1),this._closeState=this._closeState.bind(this)},g._addEventListeners=function(){this._facebookButton&&this._facebookButton.addEventListener("click",this._doFacebookShare),this._twitterButton&&this._twitterButton.addEventListener("click",this._doTwitterShare),this._copyLinkButton&&this._copyLinkButton.addEventListener("click",this._copyUrl),this._copyEmbedCodeButton&&this._copyEmbedCodeButton.addEventListener("click",this._copyEmbedCode),this._copyCloseButton&&this._copyCloseButton.addEventListener("click",this._closeCopyArea),this._closeButton&&this._closeButton.addEventListener("click",this._closeState)},g._removeEventListeners=function(){this._facebookButton&&this._facebookButton.removeEventListener("click",this._doFacebookShare),this._twitterButton&&this._twitterButton.removeEventListener("click",this._doTwitterShare),this._copyLinkButton&&this._copyLinkButton.removeEventListener("click",this._copyUrl),this._copyEmbedCodeButton&&this._copyEmbedCodeButton.removeEventListener("click",this._copyEmbedCode),this._copyCloseButton&&this._copyCloseButton.removeEventListener("click",this._closeCopyArea),this._closeButton&&this._closeButton.removeEventListener("click",this._closeState)},g._syncSocialShareHidden=function(){this._facebookButton&&(this._hideFacebook?this._facebookButton.classList.add("hide-button"):this._facebookButton.classList.remove("hide-button")),this._twitterButton&&(this._hideTwitter?this._twitterButton.classList.add("hide-button"):this._twitterButton.classList.remove("hide-button"))},g._doSocialShare=function(e){this._clickedShareButton=null,this._copyLinkButton.classList.remove("active"),this._copyEmbedCodeButton.classList.remove("active"),this._showTextArea(!1),l.create(e,{url:this._sharingUrl,title:this._title})},g._showTextArea=function(e){e?(this._container.classList.add("textarea-active"),o(this._copyTextArea),f||this._copyTextArea.setAttribute("readonly","")):(this._container.classList.remove("textarea-active"),this._copyLinkButton.classList.remove("active"),this._copyEmbedCodeButton.classList.remove("active"),this._copyTextArea.removeAttribute("readonly"),this._clickedShareButton&&this._clickedShareButton.focus(),this._copyLinkButton.setAttribute("aria-label",this._templateData.copylink),this._copyEmbedCodeButton.setAttribute("aria-label",this._templateData.copyembed))},g._copyUrl=function(){this._clearTextArea(),this._copyTextArea.value=this._sharingUrl,this._copyLinkButton.classList.add("active"),this._copyLinkButton.setAttribute("aria-label",this._templateData.selectlink),this._showTextArea(!0),this._clickedShareButton=this._copyLinkButton,this._copyTextArea.setAttribute("aria-label",this._templateData.copylink),o(this._copyTextArea)},g._clearTextArea=function(){window.getSelection().removeAllRanges(),this._copyLinkButton.classList.remove("active"),this._copyEmbedCodeButton.classList.remove("active"),this._copyTextArea.removeAttribute("readonly")},g._copyEmbedCode=function(){this._clearTextArea(),this._copyTextArea.value=h(n,{videoid:this._videoid,embedCodePath:this._embedPath,width:this._player.getMediaWidth(),height:this._player.getMediaHeight(),title:this._title,extension:this._hideExtension?"":".html"}),this._copyEmbedCodeButton.classList.add("active"),this._copyEmbedCodeButton.setAttribute("aria-label",this._templateData.selectembed),this._showTextArea(!0),this._clickedShareButton=this._copyEmbedCodeButton,this._copyTextArea.setAttribute("aria-label",this._templateData.copyembed),o(this._copyTextArea)},g._focusFirstButton=function(){this._firstButton||(this._firstButton=c.getTabbableElements(this._sharingButtonContainer)[0]),this._firstButton.focus()},g.show=function(){this._container.classList.add("showing")},g.hide=function(){this._clickedShareButton=null,this._showTextArea(!1),this._container.classList.remove("showing")},g._getClientHeight=function(){return this.el.clientHeight},g._getClientWidth=function(){return this.el.clientWidth},g.destroy=function(){this._removeEventListeners()},g._closeState=function(){this._showTextArea(!1),0===this._player.getCurrentTime()||this._player.getEnded()?this._player.states.setState("initial"):this._player.states.setState("none")},g._getAnalyticsSource=function(){return"drawer"},g._initAnalyticsAttributes=function(e){var t=[];this._facebookButton&&t.push({button:this._facebookButton,title:"facebook",events:"event85"}),this._twitterButton&&t.push({button:this._twitterButton,title:"twitter",events:"event84"}),this._copyLinkButton&&t.push({button:this._copyLinkButton,title:"copy-link",events:"event89"}),this._copyEmbedCodeButton&&t.push({button:this._copyEmbedCodeButton,title:"copy-embed-code",events:"event101"});var i=(-1!==(e.url&&e.url.indexOf(".m3u8"))?"m3u8":"mp4")+" via html5",s=this._getAnalyticsSource(),r=e.videoid,n=document.head.querySelectorAll('meta[property="analytics-track"]');n=n?n[0].getAttribute("content"):"",t.forEach(function(e){e.button.setAttribute("data-analytics-click",""),e.button.setAttribute("data-analytics-share",JSON.stringify({title:r,events:e.events,prop2:n+" - "+r+" - "+e.title,prop18:i,eVar49:document.referrer,eVar54:document.location.href,eVar55:n+" - "+r,eVar70:s}))}.bind(this))},e.exports=p},2503:function(e,t){e.exports='<div class="sharing-state">\n    <div class="container" data-acv-active-area>\n        <div class="social-sharing-container">\n            <div class="sharing-button-container">\n                <button class="acv-fb-share ac-video-icon icon-share_fb" aria-label="{facebookshare}, {newwindow}"></button>\n                <button class="acv-tw-share ac-video-icon icon-share_twitter" aria-label="{twittershare}, {newwindow}"></button>\n                <button class="copy-link ac-video-icon icon-share_link" aria-label="{copylink}"></button>\n                <button class="copy-embed-code ac-video-icon icon-share_embed" aria-label="{copyembed}"></button>\n            </div>\n        </div>\n        <div class="textarea-container">\n            <span>\n                <input class="copy-area form-textbox form-textbox-text disabled" type="text" id="copy-link" aria-label="{copylink}"></input>\n                <button class="textinput-close-button ac-video-icon icon-share_close" aria-label="{dismisscopy}"></button>\n            </span>\n        </div>\n    </div>\n</div>'},2504:function(e,t){e.exports='<iframe src="{embedCodePath}{videoid}{extension}" width="{width}" height="{height}" title="{title}" allowfullscreen></iframe>'},2505:function(e,t,i){"use strict";e.exports=function(e){if("function"===typeof e.select)e.select()||e.setSelectionRange(0,e.value.length);else{var t=document.createRange();t.selectNodeContents(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}}},2506:function(e,t,i){"use strict";e.exports={Link:i(2507),Dialog:i(2528),Focus:i(2529),Debug:i(2530)}},2507:function(e,t,i){"use strict";var s=i(2508),r=i(2527);function n(){var e;for(e in this.types={},s)s.hasOwnProperty(e)&&(a[e]=e,this.addType(e,s[e].generateLink.bind(s[e])))}var a=n.prototype;a.create=function(e,t,i){t=t||{};var s=this.types[e];if(s)return s(t,i)},a.createFromAnchor=function(e){var t,i=e.getAttribute("data-network-action");for(t in s)if(s.hasOwnProperty(t)&&i===s[t].id)return void s[t].enhanceLinkEngagement(e);r.enhanceLinkEngagement(e)},a.addType=function(e,t){return this.types[e]=t,this},a.removeType=function(){return this.types[name]=null,this},e.exports=new n},2508:function(e,t,i){"use strict";var s=i(2509),r=i(2516),n=i(2517),a=i(2518),o=i(2519),l=i(2520),h=i(2521),d=i(2522),c=i(2523),u=i(2524),f=i(2525),p=i(2526);e.exports={FACEBOOK_SHARE:s,PINTEREST_SHARE:r,TUMBLR_SHARE:n,TWITTER_FAVORITE:a,TWITTER_REPLY:o,TWITTER_RETWEET:l,TWITTER_TWEET:h,WEIBO_SHARE:d,QQWEIBO_SHARE:c,QZONE_SHARE:u,RENREN_SHARE:f,EMAIL_SHARE:p}},2509:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{u:e.url}}),{id:"facebook-share",baseLinkPath:"https://www.facebook.com/sharer/sharer.php",dialogDimensions:{width:555,height:368}})},2510:function(e,t,i){"use strict";var s,r=i(2511),n=function(e,t){t=t||{},this.baseLinkPath=t.baseLinkPath,t.dialogDimensions&&(this.dialogDimensions=t.dialogDimensions),t.id&&(this.id=t.id),t.preventDialog&&(this.preventDialog=t.preventDialog),this.normalizeData=e};(s=n.prototype).dataAttributeName="network-action",s.id="network-action",s.normalizeData=function(e){return e},s.dialogDimensions={width:500,height:500},s.generateLinkURL=function(e){var t=this.normalizeData(e),i=r.stringify(t),s=this.baseLinkPath;return i.length>0&&(s=s+"?"+i),s},s.generateLink=function(e,t){var i=this.generateLinkURL(e);return(t=t||document.createElement("A")).setAttribute("href",i),t.setAttribute("target","_blank"),t.setAttribute("data-"+this.dataAttributeName,this.id),this.enhanceLinkEngagement(t,i),t},s.generateDialog=function(e){var t=this.generateLinkURL(e);this._triggerDialog(t)},s.enhanceLinkEngagement=function(e,t){t=t||e.getAttribute("href"),e.addEventListener("click",this._onLinkEngaged.bind(this,t))},s.getDialogOptions=function(){var e,t="status=1",i={width:this.dialogDimensions.width,height:this.dialogDimensions.height};for(e in i.top=(window.screen.availHeight-i.height)/2,i.left=(window.screen.availWidth-i.width)/2,i)i.hasOwnProperty(e)&&(t+=", "+e+"="+i[e]);return t},s.getDialogDebugData=function(e){return{data:this.normalizeData(e),dialogUrl:this.generateLinkURL(e)}},s._triggerDialog=function(e){this.preventDialog?window.location.href=e:window.open(e,"_blank",this.getDialogOptions())},s._onLinkEngaged=function(e,t){t.preventDefault(),this._triggerDialog(e)},e.exports=n},2511:function(e,t,i){e.exports=i(2512)},2512:function(e,t,i){var s=i(2513),r=i(2515);e.exports={stringify:s,parse:r}},2513:function(e,t,i){var s=i(2514),r={delimiter:"&",indices:!0,stringify:function(e,t,i){if(s.isBuffer(e)?e=e.toString():e instanceof Date?e=e.toISOString():null===e&&(e=""),"string"===typeof e||"number"===typeof e||"boolean"===typeof e)return[encodeURIComponent(t)+"="+encodeURIComponent(e)];var n=[];if("undefined"===typeof e)return n;for(var a=Object.keys(e),o=0,l=a.length;o<l;++o){var h=a[o];n=!i.indices&&Array.isArray(e)?n.concat(r.stringify(e[h],t,i)):n.concat(r.stringify(e[h],t+"["+h+"]",i))}return n}};e.exports=function(e,t){var i="undefined"===typeof(t=t||{}).delimiter?r.delimiter:t.delimiter;t.indices="boolean"===typeof t.indices?t.indices:r.indices;var s=[];if("object"!==typeof e||null===e)return"";for(var n=Object.keys(e),a=0,o=n.length;a<o;++a){var l=n[a];s=s.concat(r.stringify(e[l],l,t))}return s.join(i)}},2514:function(e,t){t.arrayToObject=function(e){for(var t={},i=0,s=e.length;i<s;++i)"undefined"!==typeof e[i]&&(t[i]=e[i]);return t},t.merge=function(e,i){if(!i)return e;if("object"!==typeof i)return Array.isArray(e)?e.push(i):e[i]=!0,e;if("object"!==typeof e)return[e].concat(i);Array.isArray(e)&&!Array.isArray(i)&&(e=t.arrayToObject(e));for(var s=Object.keys(i),r=0,n=s.length;r<n;++r){var a=s[r],o=i[a];e[a]?e[a]=t.merge(e[a],o):e[a]=o}return e},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.compact=function(e,i){if("object"!==typeof e||null===e)return e;var s=(i=i||[]).indexOf(e);if(-1!==s)return i[s];if(i.push(e),Array.isArray(e)){for(var r=[],n=0,a=e.length;n<a;++n)"undefined"!==typeof e[n]&&r.push(e[n]);return r}var o=Object.keys(e);for(n=0,a=o.length;n<a;++n){var l=o[n];e[l]=t.compact(e[l],i)}return e},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!==e&&"undefined"!==typeof e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}},2515:function(e,t,i){var s=i(2514),r={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,parseValues:function(e,t){for(var i={},r=e.split(t.delimiter,t.parameterLimit===1/0?void 0:t.parameterLimit),n=0,a=r.length;n<a;++n){var o=r[n],l=-1===o.indexOf("]=")?o.indexOf("="):o.indexOf("]=")+1;if(-1===l)i[s.decode(o)]="";else{var h=s.decode(o.slice(0,l)),d=s.decode(o.slice(l+1));i.hasOwnProperty(h)?i[h]=[].concat(i[h]).concat(d):i[h]=d}}return i},parseObject:function(e,t,i){if(!e.length)return t;var s=e.shift(),n={};if("[]"===s)n=(n=[]).concat(r.parseObject(e,t,i));else{var a="["===s[0]&&"]"===s[s.length-1]?s.slice(1,s.length-1):s,o=parseInt(a,10),l=""+o;!isNaN(o)&&s!==a&&l===a&&o>=0&&o<=i.arrayLimit?(n=[])[o]=r.parseObject(e,t,i):n[a]=r.parseObject(e,t,i)}return n},parseKeys:function(e,t,i){if(e){var s=/(\[[^\[\]]*\])/g,n=/^([^\[\]]*)/.exec(e);if(!Object.prototype.hasOwnProperty(n[1])){var a=[];n[1]&&a.push(n[1]);for(var o=0;null!==(n=s.exec(e))&&o<i.depth;)++o,Object.prototype.hasOwnProperty(n[1].replace(/\[|\]/g,""))||a.push(n[1]);return n&&a.push("["+e.slice(n.index)+"]"),r.parseObject(a,t,i)}}}};e.exports=function(e,t){if(""===e||null===e||"undefined"===typeof e)return{};(t=t||{}).delimiter="string"===typeof t.delimiter||s.isRegExp(t.delimiter)?t.delimiter:r.delimiter,t.depth="number"===typeof t.depth?t.depth:r.depth,t.arrayLimit="number"===typeof t.arrayLimit?t.arrayLimit:r.arrayLimit,t.parameterLimit="number"===typeof t.parameterLimit?t.parameterLimit:r.parameterLimit;for(var i="string"===typeof e?r.parseValues(e,t):e,n={},a=Object.keys(i),o=0,l=a.length;o<l;++o){var h=a[o],d=r.parseKeys(h,i[h],t);n=s.merge(n,d)}return s.compact(n)}},2516:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){var t={url:e.url,description:e.description};return e.media&&(t.media=e.media),t}),{id:"pinterest-share",baseLinkPath:"http://www.pinterest.com/pin/create/button",dialogDimensions:{width:750,height:450}})},2517:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){var t={clickthru:e.url,caption:e.description};return e.media&&(t.source=e.media),t}),{id:"tumblr-share",baseLinkPath:"http://www.tumblr.com/share/photo",dialogDimensions:{width:450,height:432}})},2518:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{tweet_id:e.messageId}}),{id:"twitter-favorite",baseLinkPath:"https://twitter.com/intent/favorite",dialogDimensions:{width:550,height:420}})},2519:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){var t={in_reply_to:e.messageId};return e.hashtags&&(t.hashtags=e.hashtags),t}),{id:"twitter-reply",baseLinkPath:"https://twitter.com/intent/tweet",dialogDimensions:{width:550,height:420}})},2520:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{tweet_id:e.messageId}}),{id:"twitter-retweet",baseLinkPath:"https://twitter.com/intent/retweet",dialogDimensions:{width:550,height:420}})},2521:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){var t={url:e.url,text:e.description};return e.hashtags&&(t.hashtags=e.hashtags),t}),{id:"twitter-tweet",baseLinkPath:"https://twitter.com/intent/tweet",dialogDimensions:{width:550,height:420}})},2522:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{url:e.url,title:e.title,pic:e.media}}),{id:"weibo-share",baseLinkPath:"http://service.weibo.com/share/share.php",dialogDimensions:{width:650,height:426}})},2523:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{url:e.url,title:e.title,pic:e.media}}),{id:"qq-weibo-share",baseLinkPath:"http://v.t.qq.com/share/share.php",dialogDimensions:{width:658,height:506}})},2524:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{url:e.url,title:e.title,pics:e.media,summary:e.description}}),{id:"qzone-share",baseLinkPath:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey",dialogDimensions:{width:620,height:645}})},2525:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return{url:e.url,title:e.title}}),{id:"renren-share",baseLinkPath:"http://www.connect.renren.com/share/sharer",dialogDimensions:{width:500,height:315}})},2526:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){var t={url:e.url};return e.title&&(t.subject=e.title),e.description?t.body=e.description+"\r\n\r\n"+e.url:t.body=e.url,t}),{id:"email-share",baseLinkPath:"mailto:",preventDialog:!0})},2527:function(e,t,i){"use strict";var s=i(2510);e.exports=new s((function(e){return e}),{baseLinkPath:""})},2528:function(e,t,i){"use strict";var s=i(2508);function r(){var e;for(e in this.types={},s)s.hasOwnProperty(e)&&(n[e]=e,this.addType(e,s[e].generateDialog.bind(s[e])))}var n=r.prototype;n.create=function(e,t){t=t||{};var i=this.types[e];if(i)return i(t)},n.addType=function(e,t){return this.types[e]=t,this},n.removeType=function(){return this.types[name]=null,this},e.exports=new r},2529:function(e,t,i){"use strict";e.exports=function(e){if(window.getSelection){var t=window.getSelection();(i=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(i)}else if(e.setSelectionRange)e.setSelectionRange(0,e.value.length);else if(document.body.createTextRange){var i;(i=document.body.createTextRange()).moveToElementText(e),i.select()}}},2530:function(e,t,i){"use strict";var s=i(2508);function r(){var e;for(e in this.types={},s)s.hasOwnProperty(e)&&(n[e]=e,this.addType(e,s[e].getDialogDebugData.bind(s[e])))}var n=r.prototype;n.create=function(e,t){t=t||{};var i=this.types[e];if(i)return i(t)},n.addType=function(e,t){return this.types[e]=t,this},n.removeType=function(){return this.types[name]=null,this},e.exports=new r},2531:function(e,t,i){"use strict";var s=i(2532);e.exports=function(e){return new s(e)}},2532:function(e,t,i){"use strict";var s,r=i(2533),n=i(2448),a=i(2360).EventEmitterMicro,o=i(2535),l=i(2402),h=i(2551),d=i(2552);try{s=i(2397)}catch(g){d.log(g.message)}var c={dataAttribute:"analytics-share",interactionEvents:["click"],autoEnable:!0},u=function(e){e=e||{},this.options=r(c,e),a.call(this),this.elements=[],this.eventObserver=null,this.publishShareClick=this.publishShareClick.bind(this),this.options.autoEnable&&this.enable()},f=a.prototype,p=u.prototype=n(f);p.enable=function(){if(!s)return!1;this._createObserver(),this.bindEventListener()},p.disable=function(){if(!s)return!1;this.unbindEventListener()},p.bindEventListener=function(){var e;this.elements=this.populateElements(),e=this.elements.length;for(var t=0;t<e;t++)l(this.elements[t],"click",this.publishShareClick)},p.unbindEventListener=function(){for(var e=this.elements&&this.elements.length?this.elements.length:0,t=0;t<e;t++)h(this.elements[t],"click",this.publishShareClick)},p.populateElements=function(){return o("[data-"+this.options.dataAttribute+"]",this.options.context||document)},p.publishShareClick=function(e){var t=e.currentTarget,i=this.parseDataAttribute(t.getAttribute("data-"+this.options.dataAttribute));if("object"===typeof i){if(!i.title)return console.log("data-"+this.options.dataAttribute+" attribute must have a `title` property"),!1;this.trigger("click",i)}},p.parseDataAttribute=function(e){var t={};try{t=JSON.parse(e)}catch(g){console.log("data-"+this.options.dataAttribute+" must be a valid JSON string")}return t},p.destroy=function(){this.disable(),this.elements=[],this.eventObserver=null,this.publishShareClick=null,this.options=null},p._createObserver=function(){if(!s||!s.observer||!s.observer.Event)return!1;this.eventObserver=new s.observer.Event(this,this.options)},e.exports=u},2533:function(e,t,i){"use strict";i(2534);var s=Object.prototype.hasOwnProperty;e.exports=function(){var e,t;return e=arguments.length<2?[{},arguments[0]]:[].slice.call(arguments),t=e.shift(),e.forEach((function(e){if(null!=e)for(var i in e)s.call(e,i)&&(t[i]=e[i])})),t}},2534:function(e,t){Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,s,r=Object(this);if("function"!==typeof e)throw new TypeError("No function object passed to forEach.");var n=this.length;for(i=0;i<n;i+=1)s=r[i],e.call(t,s,i,r)})},2535:function(e,t,i){"use strict";i(2536);var s=i(2537),r=i(2545),n="querySelectorAll"in document;e.exports=function(e,t){return t=t||document,s.parentNode(t,!0,"querySelectorAll","context"),s.selector(e,!0,"querySelectorAll"),n?Array.prototype.slice.call(t.querySelectorAll(e)):r(e,t)}},2536:function(e,t){!function(){"use strict";var e=Array.prototype.slice;try{e.call(document.documentElement)}catch(t){Array.prototype.slice=function(t,i){if(i="undefined"!==typeof i?i:this.length,"[object Array]"===Object.prototype.toString.call(this))return e.call(this,t,i);var s,r,n=[],a=this.length,o=t||0,l=i||a;if(i<0&&(l=a+i),(r=l-(o=o>=0?o:a+o))>0)if(n=new Array(r),this.charAt)for(s=0;s<r;s++)n[s]=this.charAt(o+s);else for(s=0;s<r;s++)n[s]=this[o+s];return n}}}()},2537:function(e,t,i){"use strict";i(2538);var s=i(2539),r=i(2540),n=i(2541),a=i(2542),o=i(2543),l=i(2544),h=function(e,t){return!!s(e)&&("number"===typeof t?e.nodeType===t:-1!==t.indexOf(e.nodeType))},d=[o,a,n],c=[o,l,r];e.exports={parentNode:function(e,t,i,s){if(s=s||"node",(e||t)&&!h(e,d))throw new TypeError(i+": "+s+" must be an Element, Document, or Document Fragment")},childNode:function(e,t,i,s){if(s=s||"node",(e||t)&&!h(e,c))throw new TypeError(i+": "+s+" must be an Element, TextNode, or Comment")},selector:function(e,t,i,s){if(s=s||"selector",(e||t)&&"string"!==typeof e)throw new TypeError(i+": "+s+" must be a string")}}},2538:function(e,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i=t||0,s=0;if(i<0&&(i=this.length+t-1)<0)throw"Wrapped past beginning of array while looking up a negative start index.";for(s=0;s<this.length;s++)if(this[s]===e)return s;return-1})},2539:function(e,t,i){"use strict";e.exports=function(e){return!(!e||!e.nodeType)}},2540:function(e,t,i){"use strict";e.exports=8},2541:function(e,t,i){"use strict";e.exports=11},2542:function(e,t,i){"use strict";e.exports=9},2543:function(e,t,i){"use strict";e.exports=1},2544:function(e,t,i){"use strict";e.exports=3},2545:function(e,t,i){"use strict";i(2538);var s=i(2546),r=i(2548),n=i(2549),a=function(e,t){var i;if(t===document)return!0;for(i=e;(i=i.parentNode)&&s(i);)if(i===t)return!0;return!1},o=function(e){"recalc"in e?e.recalc(!1):document.recalc(!1),window.scrollBy(0,0)};e.exports=function(e,t){var i,s=document.createElement("style"),l="_ac_qsa_"+(Math.random()+"").slice(-6),h=[];for(t=t||document,document[l]=[],r(t)?t.appendChild(s):document.documentElement.firstChild.appendChild(s),s.styleSheet.cssText="*{display:recalc;}"+e+'{ac-qsa:expression(document["'+l+'"] && document["'+l+'"].push(this));}',o(t);document[l].length;)(i=document[l].shift()).style.removeAttribute("ac-qsa"),-1===h.indexOf(i)&&a(i,t)&&h.push(i);return document[l]=null,n(s),o(t),h}},2546:function(e,t,i){"use strict";var s=i(2547),r=i(2543);e.exports=function(e){return s(e,r)}},2547:function(e,t,i){"use strict";var s=i(2539);e.exports=function(e,t){return!!s(e)&&("number"===typeof t?e.nodeType===t:-1!==t.indexOf(e.nodeType))}},2548:function(e,t,i){"use strict";var s=i(2547),r=i(2541);e.exports=function(e){return s(e,r)}},2549:function(e,t,i){"use strict";var s=i(2550);e.exports=function(e){return s.childNode(e,!0,"remove"),e.parentNode?e.parentNode.removeChild(e):e}},2550:function(e,t,i){"use strict";var s=i(2547),r=i(2540),n=i(2541),a=i(2543),o=i(2544),l=[a,o,r,n],h=[a,o,r],d=[a,n];e.exports={parentNode:function(e,t,i,r){if(r=r||"target",(e||t)&&!s(e,d))throw new TypeError(i+": "+r+" must be an Element, or Document Fragment")},childNode:function(e,t,i,r){if(r=r||"target",(e||t)&&!s(e,h))throw new TypeError(i+": "+r+" must be an Element, TextNode, or Comment")},insertNode:function(e,t,i,r){if(r=r||"node",(e||t)&&!s(e,l))throw new TypeError(i+": "+r+" must be an Element, TextNode, Comment, or Document Fragment")},hasParentNode:function(e,t,i){if(i=i||"target",!e.parentNode)throw new TypeError(t+": "+i+" must have a parentNode")}}},2551:function(e,t,i){"use strict";var s=i(2447),r=i(2404);e.exports=function(e,t,i,n){return t=r(e,t),s(e,t,i,n)}},2552:function(e,t,i){"use strict";e.exports={log:i(2553)}},2553:function(e,t,i){"use strict";var s=!!function(){try{return window.localStorage.getItem("f7c9180f-5c45-47b4-8de4-428015f096c0")}catch(e){}}();e.exports=function(){window.console&&"undefined"!==typeof console.log&&s&&console.log.apply(console,Array.prototype.slice.call(arguments,0))}},2554:function(e,t,i){function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var n=function(e){var t,i;function n(t,i){var r;return(r=e.call(this,t,i)||this)._player.supportsAirPlay()&&(r._airplayStateChange=r._airplayStateChange.bind(s(r)),r._player.getMediaElement().addEventListener("webkitplaybacktargetavailabilitychanged",r._airplayStateChange),r._updateState=r._updateState.bind(s(r)),r._player.getMediaElement().addEventListener("webkitcurrentplaybacktargetiswirelesschanged",r._updateState)),r}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,r(t,i);var a=n.prototype;return a._airplayStateChange=function(e){"available"===e.availability?this._airplayAvailable=!0:this._airplayAvailable=!1,this._updateState()},a._updateState=function(){this._player.getMediaElement().webkitCurrentPlaybackTargetIsWireless?this._view.setState("on"):this._airplayAvailable?this._view.setState("off"):this._view.setState("initial")},a._onClick=function(){this._player.getMediaElement().webkitShowPlaybackTargetPicker()},a.destroy=function(){this._player.getMediaElement().removeEventListener("webkitplaybacktargetavailabilitychanged",this._airplayStateChange),this._player.getMediaElement().removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",this._updateState),e.prototype.destroy.call(this)},n}(i(2488));e.exports=n},2555:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2488),n=i(2373),a=function(e){var t,i;function r(t,i){var s;return(s=e.call(this,t,i)||this)._updateState=s._updateState.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(s)),s._player.on("timeupdate",s._updateState),s}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var a=r.prototype;return a._updateState=function(){this._player.getDuration()-this._player.getCurrentTime()<n?this._view.setState("on"):this._view.setState("off")},a._onClick=function(){this._player.goToLive()},a.destroy=function(){this._player.off("timeupdate",this._updateState),e.prototype.destroy.call(this)},r}(r);e.exports=a},2556:function(e,t){e.exports={disableForcedCursorPointer:function(){document.body.classList.remove("cursor-pointer"),this.onSelectStartResumeDefault()},forceCursorPointer:function(){document.body.classList.add("cursor-pointer"),this.onSelectStartPreventDefault()},onSelectStartResumeDefault:function(){document.removeEventListener("selectstart",this.preventDefault)},onSelectStartPreventDefault:function(){document.addEventListener("selectstart",this.preventDefault)},preventDefault:function(e){e.preventDefault()}}},2557:function(e,t){e.exports='\n<div class="ac-slider-ax-track" role="slider" aria-valuemin="0" aria-valuemax="1" ></div>\n<div class="ac-slider-runnable-track">\n\t<div class="ac-slider-hover-track">\n\t\t<div class="ac-slider-hover-notch"></div>\n\t</div>\n\t<div class="ac-slider-thumb">\n\t\t<div class="ac-slider-thumb-background-wrapper">\n\t\t\t<div class="ac-slider-thumb-overlay"></div>\n\t\t\t<div class="ac-slider-thumb-background"></div>\n\t\t</div>\n\t</div>\n\t<div class="ac-slider-chapters-track"></div>\n\t<div class="ac-slider-inner-track">\n\t\t<div class="ac-slider-buffered"></div>\n\t\t<div class="ac-slider-scrubbed"></div>\n\t</div>\n</div>\n'},2558:function(e,t){e.exports='\n<div class="ac-slider-runnable-track">\n\t<div class="ac-slider-background"></div>\n\t<div class="ac-slider-thumb-wrapper">\n\t\t<div class="ac-slider-thumb">\n\t\t\t<div class="ac-slider-thumb-background-wrapper">\n\t\t\t\t<div class="ac-slider-thumb-background"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="ac-slider-inner-track">\n\t\t<div class="ac-slider-scrubbed"></div>\n\t</div>\n</div>\n'},2559:function(e,t,i){"use strict";var s=i(2394),r=i(2393),n=i(2415),a=i(2380),o=i(2434)(),l=i(2560),h=i(2565),d=i(2568),c=i(2569),u=i(2570),f=i(2573),p=function(e){this._initialize(e)},g=p.prototype;g._initialize=function(e){this.el=e.element||document.createElement("div"),this._basePath=e.basePath,this._forceEnglishLabels=e.forceEnglishLabels,this.el.style.display="none",this._template=e.template||f,this._templateData=e.templateData||Object.assign({elementClassPrefix:"controls"}),this._destroyed=!1,this._localize().then(function(){this._destroyed||(this._initUIComponents(e),this.el.style.display=""),"function"===typeof e.readyCallback&&e.readyCallback()}.bind(this))},g._localize=function(){return new Promise(function(e){n.getTranslation({callback:function(t){e(t)}.bind(this),basePath:this._basePath,forceEnglishLabels:this._forceEnglishLabels})}.bind(this)).then(function(e){this._templateData=Object.assign(this._templateData,e)}.bind(this))},g._renderTemplateMarkup=function(){var e=s(this._template,this._templateData);this.el.innerHTML=e},g._initDesktopControls=function(e,t){this._componentCollection=a(e,u(t,{elementClassPrefix:this._templateData.elementClassPrefix,elapsedTimeIndicator:{behavior:{observe:{source:this._player,events:["loadstart","timeupdate","seeking","seeked","durationchange"],update:function(e){if(this._player.isDvr()){var t=this._player.getCurrentTime();e.setText(isNaN(t)?"0:00:00":r.formatTime(t,1/0,2))}else e.setText(r.formatTime(this._player.getCurrentTime(),this._player.getDuration()))}.bind(this)}}},remainingTimeIndicator:{behavior:{observe:{source:this._player,events:["timeupdate","seeking","seeked","durationchange"],update:function(e){e.setText(r.formatTime(this._player.getCurrentTime()-this._player.getDuration(),this._player.getDuration()))}.bind(this)}}},volumeLevel:{view:{options:{value:this._player.getMuted()?0:100*this._player.getVolume()}}},playPauseContainer:{view:{options:{labels:{playing:this._templateData.pause,paused:this._templateData.play,ended:this._templateData.replay}}}},fullScreen:{view:{options:{labels:{initial:this._templateData.fullscreen,on:this._templateData.exitfullscreen,off:this._templateData.fullscreen}}}},pictureInPictureToggle:{view:{options:{labels:{initial:this._templateData.pictureinpicture,on:this._templateData.exitpictureinpicture,off:this._templateData.pictureinpicture}}}}}),{player:this._player,localization:this._templateData})},g._initUIComponents=function(e){this._player=e.player;var t=this.el,i=e.components;t.classList.add(e.className||"ac-video-controls"),this._renderTemplateMarkup();var s=t.querySelector(".main-controls-container");s&&(e.enableMainControls?(s.classList.add("control-bar-skin-default"),this.mainControlsElement=s):s.parentElement.removeChild(s));var r=t.querySelector(".end-state-container");r&&(this.endState=new h(Object.assign({},{el:r,player:this._player},e.endState))),e.threesixty&&(this.compass=new d({rootElement:t,player:this._player})),this._initDesktopControls(t,i);var n=this._componentCollection.components.socialShare;this.sharingModule=n&&n.length?n[0].behavior.sharingModule:null,this._componentCollection.components.progressBar.length&&(this.scrubberView=this._componentCollection.components.progressBar[0].view),this.playButtonElement=this.el.querySelector(".controls-play-pause-button"),o&&e.enableMainControls&&(this.overlays=new l({el:this.el.querySelector(".ac-video-overlay-container"),player:this._player})),this._loadingIndicator=new c({player:this._player,el:this.el.querySelector(".loading-indicator-container")})},g.destroy=function(){this._componentCollection&&(this._componentCollection.destroy(),this._componentCollection=null),this._loadingIndicator&&(this._loadingIndicator.destroy(),this._loadingIndicator=null),this.overlays&&this.overlays.destroy(),this._destroyed=!0,this._player=null,this._templateData=null},e.exports=p},2560:function(e,t,i){"use strict";var s=i(2561),r=function(e){this.el=e.el,this._player=e.player,this._popUp=new s(e),this.el.appendChild(this._popUp.el)},n=r.prototype;n.setData=function(e){this._popUp.setData(e)},n.show=function(){this.el.classList.remove("hidden"),this._popUp.show()},n.hide=function(){this.el.classList.add("hidden"),this._popUp.hide()},n.setPopUpPosition=function(e){this._popUp.setPopUpPosition(e)},n.destroy=function(){this._popUp.destroy()},e.exports=r},2561:function(e,t,i){"use strict";var s=i(2562),r=i(2393),n=i(2563),a=i(2564),o=i(2373),l=function(e){this._player=e.player,this.el=document.createElement("div"),this.el.style.opacity="0",this.el.innerHTML=s,this._player.isDvr()?this._liveStreamLookback=o:this._liveStreamLookback=0,this._thumbnailHandler=new n({el:this.el.querySelector(".ac-video-trickplay-image"),player:this._player,numberOfImages:e.numberOfImages}),this._timeLabel=this.el.querySelector(".ac-video-trickplay-time"),this._chapterLabel=this.el.querySelector(".ac-video-trickplay-chapter-title"),this._bindMethods(),this._addEventListeners()},h=l.prototype;h._initPointerTracking=function(){this._scrubberView=this._player.controls.scrubberView,this._scrubberView&&(this._runnableTrack=this._scrubberView.el.querySelector(".ac-slider-runnable-track"),this._calcOffsets(),this._scrubberView.el.addEventListener("mouseover",this.show),this._scrubberView.el.addEventListener("mouseout",this.hide),this._scrubberView.el.addEventListener("focusin",this._onScrubberFocusIn),this._scrubberView.el.addEventListener("focusout",this._onScrubberFocusOut),this._scrubberView.el.addEventListener("mousedown",this._startScrubbing),this._scrubberView.el.addEventListener("mouseup",this._endScrubbing),this._scrubberView.el.addEventListener("mousemove",this._onTrackerUpdate),this._scrubberView.el.addEventListener("mousemove",this._setThumbnail),this._player.on("resize",this._throttledCalcOffsets),window.addEventListener("resize",this._throttledCalcOffsets))},h._bindMethods=function(){this.show=this.show.bind(this),this.hide=this.hide.bind(this),this._onDurationChange=this._onDurationChange.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._startScrubbing=this._startScrubbing.bind(this),this._endScrubbing=this._endScrubbing.bind(this),this._initPointerTracking=this._initPointerTracking.bind(this),this._onTrackerUpdate=this._onTrackerUpdate.bind(this),this._setThumbnail=this._setThumbnail.bind(this),this._calcOffsets=this._calcOffsets.bind(this),this._onScrubberFocusIn=this._onScrubberFocusIn.bind(this),this._onScrubberFocusOut=this._onScrubberFocusOut.bind(this),this._throttledCalcOffsets=a(this._calcOffsets,30)},h._startScrubbing=function(e){this._thumbnailHandler.el.classList.add("hidden"),this._scrubberView.el.removeEventListener("mousemove",this._setThumbnail),this._scrubberView.el.removeEventListener("mouseout",this.hide),document.addEventListener("mouseup",this._endScrubbing),document.addEventListener("mousemove",this._onTrackerUpdate)},h._endScrubbing=function(e){e.target===this._scrubberView.el&&this.hide(),this._scrubberView.el.addEventListener("mousemove",this._setThumbnail),this._scrubberView.el.addEventListener("mouseout",this.hide),document.removeEventListener("mouseup",this._endScrubbing),document.removeEventListener("mousemove",this._onTrackerUpdate),this._setThumbnail(e),this._thumbnailHandler.el.classList.remove("hidden")},h._calcOffsets=function(){this._onLoadedMetaData();var e=this._player.el.getBoundingClientRect();this._offsetLeft=e.left;var t=this._runnableTrack.getBoundingClientRect();this._leftBoundary=t.left-this._offsetLeft,this._rightBoundary=t.right-this._offsetLeft,this._imgWidth=this.el.firstElementChild.getBoundingClientRect().width},h._onLoadedMetaData=function(){var e=this._player.getMediaElement().videoWidth,t=this._player.getMediaElement().videoHeight,i=-1!==(this._player.getCurrentSrc()||"").indexOf("-tft-");this.el.classList.remove("square-video"),this.el.classList.remove("vertical-video"),this.el.classList.remove("tft-video"),i?(this.el.classList.add("tft-video"),this._thumbnailHandler.setVertical(!1)):e<t?(this.el.classList.add("vertical-video"),this._thumbnailHandler.setVertical(!0)):e===t?(this.el.classList.add("square-video"),this._thumbnailHandler.setVertical(!1)):this._thumbnailHandler.setVertical(!1)},h._addEventListeners=function(){this._player.on("durationchange",this._onDurationChange),this._player.once("controlsready",this._initPointerTracking),this._player.on("loadedmetadata",this._calcOffsets)},h._removeEventListeners=function(){this._player.off("durationchange",this._onDurationChange),this._player.off("controlsready",this._initPointerTracking),this._player.off("canplaythrough",this._canPlayThroughHander),this._player.off("playing",this._canPlayThroughHander),this._player.off("loadedmetadata",this._calcOffsets),this._player.off("resize",this._throttledCalcOffsets),window.removeEventListener("resize",this._throttledCalcOffsets),this._scrubberView.el.removeEventListener("mouseover",this.show),this._scrubberView.el.removeEventListener("mouseout",this.hide),this._scrubberView.el.removeEventListener("focusin",this._onScrubberFocusIn),this._scrubberView.el.removeEventListener("focusout",this._onScrubberFocusOut),this._scrubberView.el.removeEventListener("mouseout",this.hide),this._scrubberView.el.removeEventListener("mousemove",this._onTrackerUpdate),this._scrubberView.el.removeEventListener("mousemove",this._setThumbnail),document.removeEventListener("mouseup",this._endScrubbing),document.removeEventListener("mousemove",this._onTrackerUpdate)},h._getDuration=function(){return this._cachedDuration&&isNaN(this._cachedDuration)||(this._cachedDuration=Math.max(0,this._player.getDuration()-this._liveStreamLookback)),this._cachedDuration},h.setPopUpPosition=function(e){this.show();var t=e/this.getDuration()*(this._rightBoundary-this._leftBoundary)-this._imgWidth/2-1,i=this._leftBoundary+t;this.el.firstElementChild.style.left=i+"px",this._time=e,this._timeLabel.innerText=r.formatTime(e,this._getDuration()),this._refreshChapter(),this._setThumbnail()},h._onScrubberFocusIn=function(e){if(e.target.classList.contains("ac-slider-chapter-container")){this._calcOffsets();var t=Array.from(e.target.parentElement.children).indexOf(e.target),i=this._player.getChapters()[t]["start-time"];this.setPopUpPosition(i),this.show()}},h._onScrubberFocusOut=function(e){this.hide()},h._onTrackerUpdate=function(e){this._calcOffsets();var t=Math.min(Math.max(e.clientX-this._offsetLeft,this._leftBoundary),this._rightBoundary);this.el.firstElementChild.style.left=t-this._imgWidth/2+"px";var i=this._scrubberView.getClientXValue(e);this._cachedTrackerUpdate=e,this._setTimeFromPercentPosition(Math.max(i,0))},h._onDurationChange=function(e){this._cachedDuration=Math.max(0,this._player.getDuration()-this._liveStreamLookback),this._cachedTrackerUpdate&&(this._onTrackerUpdate(this._cachedTrackerUpdate),this._setThumbnail()),this.el.style.opacity="1"},h._setThumbnail=function(e){this._thumbnailHandler.setTime(this._time,this._getDuration())},h._setTimeFromPercentPosition=function(e){var t=e/this._scrubberView.getMax();this._time=Math.min(t*this._getDuration(),this._getDuration());var i=r.formatTime(this._time,this._getDuration());this._timeLabel.innerText=i,this._refreshChapter()},h._refreshChapter=function(){var e=this._player.getChapterForTime(this._time,0);if(e&&e.titles.length){var t=e.titles.find((function(e){return"en"===e.language}))||e.titles[0];this._chapterLabel.innerText=t.title,this._chapterLabel.classList.remove("hidden")}else this._chapterLabel.classList.add("hidden")},h.setData=function(e){this.el.style.opacity="0",this._canPlayThroughHander&&(this._player.off("canplaythrough",this._canPlayThroughHander),this._player.off("playing",this._canPlayThroughHander),this._canPlayThroughHander=null),e&&this._player.getReadyState()>2?(this.el.style.opacity="1",this._thumbnailHandler.setData(e),this._cachedTrackerUpdate&&(this._onTrackerUpdate(this._cachedTrackerUpdate),this._setThumbnail())):(this._thumbnailHandler.setData(null),e?(this._canPlayThroughHander=this.setData.bind(this,e),this._player.on("canplaythrough",this._canPlayThroughHander),this._player.on("playing",this._canPlayThroughHander)):this.el.style.opacity="1"),this._onLoadedMetaData()},h.show=function(e){e&&this._onTrackerUpdate(e),this.el.firstElementChild.classList.remove("hidden")},h.hide=function(){this.el.firstElementChild.classList.add("hidden")},h.destroy=function(){this._canPlayThroughHander&&(this._player.off("canplaythrough",this._canPlayThroughHander),this._player.off("playing",this._canPlayThroughHander)),this._removeEventListeners(),this._throttledCalcOffsets&&this._throttledCalcOffsets.cancel(),this._scrubberView=null},e.exports=l},2562:function(e,t){e.exports='<div class="ac-video-trickplay hidden" aria-hidden="true">\n    <div class="ac-video-trickplay-image">\n    </div>\n    <div class="ac-video-trickplay-chapter-title"></div>\n    <div class="ac-video-trickplay-time"></div>\n</div>'},2563:function(e,t,i){"use strict";var s=function(e){this.el=e.el,this._player=e.player,this._imgWidth=e.imgWidth||144,this.el.style.backgroundSize=100*this._numberOfImages+"% 100%"},r=s.prototype;r.setVertical=function(e){this._imgWidth=e?81:144},r.getWidth=function(){return this._imgWidth},r.setData=function(e){if(!e)return this._imgUrl=null,void(this.el.style.backgroundImage="");if(e.url!==this._imgUrl){this._imgUrl=e.url,this._numberOfImages=parseInt(e.numberOfImages||120),this.el.style.backgroundSize=100*this._numberOfImages+"% 100%",this.el.style.backgroundImage="",this.el.classList.add("hidden");var t=this._loadImage(this._imgUrl).then(function(){this._imageLoadPromise===t&&(this.el.style.backgroundImage='url("'+this._imgUrl+'")',this._imageLoadPromise=null,this.el.classList.remove("hidden"))}.bind(this));this._imageLoadPromise=t}},r._loadImage=function(e){return new Promise((function(t,i){var s=new Image;s.onload=function(){t()},s.onerror=function(){i()},s.src=e}))},r.setTime=function(e,t){var i=e/t,s=Math.min(Math.round(i*this._numberOfImages),this._numberOfImages-1)/(this._numberOfImages-1)*100;this.el.style.backgroundPositionX=s+"%"},r.destroy=function(){this._imageLoadPromise&&this._imageLoadPromise.cancel()},e.exports=s},2564:function(e,t,i){"use strict";e.exports=function(e,t){var i=null,s=function(){null===i&&(e.apply(this,arguments),i=setTimeout((function(){i=null}),t))};return s.cancel=function(){clearTimeout(i)},s}},2565:function(e,t,i){"use strict";var s=i(2566),r=function(e){this.el=e.el,this._player=e.player,this._addItems(e.items||[])},n=r.prototype;n._addItems=function(e){this._items=[],e.forEach(function(e){var t=document.createElement("div");t.classList.add("end-state-item");var i=new s(Object.assign({},e,{el:t,player:this._player}));this.el.appendChild(t),this._items.push(i)}.bind(this))},n.setData=function(e){for(;this._items.length;)this._items.pop().destroy();this.el.innerHTML="",e?(this.el.classList.remove("hidden"),this._addItems(e.items)):this.el.classList.add("hidden")},n.destroy=function(){for(;this._items.length;)this._items.pop().destroy()},e.exports=r},2566:function(e,t,i){"use strict";var s=i(2567),r=function(e){this.el=e.el,this.el.innerHTML=s,this._player=e.player,this._bindContent(e)},n=r.prototype;n._bindContent=function(e){if("link"===e.type||"video"===e.type){var t=this.el.querySelector(".end-state-link"),i=document.createElement("div");t.classList.remove("hidden"),i.classList.add("end-state-text-container"),i.innerText=e.label||"",t.href=e.url||"",t.appendChild(i),"link"===e.type?t.classList.add("icon","icon-after","icon-chevronright"):"video"===e.type&&t.classList.add("icon","icon-after","icon-playcircle"),this._bindAction(this.el,e)}},n._bindAction=function(e,t){"function"===typeof t.onclick?e.onclick=function(e){e.preventDefault(),t.onclick.call(null,e)}.bind(this):"video"===t.type&&t.url&&(e.onclick=function(e){e.preventDefault(),this._player.load(t.url,null,0,{})}.bind(this))},n.destroy=function(){},e.exports=r},2567:function(e,t){e.exports='<a class="end-state-link hidden"></a>'},2568:function(e,t,i){var s=i(2446),r=i(2365),n=r.os.ios||r.os.android,a=i(2397),o=function(){function e(e){this._rootElement=e.rootElement,this._player=e.player,this._360=this._player.get360(),this.el=this._rootElement.querySelector(".compass-wrapper"),this.compassRing=this.el.querySelector(".compass-ring"),this.compassField=this.el.querySelector(".compass-field"),this.compass=this.el.querySelector(".compass"),this.compassArrows=this.el.querySelector(".compass-arrows"),this.compassArrowLeft=this.el.querySelector(".compass-arrow-left"),this.compassArrowRight=this.el.querySelector(".compass-arrow-right"),this.compassArrowTop=this.el.querySelector(".compass-arrow-top"),this.compassArrowBottom=this.el.querySelector(".compass-arrow-bottom"),this._keyboard=new s(this.el),this._arrowControls=this._player.get360().arrowControls,this._bindMethods(),this._addEventListeners()}var t=e.prototype;return t._bindMethods=function(){this._onFocusIn=this._onFocusIn.bind(this),this._onFocusOut=this._onFocusOut.bind(this),this._onCompassClick=this._onCompassClick.bind(this),this._onCompassMouseEnter=this._onCompassMouseEnter.bind(this),this._onCompassMouseLeave=this._onCompassMouseLeave.bind(this),this._onCompassFocusIn=this._onCompassFocusIn.bind(this),this._onCompassFocusOut=this._onCompassFocusOut.bind(this),this._onRotationTransitionEnd=this._onRotationTransitionEnd.bind(this),this._onCompassArrowsClick=this._onCompassArrowsClick.bind(this),this._on360PositionChange=this._on360PositionChange.bind(this),this._on360IconUpdate=this._on360IconUpdate.bind(this),this._transitionTiming=this._transitionTiming.bind(this)},t._addEventListeners=function(){this._player.once("controlsready",function(){n||(this.compass.addEventListener("mouseenter",this._onCompassMouseEnter),this.compass.addEventListener("mouseleave",this._onCompassMouseLeave)),this.el.addEventListener("focusin",this._onFocusIn),this.el.addEventListener("focusout",this._onFocusOut),this.compass.addEventListener("click",this._onCompassClick),this.compass.addEventListener("focusin",this._onCompassFocusIn),this.compass.addEventListener("focusout",this._onCompassFocusOut),this.compassArrows.addEventListener("click",this._onCompassArrowsClick),this._360.on(a.POSITION_CHANGE,this._on360PositionChange),this._360.on(a.ROTATION_START,this._transitionTiming),this._360.on(a.ROTATION_COMPLETE,this._onRotationTransitionEnd)}.bind(this))},t._removeEventListeners=function(){this.el.removeEventListener("focusin",this._onFocusIn),this.el.removeEventListener("focusout",this._onFocusOut),this.compass.removeEventListener("click",this._onCompassClick),this.compass.removeEventListener("focusin",this._onCompassFocusIn),this.compass.removeEventListener("focusout",this._onCompassFocusOut),this.compass.removeEventListener("mouseenter",this._onCompassMouseEnter),this.compass.removeEventListener("mouseleave",this._onCompassMouseLeave),this.compassArrows.removeEventListener("click",this._onCompassArrowsClick),this._360.off(a.POSITION_CHANGE,this._on360PositionChange),this._360.off(a.ROTATION_START,this._transitionTiming),this._360.off(a.ROTATION_COMPLETE,this._onRotationTransitionEnd)},t._showCompassArrows=function(){this.el.classList.add("show-arrows")},t._hideCompassArrows=function(){this.el.classList.remove("show-arrows")},t._onRotationTransitionEnd=function(){this._compassIsRotating=!1,this._360.off(a.ROTATION_UPDATE,this._on360IconUpdate)},t._transitionTiming=function(e){var t=e.time,i=this._get360HorizontalAngle();this._compassIsRotating=!0,this.compassRing.style.transition="transform "+t+"ms cubic-bezier(0.25,0.1,0,1)",this.compassField.style.transition="transform "+t+"ms cubic-bezier(0.25,0.1,0,1)",i>180||i<-180?(this.compassRing.style.transform="rotate(360deg)",this.compassField.style.transform="rotate(360deg)"):(this.compassRing.style.transform="rotate(0deg)",this.compassField.style.transform="rotate(0deg)")},t._on360IconUpdate=function(e){this.compassRing.style.transition="transform 0.1s ease",this.compassRing.style.transform="rotate("+e.currentPosition.lon+"deg)",this.compassField.style.transition="transform 0.1s ease",this.compassField.style.transform="rotate("+e.currentPosition.lon+"deg)"},t._onCompassClick=function(e){this._compassIsRotating||(this._player.get360().isAtOrigin?(this._360.on(a.ROTATION_UPDATE,this._on360IconUpdate),this._player.get360().oscillateLongitude()):this._player.panToOrigin())},t._onCompassArrowsClick=function(e){switch(e.target){case this.compassArrowLeft:this._arrowControls.leftArrowDown(e),this._arrowControls.leftArrowUp(e);break;case this.compassArrowRight:this._arrowControls.rightArrowDown(e),this._arrowControls.rightArrowUp(e);break;case this.compassArrowTop:this._arrowControls.upArrowDown(e),this._arrowControls.upArrowUp(e);break;case this.compassArrowBottom:this._arrowControls.downArrowDown(e),this._arrowControls.downArrowUp(e)}},t._onFocusIn=function(e){e.target!==this.compass&&this._showCompassArrows()},t._onFocusOut=function(e){this._hideCompassArrows()},t._onCompassFocusIn=function(e){this._rotateFieldOfViewToOrigin()},t._onCompassFocusOut=function(e){var t=this._get360HorizontalAngle();this.compassField.style.transform="rotate("+t+"deg)"},t._rotateFieldOfViewToOrigin=function(){var e=this._get360HorizontalAngle();this.compassField.style.transition="transform 0.3s ease",this.compassField.style.transform=e>180?"rotate(360deg)":e<-180?"rotate(-360deg)":"rotate(0deg)"},t._onCompassMouseEnter=function(e){this._hovering=!0,this._compassIsRotating||this._rotateFieldOfViewToOrigin()},t._onCompassMouseLeave=function(e){if(this._hovering=!1,!this._compassIsRotating){var t=this._get360HorizontalAngle();this.compassField.style.transition="transform 0.3s ease",this.compassField.style.transform="rotate("+t+"deg)"}},t._on360PositionChange=function(){var e=this._get360HorizontalAngle();this.compassRing.style.transition="none",this.compassRing.style.transform="rotate("+e+"deg)",this._hovering||(this.compassField.style.transition="none",this.compassField.style.transform="rotate("+e+"deg)")},t._get360HorizontalAngle=function(){return this._player.get360().position.lon%360},t.destroy=function(){this._removeEventListeners()},e}();e.exports=o},2569:function(e,t,i){var s=i(2415),r=function(){function e(e){var t=this;this._player=e.player,this.el=e.el,this.el.innerHTML='<div class="loading-indicator">\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n\t\t<div></div>\n    </div>',this._ariaSpan=this._player.controls.el.querySelector("#loading-status"),this._ariaString="",s.getTranslation({callback:function(e){t._ariaString=e.loading,t._isShowing()&&(t._ariaSpan.innerText=t._ariaString)}}),this._showTimeoutDelay=void 0!==e.showTimeoutDelay?e.showTimeoutDelay:500,this._bindMethods(),this._addEventListeners()}var t=e.prototype;return t._bindMethods=function(){this.show=this.show.bind(this),this.hide=this.hide.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeking=this._onSeeking.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onPause=this._onPause.bind(this),this._onEnded=this._onEnded.bind(this),this._onError=this._onError.bind(this),this._doShow=this._doShow.bind(this),this._checkLoadingState=this._checkLoadingState.bind(this),this._onPlay=this._onPlay.bind(this),this._onMouseOut=this._onMouseOut.bind(this)},t._addEventListeners=function(){this._player.on("waiting",this.show),this._player.on("seeking",this._onSeeking),this._player.on("seeked",this._onSeeked),this._player.on("playing",this._onPlaying),this._player.on("ended",this._onEnded),this._player.on("canplaythrough",this._checkLoadingState),this._player.on("progress",this._checkLoadingState),this._player.on("error",this._onError),this._player.on("pause",this._onPause),this._player.on("timeupdate",this._checkLoadingState),this._player.on("play",this._onPlay),this._player.controls&&this._player.controls.el.addEventListener("mouseout",this._onMouseOut)},t._removeEventListeners=function(){this._player.off("waiting",this.show),this._player.off("seeking",this._onSeeking),this._player.off("seeked",this._onSeeked),this._player.off("playing",this._onPlaying),this._player.off("ended",this._onEnded),this._player.off("canplaythrough",this._checkLoadingState),this._player.off("progress",this._checkLoadingState),this._player.off("error",this._onError),this._player.off("pause",this._onPause),this._player.off("timeupdate",this._checkLoadingState),this._player.off("play",this._onPlay),this.el.removeEventListener("click",this._onClick),this._player.controls&&this._player.controls.el.removeEventListener("mouseout",this._onMouseOut)},t._onPause=function(){this._isPaused=this._player.getPaused(),this._isPaused&&this.hide()},t._onPlaying=function(){this._isPaused=this._player.getPaused(),this._started=!0,this._checkLoadingState()},t._onPlay=function(){!this._isPaused&&this._started||(this._isPaused=this._player.getPaused(),this._isPaused||(this._started=!0),this._isSeeking=!1,this._checkLoadingState(!0))},t._onSeeking=function(){this._isSeeking=!0,this.show()},t._onSeeked=function(){this._isSeeking=!1,this._checkLoadingState()},t._onEnded=function(){this._started=!1,this.hide()},t._onError=function(){this._started&&this.show(!0)},t._onMouseOut=function(){this._player.isStalled()||this._player.el.classList.remove("was-loading")},t.show=function(e){this._isPaused||(!0!==e&&this._started?(clearTimeout(this._showTimeout),this._showTimeout=setTimeout(this._doShow,this._showTimeoutDelay)):this._doShow())},t._checkLoadingState=function(e){!this._player.getEnded()&&this._started&&(this._player.isStalled()||this._isSeeking)?this.show(!0===e):this.hide()},t._isShowing=function(){return this._player.el.classList.contains("loading")},t._doShow=function(){this._player.el.classList.add("loading"),this._player.el.classList.remove("was-loading"),this._ariaSpan.innerText=this._ariaString},t.hide=function(){clearTimeout(this._showTimeout),this._isShowing()&&(this._player.el.classList.remove("loading"),this._player.el.classList.contains("user-hover")||this._player.el.classList.add("was-loading"),this._ariaSpan.innerText="")},t.destroy=function(){this._removeEventListeners()},e}();e.exports=r},2570:function(e,t,i){"use strict";var s=i(2571);e.exports=function e(){var t=Array.prototype.slice.call(arguments);if(t.length<2)return s(t[0]);var i=s(t.shift(),!0),r=t.shift();for(var n in r)r.hasOwnProperty(n)&&(i.hasOwnProperty(n)&&"object"===typeof i[n]?"object"===typeof i[n]&&"object"===typeof r[n]&&(i[n]=e(i[n],r[n])):i[n]=r[n]);return t.length?e.apply(null,[i].concat(t)):i}},2571:function(e,t,i){"use strict";i(2572);var s=i(2533),r=Object.prototype.hasOwnProperty;e.exports=function(e,t){return t?function e(t,i){var s;for(s in i)r.call(i,s)&&(null===i[s]?t[s]=null:"object"===typeof i[s]?(t[s]=Array.isArray(i[s])?[]:{},e(t[s],i[s])):t[s]=i[s]);return t}({},e):s({},e)}},2572:function(e,t){Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})},2573:function(e,t){e.exports='\n<div class="controls-container">\n\t<div class="{elementClassPrefix}-social-tray hidden"></div>\n\n\t<div class="center-button-container {elementClassPrefix}-play-pause-button-container">\n\t\t<div class="button-wrapper">\n\t\t\t<button type="button" class="ac-video-icon centered-button {elementClassPrefix}-play-pause-button {elementClassPrefix}-button no-autoplay" value="{playpause}" aria-label="{playpause}" role="button" tabindex="0" data-acv-active-area data-acv-draggable-area>\n\t\t\t\t<div class="loading-indicator-container"></div>\n\t\t\t</button>\n\t\t\t<span id=\'loading-status\' class="acv-visually-hidden" aria-live=\'polite\'></span>\n\t\t</div>\t\t\n\t</div>\n\n\t<div class="main-controls-container">\n\t\t<div class="ac-video-overlay-container"></div>\n\t\t<div class="main-controls">\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<div class="main-controls-item controls-volume">\n\t\t\t\t\t<button type="button" class="ac-video-icon {elementClassPrefix}-toggle-mute-volume-button {elementClassPrefix}-button" value="{togglemutevolume}" aria-label="{togglemutevolume}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t\t\t<div class="{elementClassPrefix}-volume-level-indicator" tabindex="0" aria-valuemin="0" aria-valuemax="100" min="0" max="100" aria-label="{adjustvolume}" role="slider" aria-orientation="vertical" step="0.05" data-acv-active-area></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<button type="button" class="ac-video-icon main-controls-item {elementClassPrefix}-text-tracks-toggle-button {elementClassPrefix}-button no-text-tracks" value="{captionscontrol}" aria-label="{captionscontrol}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t\t<div class="ac-video-captions-selector-container">\n\t\t\t\t\t<span class="ac-video-captions-selector-title">{subtitlescontrol}</span>\n\t\t\t\t\t<ul class="{elementClassPrefix}-captions-selector" role="radiogroup" aria-label="{subtitlescontrol}" data-acv-active-area></ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="main-controls-item controls-progress">\n\t\t\t\t<div class="controls-progress-time controls-progress-time-1">\n\t\t\t\t\t<div class="{elementClassPrefix}-elapsed-time-indicator" role="text" tabindex="-1">\n\t\t\t\t\t\t<span class="label">{elapsed}</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-elapsed-time">00:00</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-time-maxwidth" aria-hidden="true">44:44</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="controls-progress-bar">\n\t\t\t\t\t<div class="{elementClassPrefix}-buffered-indicator"></div>\n\t\t\t\t\t<div class="{elementClassPrefix}-progress-indicator ac-slider-inactive" aria-label="progress-indicator" role="slider" precision="float" min="0" max="1" step="0.0005" value="0" tabindex="0" aria-valuemax="1" aria-valuemin="0" aria-valuenow="{value}" data-acv-active-area></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="controls-progress-time controls-progress-time-2">\n\t\t\t\t\t<div class="{elementClassPrefix}-remaining-time-indicator" role="text" tabindex="-1">\n\t\t\t\t\t\t<span class="label">{remaining}</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-remaining-time">-00:00</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-time-maxwidth" aria-hidden="true">-44:44</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n                <div class="controls-progress-time controls-progress-dvr-label-container" role="button">\n                    \n                        <span class="live-stream-dvr-text">{live}</span>\n                    \n                </div>\t\n\t\t\t</div>\n\n\t\t\t<div class="main-controls-item live-stream">\n\t\t\t\t<span class="live-stream-text">{livestream}</span>\n\t\t\t</div>\n\t\t\t\n\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<button type="button" class="ac-video-icon main-controls-item {elementClassPrefix}-airplay-button {elementClassPrefix}-button airplay-unsupported" value="{airplay}" aria-label="{airplay}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t</div>\n\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<button type="button" class="ac-video-icon main-controls-item {elementClassPrefix}-picture-in-picture-button {elementClassPrefix}-button picture-in-picture-unsupported" value="{pictureinpicture}" aria-label="{pictureinpicture}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t</div>\n\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<button type="button" class="ac-video-icon main-controls-item {elementClassPrefix}-full-screen-button {elementClassPrefix}-button fullscreen-unsupported" value="{fullscreen}" aria-label="{fullscreen}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\t</div>\n\n\t<div class="end-state-wrapper">\n\t\t<div class="end-state-container"></div>\n\t</div>\n\n\n</div>\n\n<div class="compass-wrapper" data-acv-active-area>\n\t<div class="compass-background ac-video-icon"></div>\n\t<div class="compass-arrows">\n\t\t<button class="compass-arrow-top ac-video-icon" aria-label="{threesixtyup}" role="button" tabindex="0"></button>\n\t\t<button class="compass-arrow-right ac-video-icon" aria-label="{threesixtyright}" role="button" tabindex="0"></button>\n\t\t<button class="compass-arrow-bottom ac-video-icon" aria-label="{threesixtydown}" role="button" tabindex="0"></button>\n\t\t<button class="compass-arrow-left ac-video-icon" aria-label="{threesixtyleft}" role="button" tabindex="0"></button>\n\t</div>\n\t<div class="compass-field ac-video-icon"></div>\n\t<div class="compass-ring ac-video-icon"></div>\n\t<button class="compass" aria-label="{threesixtyicon}" role="button" tabindex="0"></button>\n</div>\n'},2574:function(e,t,i){"use strict";var s={components:i(2464),controlsImplementation:i(2559)};e.exports=function(e){e=e||{};var t=Object.assign({},s,e);return{create:function(i){var r=Object.assign({},t,i);return r.components=e.components||s.components,new r.controlsImplementation(r)}}}},2575:function(e,t,i){"use strict";e.exports=i(2576)},2576:function(e,t,i){"use strict";var s=i(2394),r=/_r[0-9].+\.mov$/,n=/_[0-9]+x[0-9].+\.mp4$/,a=/_[0-9]+x[0-9].+\.(mp4|m3u8)$/,o=/_[0-9]+x[0-9]*.+\.(mp4|m3u8)/,l=/_([0-9]+)x([0-9]+)/,h=/-tpl-.*-/,d=/-cc-[a-z].*-/,c=/-tft-.*-/,u=i(2577),f=i(2578),p=i(2579),g=i(2580),m=function(e,t){return e.find((function(e){return e.width===t.width&&(e.height=t.height)||e.width===t.height&&(e.height=t.width)}))};e.exports={getVideoSource:function(e,t,i,o){var h,d;l.test(e);var y,v={};if(v.width=parseInt(RegExp.$1,10),v.height=parseInt(RegExp.$2,10),e.match(c))h=p,d=1536;else if(v.width===v.height)h=u,d=1080;else if(e.match(r)||m(f,v))h=f,d=1280;else{if(!m(g,v))return e;h=g,d=1624}v.width<v.height&&(y=!0);var _,b=h[0].width,T=o&&o.maxWidth?Math.max(o.maxWidth,b):d;if(!e)throw"Must provide an url to optimize";if(void 0===t||isNaN(t))throw"Must provide a width";0===t&&(t=v.width),i&&(h=h.filter((function(e){return e.type===i}))),T<1920&&(h=h.filter((function(e){return e.width<=T}))),(_=y?h.reduce((function(e,i){return Math.abs(i.height-t)<Math.abs(e.height-t)?i:e})):h.reduce((function(e,i){return Math.abs(i.width-t)<Math.abs(e.width-t)?i:e}))).extension=e.indexOf(".m3u8")>=0?"m3u8":"mp4";var S="_{width}x{height}{suffix}.{extension}";y&&(S="_{height}x{width}{suffix}.{extension}");var E=n;return o&&o.urlOptimizeHls&&(E=a),e.match(E)?e.replace(E,s(S,_)):e.match(r)?e.replace(r,s(S,_)):e},getCaptionsSource:function(e){return e.match(d)?e.match(n)?{src:e.replace(n,"_cc.vtt"),srclang:"en"}:e.match(r)?{src:e.replace(r,"_cc.vtt"),srclang:"en"}:null:null},getThumbnailImageSource:function(e){return e.match(h)?{url:e.replace(o,"_thumbnails.jpg")}:null}}},2577:function(e,t,i){"use strict";e.exports=[{width:480,height:480,type:"medium",suffix:""},{width:540,height:540,type:"medium",suffix:""},{width:720,height:720,type:"large",suffix:"h"},{width:720,height:720,type:"large",suffix:"l"},{width:1080,height:1080,type:"large",suffix:"l"},{width:1080,height:1080,type:"large",suffix:"h"}]},2578:function(e,t,i){"use strict";e.exports=[{width:640,height:360,type:"medium",suffix:"h"},{width:848,height:480,type:"large",suffix:""},{width:960,height:540,type:"large",suffix:""},{width:1280,height:720,type:"large",suffix:"h"},{width:1280,height:720,type:"large",suffix:"l"},{width:1920,height:1080,type:"large",suffix:"l"},{width:1920,height:1080,type:"large",suffix:"h"}]},2579:function(e,t,i){"use strict";e.exports=[{width:480,height:200,type:"medium",suffix:"h"},{width:768,height:320,type:"large",suffix:""},{width:960,height:400,type:"large",suffix:""},{width:1536,height:640,type:"large",suffix:"h"},{width:1536,height:640,type:"large",suffix:"l"},{width:1920,height:800,type:"large",suffix:"l"},{width:1920,height:800,type:"large",suffix:"h"}]},2580:function(e,t,i){"use strict";e.exports=[{width:812,height:375,type:"medium",suffix:"h"},{width:1082,height:500,type:"large",suffix:""},{width:1218,height:563,type:"large",suffix:""},{width:1624,height:750,type:"large",suffix:"h"},{width:1624,height:750,type:"large",suffix:"l"},{width:2436,height:1126,type:"large",suffix:"l"},{width:2436,height:1126,type:"large",suffix:"h"}]},2581:function(e,t,i){function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var r=i(2358),n=i(2451),a=i(2365).os,o=a.ios||a.android||!i(2434)(),l=function(e){var t,i;function r(t){var i;return i=e.call(this,t)||this,t.threesixty&&i.el.classList.add("threesixty-video"),i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,s(t,i);var a=r.prototype;return a._bindMethods=function(){e.prototype._bindMethods.call(this),this._showCompass=this._showCompass.bind(this),this._hideCompass=this._hideCompass.bind(this),this.panToOrigin=this.panToOrigin.bind(this)},a._addEventListeners=function(){e.prototype._addEventListeners.call(this)},a._removeEventListeners=function(){e.prototype._removeEventListeners.call(this),this.controls.compass.removeEventListener("click",this.panToOrigin)},a._showCompass=function(){this.el.classList.add("threesixty-ui")},a._hideCompass=function(){this.el.classList.remove("threesixty-ui")},a._instantiateDefaultCustomUIControls=function(){return this.controls=this._controlsFactory.create({player:this,endState:this.options.endState,threesixty:!0,enableMainControls:!0,basePath:this.options.localizationBasePath,template:this.options.template,readyCallback:function(){this.options.autoplay&&!o||this._showStartState(),this.trigger("controlsready")}.bind(this)}),this.controls.el.parentNode!==this.el&&this.el.appendChild(this.controls.el),this._videoImpl.setControls(!1),this._createBlockade(),this._controlsInteraction=n({player:this,keyboardControl:this._keyboardControl,threesixty:!0,controlsTimeoutDuration:this.options.controlsTimeoutDuration,threesixtyElementsTimeoutDuration:this.options.threesixtyElementsTimeoutDuration,showControls:this._showControls,hideControls:this._hideControls,raiseControls:this._raiseControls,lowerControls:this._lowerControls,showCompass:this._showCompass,hideCompass:this._hideCompass,controlsVisible:function(){return this._controlsVisible}.bind(this),sendMouseDown:this._videoImpl.sendMouseDown,elementEmitter:this._elementEmitter}),this.controls},a.panToOrigin=function(){this.get360().panToPosition({lat:0,lon:0})},a.get360=function(){return this._videoImpl.get360()},a.getFullScreenElement=function(){return this.el},a.getFullScreenEnabled=function(){return!o&&e.prototype.getFullScreenEnabled.call(this)},r}(r);e.exports=l},2582:function(e,t,i){},2597:function(e,t,i){"use strict";i.r(t),i.d(t,"VideoPlayerWrapper",(function(){return j}));var s=i(1238),r=i(1291),n=i.n(r),a=(i(2353),i(2682));function o(e,t,i){s.useEffect((function(){if(e)return e.on(t,i),function(){e.off(t,i)}}),[e,t,i])}var l=i(2357),h='\n<div class="controls-container">\n\t<div class="center-button-container {elementClassPrefix}-play-pause-button-container">\n\t\t<div class="button-wrapper">\n\t\t\t<button type="button" class="ac-video-icon centered-button {elementClassPrefix}-play-pause-button {elementClassPrefix}-button no-autoplay" value="{playpause}" aria-label="{playpause}" role="button" tabindex="0" data-acv-active-area data-acv-draggable-area>\n\t\t\t\t<div class="loading-indicator-container"></div>\n\t\t\t</button>\n\t\t\t<span id=\'loading-status\' class="visuallyhidden" aria-live=\'polite\' style="display: none;"></span>\n\t\t</div>\n\t</div>\n\t<div class="main-controls-container">\n\t\t<div class="ac-video-overlay-container"></div>\n\t\t<div class="main-controls">\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<div class="main-controls-item controls-volume">\n\t\t\t\t\t<button type="button" class="ac-video-icon {elementClassPrefix}-toggle-mute-volume-button {elementClassPrefix}-button" value="{togglemutevolume}" aria-label="{togglemutevolume}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t\t\t<div class="{elementClassPrefix}-volume-level-indicator" tabindex="0" aria-valuemin="0" aria-valuemax="100" min="0" max="100" aria-label="{adjustvolume}" role="slider" aria-orientation="vertical" step="0.05" data-acv-active-area></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="main-controls-item controls-progress">\n\t\t\t\t<div class="controls-progress-time controls-progress-time-1">\n\t\t\t\t\t<div class="{elementClassPrefix}-elapsed-time-indicator" role="text" tabindex="-1">\n\t\t\t\t\t\t<span class="label">{elapsed}</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-elapsed-time">00:00</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-time-maxwidth" aria-hidden="true">44:44</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="controls-progress-bar">\n\t\t\t\t\t<div class="{elementClassPrefix}-buffered-indicator"></div>\n\t\t\t\t\t<div class="{elementClassPrefix}-progress-indicator ac-slider-inactive" aria-label="progress-indicator" role="slider" precision="float" min="0" max="1" step="0.0005" value="0" tabindex="0" aria-valuemax="1" aria-valuemin="0" aria-valuenow="{value}" data-acv-active-area></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="controls-progress-time controls-progress-time-2">\n\t\t\t\t\t<div class="{elementClassPrefix}-remaining-time-indicator" role="text" tabindex="-1">\n\t\t\t\t\t\t<span class="label">{remaining}</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-remaining-time">-00:00</span>\n\t\t\t\t\t\t<span class="{elementClassPrefix}-time-maxwidth" aria-hidden="true">-44:44</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="button-wrapper">\n\t\t\t\t<button type="button" class="ac-video-icon main-controls-item {elementClassPrefix}-full-screen-button {elementClassPrefix}-button fullscreen-unsupported" value="{fullscreen}" aria-label="{fullscreen}" role="button" tabindex="0" data-acv-active-area></button>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\t<div class="end-state-wrapper">\n\t\t<div class="end-state-container"></div>\n\t</div>\n</div>\n',d=(i(2582),"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==");l.Player.prototype._onError=function(e){var t=this._videoImpl&&this._videoImpl.getError(),i=this._videoImpl&&this.getMediaElement();i&&i.currentTime>0||this._vpv_receivedVideoPlayerError&&this._vpv_receivedVideoPlayerError({error:t,event:e})},l.Player.prototype._onPlayPromiseError=function(e){var t=this._videoImpl&&this._videoImpl.getError();this._vpv_receivedVideoPlayerError&&this._vpv_receivedVideoPlayerError({error:t,event:e})};var c=l.Player.prototype.isStalled;l.Player.prototype.isStalled=function(){if(this._videoImpl._hls)return this._videoImpl.isStalled();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return c.apply(this,t)};var u=l.Player.prototype.destroy;l.Player.prototype.destroy=function(){for(var e=this,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];setTimeout((function(){e._actuallyDestroy.apply(e,i)}),1e3)},l.Player.prototype._actuallyDestroy=function(){if(!this._photos_isDestroyed){this._photos_isDestroyed=!0;var e=this._videoImpl&&this._videoImpl._listeners;e&&(e.webkitbeginfullscreen||(e.webkitbeginfullscreen=[]),e.webkitendfullscreen||(e.webkitendfullscreen=[]));for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return u.apply(this,i)}};var f,p,g=i(1308);function m(){m=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(L){o=function(e,t,i){return e[t]=i}}function l(e,t,i,s){var r=t&&t.prototype instanceof c?t:c,n=Object.create(r.prototype),a=new w(s||[]);return n._invoke=function(e,t,i){var s="suspendedStart";return function(r,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===r)throw n;return{value:void 0,done:!0}}for(i.method=r,i.arg=n;;){var a=i.delegate;if(a){var o=T(a,i);if(o){if(o===d)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===s)throw s="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s="executing";var l=h(e,t,i);if("normal"===l.type){if(s=i.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(s="completed",i.method="throw",i.arg=l.arg)}}}(e,i,a),n}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(L){return{type:"throw",arg:L}}}e.wrap=l;var d={};function c(){}function u(){}function f(){}var p={};o(p,r,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(I([])));y&&y!==t&&i.call(y,r)&&(p=y);var v=f.prototype=c.prototype=Object.create(p);function _(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var s;this._invoke=function(r,n){function a(){return new t((function(s,a){!function s(r,n,a,o){var l=h(e[r],e,n);if("throw"!==l.type){var d=l.arg,c=d.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){s("next",e,a,o)}),(function(e){s("throw",e,a,o)})):t.resolve(c).then((function(e){d.value=e,a(d)}),(function(e){return s("throw",e,a,o)}))}o(l.arg)}(r,n,s,a)}))}return s=s?s.then(a,a):a()}}function T(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var s=h(i,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,d;var r=s.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function I(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,n=function t(){for(;++s<e.length;)if(i.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:D}}function D(){return{value:void 0,done:!0}}return u.prototype=f,o(v,"constructor",f),o(f,"constructor",u),u.displayName=o(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===u||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},_(b.prototype),o(b.prototype,n,(function(){return this})),e.AsyncIterator=b,e.async=function(t,i,s,r,n){void 0===n&&(n=Promise);var a=new b(l(t,i,s,r),n);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(v),o(v,a,"Generator"),o(v,r,(function(){return this})),o(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var s=t.pop();if(s in e)return i.value=s,i.done=!1,i}return i.done=!0,i}},e.values=I,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(i,s){return a.type="throw",a.arg=e,t.next=i,s&&(t.method="next",t.arg=void 0),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=i.call(n,"catchLoc"),l=i.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),E(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var s=i.completion;if("throw"===s.type){var r=s.arg;E(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:I(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function y(e,t,i,s,r,n,a){try{var o=e[n](a),l=o.value}catch(h){return void i(h)}o.done?t(l):Promise.resolve(l).then(s,r)}function v(e){return function(){var t=this,i=arguments;return new Promise((function(s,r){var n=e.apply(t,i);function a(e){y(n,s,r,a,o,"next",e)}function o(e){y(n,s,r,a,o,"throw",e)}a(void 0)}))}}function _(){return f||(f=function(){return b.apply(this,arguments)}())}function b(){return(b=v(m().mark((function e(){var t,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.e(4).then(i.bind(null,2749));case 3:return t=e.sent,s=t.shimHls,window.Hls=s(),a.b.instance.report("staticHlsJsLoadSuccess"),e.abrupt("return",g.Result.success(void 0));case 10:return e.prev=10,e.t0=e.catch(0),a.b.instance.report("staticHlsJsLoadFailure"),e.abrupt("return",g.Result.failure(void 0));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function T(){T=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function o(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(L){o=function(e,t,i){return e[t]=i}}function l(e,t,i,s){var r=t&&t.prototype instanceof c?t:c,n=Object.create(r.prototype),a=new w(s||[]);return n._invoke=function(e,t,i){var s="suspendedStart";return function(r,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===r)throw n;return{value:void 0,done:!0}}for(i.method=r,i.arg=n;;){var a=i.delegate;if(a){var o=b(a,i);if(o){if(o===d)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===s)throw s="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s="executing";var l=h(e,t,i);if("normal"===l.type){if(s=i.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(s="completed",i.method="throw",i.arg=l.arg)}}}(e,i,a),n}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(L){return{type:"throw",arg:L}}}e.wrap=l;var d={};function c(){}function u(){}function f(){}var p={};o(p,r,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(I([])));m&&m!==t&&i.call(m,r)&&(p=m);var y=f.prototype=c.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){var s;this._invoke=function(r,n){function a(){return new t((function(s,a){!function s(r,n,a,o){var l=h(e[r],e,n);if("throw"!==l.type){var d=l.arg,c=d.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){s("next",e,a,o)}),(function(e){s("throw",e,a,o)})):t.resolve(c).then((function(e){d.value=e,a(d)}),(function(e){return s("throw",e,a,o)}))}o(l.arg)}(r,n,s,a)}))}return s=s?s.then(a,a):a()}}function b(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var s=h(i,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,d;var r=s.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function I(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,n=function t(){for(;++s<e.length;)if(i.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:D}}function D(){return{value:void 0,done:!0}}return u.prototype=f,o(y,"constructor",f),o(f,"constructor",u),u.displayName=o(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===u||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},v(_.prototype),o(_.prototype,n,(function(){return this})),e.AsyncIterator=_,e.async=function(t,i,s,r,n){void 0===n&&(n=Promise);var a=new _(l(t,i,s,r),n);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(y),o(y,a,"Generator"),o(y,r,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var s=t.pop();if(s in e)return i.value=s,i.done=!1,i}return i.done=!0,i}},e.values=I,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(i,s){return a.type="throw",a.arg=e,t.next=i,s&&(t.method="next",t.arg=void 0),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r],a=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=i.call(n,"catchLoc"),l=i.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),E(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var s=i.completion;if("throw"===s.type){var r=s.arg;E(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:I(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function S(e,t,i,s,r,n,a){try{var o=e[n](a),l=o.value}catch(h){return void i(h)}o.done?t(l):Promise.resolve(l).then(s,r)}function E(e){return function(){var t=this,i=arguments;return new Promise((function(s,r){var n=e.apply(t,i);function a(e){S(n,s,r,a,o,"next",e)}function o(e){S(n,s,r,a,o,"throw",e)}a(void 0)}))}}!function(e){e.Unloaded="unloaded",e.Loading="loading",e.Loaded="loaded",e.FailedToLoad="failedtoload"}(p||(p={}));var w=i(2354),I=i.n(w),D=i(1450),L=i(1445);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var R,C=Boolean(document.createElement("video").canPlayType("application/vnd.apple.mpegurl"));function A(e){var t=e.wantsVideoPlayer,i=void 0===t||t,r=e.urlInfos,n=e._canUseHlsNative,a=void 0===n?C:n,o=s.useState(R.UNLOADED),l=o[0],h=o[1],d=s.useState(),c=d[0],u=d[1],f=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=s.useState(p.Unloaded),i=t[0],r=t[1];return s.useEffect((function(){E(T().mark((function t(){return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(i===p.Unloaded){t.next=4;break}return t.abrupt("return");case 4:return r(p.Loading),t.next=7,_();case 7:t.sent.ok?r(p.Loaded):r(p.FailedToLoad);case 9:case"end":return t.stop()}}),t)})))()}),[i,e]),i}(r.some((function(e){return"HLS"===e.slot})));return s.useEffect((function(){if(i){for(var e,t=function(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"===typeof e)return k(e,void 0);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?k(e,void 0):void 0}}(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(r);!(e=t()).done;){var s=e.value,n=s.slot,o=s.utType;if("HLS"!==n)return Object(D.a)(o,L.b.Audio)?(h(R.AUDIO),void u(s)):(h(R.CRABS),void u(s));if(f!==p.FailedToLoad){if(f===p.Unloaded||f===p.Loading)return;if(I.a.isSupported())return h(R.HLS_JS),void u(s);if(a)return h(R.HLS_NATIVE),void u(s)}}h(R.UNABLE),u(void 0)}else h(R.UNLOADED)}),[i,f,a,r]),{playbackMode:l,urlInfo:c,unloadVideoPlayer:s.useCallback((function(){h(R.UNLOADED),u(void 0)}),[])}}function P(e){var t=s.useMemo((function(){switch(e){case R.HLS_JS:return function(){var e=window._PhotosEnableHlsLogging;return l.Player.create({hls:!0,poster:d,template:h,debugHls:e,enablePerformanceLogging:e,useNativeHls:!1,forceEnglishLabels:!0,autoplay:!1})}();case R.HLS_NATIVE:case R.CRABS:case R.AUDIO:return l.Player.create({hls:!1,poster:d,template:h,forceEnglishLabels:!0,autoplay:!1});default:return}}),[e]);return s.useEffect((function(){return function(){null==t||t.destroy()}}),[t]),t}!function(e){e.CRABS="crabs",e.HLS_NATIVE="hlsNative",e.HLS_JS="hlsJs",e.AUDIO="audio",e.UNABLE="unable",e.UNLOADED="loading"}(R||(R={}));var x=i(1647),M=i(1444),O=i(2634),N=i(1763);function F(e){var t,i,s,r;return{videoPlayerErrorType:e.event.type,videoPlayerErrorDetails:e.event.details,videoPlayerErrorIsFatal:e.event.fatal,videoPlayerErrorResponseStatus:null==(t=e.event)||null==(i=t.response)?void 0:i.code,videoPlayerErrorResponseText:null==(s=e.event)||null==(r=s.response)?void 0:r.text,_Photos_hls_interception:e._Photos_hls_interception}}var B,U,V=i(1921),$=i(1920),G=i(1950);!function(e){e.UnableToPlay="unabletoplay"}(B||(B={})),function(e){e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(U||(U={}));var H=function(e){var t=e.asset,i=e.master,r=e.className,l=e.isOnScreen,h=e.onVideoError,d=e.onVideoPlay,c=e.onVideoSeeked,u=e.onSetVideoUrl,f=e.urlInfos,p=e.loadingLocKey,g=s.useRef(null),m=s.useState(!1),y=m[0],v=m[1],_=s.useState(!1),b=_[0],T=_[1],S=s.useState(!1),E=S[0],w=S[1];s.useEffect((function(){b&&w(!0)}),[b]),s.useEffect((function(){v(!1)}),[f]);var I=s.useRef(0),D=A({wantsVideoPlayer:!0,urlInfos:s.useMemo((function(){return y?f.filter((function(e){return"HLS"!==e.slot})):f}),[f,y])}),L=D.urlInfo,k=D.playbackMode,H=D.unloadVideoPlayer,K=L&&L.url;s.useEffect((function(){null==u||u(K||"")}),[K,u]);var j=P(k),W=function(e){var t=e.videoPlayer,i=e.url,r=e.resumePlaybackTimestampRef,n=s.useState(!1),a=n[0],l=n[1];s.useEffect((function(){var e;t&&i&&(l(!1),t.load([i],[],null!=(e=null==r?void 0:r.current)?e:0),r&&(r.current=0))}),[t,i,r]);var h=s.useCallback((function(){t&&i&&setTimeout((function(){l(!0)}),10)}),[i,t]);return o(t,"loadeddata",h),a}({videoPlayer:j,url:K});(function(e,t){var i=a.b.instance,r=s.useRef(!1),n=s.useRef(NaN),l=Object(N.a)(t),h=s.useRef(!1),d=Object(N.a)(e),c=s.useCallback((function(){var e=l.current;e.playbackMode!==R.UNABLE&&e.playbackMode!==R.UNLOADED&&(r.current=e.isOnScreen,n.current=Date.now(),h.current=!0)}),[l]),u=s.useCallback((function(){var e=l.current;if(h.current=!1,e.playbackMode!==R.UNABLE&&e.playbackMode!==R.UNLOADED){var t=function(e){if(e.asset&&e.master){var t=e.playbackMode,i=e.asset,s=e.master,r=e.isOnScreen,n=e.wasOnscreen,a=e.timeToFirstFrame,o=e.videoLength,l=r?1:0,h=n?1:0,d=e.crabsRecoveryMode,c=e.urlInfo;if(c){var u={derivativeTimeToFirstFrame:a,derivativeMIMETypeForWebClient:c.mimeType,derivativeOffscreeninessAtSend:l,derivativeOffscreeninessAtReceipt:h,derivativeRequestReportProbability:1,videoPlaybackMode:t,recoveryMode:d},f=c.slot,p=r?x.a.OneUpMainDisplay:x.a.OneUpMainDisplayPrefetch;if("HLS"!==f&&"Original"!==f){var g,m="res"+f+"Res",y=null!=(g=i.fields[m])?g:s.fields[m],v=(null==y?void 0:y.size)||0,_=Object(M.a)(v),b=8*Object(M.a)(v/o)/1e6;return Object.assign({},u,{derivativeApproxByteSize:_,derivativeBitrateMbps:b},Object(O.b)(s,p,c))}return Object.assign({},u,{derivativeNameNominal:f,derivativeRequestReason:p})}}}(Object.assign({},e,{wasOnscreen:r.current,timeToFirstFrame:Date.now()-n.current,videoLength:d.current.getDuration()}));t&&Object(M.b)(Object.assign({reportStatFn:i.report},t))}}),[i,l,d]),f=s.useCallback((function(){if(h.current){var e=l.current;e.playbackMode!==R.UNABLE&&e.playbackMode!==R.UNLOADED&&i.report("cvwsRequestFailure",{})}}),[i,l]);o(e,"loadstart",c),o(e,"loadeddata",u),o(e,"error",f)})(j,{asset:t,master:i,playbackMode:k,urlInfo:L,crabsRecoveryMode:y,isOnScreen:l}),function(e){var t=s.useCallback((function(){e&&setTimeout((function(){e._onStart()}),10)}),[e]);o(e,"controlsready",t),s.useEffect((function(){null!=e&&e.controls&&e._onStart()}),[e])}(j),function(e,t){s.useEffect((function(){e&&!t&&(e.pause(),e.seek(0))}),[t,e])}(j,l),s.useEffect((function(){var e=g.current;if(j&&e)return j.appendTo(e),function(){j.pause(),j.seek(0),j.el.remove()}}),[g,j]);var q=a.b.instance,z=s.useCallback((function(e){Object($.b)(e,[{keyCode:$.a.Space},{keyCode:$.a.Enter}])&&(e.preventDefault(),j&&(b?j.pause():j.play()))}),[b,j]);Object(V.a)("keydown",document.body,z);var Y=s.useRef(!1),X=s.useCallback((function(){Y.current||(q.report("videoPlayerStart"),Y.current=!0)}),[q]),Q=s.useCallback((function(){X(),d&&(T(!0),d())}),[d,X]),J=s.useCallback((function(){T(!1)}),[]),Z=s.useCallback((function(){c&&c()}),[c]);o(j,"play",Q),o(j,"pause",J),o(j,"seeked",Z);var ee=Object(N.a)(W),te=Object(N.a)(q);s.useEffect((function(){return function(){ee.current&&!Y.current&&te.current.report("videoPlayerPreloadUnused")}}),[]);var ie=s.useRef(NaN),se=s.useRef(!1),re=s.useCallback((function(e){if(!se.current&&e.currentTime>0){se.current=!0;var t=performance.now()-ie.current;q.report("videoPlaybackTiming",{videoPlaybackMode:k,recoveryMode:y,millisecondsSinceButtonPressed:t})}}),[y,k,q]);o(j,"timeupdate",re),s.useEffect((function(){Y.current=!1,se.current=!1}),[j]),s.useEffect((function(){var e;k===R.UNABLE&&(q.report("videoPlayerUnableToPlay",{type:B.UnableToPlay,fileTypes:f.map((function(e){return e.utType})).join(", "),recoveryMode:y,hasWindowHls:!!window.Hls,hlsIsSupported:null==(e=window.Hls)||null==e.isSupported?void 0:e.isSupported(),canUseHlsNative:C}),h())}),[y,q,f,h,k]);var ne=s.useCallback((function(e){if(e.event&&e._Photos_hls_interception&&("networkError"===e.event.type||"mediaError"===e.event.type))y||k!==R.HLS_JS||(j&&(I.current=j.getCurrentTime()),v(!0),H(),q.report("videoPlayerReload",Object.assign({currentTimeRecoverable:Boolean(I.current)},F(e))));else if(void 0===e._Photos_hls_interception&&e.error){var t=e.error,i=null==L?void 0:L.slot;q.report("videoPlayerError",Object.assign({videoElementErrorType:U[t.code],videoElementErrorMessage:t&&t.message||"",videoPlaybackMode:k,derivativeNameNominal:i},F(e))),h()}}),[y,k,j,H,q,L,h]);return s.useEffect((function(){if(j){j._vpv_receivedVideoPlayerError=ne;var e={_receivedVideoPlayerError:ne};if(void 0!==j._Photos_vpvOwner)throw new Error("Ownership error: video player is already owned by a different container");return j._Photos_vpvOwner=e,window.Hls&&(window.Hls._Photos_vpvOwner=e),function(){j._Photos_vpvOwner=void 0,j._vpv_receivedVideoPlayerError=void 0,window.Hls&&(window.Hls._Photos_vpvOwner=void 0)}}}),[ne,j]),s.createElement(s.Fragment,null,!W&&s.createElement(G.a,{locKey:p}),s.createElement("div",{className:n()("ACVideoPlayer",r,{loaded:W,"always-show-progress-bar":!E}),ref:g}))};function K(){return(K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var j=function(e){var t=s.useState("video"),i=t[0],r=t[1],n=e.onVideoError,a=e.onVideoPlay,o=e.onVideoSeeked,l=e.urlInfos,h=e.isVideoElementHidden,d=s.useCallback((function(){r("error"),n()}),[n]);s.useEffect((function(){r("video")}),[l]);var c=h?"has-hidden-video-element":void 0;switch(i){case"video":return s.createElement(H,K({className:c},e,{onVideoError:d,onVideoPlay:a,onVideoSeeked:o}));case"error":return s.createElement(s.Fragment,null)}}}}]);